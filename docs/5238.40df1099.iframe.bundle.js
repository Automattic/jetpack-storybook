"use strict";(()=>{var Ze=Object.defineProperty;var Be=(d,l,a)=>l in d?Ze(d,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[l]=a;var oe=(d,l,a)=>(Be(d,typeof l!="symbol"?l+"":l,a),a);(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[5238],{"../../plugins/protect/src/js/hooks/use-protect-data/index.js":(d,l,a)=>{a.d(l,{Z:()=>_});var U=a("../../../node_modules/.pnpm/@wordpress+data@9.15.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),S=a("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),o=a("../../plugins/protect/src/js/state/store.js");function _(){const{statusIsFetching:k,status:s,jetpackScan:A,hasRequiredPlan:y}=(0,U.Z)(r=>({statusIsFetching:r(o.t).getStatusIsFetching(),status:r(o.t).getStatus(),jetpackScan:r(o.t).getJetpackScan(),hasRequiredPlan:r(o.t).hasRequiredPlan()}));let p="error";k===!0?p="loading":s.status&&(p=s.status);const E=(0,S.useMemo)(()=>{var r,i;return((i=(r=s.core)==null?void 0:r.threats)==null?void 0:i.length)||0},[s.core]),h=(0,S.useMemo)(()=>(s.plugins||[]).reduce((r,i)=>r+i.threats.length,0),[s.plugins]),g=(0,S.useMemo)(()=>(s.themes||[]).reduce((r,i)=>r+i.threats.length,0),[s.themes]),I=(0,S.useMemo)(()=>{var r;return((r=s.files)==null?void 0:r.length)||0},[s.files]),f=(0,S.useMemo)(()=>{var r;return((r=s.database)==null?void 0:r.length)||0},[s.database]);return{numThreats:E+h+g+I+f,numCoreThreats:E,numPluginsThreats:h,numThemesThreats:g,numFilesThreats:I,numDatabaseThreats:f,lastChecked:s.lastChecked||null,errorCode:s.errorCode||null,errorMessage:s.errorMessage||null,core:s.core||{},plugins:s.plugins||[],themes:s.themes||[],files:{threats:s.files||[]},database:{threats:s.database||[]},currentStatus:p,hasUncheckedItems:s.hasUncheckedItems,jetpackScan:A,hasRequiredPlan:y}}},"../../plugins/protect/src/js/state/store.js":(d,l,a)=>{a.d(l,{t:()=>ce,N:()=>He});var U=a("../../../node_modules/.pnpm/camelize@1.0.1/node_modules/camelize/index.js"),S=a.n(U),o=a("../../../node_modules/.pnpm/@wordpress+api-fetch@6.42.0/node_modules/@wordpress/api-fetch/build-module/index.js"),_=a("../../../node_modules/.pnpm/@wordpress+i18n@4.45.0/node_modules/@wordpress/i18n/build-module/index.js");const k=_._n,s=_.__,A="SET_CREDENTIALS_STATE_IS_FETCHING",y="SET_CREDENTIALS_STATE",p="SET_STATUS",E="SET_STATUS_PROGRESS",h="START_SCAN_OPTIMISTICALLY",g="SET_STATUS_IS_FETCHING",I="SET_SCAN_IS_UNAVAILABLE",f="SET_SCAN_IS_ENQUEUING",F="SET_INSTALLED_PLUGINS",r="SET_INSTALLED_THEMES",i="SET_WP_VERSION",O="SET_JETPACK_SCAN",Ve="SET_PRODUCT_DATA",G="SET_THREAT_IS_UPDATING",b="SET_THREATS_ARE_FIXING",v="SET_MODAL",x="SET_NOTICE",M="CLEAR_NOTICE",H="SET_HAS_REQUIRED_PLAN",Z="SET_WAF_IS_SEEN",B="SET_WAF_UPGRADE_IS_SEEN",V="SET_WAF_IS_ENABLED",J="SET_WAF_IS_UPDATING",q="SET_WAF_IS_TOGGLING",z="SET_WAF_CONFIG",K="SET_WAF_STATS",$=e=>({type:p,status:e}),ue=e=>({type:E,currentProgress:e}),Q=()=>({type:h}),le=()=>({dispatch:e})=>{(0,o.Z)({path:"jetpack-protect/v1/check-plan",method:"GET"}).then(t=>e(ne(t)))},Y=e=>(0,o.Z)({path:`jetpack-protect/v1/status${e?"?hard_refresh=true":""}`,method:"GET"}),P=(e=!1)=>async({dispatch:t})=>(t(j(!0)),await new Promise((n,c)=>Y(e).then(X).then(u=>{t(te(u.status==="unavailable")),t($(S()(u))),n(u)}).catch(u=>{c(u)}).finally(()=>{t(j(!1))}))),X=(e,t=0)=>new Promise((n,c)=>{e.status==="unavailable"&&t<3?Y(!0).then(u=>{setTimeout(()=>{X(u,t+1).then(C=>n(C)).catch(C=>c(C))},5e3)}).catch(c):n(e)}),ie=()=>async({dispatch:e})=>await new Promise((t,n)=>(e(R(!0)),(0,o.Z)({path:"jetpack-protect/v1/check-credentials",method:"POST"}).then(c=>{e(ee(c)),t(c)}).catch(c=>{n(c)}).finally(()=>{e(R(!1))}))),R=e=>({type:A,isFetching:e}),ee=e=>({type:y,credentials:e}),j=e=>({type:g,status:e}),te=e=>({type:I,status:e}),W=e=>({type:f,isEnqueuing:e}),Se=e=>({type:F,plugins:e}),Te=e=>({type:r,themes:e}),de=e=>({type:i,version:e}),pe=e=>({type:O,scan:e}),N=(e,t)=>({type:G,payload:{threatId:e,isUpdating:t}}),L=e=>({type:b,threatIds:e}),_e=(e,t=()=>{})=>async({dispatch:n})=>(n(N(e,!0)),await new Promise(()=>(0,o.Z)({path:`jetpack-protect/v1/ignore-threat?threat_id=${e}`,method:"POST"}).then(()=>n(P())).then(()=>n(T({type:"success",message:s("Threat ignored","jetpack-protect")}))).catch(()=>n(T({type:"error",message:s("An error ocurred ignoring the threat.","jetpack-protect")}))).finally(()=>{n(N(e,!1)),t()}))),se=e=>async({dispatch:t})=>{const n=e.reduce((c,u)=>`${c}threat_ids[]=${u}&`,"jetpack-protect/v1/fix-threats-status?");return t(L(e)),await(0,o.Z)({path:n,method:"GET"}).then(async c=>{const u=Object.values(c.threats);if(u.filter(D=>D.status==="in_progress").length>0)return await new Promise(()=>{setTimeout(()=>{t(se(e))},1e3)});if(!u.filter(D=>D.status==="fixed").length===e.length)throw"Not all threats could be fixed."}).then(()=>{t(P()),t(T({type:"success",message:(0,_.gB)(k("%s threat was fixed successfully","%s threats were fixed successfully",e.length,"jetpack-protect"),e.length)}))}).catch(()=>{t(T({type:"error",message:s("Not all threats could be fixed. Please contact our support.","jetpack-protect")}))}).finally(()=>{t(L([]))})},Ee=(e,t=()=>{})=>async({dispatch:n})=>(e.forEach(c=>{n(N(c,!0))}),await new Promise(()=>(0,o.Z)({path:`jetpack-protect/v1/fix-threats?threat_ids=${e}`,method:"POST",data:{threatIds:e}}).then(()=>n(T({type:"success",message:s("We're hard at work fixing this threat in the background. Please check back shortly.","jetpack-protect")}))).then(()=>{setTimeout(()=>n(se(e)),1e3)}).catch(()=>n(T({type:"error",message:s("Error fixing threats. Please contact support.","jetpack-protect")}))).finally(()=>{e.forEach(c=>{n(N(c,!1))}),t()}))),he=(e=()=>{})=>async({dispatch:t})=>(t(W(!0)),await new Promise(()=>(0,o.Z)({path:"jetpack-protect/v1/scan",method:"POST"}).then(()=>{t(Q()),setTimeout(()=>t(P(!0)),5e3)}).catch(()=>t(T({type:"error",message:s("An error ocurred enqueuing the scan","jetpack-protect")}))).finally(()=>{t(W(!1)),e()}))),ge=e=>({type:v,payload:e}),T=e=>({type:x,payload:e}),Ie=()=>({type:M}),ne=e=>({type:H,hasRequiredPlan:e}),re={checkCredentials:ie,setCredentials:ee,setCredentialsIsFetching:R,setStatus:$,setStatusProgress:ue,startScanOptimistically:Q,refreshStatus:P,setStatusIsFetching:j,setScanIsEnqueuing:W,setInstalledPlugins:Se,setInstalledThemes:Te,setwpVersion:de,setJetpackScan:pe,ignoreThreat:_e,setModal:ge,setNotice:T,clearNotice:Ie,fixThreats:Ee,scan:he,setThreatsAreFixing:L,refreshPlan:le,setHasRequiredPlan:ne,setScanIsUnavailable:te,setWafIsEnabled:e=>({type:V,isEnabled:e}),setWafIsSeen:e=>({type:Z,isSeen:e}),setWafUpgradeIsSeen:e=>({type:B,upgradeIsSeen:e}),setWafIsUpdating:e=>({type:J,isUpdating:e}),setWafIsToggling:e=>({type:q,isToggling:e}),setWafConfig:e=>({type:z,config:e}),setWafStats:e=>({type:K,stats:e})};var ae=a("../../../node_modules/.pnpm/@wordpress+data@9.15.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const fe=(e=null,t)=>{switch(t.type){case y:return t.credentials}return e},me=(e=!1,t)=>{switch(t.type){case A:return t.isFetching}return e},Ae=(e={},t)=>{switch(t.type){case p:return t.status;case E:return{...e,currentProgress:t.currentProgress};case h:return{...e,currentProgress:0,status:"optimistically_scanning"}}return e},ye=(e=!1,t)=>{switch(t.type){case g:return t.status}return e},Pe=(e=!1,t)=>{switch(t.type){case I:return t.status}return e},Ne=(e=!1,t)=>{switch(t.type){case f:return t.isEnqueuing}return e},we=(e={},t)=>{switch(t.type){case F:return t.plugins}return e},Ce=(e={},t)=>{switch(t.type){case r:return t.themes}return e},Ue=(e={},t)=>{switch(t.type){case i:return t.version}return e},ke=(e={},t)=>{switch(t.type){case O:return t.scan}return e},Fe=(e={},t)=>{switch(t.type){case G:return{...e,[t.payload.threatId]:t.payload.isUpdating}}return e},Re=(e=[],t)=>{switch(t.type){case b:return t.threatIds}return e},je=(e={},t)=>{switch(t.type){case v:return{...e,...t.payload}}return e},We=(e={},t)=>{switch(t.type){case x:return{...e,...t.payload};case M:return{}}return e},Le=(e=!1,t)=>{switch(t.type){case H:return t.hasRequiredPlan}return e},De={wafSupported:null,bruteForceSupported:null,isSeen:!1,upgradeIsSeen:!1,isEnabled:!1,isUpdating:!1,isToggling:!1,config:void 0,stats:void 0},Oe=(e=De,t)=>{switch(t.type){case Z:return{...e,isSeen:t.isSeen};case B:return{...e,upgradeIsSeen:t.upgradeIsSeen};case V:return{...e,isEnabled:t.isEnabled};case z:return{...e,config:t.config};case K:return{...e,stats:t.stats};case J:return{...e,isUpdating:t.isUpdating};case q:return{...e,isToggling:t.isToggling}}return e},Ge=(0,ae.UY)({credentials:fe,credentialsIsFetching:me,status:Ae,statusIsFetching:ye,scanIsUnavailable:Pe,scanIsEnqueuing:Ne,installedPlugins:we,installedThemes:Ce,wpVersion:Ue,jetpackScan:ke,threatsUpdating:Fe,modal:je,notice:We,setThreatsFixing:Re,hasRequiredPlan:Le,waf:Oe}),be={getJetpackScan:{isFulfilled:e=>Object.keys(e==null?void 0:e.jetpackScan).length>0,fulfill:()=>async({dispatch:e})=>{const t=await(0,o.Z)({path:"/my-jetpack/v1/site/products/scan",method:"GET"});e(re.setJetpackScan(t))}}},ve={getCredentials:e=>e.credentials||null,getCredentialsIsFetching:e=>e.credentialsIsFetching||!1,getInstalledPlugins:e=>e.installedPlugins||{},getInstalledThemes:e=>e.installedThemes||{},getStatus:e=>e.status||{},getStatusIsFetching:e=>e.statusIsFetching||!1,getScanIsUnavailable:e=>e.scanIsUnavailable||!1,getScanIsEnqueuing:e=>e.scanIsEnqueuing||!1,getWpVersion:e=>e.wpVersion||"",getJetpackScan:e=>e.jetpackScan||{},getThreatsUpdating:e=>e.threatsUpdating||{},getModalType:e=>{var t;return((t=e.modal)==null?void 0:t.type)||null},getModalProps:e=>{var t;return((t=e.modal)==null?void 0:t.props)||{}},getNotice:e=>e.notice||null,getThreatsAreFixing:e=>e.threatsAreFixing||[],hasRequiredPlan:e=>e.hasRequiredPlan||!1,getWaf:e=>e.waf};var xe=a("../../../node_modules/.pnpm/@wordpress+data@9.15.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");const m=class{static mayBeInit(t,n){m.store===null&&(m.store=(0,xe.Z)(t,n),(0,ae.z2)(m.store))}};let w=m;oe(w,"store",null);const Me=w,ce="jetpack-protect";function He(){Me.mayBeInit(ce,{__experimentalUseThunks:!0,reducer:Ge,actions:re,selectors:ve,resolvers:be,initialState:S()(window.jetpackProtectInitialState)||{}})}}}]);})();
