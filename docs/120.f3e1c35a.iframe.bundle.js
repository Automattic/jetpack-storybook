"use strict";(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[120],{"../../packages/videopress/src/client/state/constants.js":(uo,te,O)=>{O.d(te,{$A:()=>Pe,$L:()=>i,CM:()=>Re,Db:()=>Ce,Dj:()=>fe,El:()=>be,Et:()=>j,FP:()=>B,FY:()=>ie,Gr:()=>We,H:()=>ae,IN:()=>Ne,JV:()=>M,Kc:()=>D,NL:()=>ge,O1:()=>Te,Og:()=>Ie,Ps:()=>ye,QC:()=>ce,RB:()=>me,TD:()=>we,UJ:()=>Ve,Vc:()=>_e,Vm:()=>xe,Vz:()=>Ge,WJ:()=>je,W_:()=>W,Wi:()=>le,Z5:()=>Ye,ZP:()=>C,Zp:()=>H,ah:()=>Qe,b1:()=>Le,dY:()=>Ae,fi:()=>De,jV:()=>He,jc:()=>Ze,kH:()=>Me,o1:()=>Fe,p0:()=>he,pD:()=>pe,pI:()=>ke,pf:()=>Be,qP:()=>de,tH:()=>$,tT:()=>se,tb:()=>re,tw:()=>Ee,u_:()=>U,uo:()=>N,vP:()=>F,wI:()=>ve,x4:()=>$e,x_:()=>Oe,z$:()=>ue,z8:()=>Ue});const se="videopress/media",ne="/wp-admin/admin-ajax.php",D="wp/v2/users",U="wp/v2/media",ie="wpcom/v2/videopress",re="wpcom/v2/videopress/meta",de="wpcom/v2/videopress/playback-jwt",N="videopress/v1/settings",M="videopress/v1/site",ce="SET_IS_FETCHING_VIDEOS",$="SET_VIDEOS_FETCH_ERROR",fe="SET_VIDEOS_QUERY",ae="SET_VIDEOS_PAGINATION",he="SET_VIDEOS",F="SET_VIDEOS_STORAGE_USED",le="SET_UPLOADED_VIDEO_COUNT",ue="SET_IS_FETCHING_UPLOADED_VIDEO_COUNT",pe="DISMISS_FIRST_VIDEO_POPOVER",B="SET_LOCAL_VIDEOS",C="SET_IS_FETCHING_LOCAL_VIDEOS",ye="SET_LOCAL_VIDEOS_QUERY",_e="SET_LOCAL_VIDEOS_PAGINATION",W="SET_LOCAL_VIDEO_UPLOADED",i="SET_VIDEOS_FILTER",j="SET_VIDEO",ge="SET_VIDEO_PRIVACY",me="UPDATE_VIDEO_PRIVACY",Ee="DELETE_VIDEO",Ie="REMOVE_VIDEO",H="FLUSH_DELETED_VIDEOS",ve="UPDATE_PAGINATION_AFTER_DELETE",Oe="SET_VIDEO_UPLOADING",De="SET_VIDEO_PROCESSING",ke="SET_VIDEO_UPLOADED",Ae="SET_VIDEO_UPLOAD_PROGRESS",Re="SET_IS_FETCHING_PURCHASES",Ue="SET_PURCHASES",we="SET_IS_FETCHING_PLAYBACK_TOKEN",be="SET_PLAYBACK_TOKEN",Fe="EXPIRE_PLAYBACK_TOKEN",Le="SET_USERS",Ne="SET_USERS_PAGINATION",Ce="SET_UPDATING_VIDEO_POSTER",xe="UPDATE_VIDEO_POSTER",je="SET_VIDEOPRESS_SETTINGS",He="UPDATE_VIDEO_IS_PRIVATE",po=null,Pe="public",Ve="private",Te="site-default",Ge=[Pe,Ve,Te],_o=0,go=1,Me=2,mo=3,$e="G",Be="PG-13",We="R-17",Ye="uploader",Qe="rating",Ze="privacy"},"../../packages/videopress/src/client/state/index.js":(uo,te,O)=>{var eo;O.d(te,{tT:()=>i.tT});var se=O("../../../node_modules/.pnpm/debug@4.3.4/node_modules/debug/src/browser.js"),ne=O.n(se),D=O("../../../node_modules/.pnpm/@wordpress+api-fetch@6.34.0/node_modules/@wordpress/api-fetch/build-module/index.js"),U=O("../../../node_modules/.pnpm/@wordpress+url@3.38.0/node_modules/@wordpress/url/build-module/add-query-args.js"),ie=O("../../../node_modules/.pnpm/@wordpress+i18n@4.37.0/node_modules/@wordpress/i18n/build-module/index.js"),re=O("../../../node_modules/.pnpm/tus-js-client@2.3.0/node_modules/tus-js-client/lib.esm/browser/index.js");const de=ie.__,N={},M=function(){return new Promise(function(e,o){apiFetch({path:"/wpcom/v2/videopress/upload-jwt",method:"POST"}).then(t=>{e({token:t.upload_token,blogId:t.upload_blog_id,url:t.upload_url})}).catch(t=>{o(t)})})},ce=e=>{let{file:o,onProgress:t,onSuccess:s,onError:n,data:r}=e;const c=new tus.Upload(o,{onError:n,onProgress:t,endpoint:r.url,removeFingerprintOnSuccess:!0,withCredentials:!1,autoRetry:!0,overridePatchMethod:!1,chunkSize:1e7,metadata:{filename:o.name,filetype:o.type},retryDelays:[0,1e3,3e3,5e3,1e4],onAfterResponse:function(d,a){if(a.getStatus()>=400)return;const p="x-videopress-upload-guid",m="x-videopress-upload-media-id",E="x-videopress-upload-src-url",f=a.getHeader(p),h=a.getHeader(m),I=a.getHeader(E);if(f&&h&&I){s&&s({id:Number(h),guid:f,src:I},o);return}const S={"x-videopress-upload-key-token":"token","x-videopress-upload-key":"key"},P={};Object.keys(S).forEach(function(y){const k=a.getHeader(y);k&&(P[S[y]]=k)}),P.key&&P.token&&(N[P.key]=P.token)},onBeforeRequest:function(d){const a=d._method;if(["HEAD","OPTIONS"].indexOf(a)>=0&&(d._method="GET",d.setHeader("X-HTTP-Method-Override",a)),["DELETE","PUT","PATCH"].indexOf(a)>=0&&(d._method="POST",d.setHeader("X-HTTP-Method-Override",a)),d._xhr.open(d._method,d._url,!0),Object.keys(d._headers).map(function(p){d.setHeader(p,d._headers[p])}),a==="POST")if(!!r.token)d.setHeader("x-videopress-upload-token",r.token);else throw"should never happen";if(["OPTIONS","GET","HEAD","DELETE","PUT","PATCH"].indexOf(a)>=0){const E=new URL(d._url).pathname.split("/"),f=E[E.length-1];if(N[f])d.setHeader("x-videopress-upload-token",N[f]);else if(a==="HEAD")return M(f).then(h=>(N[f]=h.token,d.setHeader("x-videopress-upload-token",h.token),d))}return Promise.resolve(d)}});return c.findPreviousUploads().then(function(d){d.length&&c.resumeFromPreviousUpload(d[0]),c.start()}),c},$=e=>{const o=`videopress/v1/upload/${e}`;return new Promise((t,s)=>{(0,D.Z)({path:o,method:"POST"}).then(n=>{n.status==="uploading"||n.status==="new"||n.status==="resume"?$(e).then(t).catch(s):n.status==="complete"?t({guid:n.uploaded_details.guid,id:n.uploaded_details.media_id,src:n.uploaded_details.upload_src}):n.status==="error"?s({data:{message:n.error}}):s({data:{message:de("Unexpected error uploading video.","jetpack-videopress-pkg")}})}).catch(n=>{s({data:{message:n==null?void 0:n.message}})})})},fe=e=>{let{onError:o,onProgress:t,onSuccess:s}=e;const[n,r]=useState({}),[c,d]=useState(null);return useEffect(()=>{M().then(r).catch(p=>{d(p),o==null||o(p)})},[]),[p=>ce({file:p,onProgress:t,onSuccess:s,onError:o,data:n}),n,c]},ae=["upload","playback","upload-jwt"],he=null,F=ne()("videopress:get-media-token"),le=1e3*60*60*24,ue=function(e){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:t=0,guid:s,adminAjaxAPI:n,filename:r}=o;return new Promise(function(c,d){var m;const a=n||((m=window.videopressAjax)==null?void 0:m.ajaxUrl)||(window==null?void 0:window.ajaxurl)||"/wp-admin/admin-ajax.php";if(!ae.includes(e))return d("Invalid scope");const p={action:"videopress-get-playback-jwt"};switch(e){case"upload":p.action="videopress-get-upload-token",r&&(p.filename=r);break;case"upload-jwt":p.action="videopress-get-upload-jwt";break;case"playback":p.action="videopress-get-playback-jwt",p.guid=s,p.post_id=String(t);break}fetch(a,{method:"POST",credentials:"same-origin",body:new URLSearchParams(p)}).then(E=>{if(!E.ok)throw new Error("Network response was not ok");return E.json()}).then(E=>{if(!E.success)throw new Error("Token is not achievable");switch(e){case"upload":case"upload-jwt":c({token:E.data.upload_token,blogId:E.data.upload_blog_id,url:E.data.upload_action_url});break;case"playback":c({token:E.data.jwt});break}}).catch(()=>{console.warn("Token is not achievable"),c({token:null})})})};async function pe(e){var m;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:t=0,guid:s=0,flushToken:n}=o,r=`vpc-${e}-${t}-${s}`,c=((m=window==null?void 0:window.videopressAjax)==null?void 0:m.context)||"main";let d;const a=localStorage.getItem(r);if(n)F("(%s) Flushing %o token",c,r),localStorage.removeItem(r);else try{if(a){if(d=await JSON.parse(a),d&&d.expire>Date.now())return F("(%s) Providing %o token from the store",c,r),d.data;F("(%s) Token %o expired. Clean.",c,r),localStorage.removeItem(r)}}catch(E){F("Invalid token in the localStore")}const p=await ue(e,o);return e==="playback"&&(p!=null&&p.token)&&(F("(%s) Storing %o token",c,r),localStorage.setItem(r,JSON.stringify({data:p,expire:Date.now()+le}))),F("(%s) Providing %o token from request/response",c,r),p}const B=pe,C={},_e=e=>{let{file:o,tokenData:t,onProgress:s,onSuccess:n,onError:r}=e;const c=new re.gq(o,{onError:r,onProgress:s,endpoint:t.url,removeFingerprintOnSuccess:!0,withCredentials:!1,autoRetry:!0,overridePatchMethod:!1,chunkSize:1e7,metadata:{filename:o.name,filetype:o.type},retryDelays:[0,1e3,3e3,5e3,1e4],onBeforeRequest:function(d){const a=d._method;if(["HEAD","OPTIONS"].indexOf(a)>=0&&(d._method="GET",d.setHeader("X-HTTP-Method-Override",a)),["DELETE","PUT","PATCH"].indexOf(a)>=0&&(d._method="POST",d.setHeader("X-HTTP-Method-Override",a)),d._xhr.open(d._method,d._url,!0),Object.keys(d._headers).map(function(p){d.setHeader(p,d._headers[p])}),a==="POST")if(!!t.token)d.setHeader("x-videopress-upload-token",t.token);else throw"should never happen";if(["OPTIONS","GET","HEAD","DELETE","PUT","PATCH"].indexOf(a)>=0){const E=new URL(d._url).pathname.split("/"),f=E[E.length-1];if(C[f])d.setHeader("x-videopress-upload-token",C[f]);else if(a==="HEAD")return B("upload-jwt").then(h=>(C[f]=h.token,d.setHeader("x-videopress-upload-token",h.token),d))}return Promise.resolve(d)},onAfterResponse:function(d,a){if(a.getStatus()>=400)return;const p="x-videopress-upload-guid",m="x-videopress-upload-media-id",E="x-videopress-upload-src-url",f=a.getHeader(p),h=a.getHeader(m),I=a.getHeader(E);if(f&&h&&I){n&&n({id:Number(h),guid:f,src:I},o);return}const S={"x-videopress-upload-key-token":"token","x-videopress-upload-key":"key"},P={};Object.keys(S).forEach(function(y){const k=a.getHeader(y);k&&(P[S[y]]=k)}),P.key&&P.token&&(C[P.key]=P.token)}});return c.findPreviousUploads().then(function(d){d.length&&c.resumeFromPreviousUpload(d[0]),c.start()}),c},W=()=>{const e=new Uint32Array(10);crypto.getRandomValues(e);const o=performance.now().toString(36),t=Array.from(e).map(s=>s.toString(36)).join("");return`${o}-${t}`};var i=O("../../packages/videopress/src/client/state/constants.js");const j=e=>{const{media_details:o,id:t,jetpack_videopress:s,jetpack_videopress_guid:n}=e,{videopress:r,width:c,height:d}=o,{title:a,description:p,caption:m,rating:E,allow_download:f,display_embed:h,privacy_setting:I,needs_playback_token:S,is_private:P}=s,{original:y,poster:k,upload_date:Q,duration:Z,file_url_base:K,finished:J,files:z={dvd:{original_img:""}}}=r||{},{dvd:L}=z,X=L!=null&&L.original_img?`${K.https}${L.original_img}`:void 0,q=y==null?void 0:y.split("/").slice(-1)[0];return{id:t,guid:n,title:a,description:p,caption:m,url:y,uploadDate:Q,duration:Z,isPrivate:P,posterImage:k,allowDownload:f,displayEmbed:h,rating:E,privacySetting:I,needsPlaybackToken:S,width:c,height:d,poster:{src:k},thumbnail:X,finished:J,filename:q}},ge=e=>{var o;return(o=e==null?void 0:e.map)==null?void 0:o.call(e,j)},me=e=>{const{media_details:o,id:t,jetpack_videopress:s,source_url:n,date:r}=e,{width:c,height:d,length:a}=o,{title:p,description:m,caption:E}=s;return{id:t,title:p,description:m,caption:E,width:c,height:d,url:n,uploadDate:r,duration:a}},Ee=e=>e.map(me),Ie=(e,o)=>i.Vz[e]===i.$A?!1:i.Vz[e]===i.UJ?!0:o,H=async e=>{const o=await(0,D.Z)({path:(0,U.f)(`${i.u_}/${e==null?void 0:e.id}`)}),t=j(o);return(t==null?void 0:t.posterImage)!==null&&(t==null?void 0:t.posterImage)!==""?Promise.resolve(t):new Promise((s,n)=>{setTimeout(()=>{H(e).then(s).catch(n)},2e3)})},Do={setIsFetchingVideos:e=>({type:i.QC,isFetching:e}),setFetchVideosError:e=>({type:i.tH,error:e}),setVideosQuery:e=>({type:i.Dj,query:e}),setVideosPagination:e=>({type:i.H,pagination:e}),setVideosFilter:(e,o,t)=>({type:i.$L,filter:e,value:o,isActive:t}),setVideos:e=>({type:i.p0,videos:e}),dismissFirstVideoPopover:()=>({type:i.pD}),setLocalVideos:e=>({type:i.FP,videos:e}),setIsFetchingLocalVideos:e=>({type:i.ZP,isFetching:e}),setLocalVideosQuery:e=>({type:i.Ps,query:e}),setLocalVideosPagination:e=>({type:i.Vc,pagination:e}),setVideosStorageUsed:e=>({type:i.vP,used:e}),setVideo:function(e){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return{type:i.Et,video:e,addAtEnd:o}},setIsFetchingUploadedVideoCount:e=>({type:i.z$,isFetchingUploadedVideoCount:e}),setUploadedVideoCount:e=>({type:i.Wi,uploadedVideoCount:e}),setVideoPrivacy:e=>{let{id:o,privacySetting:t}=e;return{type:i.NL,id:o,privacySetting:t}},updateVideoPrivacy:(e,o)=>async t=>{let{dispatch:s,select:n,resolveSelect:r}=t;const c=Number(o);if(isNaN(c))throw new Error(`Invalid privacy level: '${o}'`);if(0>c||c>=i.Vz.length)throw new Error(`Invalid privacy level: '${o}'`);if(o===1){const d=await n.getVideo(e);await r.getPlaybackToken(d==null?void 0:d.guid)}s.setVideoPrivacy({id:e,privacySetting:c});try{const d=await(0,D.Z)({path:i.tb,method:"POST",data:{id:e,privacy_setting:c}});if((d==null?void 0:d.data)!==200)return;const{videoPressVideosPrivateForSite:a}=n.getVideoPressSettings();return s.updateVideoIsPrivate(e,Ie(c,a)),s({type:i.RB,id:e,privacySetting:c})}catch(d){console.error(d)}},removeVideo:e=>({type:i.Og,id:e}),deleteVideo:e=>async o=>{let{dispatch:t,select:s}=o;t.removeVideo(e);let n={type:i.tw,id:e,hasBeenDeleted:!1,video:{}};try{const c=await(0,D.Z)({path:`${i.u_}/${e}`,method:"DELETE",data:{id:e,force:!0}});c!=null&&c.deleted&&(n={...n,hasBeenDeleted:!0,video:c==null?void 0:c.previous})}catch(c){console.error(c)}finally{t(n)}s.getProcessedAllVideosBeingRemoved()&&(t({type:i.wI}),t({type:i.Zp}))},uploadVideo:e=>async o=>{let{dispatch:t}=o;const s=W(),n=()=>{};t({type:i.x_,id:s,title:e==null?void 0:e.name});const r=await B("upload-jwt");_e({tokenData:r,file:e,onError:n,onProgress:(a,p)=>{t({type:i.dY,id:s,bytesSent:a,bytesTotal:p})},onSuccess:async a=>{t({type:i.fi,id:s,data:a});const p=await H(a);t({type:i.pI,video:p})}})},uploadVideoFromLibrary:e=>async o=>{let{dispatch:t}=o;const s=W();t({type:i.x_,id:s,title:e==null?void 0:e.title});const n=await $(e==null?void 0:e.id);t({type:i.W_,id:e==null?void 0:e.id}),t({type:i.fi,id:s,data:n});const r=await H(n);t({type:i.pI,video:r})},setIsFetchingPurchases:e=>({type:i.CM,isFetching:e}),setPurchases:e=>({type:i.z8,purchases:e}),updateVideoPoster:(e,o,t)=>async s=>{var f,h;let{dispatch:n,select:r,resolveSelect:c}=s;const d=`${i.FY}/${o}/poster`,a=await r.getVideo(e),p=async()=>{if(!a.needsPlaybackToken)return null;const I=await c.getPlaybackToken(a.guid);return I==null?void 0:I.token},m=(I,S)=>!I||!S?I:`${I}?metadata_token=${S}`,E=()=>{setTimeout(async()=>{var I,S;try{const P=await(0,D.Z)({path:d,method:"GET"});if((I=P==null?void 0:P.data)!=null&&I.generating)E();else{const y=await p(),k=(S=P==null?void 0:P.data)==null?void 0:S.poster;n({type:i.Vm,id:e,poster:m(k,y)}),(0,D.Z)({path:i.tb,method:"POST",data:{id:e,poster:k}})}}catch(P){console.error(P)}},2e3)};try{n({type:i.Db,id:e});const I=a.duration-t.at_time;I<50&&(t.at_time-=I+50);const S=await(0,D.Z)({method:"POST",path:d,data:t});if((f=S==null?void 0:S.data)!=null&&f.generating){E();return}const P=await p(),y=m((h=S==null?void 0:S.data)==null?void 0:h.poster,P);return n({type:i.Vm,id:e,poster:y})}catch(I){console.error(I)}},setUsers:e=>({type:i.b1,users:e}),setUsersPagination:e=>({type:i.IN,pagination:e}),setIsFetchingPlaybackToken:e=>({type:i.TD,isFetching:e}),setPlaybackToken:e=>({type:i.El,playbackToken:e}),expirePlaybackToken:e=>({type:i.o1,guid:e}),setVideoPressSettings:e=>({type:i.WJ,videoPressSettings:e}),updateVideoPressSettings:e=>async o=>{let{dispatch:t}=o;if(!e)return;const s={force:!0};typeof e.videoPressVideosPrivateForSite=="boolean"&&(s.videopress_videos_private_for_site=e.videoPressVideosPrivateForSite);try{return t.setVideoPressSettings(e),await(0,D.Z)({path:i.uo,method:"PUT",data:s})}catch(n){console.error(n)}},updateVideoIsPrivate:(e,o)=>({type:i.jV,id:e,isPrivate:o})};var Ke=O("../../../node_modules/.pnpm/@wordpress+data@9.7.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js"),Je=O("../../../node_modules/.pnpm/@wordpress+url@3.38.0/node_modules/@wordpress/url/build-module/clean-for-slug.js");function Se(){return{order:"desc",orderBy:"date",itemsPerPage:6,page:1,type:"video/videopress"}}const Eo=(e,o)=>{var t,s,n,r,c,d,a,p,m,E,f,h,I,S,P,y,k,Q,Z,K,J,z,L,X,q,oo,to,so,no,io,ro,co,ao,lo;switch(o.type){case i.QC:return{...e,isFetching:o.isFetching};case i.tH:{const{error:u}=o;return{...e,isFetching:!1,error:u}}case i.Dj:return{...e,query:{...e.query,...o.query},_meta:{...e._meta,relyOnInitialState:!1}};case i.H:return{...e,pagination:{...e.pagination,...o.pagination},_meta:{...e._meta,relyOnInitialState:!1}};case i.$L:{const{filter:u,value:_,isActive:l}=o;return{...e,filter:{...e.filter,[u]:{...((t=e.filter)==null?void 0:t[u])||{},[_]:l}},_meta:{...e._meta,relyOnInitialState:!1}}}case i.p0:{const{videos:u}=o;return{...e,items:u,isFetching:!1}}case i.Et:{const{video:u,addAtEnd:_=!1}=o,l=[...(s=e.items)!=null?s:[]],g=l.findIndex(V=>V.id===u.id);return g===-1?_?l.push(u):l.unshift(u):l[g]={...l[g],...u},{...e,isFetching:!1,items:l}}case i.NL:{const{id:u,privacySetting:_}=o,l=[...(n=e.items)!=null?n:[]],g=l.findIndex(R=>R.id===u);if(g<0)return e;const V=l[g].privacySetting;l[g]={...l[g],privacySetting:_};const T={...(c=(r=e._meta)==null?void 0:r.items)!=null?c:[]},v=(d=T[u])!=null?d:{};return{...e,items:l,_meta:{...e._meta,items:{...T,[u]:{...v,isUpdatingPrivacy:!0,hasBeenUpdatedPrivacy:!1,prevPrivacySetting:V}}}}}case i.RB:{const{id:u}=o,_={...(p=(a=e._meta)==null?void 0:a.items)!=null?p:[]};if(!(_!=null&&_[u]))return e;const l=(m=_[u])!=null?m:{};return{...e,_meta:{...e._meta,items:{..._,[u]:{...l,isUpdatingPrivacy:!1,hasBeenUpdatedPrivacy:!0,prevPrivacySetting:null}}}}}case i.jV:{const{id:u,isPrivate:_}=o,l=[...(E=e.items)!=null?E:[]],g=l.findIndex(V=>V.id===u);return g<0?e:(l[g]={...l[g],isPrivate:_},{...e,items:l})}case i.Og:{const{id:u}=o,{items:_=[]}=e;if(_.findIndex(T=>T.id===u)<0)return e;const g={...(h=(f=e._meta)==null?void 0:f.items)!=null?h:[]},V=(I=g[u])!=null?I:{};return{...e,_meta:{...e._meta,videosBeingRemoved:[{id:u,processed:!1,deleted:!1},...(S=e._meta.videosBeingRemoved)!=null?S:[]],items:{...g,[u]:{...V,isDeleting:!0}}}}}case i.tw:{const{id:u,hasBeenDeleted:_,video:l}=o,g=((P=e==null?void 0:e._meta)==null?void 0:P.items)||[],V=g[u]||{},T=[...(y=e._meta.videosBeingRemoved)!=null?y:[]],v=T.findIndex(A=>A.id===u);if(!V||v<0)return e;T[v].processed=!0,T[v].deleted=_;const R=T.filter(A=>!A.processed).length===0;let b=(k=e.uploadedVideoCount)!=null?k:0;if(R){const A=T.filter(x=>x.deleted).length;b=b-A}return{...e,uploadedVideoCount:b,_meta:{...e._meta,videosBeingRemoved:T,processedAllVideosBeingRemoved:R,items:{...g,[u]:{...V,hasBeenDeleted:_,deletedVideo:l}}}}}case i.Zp:return{...e,_meta:{...e._meta,videosBeingRemoved:[],relyOnInitialState:!1}};case i.wI:{const{items:u=[],query:_={},pagination:l={},_meta:g={}}=e,{videosBeingRemoved:V=[]}=g,T=V.filter(oe=>oe.deleted).length,v=(u==null?void 0:u.length)===T,R=(Q=_==null?void 0:_.page)!=null?Q:1,b=(Z=l==null?void 0:l.totalPages)!=null?Z:1,A=l==null?void 0:l.total,x=v&&R>1?R-1:R,ee=v&&b>1?b-1:b;return{...e,query:{..._,page:x},pagination:{...l,total:A-1,totalPages:ee}}}case i.vP:return{...e,storageUsed:o.used};case i.z$:return{...e,isFetchingUploadedVideoCount:o.isFetchingUploadedVideoCount};case i.Wi:return{...e,uploadedVideoCount:o.uploadedVideoCount,isFetchingUploadedVideoCount:!1};case i.x_:{const{id:u,title:_}=o,l=(e==null?void 0:e._meta)||{},g=(l==null?void 0:l.items)||{},V=(0,Je.J)(_);return{...e,_meta:{...l,items:{...g,[u]:{title:V,uploading:!0}}}}}case i.fi:{const{id:u,data:_}=o,l=(K=e==null?void 0:e.query)!=null?K:Se(),g={...e.pagination},V=[...(J=e==null?void 0:e.items)!=null?J:[]],T=(e==null?void 0:e._meta)||{},v=Object.assign({},(T==null?void 0:T.items)||{}),R=((X=(L=(z=_==null?void 0:_.src)==null?void 0:z.split("/"))==null?void 0:L.slice(-1))==null?void 0:X[0])||((q=v[u])==null?void 0:q.title)||"",b=(0,Je.J)(R);let A=(oo=e==null?void 0:e.uploadedVideoCount)!=null?oo:0,x=(to=e==null?void 0:e.firstUploadedVideoId)!=null?to:null,ee=(so=e==null?void 0:e.firstVideoProcessed)!=null?so:!1,oe=(no=e==null?void 0:e.dismissedFirstVideoPopover)!=null?no:!1;return A===0&&(x=_.id,ee=!1,oe=!1),(l==null?void 0:l.page)===1&&!(l!=null&&l.search)&&(A=((io=e==null?void 0:e.uploadedVideoCount)!=null?io:0)+1,g.total=A,g.totalPages=Math.ceil(A/(l==null?void 0:l.itemsPerPage)),V.unshift({id:_.id,guid:_.guid,url:_.src,title:b,posterImage:null,finished:!1})),delete v[u],{...e,items:V,uploadedVideoCount:A,firstUploadedVideoId:x,firstVideoProcessed:ee,dismissedFirstVideoPopover:oe,pagination:g,_meta:{...T,items:v}}}case i.pI:{const{video:u}=o,_=[...(ro=e==null?void 0:e.items)!=null?ro:[]],l=_.findIndex(T=>T.id===u.id),g=(co=e==null?void 0:e.firstUploadedVideoId)!=null?co:null;let V=(ao=e==null?void 0:e.firstVideoProcessed)!=null?ao:null;return u.id===g&&(V=!0),l===-1?{...e,firstVideoProcessed:V}:(_[l]=u,{...e,firstVideoProcessed:V,items:_})}case i.Db:{const{id:u}=o,_=(e==null?void 0:e._meta)||{},l=(_==null?void 0:_.items)||{},g=l[u]||{};return{...e,_meta:{..._,items:{...l,[u]:{...g,isUpdatingPoster:!0}}}}}case i.Vm:{const{id:u,poster:_}=o,l=[...(lo=e.items)!=null?lo:[]],g=(e==null?void 0:e._meta)||{},V=(g==null?void 0:g.items)||{},T=l.findIndex(v=>v.id===u);return T>=0&&(l[T]={...l[T],posterImage:_}),{...e,items:l,_meta:{...g,items:{...V,[u]:{isUpdatingPoster:!1}}}}}case i.dY:{const{id:u,bytesSent:_,bytesTotal:l}=o,g=(e==null?void 0:e._meta)||{},V=(g==null?void 0:g.items)||{},T=V[u]||{},v=l>0?_/l:0;return{...e,_meta:{...g,items:{...V,[u]:{...T,uploadProgress:v}}}}}case i.pD:return{...e,dismissedFirstVideoPopover:!0,firstUploadedVideoId:null};default:return e}},Io=(e,o)=>{var t;switch(o.type){case i.FP:{const{videos:s}=o;return{...e,items:s,isFetching:!1}}case i.ZP:return{...e,isFetching:o.isFetching};case i.Ps:return{...e,query:{...e.query,...o.query},_meta:{...e._meta,relyOnInitialState:!1}};case i.Vc:return{...e,pagination:{...e.pagination,...o.pagination},_meta:{...e._meta,relyOnInitialState:!1}};case i.W_:{const{id:s}=o,n=[...(t=e==null?void 0:e.items)!=null?t:[]],r=n.findIndex(c=>c.id===s);return r===-1?e:(n[r]={...n[r],isUploadedToVideoPress:!0},{...e,items:n,isFetching:!1})}}return e},Po=(e,o)=>{switch(o.type){case i.b1:return{...e,items:o.users};case i.IN:return{...e,pagination:{...(e==null?void 0:e.pagination)||{},...o.pagination}};default:return e}},Vo=(e,o)=>{switch(o.type){case i.CM:return{...e,isFetching:o.isFetching};case i.z8:return{...e,items:o.purchases,isFetching:!1};default:return e}},To=(e,o)=>{var t,s;switch(o.type){case i.TD:return{...e,isFetching:o.isFetching};case i.El:{const{playbackToken:n}=o,r=[...(t=e.items)!=null?t:[]],c=r.findIndex(d=>d.guid===n.guid);return c===-1?r.unshift(n):r[c]={...r[c],...n},{...e,items:r,isFetching:!1}}case i.o1:{const{guid:n}=o,r=[...(s=e.items)!=null?s:[]],c=r.findIndex(d=>d.guid===n);return c>-1&&r.splice(c,1),{...e,items:r,isFetching:!1}}default:return e}},So=(e,o)=>{switch(o.type){case i.WJ:{const{videoPressSettings:t}=o;return{...e,...t}}default:return e}},ko=(0,Ke.UY)({videos:Eo,localVideos:Io,purchases:Vo,users:Po,playbackTokens:To,siteSettings:So}),Ao=null,{apiRoot:Y}=(window==null?void 0:window.jetpackVideoPressInitialState)||{};async function ze(e,o,t){if(!e.needsPlaybackToken)return e;let s=await o.getPlaybackToken(e.guid);return s&&Number(s.issueTime)+864e5<Date.now()&&(await t.expirePlaybackToken(e.guid),s=await o.getPlaybackToken(e.guid)),/metadata_token=/.test(e.posterImage)||(e.posterImage+=`?metadata_token=${s.token}`),/metadata_token=/.test(e.thumbnail)||(e.thumbnail+=`?metadata_token=${s.token}`),/metadata_token=/.test(e.url)||(e.url+=`?metadata_token=${s.token}`),e}const xo={getStorageUsed:{isFulfilled:e=>{var o,t;return(t=(o=e==null?void 0:e.videos)==null?void 0:o._meta)==null?void 0:t.relyOnInitialState},fulfill:()=>async e=>{var t;let{dispatch:o}=e;try{const s=await(0,D.Z)({path:i.JV});if(!((t=s==null?void 0:s.options)!=null&&t.videopress_storage_used))return;const n=s.options.videopress_storage_used?Math.round(Number(s.options.videopress_storage_used)*1e3*1e3):0;o.setVideosStorageUsed(n)}catch(s){console.error(s)}}},getUploadedVideoCount:{isFulfilled:e=>{var o,t;return(t=(o=e==null?void 0:e.videos)==null?void 0:o._meta)==null?void 0:t.relyOnInitialState},fulfill:()=>async e=>{let{dispatch:o}=e;const t={per_page:1,media_type:"video",mime_type:"video/videopress"};o.setIsFetchingUploadedVideoCount(!0);try{const s=await fetch((0,U.f)(`${Y}${i.u_}`,t)),n=Number(s.headers.get("X-WP-Total"));return o.setUploadedVideoCount(n),n}catch(s){console.error(s)}},shouldInvalidate:e=>e.type===i.fi||e.type===i.Zp},getVideos:{isFulfilled:e=>{var o,t;return(t=(o=e==null?void 0:e.videos)==null?void 0:o._meta)==null?void 0:t.relyOnInitialState},fulfill:()=>async e=>{let{dispatch:o,select:t,resolveSelect:s}=e;o.setIsFetchingVideos(!0);let n=t.getVideosQuery();n||(n=Se(),o.setVideosQuery(n));const r={order:n.order,orderby:n.orderBy,page:n.page,per_page:n.itemsPerPage,media_type:"video",mime_type:"video/videopress"};typeof n.search=="string"&&n.search.length>0&&(r.search=n.search);const c=t.getVideosFilter(),d=Object.keys((c==null?void 0:c.rating)||{}).filter(m=>c.rating[m]).join(",");d!=null&&d.length&&(r.videopress_rating=d);const a=Object.keys((c==null?void 0:c.privacy)||{}).filter(m=>c.privacy[m]).join(",");a!=null&&a.length&&(r.videopress_privacy_setting=a);const p=Object.keys((c==null?void 0:c.uploader)||{}).filter(m=>c.uploader[m]).join(",");p!=null&&p.length&&(r.author=p);try{const m=await fetch((0,U.f)(`${Y}${i.u_}`,r)),E=Number(m.headers.get("X-WP-Total")),f=Number(m.headers.get("X-WP-TotalPages"));o.setVideosPagination({total:E,totalPages:f});const h=await m.json(),I=await Promise.all(ge(h).map(async S=>await ze(S,s,o)));return o.setVideos(I),h}catch(m){console.error(m)}},shouldInvalidate:e=>{let{type:o}=e;return o===i.Dj||o===i.Zp||o===i.$L}},getVideo:{isFulfilled:(e,o)=>{var n,r;if(!o||typeof o=="string")return!0;const s=((n=e.videos.items)!=null?n:[]).find(c=>{let{id:d}=c;return d===o});return s&&s.needsPlaybackToken?!!(((r=e==null?void 0:e.playbackTokens)==null?void 0:r.items)||[]).find(a=>(a==null?void 0:a.guid)===s.guid):s},fulfill:function(e){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return async t=>{let{dispatch:s,resolveSelect:n}=t;s.setIsFetchingVideos(!0);try{const r=await(0,D.Z)({path:(0,U.f)(`${i.u_}/${e}`)}),c=await ze(j(r),n,s);return s.setVideo(c,o),r}catch(r){console.error(r)}}}},getLocalVideos:{isFulfilled:e=>{var o,t;return(t=(o=e==null?void 0:e.localVideos)==null?void 0:o._meta)==null?void 0:t.relyOnInitialState},fulfill:()=>async e=>{let{dispatch:o,select:t}=e,s=t.getLocalVideosQuery();o.setIsFetchingLocalVideos(!0),s||(s=Se(),o.setVideosQuery(s));const n={order:s.order,orderby:s.orderBy,page:s.page,per_page:s.itemsPerPage,media_type:"video",no_videopress:!0};typeof s.search=="string"&&s.search.length>0&&(n.search=s.search);try{const r=await fetch((0,U.f)(`${Y}${i.u_}`,n)),c=Number(r.headers.get("X-WP-Total")),d=Number(r.headers.get("X-WP-TotalPages"));o.setLocalVideosPagination({total:c,totalPages:d});const a=await r.json();return o.setLocalVideos(Ee(a)),a}catch(r){console.error(r)}},shouldInvalidate:e=>e.type===i.Ps},getUsers:{isFulfilled:e=>{var o,t;return(t=(o=e==null?void 0:e.users)==null?void 0:o._meta)==null?void 0:t.relyOnInitialState},fulfill:()=>async e=>{let{dispatch:o}=e;o.setIsFetchingLocalVideos(!0);try{const t=await fetch(`${Y}${i.Kc}`),s=Number(t.headers.get("X-WP-Total")),n=Number(t.headers.get("X-WP-TotalPages"));o.setUsersPagination({total:s,totalPages:n});const r=await t.json();return r!=null&&r.length?(o.setUsers(r.map(c=>({id:c.id,name:c.name,slug:c.slug,description:c.description,link:c.link,avatar:c.avatar_urls}))),r):void 0}catch(t){console.error(t)}}},getPlaybackToken:{isFulfilled:(e,o)=>{var s,n;const t=(n=(s=e==null?void 0:e.playbackTokens)==null?void 0:s.items)!=null?n:[];return t==null?void 0:t.some(r=>(r==null?void 0:r.guid)===o)},fulfill:e=>async o=>{let{dispatch:t}=o;t.setIsFetchingPlaybackToken(!0);try{const s=await(0,D.Z)({path:(0,U.f)(`${i.qP}/${e}`),method:"POST"}),n={guid:e,token:s.playback_token,issueTime:Date.now()};return t.setPlaybackToken(n),n}catch(s){console.error(s)}},shouldInvalidate:(e,o)=>e.type===i.o1&&e.guid===o},getVideoPressSettings:{isFulfilled:e=>(e==null?void 0:e.siteSettings)!==void 0,fulfill:()=>async e=>{let{dispatch:o}=e;try{const{videopress_videos_private_for_site:t}=await(0,D.Z)({path:(0,U.f)(`${i.uo}`),method:"GET"}),s={videoPressVideosPrivateForSite:t};return o.setVideoPressSettings(s),s}catch(t){console.error(t)}}}},Xe=e=>{var o;return((o=e==null?void 0:e.videos)==null?void 0:o.items)||[]},ut={getVideos:Xe,getUploadingVideos:e=>{var t,s;const o=((s=(t=e==null?void 0:e.videos)==null?void 0:t._meta)==null?void 0:s.items)||{};return Object.keys(o||{}).map(n=>({...o[n],id:n})).filter(n=>n.uploading)},getVideosQuery:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.query},getPagination:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.pagination},getVideosFilter:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.filter},getUploadedVideoCount:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.uploadedVideoCount},getIsFetching:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.isFetching},getIsFetchingUploadedVideoCount:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.isFetchingUploadedVideoCount},getStorageUsed:e=>{var o;return{storageUsed:(o=e==null?void 0:e.videos)==null?void 0:o.storageUsed}},getFirstUploadedVideoId:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.firstUploadedVideoId},getFirstVideoProcessed:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.firstVideoProcessed},getDismissedFirstVideoPopover:e=>{var o;return(o=e==null?void 0:e.videos)==null?void 0:o.dismissedFirstVideoPopover},getProcessedAllVideosBeingRemoved:e=>{var o,t;return(t=(o=e==null?void 0:e.videos)==null?void 0:o._meta)==null?void 0:t.processedAllVideosBeingRemoved},getLocalVideos:e=>{var o;return((o=e==null?void 0:e.localVideos)==null?void 0:o.items)||[]},getIsFetchingLocalVideos:e=>{var o;return(o=e==null?void 0:e.localVideos)==null?void 0:o.isFetching},getLocalVideosQuery:e=>{var o;return(o=e==null?void 0:e.localVideos)==null?void 0:o.query},getLocalPagination:e=>{var o;return(o=e==null?void 0:e.localVideos)==null?void 0:o.pagination},getUploadedLocalVideoCount:e=>{var o;return(o=e==null?void 0:e.localVideos)==null?void 0:o.uploadedVideoCount},getVideo:(e,o)=>Xe(e).find(n=>{let{id:r}=n;return r===o}),getVideoStateMetadata:(e,o)=>{var n,r;return(((r=(n=e==null?void 0:e.videos)==null?void 0:n._meta)==null?void 0:r.items)||{})[o]||{}},getUsers:e=>{var o;return((o=e==null?void 0:e.users)==null?void 0:o.items)||[]},getUsersPagination:e=>{var o;return(o=e==null?void 0:e.users)==null?void 0:o.pagination},getPurchases:e=>{var o;return((o=e==null?void 0:e.purchases)==null?void 0:o.items)||[]},isFetchingPurchases:e=>{var o;return(o=e==null?void 0:e.purchases)==null?void 0:o.isFetching},getPlaybackToken:(e,o)=>{var n;return(((n=e==null?void 0:e.playbackTokens)==null?void 0:n.items)||[]).find(r=>(r==null?void 0:r.guid)===o)||{}},isFetchingPlaybackToken:e=>{var o;return(o=e==null?void 0:e.playbackTokens)==null?void 0:o.isFetching},getVideoPressSettings:e=>e==null?void 0:e.siteSettings},pt=null;var fo=O("../../../node_modules/.pnpm/@babel+runtime@7.22.6/node_modules/@babel/runtime/helpers/defineProperty.js"),ho=O.n(fo),yo=O("../../../node_modules/.pnpm/@wordpress+data@9.7.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");class G{static mayBeInit(o,t){G.store===null&&(G.store=(0,yo.Z)(o,t),(0,Ke.z2)(G.store))}}ho()(G,"store",null);const _t=null,vo=ne()("videopress/media:state"),qe=((eo=window.jetpackVideoPressInitialState)==null?void 0:eo.initialState)||{videos:{}},w=window.location.hash.split("?");(w==null?void 0:w[0])==="#/"&&(w!=null&&w[1])&&(w==null?void 0:w[1])!=="page=1"&&(qe.videos.isFetching=!0);function gt(){vo("Initializing %o store",STORE_ID),storeHolder.mayBeInit(STORE_ID,{__experimentalUseThunks:!0,reducer,actions,selectors,resolvers,initialState:qe})}}}]);})();
