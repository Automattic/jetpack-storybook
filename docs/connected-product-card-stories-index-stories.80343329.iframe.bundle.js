"use strict";(()=>{var q=(d,o,e)=>{if(!o.has(d))throw TypeError("Cannot "+e)};var s=(d,o,e)=>(q(d,o,"read from private field"),e?e.call(d):o.get(d)),A=(d,o,e)=>{if(o.has(d))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(d):o.set(d,e)},O=(d,o,e,r)=>(q(d,o,"write to private field"),r?r.call(d,e):o.set(d,e),e);var E=(d,o,e)=>(q(d,o,"access private method"),e);(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[5462],{"../../packages/my-jetpack/_inc/components/connected-product-card/stories/index.stories.jsx":(d,o,e)=>{var M,_,N;e.r(o),e.d(o,{Default:()=>g,__namedExportsOrder:()=>p,default:()=>T});var r=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),u=e("../../../node_modules/.pnpm/react-router-dom@6.6.2_react-dom@18.2.0_react@18.2.0/node_modules/react-router-dom/dist/index.js"),m=e("../../../node_modules/.pnpm/react-router@6.6.2_react@18.2.0/node_modules/react-router/dist/index.js"),i=e("../../packages/my-jetpack/_inc/components/connected-product-card/index.jsx"),C=e("../../packages/my-jetpack/_inc/components/product-card/action-button.jsx"),y=e("../../packages/my-jetpack/_inc/components/product-detail-card/stories/utils.js"),j=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js"),R=`/* eslint-disable react/react-in-jsx-scope */

import React from 'react';
import { HashRouter, Routes, Route } from 'react-router-dom';
import ConnectedProductCard from '../';
import { PRODUCT_STATUSES } from '../../product-card';
import { getAllMockData, getProductSlugs } from '../../product-detail-card/stories/utils.js';

// Set myJetpackRest global var.
window.myJetpackRest = {};

const mockData = getAllMockData();

export default {
	title: 'Packages/My Jetpack/Connected Product Card',
	component: ConnectedProductCard,
	argTypes: {
		slug: {
			options: getProductSlugs(),
			control: { type: 'select' },
		},
		status: {
			options: Object.values( PRODUCT_STATUSES ),
			control: { type: 'select' },
		},
	},
};

const Template = args => (
	<HashRouter>
		<Routes>
			<Route path="/" element={ <ConnectedProductCard { ...args } /> } />
		</Routes>
	</HashRouter>
);

export const Default = Template.bind( {} );
Default.parameters = { mockData };
Default.args = {
	admin: false,
	slug: 'backup',
};
`,L={Default:{startLoc:{col:17,line:29},endLoc:{col:1,line:35},startBody:{col:17,line:29},endBody:{col:1,line:35}}};window.myJetpackRest={};const x=(0,y.As)(),T={parameters:{storySource:{source:`

import React from 'react';
import { HashRouter, Routes, Route } from 'react-router-dom';
import ConnectedProductCard from '../';
import { PRODUCT_STATUSES } from '../../product-card';
import { getAllMockData, getProductSlugs } from '../../product-detail-card/stories/utils.js';

// Set myJetpackRest global var.
window.myJetpackRest = {};

const mockData = getAllMockData();

export default {
	title: 'Packages/My Jetpack/Connected Product Card',
	component: ConnectedProductCard,
	argTypes: {
		slug: {
			options: getProductSlugs(),
			control: { type: 'select' },
		},
		status: {
			options: Object.values( PRODUCT_STATUSES ),
			control: { type: 'select' },
		},
	},
};

const Template = args => (
	<HashRouter>
		<Routes>
			<Route path="/" element={ <ConnectedProductCard { ...args } /> } />
		</Routes>
	</HashRouter>
);

export const Default = Template.bind( {} );
Default.parameters = { mockData };
Default.args = {
	admin: false,
	slug: 'backup',
};
`,locationsMap:{default:{startLoc:{col:17,line:29},endLoc:{col:1,line:35},startBody:{col:17,line:29},endBody:{col:1,line:35}}}}},title:"Packages/My Jetpack/Connected Product Card",component:i.Z,argTypes:{slug:{options:(0,y.h7)(),control:{type:"select"}},status:{options:Object.values(C.N),control:{type:"select"}}}},l=B=>(0,j.jsx)(u.UT,{children:(0,j.jsx)(m.Z5,{children:(0,j.jsx)(m.AW,{path:"/",element:(0,j.jsx)(i.Z,{...B})})})});l.displayName="Template";const g=l.bind({});g.parameters={mockData:x},g.args={admin:!1,slug:"backup"},g.parameters={...g.parameters,docs:{...(M=g.parameters)==null?void 0:M.docs,source:{originalSource:`args => <HashRouter>
        <Routes>
            <Route path="/" element={<ConnectedProductCard {...args} />} />
        </Routes>
    </HashRouter>`,...(N=(_=g.parameters)==null?void 0:_.docs)==null?void 0:N.source}}};const p=["Default"]},"../../../node_modules/.pnpm/@tanstack+react-query@5.20.5_react@18.2.0/node_modules/@tanstack/react-query/build/modern/useMutation.js":(d,o,e)=>{var l,g,p,M,_,w,B,S,f,c,P,b,Q,W,tt,G;e.d(o,{D:()=>x});var r=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),u=(B=class extends null{constructor(t){super();A(this,_);A(this,l,void 0);A(this,g,void 0);A(this,p,void 0);A(this,M,void 0);this.mutationId=t.mutationId,O(this,g,t.defaultOptions),O(this,p,t.mutationCache),O(this,l,[]),this.state=t.state||m(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options={...s(this,g),...t},this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){s(this,l).includes(t)||(s(this,l).push(t),this.clearGcTimeout(),s(this,p).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){O(this,l,s(this,l).filter(a=>a!==t)),this.scheduleGc(),s(this,p).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){s(this,l).length||(this.state.status==="pending"?this.scheduleGc():s(this,p).remove(this))}continue(){var t,a;return(a=(t=s(this,M))==null?void 0:t.continue())!=null?a:this.execute(this.state.variables)}async execute(t){var v,U,D,K,J,F,k,I,H,V,Y,X,et,st,nt,ot,at,rt,it,dt;const a=()=>{var h;return O(this,M,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(z,ut)=>{E(this,_,w).call(this,{type:"failed",failureCount:z,error:ut})},onPause:()=>{E(this,_,w).call(this,{type:"pause"})},onContinue:()=>{E(this,_,w).call(this,{type:"continue"})},retry:(h=this.options.retry)!=null?h:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode})),s(this,M).promise},n=this.state.status==="pending";try{if(!n){E(this,_,w).call(this,{type:"pending",variables:t}),await((U=(v=s(this,p).config).onMutate)==null?void 0:U.call(v,t,this));const z=await((K=(D=this.options).onMutate)==null?void 0:K.call(D,t));z!==this.state.context&&E(this,_,w).call(this,{type:"pending",context:z,variables:t})}const h=await a();return await((F=(J=s(this,p).config).onSuccess)==null?void 0:F.call(J,h,t,this.state.context,this)),await((I=(k=this.options).onSuccess)==null?void 0:I.call(k,h,t,this.state.context)),await((V=(H=s(this,p).config).onSettled)==null?void 0:V.call(H,h,null,this.state.variables,this.state.context,this)),await((X=(Y=this.options).onSettled)==null?void 0:X.call(Y,h,null,t,this.state.context)),E(this,_,w).call(this,{type:"success",data:h}),h}catch(h){try{throw await((st=(et=s(this,p).config).onError)==null?void 0:st.call(et,h,t,this.state.context,this)),await((ot=(nt=this.options).onError)==null?void 0:ot.call(nt,h,t,this.state.context)),await((rt=(at=s(this,p).config).onSettled)==null?void 0:rt.call(at,void 0,h,this.state.variables,this.state.context,this)),await((dt=(it=this.options).onSettled)==null?void 0:dt.call(it,void 0,h,t,this.state.context)),h}finally{E(this,_,w).call(this,{type:"error",error:h})}}}},l=new WeakMap,g=new WeakMap,p=new WeakMap,M=new WeakMap,_=new WeakSet,w=function(t){const a=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!canFetch(this.options.networkMode),status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=a(this.state),notifyManager.batch(()=>{s(this,l).forEach(n=>{n.onMutationUpdate(t)}),s(this,p).notify({mutation:this,type:"updated",action:t})})},B);function m(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var i=e("../../../node_modules/.pnpm/@tanstack+query-core@5.20.5/node_modules/@tanstack/query-core/build/modern/notifyManager.js"),C=e("../../../node_modules/.pnpm/@tanstack+query-core@5.20.5/node_modules/@tanstack/query-core/build/modern/subscribable.js"),y=e("../../../node_modules/.pnpm/@tanstack+query-core@5.20.5/node_modules/@tanstack/query-core/build/modern/utils.js"),j=(G=class extends C.l{constructor(t,a){super();A(this,b);A(this,W);A(this,S,void 0);A(this,f,void 0);A(this,c,void 0);A(this,P,void 0);O(this,S,t),this.setOptions(a),this.bindMethods(),E(this,b,Q).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const a=this.options;this.options=s(this,S).defaultMutationOptions(t),(0,y.VS)(a,this.options)||s(this,S).getMutationCache().notify({type:"observerOptionsUpdated",mutation:s(this,c),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&(0,y.Ym)(a.mutationKey)!==(0,y.Ym)(this.options.mutationKey)?this.reset():(n=s(this,c))==null||n.setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=s(this,c))==null||t.removeObserver(this)}onMutationUpdate(t){E(this,b,Q).call(this),E(this,W,tt).call(this,t)}getCurrentResult(){return s(this,f)}reset(){var t;(t=s(this,c))==null||t.removeObserver(this),O(this,c,void 0),E(this,b,Q).call(this),E(this,W,tt).call(this)}mutate(t,a){var n;return O(this,P,a),(n=s(this,c))==null||n.removeObserver(this),O(this,c,s(this,S).getMutationCache().build(s(this,S),this.options)),s(this,c).addObserver(this),s(this,c).execute(t)}},S=new WeakMap,f=new WeakMap,c=new WeakMap,P=new WeakMap,b=new WeakSet,Q=function(){var a,n;const t=(n=(a=s(this,c))==null?void 0:a.state)!=null?n:m();O(this,f,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},W=new WeakSet,tt=function(t){i.V.batch(()=>{var a,n,v,U,D,K,J,F;if(s(this,P)&&this.hasListeners()){const k=s(this,f).variables,I=s(this,f).context;(t==null?void 0:t.type)==="success"?((n=(a=s(this,P)).onSuccess)==null||n.call(a,t.data,k,I),(U=(v=s(this,P)).onSettled)==null||U.call(v,t.data,null,k,I)):(t==null?void 0:t.type)==="error"&&((K=(D=s(this,P)).onError)==null||K.call(D,t.error,k,I),(F=(J=s(this,P)).onSettled)==null||F.call(J,void 0,t.error,k,I))}this.listeners.forEach(k=>{k(s(this,f))})})},G),R=e("../../../node_modules/.pnpm/@tanstack+react-query@5.20.5_react@18.2.0/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),L=e("../../../node_modules/.pnpm/@tanstack+react-query@5.20.5_react@18.2.0/node_modules/@tanstack/react-query/build/modern/utils.js");function x(Z,t){const a=(0,R.NL)(t),[n]=r.useState(()=>new j(a,Z));r.useEffect(()=>{n.setOptions(Z)},[n,Z]);const v=r.useSyncExternalStore(r.useCallback(D=>n.subscribe(i.V.batchCalls(D)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),U=r.useCallback((D,K)=>{n.mutate(D,K).catch(T)},[n]);if(v.error&&(0,L.L)(n.options.throwOnError,[v.error]))throw v.error;return{...v,mutate:U,mutateAsync:v.mutate}}function T(){}},"../../../node_modules/.pnpm/@wordpress+icons@9.44.0_react@18.2.0/node_modules/@wordpress/icons/build-module/library/check.js":(d,o,e)=>{e.d(o,{Z:()=>i});var r=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),u=e("../../../node_modules/.pnpm/@wordpress+primitives@3.51.0/node_modules/@wordpress/primitives/build-module/svg/index.js");const i=(0,r.createElement)(u.Wj,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,r.createElement)(u.y$,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"}))},"../../../node_modules/.pnpm/@wordpress+icons@9.44.0_react@18.2.0/node_modules/@wordpress/icons/build-module/library/chevron-down.js":(d,o,e)=>{e.d(o,{Z:()=>i});var r=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),u=e("../../../node_modules/.pnpm/@wordpress+primitives@3.51.0/node_modules/@wordpress/primitives/build-module/svg/index.js");const i=(0,r.createElement)(u.Wj,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,r.createElement)(u.y$,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"}))},"../../packages/my-jetpack/_inc/components/connected-product-card/index.jsx":(d,o,e)=>{e.d(o,{Z:()=>S});var r=e("../components/components/text/index.tsx"),u=e("../connection/components/use-connection/index.jsx"),m=e("../../../node_modules/.pnpm/prop-types@15.8.1/node_modules/prop-types/index.js"),i=e.n(m),C=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),y=e("../../packages/my-jetpack/_inc/constants.ts"),j=e("../../packages/my-jetpack/_inc/data/products/use-activate.ts"),R=e("../../../node_modules/.pnpm/@wordpress+i18n@4.53.0/node_modules/@wordpress/i18n/build-module/index.js"),L=e("../../packages/my-jetpack/_inc/data/constants.ts"),x=e("../../packages/my-jetpack/_inc/data/use-simple-mutation.ts"),T=e("../../packages/my-jetpack/_inc/data/products/use-product.ts");const l=R.__,p=f=>{const{detail:c,refetch:P}=(0,T.Z)(f),{mutate:b,isPending:$}=(0,x.Z)({name:L.yv,query:{path:`${L.Jk}/${f}/install-standalone`,method:"POST"},options:{onSuccess:P},errorMessage:(0,R.gB)(l("Failed to install standalone plugin for %1$s. Please try again","jetpack-my-jetpack"),c.name)});return{install:b,isPending:$}};var M=e("../../packages/my-jetpack/_inc/hooks/use-my-jetpack-navigate/index.ts"),_=e("../../packages/my-jetpack/_inc/components/product-card/index.jsx"),N=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const B=({admin:f,slug:c,children:P,isDataLoading:b,Description:$=null,additionalActions:W=null,secondaryAction:ct=null,upgradeInInterstitial:G=!1,primaryActionOverride:Z})=>{const{isRegistered:t,isUserConnected:a}=(0,u.Z)(),{install:n,isPending:v}=p(c),{activate:U,isPending:D}=(0,j.Z)(c),{detail:K}=(0,T.Z)(c),{name:J,description:F,requiresUserConnection:k,status:I}=K,H=(0,M.Z)(y.xB.Connection),V=(0,C.useCallback)(()=>{if((!t||!a)&&k){H();return}U()},[U,t,a,k,H]),Y=()=>{const X=F.replace(/\s(?=[^\s]*$)/,"\xA0");return(0,N.jsx)(r.ZP,{variant:"body-small",style:{flexGrow:1},children:X})};return(0,N.jsx)(_.ZP,{name:J,Description:$||Y,status:I,admin:f,isFetching:D||v,isDataLoading:b,isInstallingStandalone:v,additionalActions:W,primaryActionOverride:Z,secondaryAction:ct,slug:c,onActivate:V,onInstallStandalone:n,onActivateStandalone:n,upgradeInInterstitial:G,children:P})};B.displayName="ConnectedProductCard",B.propTypes={children:i().node,admin:i().bool.isRequired,slug:i().string.isRequired,isDataLoading:i().bool,additionalActions:i().array,primaryActionOverride:i().object,secondaryAction:i().object};const S=B;B.__docgenInfo={description:"",methods:[],displayName:"ConnectedProductCard",props:{Description:{defaultValue:{value:"null",computed:!1},required:!1},additionalActions:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"array"},required:!1},secondaryAction:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"object"},required:!1},upgradeInInterstitial:{defaultValue:{value:"false",computed:!1},required:!1},children:{description:"",type:{name:"node"},required:!1},admin:{description:"",type:{name:"bool"},required:!0},slug:{description:"",type:{name:"string"},required:!0},isDataLoading:{description:"",type:{name:"bool"},required:!1},primaryActionOverride:{description:"",type:{name:"object"},required:!1}}}},"../../packages/my-jetpack/_inc/constants.ts":(d,o,e)=>{e.d(o,{f6:()=>u,w6:()=>r,xB:()=>i});const r="my-jetpack-my-plans-manage",u="my-jetpack-my-plans-purchase",m="my-jetpack-product-checkout",i={Home:"/",Connection:"/connection",AddAkismet:"/add-akismet",AddAntiSpam:"/add-anti-spam",AddBackup:"/add-backup",AddBoost:"/add-boost",AddCRM:"/add-crm",AddCreator:"/add-creator",AddJetpackAI:"/add-jetpack-ai",AddExtras:"/add-extras",AddProtect:"/add-protect",AddScan:"/add-scan",AddSocial:"/add-social",AddSearch:"/add-search",AddVideoPress:"/add-videopress",AddStats:"/add-stats",AddLicense:"/add-license",RedeemToken:"/redeem-token"}},"../../packages/my-jetpack/_inc/data/products/use-activate.ts":(d,o,e)=>{e.d(o,{Z:()=>j});var r=e("../../../node_modules/.pnpm/@wordpress+i18n@4.53.0/node_modules/@wordpress/i18n/build-module/index.js"),u=e("../../packages/my-jetpack/_inc/data/constants.ts"),m=e("../../packages/my-jetpack/_inc/data/use-simple-mutation.ts"),i=e("../../packages/my-jetpack/_inc/data/products/use-product.ts");const C=r.__,j=R=>{const{detail:L,refetch:x}=(0,i.Z)(R),{mutate:T,isPending:l}=(0,m.Z)({name:u.iG,query:{path:`${u.Jk}/${R}`,method:"POST"},options:{onSuccess:x},errorMessage:(0,r.gB)(C("Failed to activate %1$s. Please try again","jetpack-my-jetpack"),L.name)});return{activate:T,isPending:l}}},"../../packages/my-jetpack/_inc/data/use-simple-mutation.ts":(d,o,e)=>{e.d(o,{Z:()=>C});var r=e("../../../node_modules/.pnpm/@tanstack+react-query@5.20.5_react@18.2.0/node_modules/@tanstack/react-query/build/modern/useMutation.js"),u=e("../../../node_modules/.pnpm/@wordpress+api-fetch@6.50.0/node_modules/@wordpress/api-fetch/build-module/index.js"),m=e("../../packages/my-jetpack/_inc/data/notices/use-fetching-error-notice.ts");const C=({name:y,query:j,options:R,errorMessage:L})=>{const x=(0,r.D)({mutationKey:[y],mutationFn:()=>(0,u.Z)(j),...R}),{isError:T,isPending:l}=x;return(0,m.o)({infoName:y,isError:!l&&T,overrideMessage:L}),x}},"../../packages/my-jetpack/_inc/hooks/use-my-jetpack-navigate/index.ts":(d,o,e)=>{e.d(o,{Z:()=>m});var r=e("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),u=e("../../../node_modules/.pnpm/react-router@6.6.2_react@18.2.0/node_modules/react-router/dist/index.js");function m(i){const C=(0,u.s0)();return(0,r.useCallback)(y=>C(i,y),[C,i])}}}]);})();
