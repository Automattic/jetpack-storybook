"use strict";(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[4370],{"../connection/components/use-connection/index.jsx":(gt,z,i)=>{i.d(z,{Z:()=>O});var h=i("../api/index.jsx"),_=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-dispatch/use-dispatch.js"),I=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),m=i("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),c=i("../connection/state/store.jsx");const l=window!=null&&window.JP_CONNECTION_INITIAL_STATE?window.JP_CONNECTION_INITIAL_STATE:{},O=function(){let{registrationNonce:k=l.registrationNonce,apiRoot:x=l.apiRoot,apiNonce:A=l.apiNonce,redirectUri:f,autoTrigger:S,from:U,skipUserConnection:F}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{registerSite:W,connectUser:v,refreshConnectedPlugins:B}=(0,_.Z)(c.t),L=(0,I.Z)(T=>T(c.t).getRegistrationError()),{siteIsRegistering:j,userIsConnecting:w,userConnectionData:P,connectedPlugins:G,connectionErrors:b,isRegistered:E,isUserConnected:R,hasConnectedOwner:N,isOfflineMode:y}=(0,I.Z)(T=>({siteIsRegistering:T(c.t).getSiteIsRegistering(),userIsConnecting:T(c.t).getUserIsConnecting(),userConnectionData:T(c.t).getUserConnectionData(),connectedPlugins:T(c.t).getConnectedPlugins(),connectionErrors:T(c.t).getConnectionErrors(),isOfflineMode:T(c.t).getIsOfflineMode(),...T(c.t).getConnectionStatus()})),Z=()=>{if(F){if(f)return window.location=f,Promise.resolve(f)}else return v({from:U,redirectUri:f});return Promise.resolve()},X=T=>(T&&T.preventDefault(),E?Z():W({registrationNonce:k,redirectUri:f}).then(()=>Z()));return(0,m.useEffect)(()=>{h.ZP.setApiRoot(x),h.ZP.setApiNonce(A)},[x,A]),(0,m.useEffect)(()=>{S&&!j&&!w&&X()},[]),{handleRegisterSite:X,handleConnectUser:Z,refreshConnectedPlugins:B,isRegistered:E,isUserConnected:R,siteIsRegistering:j,userIsConnecting:w,registrationError:L,userConnectionData:P,hasConnectedOwner:N,connectedPlugins:G,connectionErrors:b,isOfflineMode:y}}},"../connection/state/store.jsx":(gt,z,i)=>{i.d(z,{t:()=>$});var h=i("../api/index.jsx");const _="SET_CONNECTION_STATUS",I="SET_CONNECTION_STATUS_IS_FETCHING",m="FETCH_CONNECTION_STATUS",c="SET_SITE_IS_REGISTERING",l="SET_USER_IS_CONNECTING",O="SET_REGISTRATION_ERROR",k="CLEAR_REGISTRATION_ERROR",x="REGISTER_SITE",A="SET_AUTHORIZATION_URL",f="CONNECT_USER",S="DISCONNECT_USER_SUCCESS",U="FETCH_AUTHORIZATION_URL",F="SET_CONNECTED_PLUGINS",W="REFRESH_CONNECTED_PLUGINS",v="SET_CONNECTION_ERRORS",B="SET_IS_OFFLINE_MODE",L=s=>({type:_,connectionStatus:s}),j=s=>({type:I,isFetching:s}),w=()=>({type:m}),P=s=>({type:c,isRegistering:s}),G=s=>({type:l,isConnecting:s}),b=()=>({type:S}),E=s=>({type:O,registrationError:s}),R=()=>({type:k}),N=s=>({type:A,authorizationUrl:s}),y=s=>({type:U,redirectUri:s}),Z=s=>({type:F,connectedPlugins:s}),X=s=>({type:v,connectionErrors:s}),T=s=>({type:B,isOfflineMode:s});function rt(){let{from:s,redirectFunc:o,redirectUri:u}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){yield G(!0),yield{type:f,from:s,redirectFunc:o,redirectUri:u}}()}function Et(s){let{registrationNonce:o,redirectUri:u}=s;return function*(){yield R(),yield P(!0);try{const p=yield{type:x,registrationNonce:o,redirectUri:u};return yield L({isRegistered:!0}),yield N(p.authorizeUrl),yield P(!1),Promise.resolve(p)}catch(p){return yield E(p),yield P(!1),Promise.reject(p)}}()}const nt={setConnectionStatus:L,setConnectionStatusIsFetching:j,fetchConnectionStatus:w,fetchAuthorizationUrl:y,setSiteIsRegistering:P,setUserIsConnecting:G,setRegistrationError:E,clearRegistrationError:R,setAuthorizationUrl:N,registerSite:Et,connectUser:rt,disconnectUserSuccess:b,setConnectedPlugins:Z,refreshConnectedPlugins:()=>async s=>{let{dispatch:o}=s;return await new Promise(u=>h.ZP.fetchConnectedPlugins().then(p=>{o(Z(p)),u(p)}))},setConnectionErrors:X,setIsOfflineMode:T};var _t=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/factory.js");const $="jetpack-connection",ht=s=>{let{registrationNonce:o,redirectUri:u}=s;return h.ZP.registerSite(o,u)},mt=(0,_t.R)(s=>{let{resolveSelect:o}=s;return function(){let{from:u,redirectFunc:p,redirectUri:Y}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((st,yt)=>{o($).getAuthorizationUrl(Y).then(at=>{const Mt=p||(Ot=>window.location.assign(Ot)),ct=new URL(at);u&&ct.searchParams.set("from",encodeURIComponent(u));const ut=ct.toString();Mt(ut),st(ut)}).catch(at=>{yt(at)})})}}),Tt={FETCH_AUTHORIZATION_URL:s=>{let{redirectUri:o}=s;return h.ZP.fetchAuthorizationUrl(o)},REGISTER_SITE:ht,CONNECT_USER:mt};var q=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const K=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case _:return{...s,...o.connectionStatus};case S:return{...s,isUserConnected:!1}}return s},pt=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case F:return o.connectedPlugins}return s},J=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case I:return o.isFetching}return s},St=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case c:return o.isRegistering}return s},D=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case l:return o.isConnecting}return s},ot=(s,o)=>{switch(o.type){case k:return!1;case O:return o.registrationError;default:return s}},Lt=(s,o)=>{switch(o.type){case A:return o.authorizationUrl;default:return s}},jt=(s,o)=>{switch(o.type){default:return s}},wt=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case v:return o.connectionErrors}return s},bt=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case B:return o.isConnecting}return s},Dt=(0,q.UY)({connectionStatus:K,connectionStatusIsFetching:J,siteIsRegistering:St,userIsConnecting:D,registrationError:ot,authorizationUrl:Lt,userConnectionData:jt,connectedPlugins:pt,connectionErrors:wt,isOfflineMode:bt});var Ht=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/select.js"),Ct=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/dispatch.js");const It={...{getAuthorizationUrl:{isFulfilled:function(s){const o=!!s.authorizationUrl;for(var u=arguments.length,p=new Array(u>1?u-1:0),Y=1;Y<u;Y++)p[Y-1]=arguments[Y];const st=(0,Ht.Y)($).hasFinishedResolution("getAuthorizationUrl",p);return o&&!st&&(0,Ct.W)($).finishResolution("getAuthorizationUrl",p),o},*fulfill(s){const o=yield nt.fetchAuthorizationUrl(s);yield nt.setAuthorizationUrl(o.authorizeUrl)}}}},ft={...{getConnectionStatus:s=>s.connectionStatus||{},getConnectionStatusIsFetching:()=>!1,getSiteIsRegistering:s=>s.siteIsRegistering||!1,getUserIsConnecting:s=>s.userIsConnecting||!1,getRegistrationError:s=>s.registrationError||!1,getAuthorizationUrl:s=>s.authorizationUrl||!1,getUserConnectionData:s=>s.userConnectionData||!1,getConnectedPlugins:s=>s.connectedPlugins||[],getConnectionErrors:s=>s.connectionErrors||[],getIsOfflineMode:s=>s.isOfflineMode||!1,getWpcomUser:s=>{var o,u;return(u=(o=s==null?void 0:s.userConnectionData)==null?void 0:o.currentUser)==null?void 0:u.wpcomUser},getBlogId:s=>{var o,u;return(u=(o=s==null?void 0:s.userConnectionData)==null?void 0:o.currentUser)==null?void 0:u.blogId}}};var Pt=i("../../../node_modules/.pnpm/@babel+runtime@7.21.5/node_modules/@babel/runtime/helpers/defineProperty.js"),Rt=i.n(Pt),Nt=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");class M{static mayBeInit(o,u){M.store===null&&(M.store=(0,Nt.Z)(o,u),(0,q.z2)(M.store))}}Rt()(M,"store",null);const Zt=M,it=window.JP_CONNECTION_INITIAL_STATE;it||console.error("Jetpack Connection package: Initial state is missing. Check documentation to see how to use the Connection composer package to set up the initial state."),Zt.mayBeInit($,{__experimentalUseThunks:!0,reducer:Dt,actions:nt,selectors:ft,resolvers:It,controls:Tt,initialState:it||{}})},"../../packages/my-jetpack/_inc/components/product-card/action-buton.jsx":(gt,z,i)=>{i.d(z,{N:()=>l,Z:()=>k});var h=i("../components/components/button/index.tsx"),_=i("../../../node_modules/.pnpm/@wordpress+i18n@4.35.0/node_modules/@wordpress/i18n/build-module/index.js"),I=i("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),m=i("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const c=_.__,l={ACTIVE:"active",INACTIVE:"inactive",ERROR:"error",ABSENT:"plugin_absent",ABSENT_WITH_PLAN:"plugin_absent_with_plan",NEEDS_PURCHASE:"needs_purchase",NEEDS_PURCHASE_OR_FREE:"needs_purchase_or_free"},O=x=>{let{status:A,admin:f,name:S,slug:U,onActivate:F,onManage:W,onFixConnection:v,isFetching:B,isInstallingStandalone:L,isDeactivatingStandalone:j,isManageDisabled:w,className:P,onAdd:G}=x;if(!f)return(0,m.jsx)(h.Z,{...E,size:"small",variant:"link",weight:"regular",children:(0,_.gB)(c("Learn about %s","jetpack-my-jetpack"),S)});const b=B||L||j,E={variant:b?void 0:"primary",disabled:b,className:P};switch(A){case l.ABSENT:case l.ABSENT_WITH_PLAN:return(0,m.jsxs)(h.Z,{...E,size:"small",variant:"link",weight:"regular",children:[A===l.ABSENT&&(0,_.gB)(c("Get %s","jetpack-my-jetpack"),S),A===l.ABSENT_WITH_PLAN&&(0,_.gB)(c("Install %s","jetpack-my-jetpack"),S)]});case l.NEEDS_PURCHASE:{const R=c("Upgrade","jetpack-my-jetpack"),N=c("Purchase","jetpack-my-jetpack"),y=U==="stats"?R:N;return(0,m.jsx)(h.Z,{...E,size:"small",weight:"regular",onClick:G,children:y})}case l.NEEDS_PURCHASE_OR_FREE:return(0,m.jsx)(h.Z,{...E,size:"small",weight:"regular",onClick:G,children:c("Start for free","jetpack-my-jetpack")});case l.ACTIVE:{const R=c("View","jetpack-my-jetpack"),N=c("Manage","jetpack-my-jetpack"),y=U==="stats"?R:N;return(0,m.jsx)(h.Z,{...E,disabled:w||(E==null?void 0:E.disabled),size:"small",weight:"regular",variant:"secondary",onClick:W,children:y})}case l.ERROR:return(0,m.jsx)(h.Z,{...E,size:"small",weight:"regular",onClick:v,children:c("Fix connection","jetpack-my-jetpack")});case l.INACTIVE:return(0,m.jsx)(h.Z,{...E,size:"small",weight:"regular",variant:"secondary",onClick:F,children:c("Activate","jetpack-my-jetpack")});default:return null}};O.__docgenInfo={description:"",methods:[],displayName:"ActionButton"};const k=O},"../../packages/my-jetpack/_inc/state/store.js":(gt,z,i)=>{i.d(z,{t:()=>zt,N:()=>Xt});var h=i("../connection/state/store.jsx"),_=i("../../../node_modules/.pnpm/@wordpress+api-fetch@6.32.0/node_modules/@wordpress/api-fetch/build-module/index.js"),I=i("../../../node_modules/.pnpm/@wordpress+i18n@4.35.0/node_modules/@wordpress/i18n/build-module/index.js");const m="my-jetpack/v1",c=`${m}/site/purchases`,l=`${m}/site/products`,O=`${m}/chat/availability`,k=`${m}/chat/authentication`,x=["scan"],A="videopress",f="videopress/v1/stats/featured",S=I.__,U="SET_PURCHASES_IS_FETCHING",F="FETCH_PURCHASES",W="SET_PURCHASES",v="SET_AVAILABLE_LICENSES_IS_FETCHING",B="FETCH_AVAILABLE_LICENSES",L="SET_AVAILABLE_LICENSES",j="SET_IS_FETCHING_PRODUCT",w="SET_PRODUCT",P="SET_PRODUCT_REQUEST_ERROR",G="ACTIVATE_PRODUCT",b="SET_PRODUCT_STATUS",E="SET_CHAT_AVAILABILITY_IS_FETCHING",R="SET_CHAT_AVAILABILITY",N="SET_CHAT_AUTHENTICATION_IS_FETCHING",y="SET_CHAT_AUTHENTICATION",Z="SET_GLOBAL_NOTICE",X="CLEAN_GLOBAL_NOTICE",T="SET_PRODUCT_STATS",rt="SET_IS_FETCHING_PRODUCT_STATS",Et=t=>({type:U,isFetching:t}),Ut=t=>({type:E,isFetching:t}),nt=t=>({type:N,isFetching:t}),_t=()=>({type:F}),Ft=t=>({type:W,purchases:t}),$=t=>({type:R,chatAvailability:t}),ht=t=>({type:y,chatAuthentication:t}),mt=t=>({type:v,isFetching:t}),vt=()=>({type:B}),Tt=t=>({type:L,availableLicenses:t}),q=t=>({type:w,product:t}),K=(t,e)=>({type:P,productId:t,error:e}),pt=(t,e)=>({type:b,productId:t,status:e}),J=(t,e)=>({type:"SET_GLOBAL_NOTICE",message:t,options:e}),St=()=>({type:"CLEAN_GLOBAL_NOTICE"});function D(t,e){return{type:j,productId:t,isFetching:e}}function ot(t,e,r){let{select:n,dispatch:a,registry:d}=r;return new Promise((H,V)=>{if(!n.isValidProduct(t)){const C=S("Invalid product name","jetpack-my-jetpack"),dt=new Error(C);a(K(t,dt)),a(J(C,{status:"error",isDismissible:!0})),V(dt);return}const et=e.activate?"POST":"DELETE";return a(D(t,!0)),(0,_.Z)({path:`${l}/${t}`,method:et}).then(C=>{a(D(t,!1)),a(q(C)),d.dispatch(h.t).refreshConnectedPlugins(),H(C==null?void 0:C.status)}).catch(C=>{const{name:dt}=n.getProduct(t),qt=(0,I.gB)(S("Failed to activate %1$s. Please try again","jetpack-my-jetpack"),dt);a(D(t,!1)),a(K(t,C)),a(J(qt,{status:"error",isDismissible:!0})),V(C)})})}const Ct={setPurchasesIsFetching:Et,setChatAvailabilityIsFetching:Ut,setChatAuthenticationIsFetching:nt,fetchPurchases:_t,setPurchases:Ft,setChatAvailability:$,setChatAuthentication:ht,setAvailableLicensesIsFetching:mt,fetchAvailableLicenses:vt,setAvailableLicenses:Tt,setProductStats:(t,e)=>({type:T,productId:t,stats:e}),setIsFetchingProductStats:(t,e)=>({type:rt,productId:t,isFetching:e}),...{setGlobalNotice:J,cleanGlobalNotice:St},...{setProduct:q,activateProduct:t=>async e=>await ot(t,{activate:!0},e),deactivateStandalonePluginForProduct:t=>async e=>await ot(t,{activate:!1},e),installStandalonePluginForProduct:t=>async e=>{const{select:r,dispatch:n,registry:a}=e;return await new Promise((d,H)=>{if(!r.isValidProduct(t)){const g=S("Invalid product name","jetpack-my-jetpack"),et=new Error(g);n(K(t,et)),n(J(g,{status:"error",isDismissible:!0})),H(et);return}return n(D(t,!0)),(0,_.Z)({path:`${l}/${t}/install-standalone`,method:"POST"}).then(g=>{n(D(t,!1)),n(q(g)),a.dispatch(h.t).refreshConnectedPlugins(),d(g==null?void 0:g.standalone_plugin_info)}).catch(g=>{const{name:et}=r.getProduct(t),C=(0,I.gB)(S("Failed to install standalone plugin for %1$s: %2$s. Please try again","jetpack-my-jetpack"),et,g.message);n(D(t,!1)),n(K(t,g)),n(J(C,{status:"error",isDismissible:!0})),H(g)})})},setIsFetchingProduct:D,setRequestProductError:K,setProductStatus:pt}};function kt(){return new Promise((t,e)=>{(0,_.Z)({path:c}).then(t).catch(e)})}const It={[F]:kt};var At=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const xt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case j:{const{productId:r,isFetching:n}=e;return{...t,isFetching:{...t.isFetching,[r]:n},errors:{...t.errors,[r]:n?void 0:t.errors[r]}}}case b:{const{productId:r,status:n}=e;return{...t,items:{...t.items,[r]:{...t.items[r],status:n}}}}case w:{const{product:r}=e,{slug:n}=r;return{...t,items:{...t.items,[n]:r}}}case P:{const{productId:r,error:n}=e;return{...t,errors:{...t.errors,[r]:n}}}default:return t}},Bt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case U:return{...t,isFetching:e.isFetching};case W:return{...t,items:(e==null?void 0:e.purchases)||[]};default:return t}},Gt=function(){var r;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{isFetching:!1,isAvailable:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case E:return{...t,isFetching:e.isFetching};case R:return{...t,isAvailable:(r=e==null?void 0:e.chatAvailability)==null?void 0:r.is_available};default:return t}},ft=function(){var r,n;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{isFetching:!1,jwt:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case N:return{...t,isFetching:e.isFetching};case y:return{...t,jwt:(n=(r=e==null?void 0:e.chatAuthentication)==null?void 0:r.user)==null?void 0:n.jwt};default:return t}},Pt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case v:return{...t,isFetching:e.isFetching};case L:return{...t,items:(e==null?void 0:e.availableLicenses)||[]};default:return t}},Rt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{global:{}},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case Z:{const{message:r,options:n}=e;return{...t,global:{message:r,options:n}}}case X:return{...t,global:{}};default:return t}},Nt=function(){return arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}},M=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case rt:{const{productId:r,isFetching:n}=e;return{...t,isFetching:{...t.isFetching,[r]:n}}}case T:{const{productId:r,stats:n}=e;return{...t,items:{...t.items,[r]:n}}}default:return t}},it=(0,At.UY)({products:xt,purchases:Bt,chatAvailability:Gt,chatAuthentication:ft,availableLicenses:Pt,notices:Rt,plugins:Nt,stats:M});var s=i("../api/index.jsx"),o=i("../../packages/my-jetpack/_inc/components/product-card/action-buton.jsx");const p=async()=>(0,_.Z)({path:f}),st=async t=>t===A?p():null,yt=I.__,ct={...{getProduct:{isFulfilled:(t,e)=>{var n;return(((n=t==null?void 0:t.products)==null?void 0:n.items)||{}).hasOwnProperty(e)&&!x.includes(e)},fulfill:t=>async e=>{let{dispatch:r}=e;try{r.setIsFetchingProduct(t,!0);const n=await(0,_.Z)({path:`${l}/${t}`});return r.setProduct(n),r.setIsFetchingProduct(t,!1),Promise.resolve()}catch(n){if(r.setIsFetchingProduct(t,!1),n!=null&&n.code&&(n!=null&&n.message))return r.setRequestProductError(t,n),Promise.reject(n);throw new Error(n)}}},getPurchases:()=>async t=>{let{dispatch:e}=t;e.setPurchasesIsFetching(!0);try{e.setPurchases(await(0,_.Z)({path:c})),e.setPurchasesIsFetching(!1)}catch(r){e.setPurchasesIsFetching(!1),r.code!=="not_connected"&&e.setGlobalNotice(yt("There was an error fetching your purchases information. Check your site connectivity and try again.","jetpack-my-jetpack"),{status:"error"})}},getChatAvailability:()=>async t=>{let{dispatch:e}=t;e.setChatAvailabilityIsFetching(!0);try{e.setChatAvailability(await(0,_.Z)({path:O})),e.setChatAvailabilityIsFetching(!1)}catch(r){e.setChatAvailabilityIsFetching(!1)}},getChatAuthentication:()=>async t=>{let{dispatch:e}=t;e.setChatAuthenticationIsFetching(!0);try{e.setChatAuthentication(await(0,_.Z)({path:k})),e.setChatAuthenticationIsFetching(!1)}catch(r){e.setChatAuthenticationIsFetching(!1)}},getAvailableLicenses:()=>async t=>{let{dispatch:e}=t;e.setAvailableLicensesIsFetching(!0);try{const{apiRoot:r,apiNonce:n}=(window==null?void 0:window.myJetpackRest)||{};s.ZP.setApiRoot(r),s.ZP.setApiNonce(n);const a=await s.ZP.getUserLicenses();a&&a.items?e.setAvailableLicenses(a.items.filter(d=>{let{attached_at:H,revoked_at:V}=d;return H===null&&V===null})):e.setAvailableLicenses([])}catch(r){e.setAvailableLicenses([])}finally{e.setAvailableLicensesIsFetching(!1)}}},getProductStats:{isFulfilled:(t,e)=>{var r,n;return((n=(r=t.stats)==null?void 0:r.items)==null?void 0:n.hasOwnProperty(e))||!1},fulfill:t=>async e=>{let{dispatch:r,select:n}=e;const{status:a}=n.getProduct(t);if(a!==o.N.ACTIVE)return r.setProductStats(t,null),Promise.resolve();try{r.setIsFetchingProductStats(t,!0);const d=await st(t);return r.setProductStats(t,d),r.setIsFetchingProductStats(t,!1),Promise.resolve()}catch(d){if(r.setProductStats(t,null),r.setIsFetchingProductStats(t,!1),d!=null&&d.code&&(d!=null&&d.message))return Promise.reject(d);throw new Error(d)}}}};function ut(t){return t.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace("_",""))}function Ot(t){return t.indexOf("_")!==-1}function Q(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=Object.assign({},t);for(const n in r)r.hasOwnProperty(n)&&Ot(n)&&(r[ut(n)]=r[n],e&&delete r[n]);return r}const lt=t=>{var e;return((e=t.products)==null?void 0:e.items)||{}},Vt=t=>Object.keys(lt(t)),$t={...{getProducts:lt,getProductNames:Vt,getProduct:(t,e)=>{var a,d;const r=((a=lt(t))==null?void 0:a[e])||{},n=Q(r,!0);return n.standalonePluginInfo=Q(n.standalonePluginInfo||{},!0),n.pricingForUi=Q(n.pricingForUi||{},!0),n.pricingForUi.introductoryOffer=n.pricingForUi.isIntroductoryOffer?Q(n.pricingForUi.introductoryOffer,!0):null,(d=n.pricingForUi)!=null&&d.tiers&&(n.pricingForUi.tiers=Q(n.pricingForUi.tiers,!0),n.pricingForUi.tiers=Object.keys(n.pricingForUi.tiers).reduce((H,V)=>{const g=Q(n.pricingForUi.tiers[V],!0)||{};return H[V]={...g,introductoryOffer:g!=null&&g.isIntroductoryOffer?Q(g==null?void 0:g.introductoryOffer,!0):null},H},{})),n.features=n.features||[],n.supportedProducts=n.supportedProducts||[],n.pricingForUi.fullPricePerMonth=n.pricingForUi.productTerm==="year"?Math.ceil(n.pricingForUi.fullPrice/12*100)/100:n.pricingForUi.fullPrice,n.pricingForUi.discountPricePerMonth=n.pricingForUi.productTerm==="year"?Math.ceil(n.pricingForUi.discountPrice/12*100)/100:n.pricingForUi.discountPrice,n},isValidProduct:(t,e)=>Vt(t).includes(e),isFetching:(t,e)=>{var r,n;return((n=(r=t.products)==null?void 0:r.isFetching)==null?void 0:n[e])||!1},getProductsThatRequiresUserConnection:t=>{const e=lt(t);return Object.keys(e).reduce((r,n)=>{const a=e[n];return(a==null?void 0:a.requires_user_connection)&&((a==null?void 0:a.status)===o.N.ACTIVE||(a==null?void 0:a.status)===o.N.ERROR)&&r.push(a==null?void 0:a.name),r},[])}},...{getPurchases:t=>{var e;return((e=t.purchases)==null?void 0:e.items)||[]},isRequestingPurchases:t=>{var e;return((e=t.purchases)==null?void 0:e.isFetching)||!1}},...{getChatAvailability:t=>t.chatAvailability.isAvailable,isRequestingChatAvailability:t=>t.chatAvailability.isFetching},...{getChatAuthentication:t=>t.chatAuthentication.jwt,isRequestingChatAuthentication:t=>t.chatAuthentication.isFetching},...{getAvailableLicenses:t=>{var e;return((e=t.availableLicenses)==null?void 0:e.items)||[]},isFetchingAvailableLicenses:t=>{var e;return((e=t.availableLicenses)==null?void 0:e.isFetching)||!1}},...{getGlobalNotice:t=>{var e;return(e=t.notices)==null?void 0:e.global}},...{hasStandalonePluginInstalled:t=>Object.values(t.plugins).filter(e=>["jetpack-backup","jetpack-boost","jetpack-protect","jetpack-search","jetpack-social","jetpack-videopress"].indexOf(e.TextDomain)>=0).length>0},...{getProductStats:(t,e)=>{var r,n;return(n=(r=t.stats)==null?void 0:r.items)==null?void 0:n[e]},isFetchingProductStats:(t,e)=>{var r,n;return((n=(r=t.stats)==null?void 0:r.isFetching)==null?void 0:n[e])||!1}}};var Kt=i("../../../node_modules/.pnpm/@babel+runtime@7.21.5/node_modules/@babel/runtime/helpers/defineProperty.js"),Jt=i.n(Kt),Yt=i("../../../node_modules/.pnpm/@wordpress+data@9.5.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");class tt{static mayBeInit(e,r){tt.store===null&&(tt.store=(0,Yt.Z)(e,r),(0,At.z2)(tt.store))}}Jt()(tt,"store",null);const Qt=tt,zt="my-jetpack";function Xt(){Qt.mayBeInit(zt,{__experimentalUseThunks:!0,reducer:it,actions:Ct,selectors:$t,resolvers:ct,controls:It,initialState:window.myJetpackInitialState||{}})}}}]);})();
