(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[3648],{"../../../node_modules/.pnpm/@wordpress+compose@6.25.0_react@18.2.0/node_modules/@wordpress/compose/build-module/hooks/use-focusable-iframe/index.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Z:()=>pt});var ct=$("../../../node_modules/.pnpm/@wordpress+compose@6.25.0_react@18.2.0/node_modules/@wordpress/compose/build-module/hooks/use-ref-effect/index.js");function pt(){return(0,ct.Z)(it=>{const{ownerDocument:N}=it;if(!N)return;const{defaultView:D}=N;if(!D)return;function y(){N&&N.activeElement===it&&it.focus()}return D.addEventListener("blur",y),()=>{D.removeEventListener("blur",y)}},[])}},"../../../node_modules/.pnpm/@wordpress+sync@0.10.0/node_modules/@wordpress/sync/build-module/connect-indexdb.js":(Ht,kt,$)=>{"use strict";$.d(kt,{D:()=>Xt});var ct=$("../../../node_modules/.pnpm/yjs@13.6.8/node_modules/yjs/dist/yjs.mjs"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/promise.js"),it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/error.js");const N=at=>pt.Ue((nt,ut)=>{at.onerror=_t=>ut(new Error(_t.target.error)),at.onsuccess=_t=>nt(_t.target.result)}),D=(at,nt)=>pt.Ue((ut,_t)=>{const vt=indexedDB.open(at);vt.onupgradeneeded=Ut=>nt(Ut.target.result),vt.onerror=Ut=>_t(it.Ue(Ut.target.error)),vt.onsuccess=Ut=>{const Ft=Ut.target.result;Ft.onversionchange=()=>{Ft.close()},ut(Ft)}}),y=at=>N(indexedDB.deleteDatabase(at)),g=(at,nt)=>nt.forEach(ut=>at.createObjectStore.apply(at,ut)),U=(at,nt,ut="readwrite")=>{const _t=at.transaction(nt,ut);return nt.map(vt=>Y(_t,vt))},M=(at,nt)=>N(at.count(nt)),a=(at,nt)=>N(at.get(nt)),w=(at,nt)=>N(at.delete(nt)),d=(at,nt,ut)=>N(at.put(nt,ut)),h=(at,nt,ut)=>N(at.add(nt,ut)),L=(at,nt)=>N(at.add(nt)),R=(at,nt,ut)=>N(at.getAll(nt,ut)),S=(at,nt,ut)=>N(at.getAllKeys(nt,ut)),B=(at,nt,ut)=>{let _t=null;return A(at,nt,vt=>(_t=vt,!1),ut).then(()=>_t)},u=(at,nt=null)=>B(at,nt,"prev"),_=(at,nt=null)=>B(at,nt,"next"),m=(at,nt,ut)=>promise.all([S(at,nt,ut),R(at,nt,ut)]).then(([_t,vt])=>_t.map((Ut,Ft)=>({k:Ut,v:vt[Ft]}))),C=(at,nt)=>pt.Ue((ut,_t)=>{at.onerror=_t,at.onsuccess=async vt=>{const Ut=vt.target.result;if(Ut===null||await nt(Ut)===!1)return ut();Ut.continue()}}),v=(at,nt,ut,_t="next")=>C(at.openCursor(nt,_t),vt=>ut(vt.value,vt.key)),A=(at,nt,ut,_t="next")=>C(at.openKeyCursor(nt,_t),vt=>ut(vt.key)),Y=(at,nt)=>at.objectStore(nt),x=(at,nt,ut,_t)=>IDBKeyRange.bound(at,nt,ut,_t),P=(at,nt)=>IDBKeyRange.upperBound(at,nt),q=(at,nt)=>IDBKeyRange.lowerBound(at,nt);var ot=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/observable.js");const wt="custom",Ct="updates",Dt=500,It=(at,nt=()=>{},ut=()=>{})=>{const[_t]=U(at.db,[Ct]);return R(_t,q(at._dbref,!1)).then(vt=>{at._destroyed||(nt(_t),ct.ay(at.doc,()=>{vt.forEach(Ut=>ct.NG(at.doc,Ut))},at,!1),ut(_t))}).then(()=>u(_t).then(vt=>{at._dbref=vt+1})).then(()=>M(_t).then(vt=>{at._dbsize=vt})).then(()=>_t)},Mt=(at,nt=!0)=>It(at).then(ut=>{(nt||at._dbsize>=Dt)&&L(ut,ct.D$(at.doc)).then(()=>w(ut,P(at._dbref,!0))).then(()=>M(ut).then(_t=>{at._dbsize=_t}))}),St=at=>idb.deleteDB(at);class ee extends ot.y{constructor(nt,ut){super(),this.doc=ut,this.name=nt,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=D(nt,_t=>g(_t,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=pt.Ue(_t=>this.on("synced",()=>_t(this))),this._db.then(_t=>{this.db=_t,It(this,Ft=>L(Ft,ct.D$(ut)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(_t,vt)=>{if(this.db&&vt!==this){const[Ut]=U(this.db,[Ct]);L(Ut,_t),++this._dbsize>=Dt&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{Mt(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},ut.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),ut.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(nt=>{nt.close()})}clearData(){return this.destroy().then(()=>{y(this.name)})}get(nt){return this._db.then(ut=>{const[_t]=U(ut,[wt],"readonly");return a(_t,nt)})}set(nt,ut){return this._db.then(_t=>{const[vt]=U(_t,[wt]);return d(vt,ut,nt)})}del(nt){return this._db.then(ut=>{const[_t]=U(ut,[wt]);return w(_t,nt)})}}function Xt(at,nt,ut){const _t=`${nt}-${at}`,vt=new ee(_t,ut);return new Promise(Ut=>{vt.on("synced",()=>{Ut(()=>vt.destroy())})})}},"../../../node_modules/.pnpm/@wordpress+sync@0.10.0/node_modules/@wordpress/sync/build-module/create-webrtc-connection.js":(Ht,kt,$)=>{"use strict";$.d(kt,{y:()=>Ce});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/observable.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/time.js"),it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/math.js");const N=1200,D=2500,y=3e4,g=O=>{if(O.shouldConnect&&O.ws===null){const H=new WebSocket(O.url),J=O.binaryType;let lt=null;J&&(H.binaryType=J),O.ws=H,O.connecting=!0,O.connected=!1,H.onmessage=dt=>{O.lastMessageReceived=pt.ZG();const Rt=dt.data,At=typeof Rt=="string"?JSON.parse(Rt):Rt;At&&At.type==="pong"&&(clearTimeout(lt),lt=setTimeout(Et,y/2)),O.emit("message",[At,O])};const rt=dt=>{O.ws!==null&&(O.ws=null,O.connecting=!1,O.connected?(O.connected=!1,O.emit("disconnect",[{type:"disconnect",error:dt},O])):O.unsuccessfulReconnects++,setTimeout(g,it.VV(it.mv(O.unsuccessfulReconnects+1)*N,D),O)),clearTimeout(lt)},Et=()=>{O.ws===H&&O.send({type:"ping"})};H.onclose=()=>rt(null),H.onerror=dt=>rt(dt),H.onopen=()=>{O.lastMessageReceived=pt.ZG(),O.connecting=!1,O.connected=!0,O.unsuccessfulReconnects=0,O.emit("connect",[{type:"connect"},O]),lt=setTimeout(Et,y/2)}}};class U extends ct.y{constructor(H,{binaryType:J}={}){super(),this.url=H,this.ws=null,this.binaryType=J||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&y<pt.ZG()-this.lastMessageReceived&&this.ws.close()},y/2),g(this)}send(H){this.ws&&this.ws.send(JSON.stringify(H))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&g(this)}}var M=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/map.js"),a=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/error.js"),w=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/random.js"),d=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/encoding.js"),h=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/decoding.js"),L=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.js"),R=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.common.js"),S=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/promise.js"),B=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/set.js"),u=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/buffer.js"),_=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/storage.js");const m=new Map;class C{constructor(H){this.room=H,this.onmessage=null,this._onChange=J=>J.key===H&&this.onmessage!==null&&this.onmessage({data:u.Gh(J.newValue||"")}),_.z2(this._onChange)}postMessage(H){_.XN.setItem(this.room,u.s3(u.eh(H)))}close(){_.F(this._onChange)}}const v=typeof BroadcastChannel=="undefined"?C:BroadcastChannel,A=O=>M.Yu(m,O,()=>{const H=B.Ue(),J=new v(O);return J.onmessage=lt=>H.forEach(rt=>rt(lt.data,"broadcastchannel")),{bc:J,subs:H}}),Y=(O,H)=>(A(O).subs.add(H),H),x=(O,H)=>{const J=A(O),lt=J.subs.delete(H);return lt&&J.subs.size===0&&(J.bc.close(),m.delete(O)),lt},P=(O,H,J=null)=>{const lt=A(O);lt.bc.postMessage(H),lt.subs.forEach(rt=>rt(H,J))},q=()=>{let O=!0;return(H,J)=>{if(O){O=!1;try{H()}finally{O=!0}}else J!==void 0&&J()}};var ot=$("../../../node_modules/.pnpm/simple-peer@9.11.1/node_modules/simple-peer/simplepeer.min.js"),wt=$.n(ot),Ct=$("../../../node_modules/.pnpm/yjs@13.6.8/node_modules/yjs/dist/yjs.mjs");const Dt=0,It=1,Mt=2,St=(O,H)=>{d.uE(O,Dt);const J=Ct.gJ(H);d.mP(O,J)},ee=(O,H,J)=>{d.uE(O,It),d.mP(O,Ct.D$(H,J))},Xt=(O,H,J)=>ee(H,J,h.HN(O)),at=(O,H,J)=>{try{Ct.NG(H,h.HN(O),J)}catch(lt){console.error("Caught error while handling a Yjs update",lt)}},nt=(O,H)=>{d.uE(O,Mt),d.mP(O,H)},ut=at,_t=(O,H,J,lt)=>{const rt=h.yg(O);switch(rt){case Dt:Xt(O,H,J);break;case It:at(O,J,lt);break;case Mt:ut(O,J,lt);break;default:throw new Error("Unknown message type")}return rt};var vt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/function.js");const Ut=3e4;class Ft extends ct.y{constructor(H){super(),this.doc=H,this.clientID=H.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const J=pt.ZG();this.getLocalState()!==null&&Ut/2<=J-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const lt=[];this.meta.forEach((rt,Et)=>{Et!==this.clientID&&Ut<=J-rt.lastUpdated&&this.states.has(Et)&&lt.push(Et)}),lt.length>0&&te(this,lt,"timeout")},it.GW(Ut/10)),H.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(H){const J=this.clientID,lt=this.meta.get(J),rt=lt===void 0?0:lt.clock+1,Et=this.states.get(J);H===null?this.states.delete(J):this.states.set(J,H),this.meta.set(J,{clock:rt,lastUpdated:pt.ZG()});const dt=[],Rt=[],At=[],Bt=[];H===null?Bt.push(J):Et==null?H!=null&&dt.push(J):(Rt.push(J),vt.Hi(Et,H)||At.push(J)),(dt.length>0||At.length>0||Bt.length>0)&&this.emit("change",[{added:dt,updated:At,removed:Bt},"local"]),this.emit("update",[{added:dt,updated:Rt,removed:Bt},"local"])}setLocalStateField(H,J){const lt=this.getLocalState();lt!==null&&this.setLocalState({...lt,[H]:J})}getStates(){return this.states}}const te=(O,H,J)=>{const lt=[];for(let rt=0;rt<H.length;rt++){const Et=H[rt];if(O.states.has(Et)){if(O.states.delete(Et),Et===O.clientID){const dt=O.meta.get(Et);O.meta.set(Et,{clock:dt.clock+1,lastUpdated:pt.ZG()})}lt.push(Et)}}lt.length>0&&(O.emit("change",[{added:[],updated:[],removed:lt},J]),O.emit("update",[{added:[],updated:[],removed:lt},J]))},Pt=(O,H,J=O.states)=>{const lt=H.length,rt=d.Mf();d.uE(rt,lt);for(let Et=0;Et<lt;Et++){const dt=H[Et],Rt=J.get(dt)||null,At=O.meta.get(dt).clock;d.uE(rt,dt),d.uE(rt,At),d.uw(rt,JSON.stringify(Rt))}return d._f(rt)},re=(O,H)=>{const J=decoding.createDecoder(O),lt=encoding.createEncoder(),rt=decoding.readVarUint(J);encoding.writeVarUint(lt,rt);for(let Et=0;Et<rt;Et++){const dt=decoding.readVarUint(J),Rt=decoding.readVarUint(J),At=JSON.parse(decoding.readVarString(J)),Bt=H(At);encoding.writeVarUint(lt,dt),encoding.writeVarUint(lt,Rt),encoding.writeVarString(lt,JSON.stringify(Bt))}return encoding.toUint8Array(lt)},G=(O,H,J)=>{const lt=h.l1(H),rt=pt.ZG(),Et=[],dt=[],Rt=[],At=[],Bt=h.yg(lt);for(let jt=0;jt<Bt;jt++){const qt=h.yg(lt);let oe=h.yg(lt);const fe=JSON.parse(h.kf(lt)),Me=O.meta.get(qt),mn=O.states.get(qt),pe=Me===void 0?0:Me.clock;(pe<oe||pe===oe&&fe===null&&O.states.has(qt))&&(fe===null?qt===O.clientID&&O.getLocalState()!=null?oe++:O.states.delete(qt):O.states.set(qt,fe),O.meta.set(qt,{clock:oe,lastUpdated:rt}),Me===void 0&&fe!==null?Et.push(qt):Me!==void 0&&fe===null?At.push(qt):fe!==null&&(vt.Hi(fe,mn)||Rt.push(qt),dt.push(qt)))}(Et.length>0||Rt.length>0||At.length>0)&&O.emit("change",[{added:Et,updated:Rt,removed:At},J]),(Et.length>0||dt.length>0||At.length>0)&&O.emit("update",[{added:Et,updated:dt,removed:At},J])};var tt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/string.js");const bt=(O,H)=>{const J=tt.lz(O).buffer,lt=tt.lz(H).buffer;return crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveKey"]).then(rt=>crypto.subtle.deriveKey({name:"PBKDF2",salt:lt,iterations:1e5,hash:"SHA-256"},rt,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},V=(O,H)=>{if(!H)return S.DB(O);const J=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:J},H,O).then(lt=>{const rt=d.Mf();return d.uw(rt,"AES-GCM"),d.mP(rt,J),d.mP(rt,new Uint8Array(lt)),d._f(rt)})},b=(O,H)=>{const J=d.Mf();return d.EM(J,O),V(d._f(J),H)},T=(O,H)=>{if(!H)return S.DB(O);const J=h.l1(O);h.kf(J)!=="AES-GCM"&&S.d1(a.Ue("Unknown encryption algorithm"));const rt=h.HN(J),Et=h.HN(J);return crypto.subtle.decrypt({name:"AES-GCM",iv:rt},H,Et).then(dt=>new Uint8Array(dt))},Z=(O,H)=>T(O,H).then(J=>h.v_(h.l1(new Uint8Array(J))));var gt=$("../../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");const n=L.YX("y-webrtc"),s=0,c=3,k=1,z=4,K=new Map,ht=new Map,Tt=O=>{let H=!0;O.webrtcConns.forEach(J=>{J.synced||(H=!1)}),(!H&&O.synced||H&&!O.synced)&&(O.synced=H,O.provider.emit("synced",[{synced:H}]),n("synced ",R.Pl,O.name,R.YW," with all peers"))},Vt=(O,H,J)=>{const lt=h.l1(H),rt=d.Mf(),Et=h.yg(lt);if(O===void 0)return null;const dt=O.awareness,Rt=O.doc;let At=!1;switch(Et){case s:{d.uE(rt,s);const Bt=_t(lt,rt,Rt,O);Bt===It&&!O.synced&&J(),Bt===Dt&&(At=!0);break}case c:d.uE(rt,k),d.mP(rt,Pt(dt,Array.from(dt.getStates().keys()))),At=!0;break;case k:G(dt,h.HN(lt),O);break;case z:{const Bt=h.kj(lt)===1,jt=h.kf(lt);if(jt!==O.peerId&&(O.bcConns.has(jt)&&!Bt||!O.bcConns.has(jt)&&Bt)){const qt=[],oe=[];Bt?(O.bcConns.add(jt),oe.push(jt)):(O.bcConns.delete(jt),qt.push(jt)),O.provider.emit("peers",[{added:oe,removed:qt,webrtcPeers:Array.from(O.webrtcConns.keys()),bcPeers:Array.from(O.bcConns)}]),mt(O)}break}default:return console.error("Unable to compute message"),rt}return At?rt:null},Nt=(O,H)=>{const J=O.room;return n("received message from ",R.Pl,O.remotePeerId,R.s7," (",J.name,")",R.YW,R.WO),Vt(J,H,()=>{O.synced=!0,n("synced ",R.Pl,J.name,R.YW," with ",R.Pl,O.remotePeerId),Tt(J)})},Ot=(O,H)=>{n("send message to ",R.Pl,O.remotePeerId,R.YW,R.s7," (",O.room.name,")",R.WO);try{O.peer.send(d._f(H))}catch(J){}},xt=(O,H)=>{n("broadcast message in ",R.Pl,O.name,R.YW),O.webrtcConns.forEach(J=>{try{J.peer.send(H)}catch(lt){}})};class se{constructor(H,J,lt,rt){n("establishing connection to ",R.Pl,lt),this.room=rt,this.remotePeerId=lt,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new(wt())({initiator:J,...rt.provider.peerOpts}),this.peer.on("signal",Et=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),zt(H,rt,{to:lt,from:rt.peerId,type:"signal",token:this.glareToken,signal:Et})}),this.peer.on("connect",()=>{n("connected to ",R.Pl,lt),this.connected=!0;const dt=rt.provider.doc,Rt=rt.awareness,At=d.Mf();d.uE(At,s),St(At,dt),Ot(this,At);const Bt=Rt.getStates();if(Bt.size>0){const jt=d.Mf();d.uE(jt,k),d.mP(jt,Pt(Rt,Array.from(Bt.keys()))),Ot(this,jt)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,rt.webrtcConns.has(this.remotePeerId)&&(rt.webrtcConns.delete(this.remotePeerId),rt.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(rt.webrtcConns.keys()),bcPeers:Array.from(rt.bcConns)}])),Tt(rt),this.peer.destroy(),n("closed connection to ",R.Pl,lt),yt(rt)}),this.peer.on("error",Et=>{n("Error in connection to ",R.Pl,lt,": ",Et),yt(rt)}),this.peer.on("data",Et=>{const dt=Nt(this,Et);dt!==null&&Ot(this,dt)})}destroy(){this.peer.destroy()}}const X=(O,H)=>V(H,O.key).then(J=>O.mux(()=>P(O.name,J))),st=(O,H)=>{O.bcconnected&&X(O,H),xt(O,H)},yt=O=>{K.forEach(H=>{H.connected&&(H.send({type:"subscribe",topics:[O.name]}),O.webrtcConns.size<O.provider.maxConns&&zt(H,O,{type:"announce",from:O.peerId}))})},mt=O=>{if(O.provider.filterBcConns){const H=d.Mf();d.uE(H,z),d.$F(H,1),d.uw(H,O.peerId),X(O,d._f(H))}};class Wt{constructor(H,J,lt,rt){this.peerId=w.k$(),this.doc=H,this.awareness=J.awareness,this.provider=J,this.synced=!1,this.name=lt,this.key=rt,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=q(),this.bcconnected=!1,this._bcSubscriber=Et=>T(new Uint8Array(Et),rt).then(dt=>this.mux(()=>{const Rt=Vt(this,dt,()=>{});Rt&&X(this,d._f(Rt))})),this._docUpdateHandler=(Et,dt)=>{const Rt=d.Mf();d.uE(Rt,s),nt(Rt,Et),st(this,d._f(Rt))},this._awarenessUpdateHandler=({added:Et,updated:dt,removed:Rt},At)=>{const Bt=Et.concat(dt).concat(Rt),jt=d.Mf();d.uE(jt,k),d.mP(jt,Pt(this.awareness,Bt)),st(this,d._f(jt))},this._beforeUnloadHandler=()=>{te(this.awareness,[H.clientID],"window unload"),ht.forEach(Et=>{Et.disconnect()})},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof gt!="undefined"&&gt.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),yt(this);const H=this.name;Y(H,this._bcSubscriber),this.bcconnected=!0,mt(this);const J=d.Mf();d.uE(J,s),St(J,this.doc),X(this,d._f(J));const lt=d.Mf();d.uE(lt,s),ee(lt,this.doc),X(this,d._f(lt));const rt=d.Mf();d.uE(rt,c),X(this,d._f(rt));const Et=d.Mf();d.uE(Et,k),d.mP(Et,Pt(this.awareness,[this.doc.clientID])),X(this,d._f(Et))}disconnect(){K.forEach(J=>{J.connected&&J.send({type:"unsubscribe",topics:[this.name]})}),te(this.awareness,[this.doc.clientID],"disconnect");const H=d.Mf();d.uE(H,z),d.$F(H,0),d.uw(H,this.peerId),X(this,d._f(H)),x(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(J=>J.destroy())}destroy(){this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof gt!="undefined"&&gt.off("exit",this._beforeUnloadHandler)}}const Zt=(O,H,J,lt)=>{if(ht.has(J))throw a.Ue(`A Yjs Doc connected to room "${J}" already exists!`);const rt=new Wt(O,H,J,lt);return ht.set(J,rt),rt},zt=(O,H,J)=>{H.key?b(J,H.key).then(lt=>{O.send({type:"publish",topic:H.name,data:u.s3(lt)})}):O.send({type:"publish",topic:H.name,data:J})};class ce extends U{constructor(H){super(H),this.providers=new Set,this.on("connect",()=>{n(`connected (${H})`);const J=Array.from(ht.keys());this.send({type:"subscribe",topics:J}),ht.forEach(lt=>zt(this,lt,{type:"announce",from:lt.peerId}))}),this.on("message",J=>{switch(J.type){case"publish":{const lt=J.topic,rt=ht.get(lt);if(rt==null||typeof lt!="string")return;const Et=dt=>{const Rt=rt.webrtcConns,At=rt.peerId;if(dt==null||dt.from===At||dt.to!==void 0&&dt.to!==At||rt.bcConns.has(dt.from))return;const Bt=Rt.has(dt.from)?()=>{}:()=>rt.provider.emit("peers",[{removed:[],added:[dt.from],webrtcPeers:Array.from(rt.webrtcConns.keys()),bcPeers:Array.from(rt.bcConns)}]);switch(dt.type){case"announce":Rt.size<rt.provider.maxConns&&(M.Yu(Rt,dt.from,()=>new se(this,!0,dt.from,rt)),Bt());break;case"signal":if(dt.signal.type==="offer"){const jt=Rt.get(dt.from);if(jt){const qt=dt.token,oe=jt.glareToken;if(oe&&oe>qt){n("offer rejected: ",dt.from);return}jt.glareToken=void 0}}if(dt.signal.type==="answer"){n("offer answered by: ",dt.from);const jt=Rt.get(dt.from);jt.glareToken=void 0}dt.to===At&&(M.Yu(Rt,dt.from,()=>new se(this,!1,dt.from,rt)).peer.signal(dt.signal),Bt());break}};rt.key?typeof J.data=="string"&&Z(u.Gh(J.data),rt.key).then(Et):Et(J.data)}}}),this.on("disconnect",()=>n(`disconnect (${H})`))}}class Se extends ct.y{constructor(H,J,{signaling:lt=["wss://y-webrtc-eu.fly.dev"],password:rt=null,awareness:Et=new Ft(J),maxConns:dt=20+it.GW(w.TN()*15),filterBcConns:Rt=!0,peerOpts:At={}}={}){super(),this.roomName=H,this.doc=J,this.filterBcConns=Rt,this.awareness=Et,this.shouldConnect=!1,this.signalingUrls=lt,this.signalingConns=[],this.maxConns=dt,this.peerOpts=At,this.key=rt?bt(rt,H):S.DB(null),this.room=null,this.key.then(Bt=>{this.room=Zt(J,this,H,Bt),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),J.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(H=>{const J=M.Yu(K,H,()=>new ce(H));this.signalingConns.push(J),J.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(H=>{H.providers.delete(this),H.providers.size===0&&(H.destroy(),K.delete(H.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),ht.delete(this.roomName)}),super.destroy()}}var gn=$("../../../node_modules/.pnpm/@wordpress+url@3.49.0/node_modules/@wordpress/url/build-module/add-query-args.js");function Ue(O,H){O.on("connect",()=>{n(`connected (${H})`);const J=Array.from(ht.keys());O.send({type:"subscribe",topics:J}),ht.forEach(lt=>zt(O,lt,{type:"announce",from:lt.peerId}))}),O.on("message",J=>{switch(J.type){case"publish":{const lt=J.topic,rt=ht.get(lt);if(rt===null||typeof lt!="string"||rt===void 0)return;const Et=dt=>{const Rt=rt.webrtcConns,At=rt.peerId;if(dt===null||dt.from===At||dt.to!==void 0&&dt.to!==At||rt.bcConns.has(dt.from))return;const Bt=Rt.has(dt.from)?()=>{}:()=>rt.provider.emit("peers",[{removed:[],added:[dt.from],webrtcPeers:Array.from(rt.webrtcConns.keys()),bcPeers:Array.from(rt.bcConns)}]);switch(dt.type){case"announce":Rt.size<rt.provider.maxConns&&(M.Yu(Rt,dt.from,()=>new se(O,!0,dt.from,rt)),Bt());break;case"signal":if(dt.signal.type==="offer"){const jt=Rt.get(dt.from);if(jt){const qt=dt.token,oe=jt.glareToken;if(oe&&oe>qt){n("offer rejected: ",dt.from);return}jt.glareToken=void 0}}if(dt.signal.type==="answer"){n("offer answered by: ",dt.from);const jt=Rt.get(dt.from);jt&&(jt.glareToken=void 0)}dt.to===At&&(M.Yu(Rt,dt.from,()=>new se(O,!1,dt.from,rt)).peer.signal(dt.signal),Bt());break}};rt.key?typeof J.data=="string"&&Z(u.Gh(J.data),rt.key).then(Et):Et(J.data)}}}),O.on("disconnect",()=>n(`disconnect (${H})`))}function qe(O){if(O.shouldConnect&&O.ws===null){const H=Math.floor(1e5+Math.random()*9e5),J=O.url,lt=new window.EventSource((0,gn.f)(J,{subscriber_id:H,action:"gutenberg_signaling_server"}));let rt=null;lt.onmessage=At=>{O.lastMessageReceived=Date.now();const Bt=At.data;if(Bt){const jt=JSON.parse(Bt);Array.isArray(jt)&&jt.forEach(Et)}},O.ws=lt,O.connecting=!0,O.connected=!1;const Et=At=>{At&&At.type==="pong"&&(clearTimeout(rt),rt=setTimeout(Rt,Oe/2)),O.emit("message",[At,O])},dt=At=>{O.ws!==null&&(O.ws.close(),O.ws=null,O.connecting=!1,O.connected?(O.connected=!1,O.emit("disconnect",[{type:"disconnect",error:At},O])):O.unsuccessfulReconnects++),clearTimeout(rt)},Rt=()=>{O.ws&&O.ws.readyState===window.EventSource.OPEN&&O.send({type:"ping"})};O.ws&&(O.ws.onclose=()=>{dt(null)},O.ws.send=function(Bt){window.fetch(J,{body:new URLSearchParams({subscriber_id:H.toString(),action:"gutenberg_signaling_server",message:Bt}),method:"POST"}).catch(()=>{n("Error sending to server with message: "+Bt)})}),lt.onerror=()=>{},lt.onopen=()=>{O.connected||lt.readyState===window.EventSource.OPEN&&(O.lastMessageReceived=Date.now(),O.connecting=!1,O.connected=!0,O.unsuccessfulReconnects=0,O.emit("connect",[{type:"connect"},O]),rt=setTimeout(Rt,Oe/2))}}}const Oe=3e4;class Qe extends ct.y{constructor(H){super(),this.url=H,this.ws=null,this.binaryType=null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Oe<Date.now()-this.lastMessageReceived&&this.ws&&this.ws.close()},Oe/2),qe(this),this.providers=new Set,Ue(this,H)}send(H){this.ws&&this.ws.send(JSON.stringify(H))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&qe(this)}}class tn extends Se{connect(){this.shouldConnect=!0,this.signalingUrls.forEach(H=>{const J=M.Yu(K,H,H.startsWith("ws://")||H.startsWith("wss://")?()=>new ce(H):()=>new Qe(H));this.signalingConns.push(J),J.providers.add(this)}),this.room&&this.room.connect()}}function Ce({signaling:O,password:H}){return function(J,lt,rt){const Et=`${lt}-${J}`;return new tn(Et,rt,{signaling:O,password:H}),Promise.resolve(()=>!0)}}},"../../../node_modules/.pnpm/@wordpress+sync@0.10.0/node_modules/@wordpress/sync/build-module/provider.js":(Ht,kt,$)=>{"use strict";$.d(kt,{G:()=>pt});var ct=$("../../../node_modules/.pnpm/yjs@13.6.8/node_modules/yjs/dist/yjs.mjs");const pt=(it,N)=>{const D={},y={},g={};function U(d,h){D[d]=h}async function M(d,h,L){const R=new ct.QW;g[d]=g[d]||{},g[d][h]=R;const S=()=>{const _=D[d].fromCRDTDoc(R);L(_)};R.on("update",S);const B=await it(h,d,R);N&&await N(h,d,R);const u=D[d].fetch;u&&u(h).then(_=>{R.transact(()=>{D[d].applyChangesToDoc(R,_)})}),y[d]=y[d]||{},y[d][h]=()=>{B(),R.off("update",S)}}async function a(d,h,L){const R=g[d][h];if(!R)throw"Error doc "+d+" "+h+" not found";R.transact(()=>{D[d].applyChangesToDoc(R,L)})}async function w(d,h){var L;(L=y==null?void 0:y[d])!=null&&L[h]&&y[d][h]()}return{register:U,bootstrap:M,update:a,discard:w}}},"../../../node_modules/.pnpm/@wordpress+undo-manager@0.8.0/node_modules/@wordpress/undo-manager/build-module/index.js":(Ht,kt,$)=>{"use strict";$.d(kt,{U:()=>N});var ct=$("../../../node_modules/.pnpm/@wordpress+is-shallow-equal@4.48.0/node_modules/@wordpress/is-shallow-equal/build-module/index.js");function pt(D,y){const g={...D};return Object.entries(y).forEach(([U,M])=>{g[U]?g[U]={...g[U],to:M.to}:g[U]=M}),g}const it=(D,y)=>{const g=D==null?void 0:D.findIndex(({id:M})=>typeof M=="string"?M===y.id:(0,ct.ZP)(M,y.id)),U=[...D];return g!==-1?U[g]={id:y.id,changes:pt(U[g].changes,y.changes)}:U.push(y),U};function N(){let D=[],y=[],g=0;const U=()=>{D=D.slice(0,g||void 0),g=0},M=()=>{var w;const d=D.length===0?0:D.length-1;let h=(w=D[d])!==null&&w!==void 0?w:[];y.forEach(L=>{h=it(h,L)}),y=[],D[d]=h},a=w=>!w.filter(({changes:h})=>Object.values(h).some(({from:L,to:R})=>typeof L!="function"&&typeof R!="function"&&!(0,ct.ZP)(L,R))).length;return{addRecord(w,d=!1){const h=!w||a(w);if(d){if(h)return;w.forEach(L=>{y=it(y,L)})}else{if(U(),y.length&&M(),h)return;D.push(w)}},undo(){y.length&&(U(),M());const w=D[D.length-1+g];if(w)return g-=1,w},redo(){const w=D[D.length+g];if(w)return g+=1,w},hasUndo(){return!!D[D.length-1+g]},hasRedo(){return!!D[D.length+g]}}}},"../../../node_modules/.pnpm/capital-case@1.0.4/node_modules/capital-case/dist.es2015/index.js":(Ht,kt,$)=>{"use strict";$.d(kt,{I:()=>D});var ct=$("../../../node_modules/.pnpm/tslib@2.6.2/node_modules/tslib/tslib.es6.mjs"),pt=$("../../../node_modules/.pnpm/no-case@3.0.4/node_modules/no-case/dist.es2015/index.js");function it(y){return y.charAt(0).toUpperCase()+y.substr(1)}function N(y){return it(y.toLowerCase())}function D(y,g){return g===void 0&&(g={}),(0,pt.B)(y,(0,ct.pi)({delimiter:" ",transform:N},g))}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/array.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Dp:()=>D,Z$:()=>ct,kJ:()=>d,s7:()=>N});const ct=S=>S[S.length-1],pt=()=>[],it=S=>S.slice(),N=(S,B)=>{for(let u=0;u<B.length;u++)S.push(B[u])},D=Array.from,y=(S,B)=>{for(let u=0;u<S.length;u++)if(!B(S[u],u,S))return!1;return!0},g=(S,B)=>{for(let u=0;u<S.length;u++)if(B(S[u],u,S))return!0;return!1},U=(S,B)=>S.length===B.length&&y(S,(u,_)=>u===B[_]),M=S=>w(S,[],(B,u)=>B.concat(u)),a=(S,B)=>{const u=new Array(S);for(let _=0;_<S;_++)u[_]=B(_,u);return u},w=(S,B,u)=>S.reduce(u,B),d=Array.isArray,h=S=>D(set.from(S)),L=(S,B)=>{const u=set.create(),_=[];for(let m=0;m<S.length;m++){const C=S[m],v=B(C);u.has(v)||(u.add(v),_.push(C))}return _},R=(S,B)=>{const u=Array(S.length);for(let _=0;_<S.length;_++)u[_]=B(S[_],_,S);return u}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/binary.js":(Ht,kt,$)=>{"use strict";$.d(kt,{$2:()=>ut,CY:()=>it,Ko:()=>N,Qn:()=>pt,RP:()=>Nt,Tg:()=>Ot,Vw:()=>ct,cq:()=>y,jS:()=>_t,kr:()=>nt,rc:()=>g,x1:()=>U});const ct=1,pt=2,it=4,N=8,D=16,y=32,g=64,U=128,M=256,a=512,w=1024,d=2048,h=4096,L=8192,R=16384,S=32768,B=65536,u=1<<17,_=1<<18,m=1<<19,C=1<<20,v=1<<21,A=1<<22,Y=1<<23,x=1<<24,P=1<<25,q=1<<26,ot=1<<27,wt=1<<28,Ct=1<<29,Dt=1<<30,It=null,Mt=0,St=1,ee=3,Xt=7,at=15,nt=31,ut=63,_t=127,vt=255,Ut=511,Ft=1023,te=2047,Pt=4095,re=8191,G=16383,tt=32767,bt=65535,V=u-1,b=_-1,T=m-1,Z=C-1,gt=v-1,n=A-1,s=Y-1,c=x-1,k=P-1,z=q-1,K=ot-1,ht=wt-1,Tt=Ct-1,Vt=Dt-1,Nt=2147483647,Ot=4294967295},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/buffer.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Gh:()=>w,eh:()=>D,f9:()=>S,s3:()=>a});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/string.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/environment.js");const it=m=>new Uint8Array(m),N=(m,C,v)=>new Uint8Array(m,C,v),D=m=>new Uint8Array(m),y=m=>{let C="";for(let v=0;v<m.byteLength;v++)C+=ct.IK(m[v]);return btoa(C)},g=m=>Buffer.from(m.buffer,m.byteOffset,m.byteLength).toString("base64"),U=m=>{const C=atob(m),v=it(C.length);for(let A=0;A<C.length;A++)v[A]=C.charCodeAt(A);return v},M=m=>{const C=Buffer.from(m,"base64");return N(C.buffer,C.byteOffset,C.byteLength)},a=pt.jU?y:g,w=pt.jU?U:M,d=m=>a(m).replaceAll("+","-").replaceAll("/","_").replaceAll("=",""),h=m=>w(m.replaceAll("-","+").replaceAll("_","/")),L=m=>array.map(m,C=>C.toString(16).padStart(2,"0")).join(""),R=m=>{const C=m.length,v=new Uint8Array(math.ceil(C/2));for(let A=0;A<C;A+=2)v[v.length-A/2-1]=Number.parseInt(m.slice(C-A-2,C-A),16);return v},S=m=>{const C=it(m.byteLength);return C.set(m),C},B=m=>encoding.encode(C=>encoding.writeAny(C,m)),u=m=>decoding.readAny(decoding.createDecoder(m)),_=(m,C)=>{if(C===0)return m;m=new Uint8Array(m),m[0]<<=C;for(let v=1;v<m.length;v++)m[v-1]|=m[v]>>>8-C,m[v]<<=C;return m}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/decoding.js":(Ht,kt,$)=>{"use strict";$.d(kt,{HN:()=>h,UF:()=>Ft,XW:()=>_t,dD:()=>Pt,kf:()=>wt,kj:()=>S,l1:()=>M,sO:()=>re,v_:()=>ut,yg:()=>A});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/binary.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/math.js"),it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/number.js"),N=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/string.js"),D=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/error.js");const y=D.Ue("Unexpected end of array"),g=D.Ue("Integer out of Range");class U{constructor(tt){this.arr=tt,this.pos=0}}const M=G=>new U(G),a=G=>G.pos!==G.arr.length,w=(G,tt=G.pos)=>{const bt=M(G.arr);return bt.pos=tt,bt},d=(G,tt)=>{const bt=new Uint8Array(G.arr.buffer,G.pos+G.arr.byteOffset,tt);return G.pos+=tt,bt},h=G=>d(G,A(G)),L=G=>d(G,G.arr.length-G.pos),R=G=>G.pos++,S=G=>G.arr[G.pos++],B=G=>{const tt=G.arr[G.pos]+(G.arr[G.pos+1]<<8);return G.pos+=2,tt},u=G=>{const tt=G.arr[G.pos]+(G.arr[G.pos+1]<<8)+(G.arr[G.pos+2]<<16)+(G.arr[G.pos+3]<<24)>>>0;return G.pos+=4,tt},_=G=>{const tt=G.arr[G.pos+3]+(G.arr[G.pos+2]<<8)+(G.arr[G.pos+1]<<16)+(G.arr[G.pos]<<24)>>>0;return G.pos+=4,tt},m=G=>G.arr[G.pos],C=G=>G.arr[G.pos]+(G.arr[G.pos+1]<<8),v=G=>G.arr[G.pos]+(G.arr[G.pos+1]<<8)+(G.arr[G.pos+2]<<16)+(G.arr[G.pos+3]<<24)>>>0,A=G=>{let tt=0,bt=1;const V=G.arr.length;for(;G.pos<V;){const b=G.arr[G.pos++];if(tt=tt+(b&ct.jS)*bt,bt*=128,b<ct.x1)return tt;if(tt>it.YM)throw g}throw y},Y=G=>{let tt=G.arr[G.pos++],bt=tt&ct.$2,V=64;const b=(tt&ct.rc)>0?-1:1;if(!(tt&ct.x1))return b*bt;const T=G.arr.length;for(;G.pos<T;){if(tt=G.arr[G.pos++],bt=bt+(tt&ct.jS)*V,V*=128,tt<ct.x1)return b*bt;if(bt>it.YM)throw g}throw y},x=G=>{const tt=G.pos,bt=A(G);return G.pos=tt,bt},P=G=>{const tt=G.pos,bt=Y(G);return G.pos=tt,bt},q=G=>{let tt=A(G);if(tt===0)return"";{let bt=String.fromCodePoint(S(G));if(--tt<100)for(;tt--;)bt+=String.fromCodePoint(S(G));else for(;tt>0;){const V=tt<1e4?tt:1e4,b=G.arr.subarray(G.pos,G.pos+V);G.pos+=V,bt+=String.fromCodePoint.apply(null,b),tt-=V}return decodeURIComponent(escape(bt))}},ot=G=>N.CO.decode(h(G)),wt=N.CO?ot:q,Ct=G=>{const tt=encoding.createEncoder();let bt;for(;;){if(bt=S(G),bt===0)return encoding.toUint8Array(tt);bt===1&&(bt=S(G)),encoding.write(tt,bt)}},Dt=G=>string.decodeUtf8(Ct(G)),It=G=>{const tt=G.pos,bt=wt(G);return G.pos=tt,bt},Mt=(G,tt)=>{const bt=new DataView(G.arr.buffer,G.arr.byteOffset+G.pos,tt);return G.pos+=tt,bt},St=G=>Mt(G,4).getFloat32(0,!1),ee=G=>Mt(G,8).getFloat64(0,!1),Xt=G=>Mt(G,8).getBigInt64(0,!1),at=G=>Mt(G,8).getBigUint64(0,!1),nt=[G=>{},G=>null,Y,St,ee,Xt,G=>!1,G=>!0,wt,G=>{const tt=A(G),bt={};for(let V=0;V<tt;V++){const b=wt(G);bt[b]=ut(G)}return bt},G=>{const tt=A(G),bt=[];for(let V=0;V<tt;V++)bt.push(ut(G));return bt},h],ut=G=>nt[127-S(G)](G);class _t extends U{constructor(tt,bt){super(tt),this.reader=bt,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),a(this)?this.count=A(this)+1:this.count=-1),this.count--,this.s}}class vt extends null{constructor(tt,bt){super(tt),this.s=bt}read(){return this.s+=Y(this),this.s}}class Ut extends null{constructor(tt,bt){super(tt),this.s=bt,this.count=0}read(){return this.count===0&&(this.s+=Y(this),a(this)?this.count=A(this)+1:this.count=-1),this.count--,this.s}}class Ft extends U{constructor(tt){super(tt),this.s=0,this.count=0}read(){if(this.count===0){this.s=Y(this);const tt=pt.GR(this.s);this.count=1,tt&&(this.s=-this.s,this.count=A(this)+2)}return this.count--,this.s}}class te extends null{constructor(tt){super(tt),this.s=0,this.count=0}read(){if(this.count===0){this.s=Y(this);const tt=math.isNegativeZero(this.s);this.count=1,tt&&(this.s=-this.s,this.count=A(this)+2)}return this.count--,this.s++}}class Pt extends U{constructor(tt){super(tt),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const tt=Y(this),bt=tt&1;this.diff=pt.GW(tt/2),this.count=1,bt&&(this.count=A(this)+2)}return this.s+=this.diff,this.count--,this.s}}class re{constructor(tt){this.decoder=new Ft(tt),this.str=wt(this.decoder),this.spos=0}read(){const tt=this.spos+this.decoder.read(),bt=this.str.slice(this.spos,tt);return this.spos=tt,bt}}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/encoding.js":(Ht,kt,$)=>{"use strict";$.d(kt,{$F:()=>R,EM:()=>vt,GF:()=>Ut,HE:()=>re,HK:()=>It,Mf:()=>g,TS:()=>V,_f:()=>w,mP:()=>Mt,sX:()=>bt,uE:()=>v,uw:()=>ot});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/math.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/number.js"),it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/binary.js"),N=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/string.js"),D=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/array.js");class y{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const g=()=>new y,U=b=>{const T=g();return b(T),w(T)},M=b=>{let T=b.cpos;for(let Z=0;Z<b.bufs.length;Z++)T+=b.bufs[Z].length;return T},a=b=>b.cpos>0||b.bufs.length>0,w=b=>{const T=new Uint8Array(M(b));let Z=0;for(let gt=0;gt<b.bufs.length;gt++){const n=b.bufs[gt];T.set(n,Z),Z+=n.length}return T.set(new Uint8Array(b.cbuf.buffer,0,b.cpos),Z),T},d=(b,T)=>{const Z=b.cbuf.length;Z-b.cpos<T&&(b.bufs.push(new Uint8Array(b.cbuf.buffer,0,b.cpos)),b.cbuf=new Uint8Array(ct.Fp(Z,T)*2),b.cpos=0)},h=(b,T)=>{const Z=b.cbuf.length;b.cpos===Z&&(b.bufs.push(b.cbuf),b.cbuf=new Uint8Array(Z*2),b.cpos=0),b.cbuf[b.cpos++]=T},L=(b,T,Z)=>{let gt=null;for(let n=0;n<b.bufs.length&&gt===null;n++){const s=b.bufs[n];T<s.length?gt=s:T-=s.length}gt===null&&(gt=b.cbuf),gt[T]=Z},R=h,S=null,B=(b,T)=>{h(b,T&binary.BITS8),h(b,T>>>8&binary.BITS8)},u=(b,T,Z)=>{L(b,T,Z&binary.BITS8),L(b,T+1,Z>>>8&binary.BITS8)},_=(b,T)=>{for(let Z=0;Z<4;Z++)h(b,T&binary.BITS8),T>>>=8},m=(b,T)=>{for(let Z=3;Z>=0;Z--)h(b,T>>>8*Z&binary.BITS8)},C=(b,T,Z)=>{for(let gt=0;gt<4;gt++)L(b,T+gt,Z&binary.BITS8),Z>>>=8},v=(b,T)=>{for(;T>it.jS;)h(b,it.x1|it.jS&T),T=ct.GW(T/128);h(b,it.jS&T)},A=(b,T)=>{const Z=ct.GR(T);for(Z&&(T=-T),h(b,(T>it.$2?it.x1:0)|(Z?it.rc:0)|it.$2&T),T=ct.GW(T/64);T>0;)h(b,(T>it.jS?it.x1:0)|it.jS&T),T=ct.GW(T/128)},Y=new Uint8Array(3e4),x=Y.length/3,P=(b,T)=>{if(T.length<x){const Z=N.YZ.encodeInto(T,Y).written||0;v(b,Z);for(let gt=0;gt<Z;gt++)h(b,Y[gt])}else Mt(b,N.lz(T))},q=(b,T)=>{const Z=unescape(encodeURIComponent(T)),gt=Z.length;v(b,gt);for(let n=0;n<gt;n++)h(b,Z.codePointAt(n))},ot=N.YZ&&N.YZ.encodeInto?P:q,wt=(b,T)=>Ct(b,string.encodeUtf8(T)),Ct=(b,T)=>{for(let Z=0;Z<T.length;Z++){const gt=T[Z];(gt===0||gt===1)&&h(b,1),h(b,T[Z])}h(b,0)},Dt=(b,T)=>It(b,w(T)),It=(b,T)=>{const Z=b.cbuf.length,gt=b.cpos,n=ct.VV(Z-gt,T.length),s=T.length-n;b.cbuf.set(T.subarray(0,n),gt),b.cpos+=n,s>0&&(b.bufs.push(b.cbuf),b.cbuf=new Uint8Array(ct.Fp(Z*2,s)),b.cbuf.set(T.subarray(n)),b.cpos=s)},Mt=(b,T)=>{v(b,T.byteLength),It(b,T)},St=(b,T)=>{d(b,T);const Z=new DataView(b.cbuf.buffer,b.cpos,T);return b.cpos+=T,Z},ee=(b,T)=>St(b,4).setFloat32(0,T,!1),Xt=(b,T)=>St(b,8).setFloat64(0,T,!1),at=(b,T)=>St(b,8).setBigInt64(0,T,!1),nt=(b,T)=>St(b,8).setBigUint64(0,T,!1),ut=new DataView(new ArrayBuffer(4)),_t=b=>(ut.setFloat32(0,b),ut.getFloat32(0)===b),vt=(b,T)=>{switch(typeof T){case"string":h(b,119),ot(b,T);break;case"number":pt.U(T)&&ct.Wn(T)<=it.RP?(h(b,125),A(b,T)):_t(T)?(h(b,124),ee(b,T)):(h(b,123),Xt(b,T));break;case"bigint":h(b,122),at(b,T);break;case"object":if(T===null)h(b,126);else if(D.kJ(T)){h(b,117),v(b,T.length);for(let Z=0;Z<T.length;Z++)vt(b,T[Z])}else if(T instanceof Uint8Array)h(b,116),Mt(b,T);else{h(b,118);const Z=Object.keys(T);v(b,Z.length);for(let gt=0;gt<Z.length;gt++){const n=Z[gt];ot(b,n),vt(b,T[n])}}break;case"boolean":h(b,T?120:121);break;default:h(b,127)}};class Ut extends y{constructor(T){super(),this.w=T,this.s=null,this.count=0}write(T){this.s===T?this.count++:(this.count>0&&v(this,this.count-1),this.count=1,this.w(this,T),this.s=T)}}class Ft extends null{constructor(T){super(),this.s=T}write(T){A(this,T-this.s),this.s=T}}class te extends null{constructor(T){super(),this.s=T,this.count=0}write(T){this.s===T&&this.count>0?this.count++:(this.count>0&&v(this,this.count-1),this.count=1,A(this,T-this.s),this.s=T)}}const Pt=b=>{b.count>0&&(A(b.encoder,b.count===1?b.s:-b.s),b.count>1&&v(b.encoder,b.count-2))};class re{constructor(){this.encoder=new y,this.s=0,this.count=0}write(T){this.s===T?this.count++:(Pt(this),this.count=1,this.s=T)}toUint8Array(){return Pt(this),w(this.encoder)}}class G{constructor(){this.encoder=new y,this.s=0,this.count=0}write(T){this.s+this.count===T?this.count++:(Pt(this),this.count=1,this.s=T)}toUint8Array(){return Pt(this),w(this.encoder)}}const tt=b=>{if(b.count>0){const T=b.diff*2+(b.count===1?0:1);A(b.encoder,T),b.count>1&&v(b.encoder,b.count-2)}};class bt{constructor(){this.encoder=new y,this.s=0,this.count=0,this.diff=0}write(T){this.diff===T-this.s?(this.s=T,this.count++):(tt(this),this.count=1,this.diff=T-this.s,this.s=T)}toUint8Array(){return tt(this),w(this.encoder)}}class V{constructor(){this.sarr=[],this.s="",this.lensE=new re}write(T){this.s+=T,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(T.length)}toUint8Array(){const T=new y;return this.sarr.push(this.s),this.s="",ot(T,this.sarr.join("")),It(T,this.lensE.toUint8Array()),w(T)}}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/environment.js":(Ht,kt,$)=>{"use strict";$.d(kt,{E0:()=>R,jU:()=>U,hH:()=>m});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/map.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/string.js");const it=C=>C===void 0?null:C;var N=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/storage.js"),D=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/function.js"),y=$("../../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");const g=typeof y!="undefined"&&y.release&&/node|io\.js/.test(y.release.name)&&Object.prototype.toString.call(typeof y!="undefined"?y:0)==="[object process]",U=typeof window!="undefined"&&typeof document!="undefined"&&!g,M=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;let a;const w=[],d=()=>{if(a===void 0)if(g){a=ct.Ue();const C=y.argv;let v=null;for(let A=0;A<C.length;A++){const Y=C[A];Y[0]==="-"?(v!==null&&a.set(v,""),v=Y):v!==null?(a.set(v,Y),v=null):w.push(Y)}v!==null&&a.set(v,"")}else typeof location=="object"?(a=ct.Ue(),(location.search||"?").slice(1).split("&").forEach(C=>{if(C.length!==0){const[v,A]=C.split("=");a.set(`--${pt.NF(v,"-")}`,A),a.set(`-${pt.NF(v,"-")}`,A)}})):a=ct.Ue();return a},h=C=>d().has(C),L=(C,v)=>d().get(C)||v,R=C=>it(g?y.env[C.toUpperCase()]:N.XN.getItem(C)),S=C=>d().get("--"+C)||R(C),u=(C=>h("--"+C)||R(C)!==null)("production"),_=g&&D.gB(y.env.FORCE_COLOR,["true","1","2"]),m=!h("no-colors")&&(!g||y.stdout.isTTY||_)&&(!g||h("color")||_||R("COLORTERM")!==null||(R("TERM")||"").includes("color"))},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/error.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Nw:()=>pt,Ue:()=>ct,zR:()=>it});const ct=N=>new Error(N),pt=()=>{throw ct("Method unimplemented")},it=()=>{throw ct("Unexpected case")}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/function.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Hi:()=>M,PP:()=>it,WY:()=>N,gB:()=>a,id:()=>y});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/array.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/object.js");const it=(S,B,u=0)=>{try{for(;u<S.length;u++)S[u](...B)}finally{u<S.length&&it(S,B,u+1)}},N=()=>{},D=S=>S(),y=S=>S,g=(S,B)=>S===B,U=(S,B)=>S===B||S!=null&&B!=null&&S.constructor===B.constructor&&(array.isArray(S)&&array.equalFlat(S,B)||typeof S=="object"&&object.equalFlat(S,B)),M=(S,B)=>{if(S==null||B==null)return g(S,B);if(S.constructor!==B.constructor)return!1;if(S===B)return!0;switch(S.constructor){case ArrayBuffer:S=new Uint8Array(S),B=new Uint8Array(B);case Uint8Array:{if(S.byteLength!==B.byteLength)return!1;for(let u=0;u<S.length;u++)if(S[u]!==B[u])return!1;break}case Set:{if(S.size!==B.size)return!1;for(const u of S)if(!B.has(u))return!1;break}case Map:{if(S.size!==B.size)return!1;for(const u of S.keys())if(!B.has(u)||!M(S.get(u),B.get(u)))return!1;break}case Object:if(pt.kE(S)!==pt.kE(B))return!1;for(const u in S)if(!pt.l$(S,u)||!M(S[u],B[u]))return!1;break;case Array:if(S.length!==B.length)return!1;for(let u=0;u<S.length;u++)if(!M(S[u],B[u]))return!1;break;default:return!1}return!0},a=(S,B)=>B.includes(S),w=ct.kJ,d=S=>S&&S.constructor===String,h=S=>S!=null&&S.constructor===Number,L=(S,B)=>S&&S.constructor===B,R=S=>B=>B&&B.constructor===S},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.common.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Ej:()=>U,Pl:()=>y,ZA:()=>a,s7:()=>M,ud:()=>h,Wd:()=>d,hM:()=>w,YW:()=>g,WO:()=>L,_X:()=>R,YX:()=>_});const ct=Symbol,pt=m=>typeof m=="symbol";var it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/time.js"),N=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/environment.js"),D=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/function.js");const y=ct(),g=ct(),U=ct(),M=ct(),a=ct(),w=ct(),d=ct(),h=ct(),L=ct(),R=m=>{const C=[],v=[];let A=0;for(;A<m.length;A++){const Y=m[A];Y.constructor===String||Y.constructor===Number?C.push(Y):Y.constructor===Object&&v.push(JSON.stringify(Y))}return v},S=[a,d,h,U];let B=0,u=it.ZG();const _=(m,C)=>{const v=S[B],A=N.E0("log"),Y=A!==null&&(A==="*"||A==="true"||new RegExp(A,"gi").test(C));return B=(B+1)%S.length,C+=": ",Y?(...x)=>{const P=it.ZG(),q=P-u;u=P,m(v,C,L,...x.map(ot=>typeof ot=="string"||typeof ot=="symbol"?ot:JSON.stringify(ot)),v," +"+q+"ms")}:D.WY}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.js":(Ht,kt,$)=>{"use strict";$.d(kt,{YX:()=>se,S0:()=>T});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/environment.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/set.js");class it{constructor(st,yt){this.left=st,this.right=yt}}const N=(X,st)=>new it(X,st),D=(X,st)=>new it(st,X),y=(X,st)=>X.forEach(yt=>st(yt.left,yt.right)),g=(X,st)=>X.map(yt=>st(yt.left,yt.right));var U=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/map.js");const M=typeof document!="undefined"?document:{},a=X=>M.createElement(X),w=()=>M.createDocumentFragment(),d=X=>M.createTextNode(X),h=typeof DOMParser!="undefined"?new DOMParser:null,L=(X,st,yt)=>X.dispatchEvent(new CustomEvent(st,yt)),R=(X,st)=>(pair.forEach(st,(yt,mt)=>{mt===!1?X.removeAttribute(yt):mt===!0?X.setAttribute(yt,""):X.setAttribute(yt,mt)}),X),S=(X,st)=>(st.forEach((yt,mt)=>{X.setAttribute(mt,yt)}),X),B=X=>{const st=w();for(let yt=0;yt<X.length;yt++)nt(st,X[yt]);return st},u=(X,st)=>(nt(X,B(st)),X),_=X=>X.remove(),m=(X,st,yt)=>X.addEventListener(st,yt),C=(X,st,yt)=>X.removeEventListener(st,yt),v=(X,st)=>(pair.forEach(st,(yt,mt)=>m(X,yt,mt)),X),A=(X,st)=>(pair.forEach(st,(yt,mt)=>C(X,yt,mt)),X),Y=(X,st=[],yt=[])=>u(R(a(X),st),yt),x=(X,st)=>{const yt=a("canvas");return yt.height=st,yt.width=X,yt},P=null,q=X=>`${X.left}:${X.right};`,ot=X=>X.map(q).join(""),wt=X=>U.UI(X,(st,yt)=>`${yt}:${st};`).join(""),Ct=(X,st)=>X.querySelector(st),Dt=(X,st)=>X.querySelectorAll(st),It=X=>M.getElementById(X),Mt=X=>h.parseFromString(`<html><body>${X}</body></html>`,"text/html").body,St=X=>B(Mt(X).childNodes),ee=X=>Mt(X).firstElementChild,Xt=(X,st)=>X.replaceWith(st),at=(X,st,yt)=>X.insertBefore(st,yt),nt=(X,st)=>X.appendChild(st),ut=M.ELEMENT_NODE,_t=M.TEXT_NODE,vt=M.CDATA_SECTION_NODE,Ut=M.COMMENT_NODE,Ft=M.DOCUMENT_NODE,te=M.DOCUMENT_TYPE_NODE,Pt=M.DOCUMENT_FRAGMENT_NODE,re=(X,st)=>X.nodeType===st,G=(X,st)=>{let yt=st.parentNode;for(;yt&&yt!==X;)yt=yt.parentNode;return yt===X};var tt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.common.js");const bt={[tt.Pl]:N("font-weight","bold"),[tt.YW]:N("font-weight","normal"),[tt.Ej]:N("color","blue"),[tt.ZA]:N("color","green"),[tt.s7]:N("color","grey"),[tt.hM]:N("color","red"),[tt.Wd]:N("color","purple"),[tt.ud]:N("color","orange"),[tt.WO]:N("color","black")},V=X=>{const st=[],yt=[],mt=U.Ue();let Wt=[],Zt=0;for(;Zt<X.length;Zt++){const zt=X[Zt],ce=bt[zt];if(ce!==void 0)mt.set(ce.left,ce.right);else if(zt.constructor===String||zt.constructor===Number){const Se=wt(mt);Zt>0||Se.length>0?(st.push("%c"+zt),yt.push(Se)):st.push(zt)}else break}for(Zt>0&&(Wt=yt,Wt.unshift(st.join("")));Zt<X.length;Zt++){const zt=X[Zt];zt instanceof Symbol||Wt.push(zt)}return Wt},b=ct.hH?V:tt._X,T=(...X)=>{console.log(...b(X)),Tt.forEach(st=>st.print(X))},Z=(...X)=>{console.warn(...b(X)),X.unshift(common.ORANGE),Tt.forEach(st=>st.print(X))},gt=X=>{console.error(X),Tt.forEach(st=>st.printError(X))},n=(X,st)=>{env.isBrowser&&console.log("%c                      ",`font-size: ${st}px; background-size: contain; background-repeat: no-repeat; background-image: url(${X})`),Tt.forEach(yt=>yt.printImg(X,st))},s=(X,st)=>n(`data:image/gif;base64,${X}`,st),c=(...X)=>{console.group(...b(X)),Tt.forEach(st=>st.group(X))},k=(...X)=>{console.groupCollapsed(...b(X)),Tt.forEach(st=>st.groupCollapsed(X))},z=()=>{console.groupEnd(),Tt.forEach(X=>X.groupEnd())},K=X=>Tt.forEach(st=>st.printDom(X())),ht=(X,st)=>n(X.toDataURL(),st),Tt=pt.Ue(),Vt=X=>{const st=[],yt=new Map;let mt=0;for(;mt<X.length;mt++){const Wt=X[mt],Zt=bt[Wt];if(Zt!==void 0)yt.set(Zt.left,Zt.right);else if(Wt.constructor===String||Wt.constructor===Number){const zt=dom.element("span",[pair.create("style",dom.mapToStyleString(yt))],[dom.text(Wt.toString())]);zt.innerHTML===""&&(zt.innerHTML="&nbsp;"),st.push(zt)}else break}for(;mt<X.length;mt++){let Wt=X[mt];Wt instanceof Symbol||(Wt.constructor!==String&&Wt.constructor!==Number&&(Wt=" "+json.stringify(Wt)+" "),st.push(dom.element("span",[],[dom.text(Wt)])))}return st},Nt="font-family:monospace;border-bottom:1px solid #e2e2e2;padding:2px;";class Ot{constructor(st){this.dom=st,this.ccontainer=this.dom,this.depth=0,Tt.add(this)}group(st,yt=!1){eventloop.enqueue(()=>{const mt=dom.element("span",[pair.create("hidden",yt),pair.create("style","color:grey;font-size:120%;")],[dom.text("\u25BC")]),Wt=dom.element("span",[pair.create("hidden",!yt),pair.create("style","color:grey;font-size:125%;")],[dom.text("\u25B6")]),Zt=dom.element("div",[pair.create("style",`${Nt};padding-left:${this.depth*10}px`)],[mt,Wt,dom.text(" ")].concat(Vt(st))),zt=dom.element("div",[pair.create("hidden",yt)]),ce=dom.element("div",[],[Zt,zt]);dom.append(this.ccontainer,[ce]),this.ccontainer=zt,this.depth++,dom.addEventListener(Zt,"click",Se=>{zt.toggleAttribute("hidden"),mt.toggleAttribute("hidden"),Wt.toggleAttribute("hidden")})})}groupCollapsed(st){this.group(st,!0)}groupEnd(){eventloop.enqueue(()=>{this.depth>0&&(this.depth--,this.ccontainer=this.ccontainer.parentElement.parentElement)})}print(st){eventloop.enqueue(()=>{dom.append(this.ccontainer,[dom.element("div",[pair.create("style",`${Nt};padding-left:${this.depth*10}px`)],Vt(st))])})}printError(st){this.print([common.RED,common.BOLD,st.toString()])}printImg(st,yt){eventloop.enqueue(()=>{dom.append(this.ccontainer,[dom.element("img",[pair.create("src",st),pair.create("height",`${math.round(yt*1.5)}px`)])])})}printDom(st){eventloop.enqueue(()=>{dom.append(this.ccontainer,[st])})}destroy(){eventloop.enqueue(()=>{Tt.delete(this)})}}const xt=X=>new Ot(X),se=X=>tt.YX(T,X)},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/map.js":(Ht,kt,$)=>{"use strict";$.d(kt,{JG:()=>pt,UI:()=>N,Ue:()=>ct,Yj:()=>D,Yu:()=>it});const ct=()=>new Map,pt=g=>{const U=ct();return g.forEach((M,a)=>{U.set(a,M)}),U},it=(g,U,M)=>{let a=g.get(U);return a===void 0&&g.set(U,a=M()),a},N=(g,U)=>{const M=[];for(const[a,w]of g)M.push(U(w,a));return M},D=(g,U)=>{for(const[M,a]of g)if(U(a,M))return!0;return!1},y=(g,U)=>{for(const[M,a]of g)if(!U(a,M))return!1;return!0}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/math.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Fp:()=>d,GR:()=>B,GW:()=>ct,VV:()=>w,Wn:()=>it,mv:()=>y});const ct=Math.floor,pt=Math.ceil,it=Math.abs,N=Math.imul,D=Math.round,y=Math.log10,g=Math.log2,U=Math.log,M=Math.sqrt,a=(u,_)=>u+_,w=(u,_)=>u<_?u:_,d=(u,_)=>u>_?u:_,h=Number.isNaN,L=Math.pow,R=u=>Math.pow(10,u),S=Math.sign,B=u=>u!==0?u<0:1/u<0},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/number.js":(Ht,kt,$)=>{"use strict";$.d(kt,{U:()=>U,YM:()=>it});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/math.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/binary.js");const it=Number.MAX_SAFE_INTEGER,N=Number.MIN_SAFE_INTEGER,D=null,y=pt.RP,g=pt.Tg,U=Number.isInteger||(d=>typeof d=="number"&&isFinite(d)&&ct.GW(d)===d),M=Number.isNaN,a=Number.parseInt,w=d=>{d&=binary.BITS32;let h=0;for(;d;)d&=d-1,h++;return h}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/object.js":(Ht,kt,$)=>{"use strict";$.d(kt,{$m:()=>w,Ed:()=>N,f0:()=>pt,kE:()=>y,l$:()=>a,xb:()=>U});const ct=()=>Object.create(null),pt=Object.assign,it=Object.keys,N=(d,h)=>{for(const L in d)h(d[L],L)},D=(d,h)=>{const L=[];for(const R in d)L.push(h(d[R],R));return L},y=d=>it(d).length,g=(d,h)=>{for(const L in d)if(h(d[L],L))return!0;return!1},U=d=>{for(const h in d)return!1;return!0},M=(d,h)=>{for(const L in d)if(!h(d[L],L))return!1;return!0},a=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),w=(d,h)=>d===h||y(d)===y(h)&&M(d,(L,R)=>(L!==void 0||a(h,R))&&h[R]===L)},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/observable.js":(Ht,kt,$)=>{"use strict";$.d(kt,{y:()=>D});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/map.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/set.js"),it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/array.js");class N{constructor(){this._observers=map.create()}on(g,U){return map.setIfUndefined(this._observers,g,set.create).add(U),U}once(g,U){const M=(...a)=>{this.off(g,M),U(...a)};this.on(g,M)}off(g,U){const M=this._observers.get(g);M!==void 0&&(M.delete(U),M.size===0&&this._observers.delete(g))}emit(g,U){return array.from((this._observers.get(g)||map.create()).values()).forEach(M=>M(...U))}destroy(){this._observers=map.create()}}class D{constructor(){this._observers=ct.Ue()}on(g,U){ct.Yu(this._observers,g,pt.Ue).add(U)}once(g,U){const M=(...a)=>{this.off(g,M),U(...a)};this.on(g,M)}off(g,U){const M=this._observers.get(g);M!==void 0&&(M.delete(U),M.size===0&&this._observers.delete(g))}emit(g,U){return it.Dp((this._observers.get(g)||ct.Ue()).values()).forEach(M=>M(...U))}destroy(){this._observers=ct.Ue()}}},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/promise.js":(Ht,kt,$)=>{"use strict";$.d(kt,{DB:()=>D,Ue:()=>ct,d1:()=>N});const ct=a=>new Promise(a),pt=a=>new Promise(a),it=Promise.all.bind(Promise),N=a=>Promise.reject(a),D=a=>Promise.resolve(a),y=a=>Promise.resolve(a),g=(a,w,d=10)=>ct((h,L)=>{const R=time.getUnixTime(),S=a>0,u=setInterval(()=>{w()?(clearInterval(u),h()):S&&time.getUnixTime()-R>a&&(clearInterval(u),L(new Error("Timeout")))},d)}),U=a=>ct((w,d)=>setTimeout(w,a)),M=a=>a instanceof Promise||a&&a.then&&a.catch&&a.finally},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/random.js":(Ht,kt,$)=>{"use strict";$.d(kt,{TN:()=>it,U7:()=>N,k$:()=>U});const ct=crypto.subtle,pt=crypto.getRandomValues.bind(crypto),it=Math.random,N=()=>pt(new Uint32Array(1))[0],D=()=>{const M=getRandomValues(new Uint32Array(8));return(M[0]&binary.BITS21)*(binary.BITS32+1)+(M[1]>>>0)},y=M=>M[math.floor(it()*M.length)],g=[1e7]+-1e3+-4e3+-8e3+-1e11,U=()=>g.replace(/[018]/g,M=>(M^N()&15>>M/4).toString(16))},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/set.js":(Ht,kt,$)=>{"use strict";$.d(kt,{Ue:()=>ct});const ct=()=>new Set,pt=D=>Array.from(D),it=D=>D.values().next().value||void 0,N=D=>new Set(D)},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/storage.js":(Ht,kt,$)=>{"use strict";$.d(kt,{F:()=>y,XN:()=>N,z2:()=>D});class ct{constructor(){this.map=new Map}setItem(U,M){this.map.set(U,M)}getItem(U){return this.map.get(U)}}let pt=new ct,it=!0;try{typeof localStorage!="undefined"&&localStorage&&(pt=localStorage,it=!1)}catch(g){}const N=pt,D=g=>it||addEventListener("storage",g),y=g=>it||removeEventListener("storage",g)},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/string.js":(Ht,kt,$)=>{"use strict";$.d(kt,{CO:()=>R,IK:()=>ct,NF:()=>U,YZ:()=>w,lz:()=>h});const ct=String.fromCharCode,pt=String.fromCodePoint,it=ct(65535),N=m=>m.toLowerCase(),D=/^\s*/g,y=m=>m.replace(D,""),g=/([A-Z])/g,U=(m,C)=>y(m.replace(g,v=>`${C}${N(v)}`)),M=m=>unescape(encodeURIComponent(m)).length,a=m=>{const C=unescape(encodeURIComponent(m)),v=C.length,A=new Uint8Array(v);for(let Y=0;Y<v;Y++)A[Y]=C.codePointAt(Y);return A},w=typeof TextEncoder!="undefined"?new TextEncoder:null,h=w?m=>w.encode(m):a,L=m=>{let C=m.length,v="",A=0;for(;C>0;){const Y=C<1e4?C:1e4,x=m.subarray(A,A+Y);A+=Y,v+=String.fromCodePoint.apply(null,x),C-=Y}return decodeURIComponent(escape(v))};let R=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});R&&R.decode(new Uint8Array).length===1&&(R=null);const S=m=>R.decode(m),B=null,u=(m,C,v,A="")=>m.slice(0,C)+A+m.slice(C+v),_=(m,C)=>array.unfold(C,()=>m).join("")},"../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/time.js":(Ht,kt,$)=>{"use strict";$.d(kt,{ZG:()=>pt});const ct=()=>new Date,pt=Date.now,it=N=>{if(N<6e4){const M=metric.prefix(N,-1);return math.round(M.n*100)/100+M.prefix+"s"}N=math.floor(N/1e3);const D=N%60,y=math.floor(N/60)%60,g=math.floor(N/3600)%24,U=math.floor(N/86400);return U>0?U+"d"+(g>0||y>30?" "+(y>30?g+1:g)+"h":""):g>0?g+"h"+(y>0||D>30?" "+(D>30?y+1:y)+"min":""):y+"min"+(D>0?" "+D+"s":"")}},"../../../node_modules/.pnpm/simple-peer@9.11.1/node_modules/simple-peer/simplepeer.min.js":(Ht,kt,$)=>{(function(ct){if(!0)Ht.exports=ct();else var pt})(function(){var ct=Math.floor,pt=Math.abs,it=Math.pow;return function(){function N(D,y,g){function U(w,d){if(!y[w]){if(!D[w]){var h=void 0;if(!d&&$("../../../node_modules/.pnpm/simple-peer@9.11.1/node_modules/simple-peer sync recursive"))return require(w,!0);if(M)return M(w,!0);var L=new Error("Cannot find module '"+w+"'");throw L.code="MODULE_NOT_FOUND",L}var R=y[w]={exports:{}};D[w][0].call(R.exports,function(S){var B=D[w][1][S];return U(B||S)},R,R.exports,N,D,y,g)}return y[w].exports}for(var M=void 0,a=0;a<g.length;a++)U(g[a]);return U}return N}()({1:[function(N,D,y){"use strict";function g(_){var m=_.length;if(0<m%4)throw new Error("Invalid string. Length must be a multiple of 4");var C=_.indexOf("=");C===-1&&(C=m);var v=C===m?0:4-C%4;return[C,v]}function U(_,m,C){return 3*(m+C)/4-C}function M(_){var m,C,v=g(_),A=v[0],Y=v[1],x=new R(U(_,A,Y)),P=0,q=0<Y?A-4:A;for(C=0;C<q;C+=4)m=L[_.charCodeAt(C)]<<18|L[_.charCodeAt(C+1)]<<12|L[_.charCodeAt(C+2)]<<6|L[_.charCodeAt(C+3)],x[P++]=255&m>>16,x[P++]=255&m>>8,x[P++]=255&m;return Y===2&&(m=L[_.charCodeAt(C)]<<2|L[_.charCodeAt(C+1)]>>4,x[P++]=255&m),Y===1&&(m=L[_.charCodeAt(C)]<<10|L[_.charCodeAt(C+1)]<<4|L[_.charCodeAt(C+2)]>>2,x[P++]=255&m>>8,x[P++]=255&m),x}function a(_){return h[63&_>>18]+h[63&_>>12]+h[63&_>>6]+h[63&_]}function w(_,m,C){for(var v,A=[],Y=m;Y<C;Y+=3)v=(16711680&_[Y]<<16)+(65280&_[Y+1]<<8)+(255&_[Y+2]),A.push(a(v));return A.join("")}function d(_){for(var m,C=_.length,v=C%3,A=[],Y=16383,x=0,P=C-v;x<P;x+=Y)A.push(w(_,x,x+Y>P?P:x+Y));return v===1?(m=_[C-1],A.push(h[m>>2]+h[63&m<<4]+"==")):v===2&&(m=(_[C-2]<<8)+_[C-1],A.push(h[m>>10]+h[63&m>>4]+h[63&m<<2]+"=")),A.join("")}y.byteLength=function(_){var m=g(_),C=m[0],v=m[1];return 3*(C+v)/4-v},y.toByteArray=M,y.fromByteArray=d;for(var h=[],L=[],R=typeof Uint8Array=="undefined"?Array:Uint8Array,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B=0,u=S.length;B<u;++B)h[B]=S[B],L[S.charCodeAt(B)]=B;L[45]=62,L[95]=63},{}],2:[function(){},{}],3:[function(N,D,y){(function(){(function(){/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <https://feross.org>
* @license  MIT
*/"use strict";var g=String.fromCharCode,U=Math.min;function M(n){if(2147483647<n)throw new RangeError('The value "'+n+'" is invalid for option "size"');var s=new Uint8Array(n);return s.__proto__=a.prototype,s}function a(n,s,c){if(typeof n=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return L(n)}return w(n,s,c)}function w(n,s,c){if(typeof n=="string")return R(n,s);if(ArrayBuffer.isView(n))return S(n);if(n==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(V(n,ArrayBuffer)||n&&V(n.buffer,ArrayBuffer))return B(n,s,c);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var k=n.valueOf&&n.valueOf();if(k!=null&&k!==n)return a.from(k,s,c);var z=u(n);if(z)return z;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return a.from(n[Symbol.toPrimitive]("string"),s,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}function d(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(0>n)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function h(n,s,c){return d(n),0>=n||s===void 0?M(n):typeof c=="string"?M(n).fill(s,c):M(n).fill(s)}function L(n){return d(n),M(0>n?0:0|_(n))}function R(n,s){if((typeof s!="string"||s==="")&&(s="utf8"),!a.isEncoding(s))throw new TypeError("Unknown encoding: "+s);var c=0|m(n,s),k=M(c),z=k.write(n,s);return z!==c&&(k=k.slice(0,z)),k}function S(n){for(var s=0>n.length?0:0|_(n.length),c=M(s),k=0;k<s;k+=1)c[k]=255&n[k];return c}function B(n,s,c){if(0>s||n.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<s+(c||0))throw new RangeError('"length" is outside of buffer bounds');var k;return k=s===void 0&&c===void 0?new Uint8Array(n):c===void 0?new Uint8Array(n,s):new Uint8Array(n,s,c),k.__proto__=a.prototype,k}function u(n){if(a.isBuffer(n)){var s=0|_(n.length),c=M(s);return c.length===0||n.copy(c,0,0,s),c}return n.length===void 0?n.type==="Buffer"&&Array.isArray(n.data)?S(n.data):void 0:typeof n.length!="number"||b(n.length)?M(0):S(n)}function _(n){if(n>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|n}function m(n,s){if(a.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||V(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);var c=n.length,k=2<arguments.length&&arguments[2]===!0;if(!k&&c===0)return 0;for(var z=!1;;)switch(s){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return Pt(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return tt(n).length;default:if(z)return k?-1:Pt(n).length;s=(""+s).toLowerCase(),z=!0}}function C(n,s,c){var k=!1;if((s===void 0||0>s)&&(s=0),s>this.length||((c===void 0||c>this.length)&&(c=this.length),0>=c)||(c>>>=0,s>>>=0,c<=s))return"";for(n||(n="utf8");;)switch(n){case"hex":return Xt(this,s,c);case"utf8":case"utf-8":return It(this,s,c);case"ascii":return St(this,s,c);case"latin1":case"binary":return ee(this,s,c);case"base64":return Dt(this,s,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return at(this,s,c);default:if(k)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),k=!0}}function v(n,s,c){var k=n[s];n[s]=n[c],n[c]=k}function A(n,s,c,k,z){if(n.length===0)return-1;if(typeof c=="string"?(k=c,c=0):2147483647<c?c=2147483647:-2147483648>c&&(c=-2147483648),c=+c,b(c)&&(c=z?0:n.length-1),0>c&&(c=n.length+c),c>=n.length){if(z)return-1;c=n.length-1}else if(0>c)if(z)c=0;else return-1;if(typeof s=="string"&&(s=a.from(s,k)),a.isBuffer(s))return s.length===0?-1:Y(n,s,c,k,z);if(typeof s=="number")return s&=255,typeof Uint8Array.prototype.indexOf=="function"?z?Uint8Array.prototype.indexOf.call(n,s,c):Uint8Array.prototype.lastIndexOf.call(n,s,c):Y(n,[s],c,k,z);throw new TypeError("val must be string, number or Buffer")}function Y(n,s,c,k,z){function K(X,st){return ht===1?X[st]:X.readUInt16BE(st*ht)}var ht=1,Tt=n.length,Vt=s.length;if(k!==void 0&&(k=(k+"").toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(2>n.length||2>s.length)return-1;ht=2,Tt/=2,Vt/=2,c/=2}var Nt;if(z){var Ot=-1;for(Nt=c;Nt<Tt;Nt++)if(K(n,Nt)!==K(s,Ot===-1?0:Nt-Ot))Ot!==-1&&(Nt-=Nt-Ot),Ot=-1;else if(Ot===-1&&(Ot=Nt),Nt-Ot+1===Vt)return Ot*ht}else for(c+Vt>Tt&&(c=Tt-Vt),Nt=c;0<=Nt;Nt--){for(var xt=!0,se=0;se<Vt;se++)if(K(n,Nt+se)!==K(s,se)){xt=!1;break}if(xt)return Nt}return-1}function x(n,s,c,k){c=+c||0;var z=n.length-c;k?(k=+k,k>z&&(k=z)):k=z;var K=s.length;k>K/2&&(k=K/2);for(var ht,Tt=0;Tt<k;++Tt){if(ht=parseInt(s.substr(2*Tt,2),16),b(ht))return Tt;n[c+Tt]=ht}return Tt}function P(n,s,c,k){return bt(Pt(s,n.length-c),n,c,k)}function q(n,s,c,k){return bt(re(s),n,c,k)}function ot(n,s,c,k){return q(n,s,c,k)}function wt(n,s,c,k){return bt(tt(s),n,c,k)}function Ct(n,s,c,k){return bt(G(s,n.length-c),n,c,k)}function Dt(n,s,c){return s===0&&c===n.length?T.fromByteArray(n):T.fromByteArray(n.slice(s,c))}function It(n,s,c){c=U(n.length,c);for(var k=[],z=s;z<c;){var K=n[z],ht=null,Tt=239<K?4:223<K?3:191<K?2:1;if(z+Tt<=c){var Vt,Nt,Ot,xt;Tt===1?128>K&&(ht=K):Tt===2?(Vt=n[z+1],(192&Vt)==128&&(xt=(31&K)<<6|63&Vt,127<xt&&(ht=xt))):Tt===3?(Vt=n[z+1],Nt=n[z+2],(192&Vt)==128&&(192&Nt)==128&&(xt=(15&K)<<12|(63&Vt)<<6|63&Nt,2047<xt&&(55296>xt||57343<xt)&&(ht=xt))):Tt===4&&(Vt=n[z+1],Nt=n[z+2],Ot=n[z+3],(192&Vt)==128&&(192&Nt)==128&&(192&Ot)==128&&(xt=(15&K)<<18|(63&Vt)<<12|(63&Nt)<<6|63&Ot,65535<xt&&1114112>xt&&(ht=xt)))}ht===null?(ht=65533,Tt=1):65535<ht&&(ht-=65536,k.push(55296|1023&ht>>>10),ht=56320|1023&ht),k.push(ht),z+=Tt}return Mt(k)}function Mt(n){var s=n.length;if(s<=4096)return g.apply(String,n);for(var c="",k=0;k<s;)c+=g.apply(String,n.slice(k,k+=4096));return c}function St(n,s,c){var k="";c=U(n.length,c);for(var z=s;z<c;++z)k+=g(127&n[z]);return k}function ee(n,s,c){var k="";c=U(n.length,c);for(var z=s;z<c;++z)k+=g(n[z]);return k}function Xt(n,s,c){var k=n.length;(!s||0>s)&&(s=0),(!c||0>c||c>k)&&(c=k);for(var z="",K=s;K<c;++K)z+=te(n[K]);return z}function at(n,s,c){for(var k=n.slice(s,c),z="",K=0;K<k.length;K+=2)z+=g(k[K]+256*k[K+1]);return z}function nt(n,s,c){if(n%1!=0||0>n)throw new RangeError("offset is not uint");if(n+s>c)throw new RangeError("Trying to access beyond buffer length")}function ut(n,s,c,k,z,K){if(!a.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>z||s<K)throw new RangeError('"value" argument is out of bounds');if(c+k>n.length)throw new RangeError("Index out of range")}function _t(n,s,c,k){if(c+k>n.length)throw new RangeError("Index out of range");if(0>c)throw new RangeError("Index out of range")}function vt(n,s,c,k,z){return s=+s,c>>>=0,z||_t(n,s,c,4,34028234663852886e22,-34028234663852886e22),Z.write(n,s,c,k,23,4),c+4}function Ut(n,s,c,k,z){return s=+s,c>>>=0,z||_t(n,s,c,8,17976931348623157e292,-17976931348623157e292),Z.write(n,s,c,k,52,8),c+8}function Ft(n){if(n=n.split("=")[0],n=n.trim().replace(gt,""),2>n.length)return"";for(;n.length%4!=0;)n+="=";return n}function te(n){return 16>n?"0"+n.toString(16):n.toString(16)}function Pt(n,s){s=s||1/0;for(var c,k=n.length,z=null,K=[],ht=0;ht<k;++ht){if(c=n.charCodeAt(ht),55295<c&&57344>c){if(!z){if(56319<c){-1<(s-=3)&&K.push(239,191,189);continue}else if(ht+1===k){-1<(s-=3)&&K.push(239,191,189);continue}z=c;continue}if(56320>c){-1<(s-=3)&&K.push(239,191,189),z=c;continue}c=(z-55296<<10|c-56320)+65536}else z&&-1<(s-=3)&&K.push(239,191,189);if(z=null,128>c){if(0>(s-=1))break;K.push(c)}else if(2048>c){if(0>(s-=2))break;K.push(192|c>>6,128|63&c)}else if(65536>c){if(0>(s-=3))break;K.push(224|c>>12,128|63&c>>6,128|63&c)}else if(1114112>c){if(0>(s-=4))break;K.push(240|c>>18,128|63&c>>12,128|63&c>>6,128|63&c)}else throw new Error("Invalid code point")}return K}function re(n){for(var s=[],c=0;c<n.length;++c)s.push(255&n.charCodeAt(c));return s}function G(n,s){for(var c,k,z,K=[],ht=0;ht<n.length&&!(0>(s-=2));++ht)c=n.charCodeAt(ht),k=c>>8,z=c%256,K.push(z),K.push(k);return K}function tt(n){return T.toByteArray(Ft(n))}function bt(n,s,c,k){for(var z=0;z<k&&!(z+c>=s.length||z>=n.length);++z)s[z+c]=n[z];return z}function V(n,s){return n instanceof s||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===s.name}function b(n){return n!==n}var T=N("base64-js"),Z=N("ieee754");y.Buffer=a,y.SlowBuffer=function(n){return+n!=n&&(n=0),a.alloc(+n)},y.INSPECT_MAX_BYTES=50,y.kMaxLength=2147483647,a.TYPED_ARRAY_SUPPORT=function(){try{var n=new Uint8Array(1);return n.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},n.foo()===42}catch(s){return!1}}(),a.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){return a.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){return a.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol!="undefined"&&Symbol.species!=null&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192,a.from=function(n,s,c){return w(n,s,c)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,a.alloc=function(n,s,c){return h(n,s,c)},a.allocUnsafe=function(n){return L(n)},a.allocUnsafeSlow=function(n){return L(n)},a.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==a.prototype},a.compare=function(n,s){if(V(n,Uint8Array)&&(n=a.from(n,n.offset,n.byteLength)),V(s,Uint8Array)&&(s=a.from(s,s.offset,s.byteLength)),!a.isBuffer(n)||!a.isBuffer(s))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===s)return 0;for(var c=n.length,k=s.length,z=0,K=U(c,k);z<K;++z)if(n[z]!==s[z]){c=n[z],k=s[z];break}return c<k?-1:k<c?1:0},a.isEncoding=function(n){switch((n+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(n,s){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return a.alloc(0);var c;if(s===void 0)for(s=0,c=0;c<n.length;++c)s+=n[c].length;var k=a.allocUnsafe(s),z=0;for(c=0;c<n.length;++c){var K=n[c];if(V(K,Uint8Array)&&(K=a.from(K)),!a.isBuffer(K))throw new TypeError('"list" argument must be an Array of Buffers');K.copy(k,z),z+=K.length}return k},a.byteLength=m,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var n=this.length;if(n%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var s=0;s<n;s+=2)v(this,s,s+1);return this},a.prototype.swap32=function(){var n=this.length;if(n%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var s=0;s<n;s+=4)v(this,s,s+3),v(this,s+1,s+2);return this},a.prototype.swap64=function(){var n=this.length;if(n%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var s=0;s<n;s+=8)v(this,s,s+7),v(this,s+1,s+6),v(this,s+2,s+5),v(this,s+3,s+4);return this},a.prototype.toString=function(){var n=this.length;return n===0?"":arguments.length===0?It(this,0,n):C.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(n){if(!a.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n||a.compare(this,n)===0},a.prototype.inspect=function(){var n="",s=y.INSPECT_MAX_BYTES;return n=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(n+=" ... "),"<Buffer "+n+">"},a.prototype.compare=function(n,s,c,k,z){if(V(n,Uint8Array)&&(n=a.from(n,n.offset,n.byteLength)),!a.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(s===void 0&&(s=0),c===void 0&&(c=n?n.length:0),k===void 0&&(k=0),z===void 0&&(z=this.length),0>s||c>n.length||0>k||z>this.length)throw new RangeError("out of range index");if(k>=z&&s>=c)return 0;if(k>=z)return-1;if(s>=c)return 1;if(s>>>=0,c>>>=0,k>>>=0,z>>>=0,this===n)return 0;for(var K=z-k,ht=c-s,Tt=U(K,ht),Vt=this.slice(k,z),Nt=n.slice(s,c),Ot=0;Ot<Tt;++Ot)if(Vt[Ot]!==Nt[Ot]){K=Vt[Ot],ht=Nt[Ot];break}return K<ht?-1:ht<K?1:0},a.prototype.includes=function(n,s,c){return this.indexOf(n,s,c)!==-1},a.prototype.indexOf=function(n,s,c){return A(this,n,s,c,!0)},a.prototype.lastIndexOf=function(n,s,c){return A(this,n,s,c,!1)},a.prototype.write=function(n,s,c,k){if(s===void 0)k="utf8",c=this.length,s=0;else if(c===void 0&&typeof s=="string")k=s,c=this.length,s=0;else if(isFinite(s))s>>>=0,isFinite(c)?(c>>>=0,k===void 0&&(k="utf8")):(k=c,c=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var z=this.length-s;if((c===void 0||c>z)&&(c=z),0<n.length&&(0>c||0>s)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");for(var K=!1;;)switch(k){case"hex":return x(this,n,s,c);case"utf8":case"utf-8":return P(this,n,s,c);case"ascii":return q(this,n,s,c);case"latin1":case"binary":return ot(this,n,s,c);case"base64":return wt(this,n,s,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ct(this,n,s,c);default:if(K)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),K=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(n,s){var c=this.length;n=~~n,s=s===void 0?c:~~s,0>n?(n+=c,0>n&&(n=0)):n>c&&(n=c),0>s?(s+=c,0>s&&(s=0)):s>c&&(s=c),s<n&&(s=n);var k=this.subarray(n,s);return k.__proto__=a.prototype,k},a.prototype.readUIntLE=function(n,s,c){n>>>=0,s>>>=0,c||nt(n,s,this.length);for(var k=this[n],z=1,K=0;++K<s&&(z*=256);)k+=this[n+K]*z;return k},a.prototype.readUIntBE=function(n,s,c){n>>>=0,s>>>=0,c||nt(n,s,this.length);for(var k=this[n+--s],z=1;0<s&&(z*=256);)k+=this[n+--s]*z;return k},a.prototype.readUInt8=function(n,s){return n>>>=0,s||nt(n,1,this.length),this[n]},a.prototype.readUInt16LE=function(n,s){return n>>>=0,s||nt(n,2,this.length),this[n]|this[n+1]<<8},a.prototype.readUInt16BE=function(n,s){return n>>>=0,s||nt(n,2,this.length),this[n]<<8|this[n+1]},a.prototype.readUInt32LE=function(n,s){return n>>>=0,s||nt(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+16777216*this[n+3]},a.prototype.readUInt32BE=function(n,s){return n>>>=0,s||nt(n,4,this.length),16777216*this[n]+(this[n+1]<<16|this[n+2]<<8|this[n+3])},a.prototype.readIntLE=function(n,s,c){n>>>=0,s>>>=0,c||nt(n,s,this.length);for(var k=this[n],z=1,K=0;++K<s&&(z*=256);)k+=this[n+K]*z;return z*=128,k>=z&&(k-=it(2,8*s)),k},a.prototype.readIntBE=function(n,s,c){n>>>=0,s>>>=0,c||nt(n,s,this.length);for(var k=s,z=1,K=this[n+--k];0<k&&(z*=256);)K+=this[n+--k]*z;return z*=128,K>=z&&(K-=it(2,8*s)),K},a.prototype.readInt8=function(n,s){return n>>>=0,s||nt(n,1,this.length),128&this[n]?-1*(255-this[n]+1):this[n]},a.prototype.readInt16LE=function(n,s){n>>>=0,s||nt(n,2,this.length);var c=this[n]|this[n+1]<<8;return 32768&c?4294901760|c:c},a.prototype.readInt16BE=function(n,s){n>>>=0,s||nt(n,2,this.length);var c=this[n+1]|this[n]<<8;return 32768&c?4294901760|c:c},a.prototype.readInt32LE=function(n,s){return n>>>=0,s||nt(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},a.prototype.readInt32BE=function(n,s){return n>>>=0,s||nt(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},a.prototype.readFloatLE=function(n,s){return n>>>=0,s||nt(n,4,this.length),Z.read(this,n,!0,23,4)},a.prototype.readFloatBE=function(n,s){return n>>>=0,s||nt(n,4,this.length),Z.read(this,n,!1,23,4)},a.prototype.readDoubleLE=function(n,s){return n>>>=0,s||nt(n,8,this.length),Z.read(this,n,!0,52,8)},a.prototype.readDoubleBE=function(n,s){return n>>>=0,s||nt(n,8,this.length),Z.read(this,n,!1,52,8)},a.prototype.writeUIntLE=function(n,s,c,k){if(n=+n,s>>>=0,c>>>=0,!k){var z=it(2,8*c)-1;ut(this,n,s,c,z,0)}var K=1,ht=0;for(this[s]=255&n;++ht<c&&(K*=256);)this[s+ht]=255&n/K;return s+c},a.prototype.writeUIntBE=function(n,s,c,k){if(n=+n,s>>>=0,c>>>=0,!k){var z=it(2,8*c)-1;ut(this,n,s,c,z,0)}var K=c-1,ht=1;for(this[s+K]=255&n;0<=--K&&(ht*=256);)this[s+K]=255&n/ht;return s+c},a.prototype.writeUInt8=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,1,255,0),this[s]=255&n,s+1},a.prototype.writeUInt16LE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,2,65535,0),this[s]=255&n,this[s+1]=n>>>8,s+2},a.prototype.writeUInt16BE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,2,65535,0),this[s]=n>>>8,this[s+1]=255&n,s+2},a.prototype.writeUInt32LE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,4,4294967295,0),this[s+3]=n>>>24,this[s+2]=n>>>16,this[s+1]=n>>>8,this[s]=255&n,s+4},a.prototype.writeUInt32BE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,4,4294967295,0),this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=255&n,s+4},a.prototype.writeIntLE=function(n,s,c,k){if(n=+n,s>>>=0,!k){var z=it(2,8*c-1);ut(this,n,s,c,z-1,-z)}var K=0,ht=1,Tt=0;for(this[s]=255&n;++K<c&&(ht*=256);)0>n&&Tt===0&&this[s+K-1]!==0&&(Tt=1),this[s+K]=255&(n/ht>>0)-Tt;return s+c},a.prototype.writeIntBE=function(n,s,c,k){if(n=+n,s>>>=0,!k){var z=it(2,8*c-1);ut(this,n,s,c,z-1,-z)}var K=c-1,ht=1,Tt=0;for(this[s+K]=255&n;0<=--K&&(ht*=256);)0>n&&Tt===0&&this[s+K+1]!==0&&(Tt=1),this[s+K]=255&(n/ht>>0)-Tt;return s+c},a.prototype.writeInt8=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,1,127,-128),0>n&&(n=255+n+1),this[s]=255&n,s+1},a.prototype.writeInt16LE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,2,32767,-32768),this[s]=255&n,this[s+1]=n>>>8,s+2},a.prototype.writeInt16BE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,2,32767,-32768),this[s]=n>>>8,this[s+1]=255&n,s+2},a.prototype.writeInt32LE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,4,2147483647,-2147483648),this[s]=255&n,this[s+1]=n>>>8,this[s+2]=n>>>16,this[s+3]=n>>>24,s+4},a.prototype.writeInt32BE=function(n,s,c){return n=+n,s>>>=0,c||ut(this,n,s,4,2147483647,-2147483648),0>n&&(n=4294967295+n+1),this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=255&n,s+4},a.prototype.writeFloatLE=function(n,s,c){return vt(this,n,s,!0,c)},a.prototype.writeFloatBE=function(n,s,c){return vt(this,n,s,!1,c)},a.prototype.writeDoubleLE=function(n,s,c){return Ut(this,n,s,!0,c)},a.prototype.writeDoubleBE=function(n,s,c){return Ut(this,n,s,!1,c)},a.prototype.copy=function(n,s,c,k){if(!a.isBuffer(n))throw new TypeError("argument should be a Buffer");if(c||(c=0),k||k===0||(k=this.length),s>=n.length&&(s=n.length),s||(s=0),0<k&&k<c&&(k=c),k===c||n.length===0||this.length===0)return 0;if(0>s)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("Index out of range");if(0>k)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),n.length-s<k-c&&(k=n.length-s+c);var z=k-c;if(this===n&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(s,c,k);else if(this===n&&c<s&&s<k)for(var K=z-1;0<=K;--K)n[K+s]=this[K+c];else Uint8Array.prototype.set.call(n,this.subarray(c,k),s);return z},a.prototype.fill=function(n,s,c,k){if(typeof n=="string"){if(typeof s=="string"?(k=s,s=0,c=this.length):typeof c=="string"&&(k=c,c=this.length),k!==void 0&&typeof k!="string")throw new TypeError("encoding must be a string");if(typeof k=="string"&&!a.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(n.length===1){var z=n.charCodeAt(0);(k==="utf8"&&128>z||k==="latin1")&&(n=z)}}else typeof n=="number"&&(n&=255);if(0>s||this.length<s||this.length<c)throw new RangeError("Out of range index");if(c<=s)return this;s>>>=0,c=c===void 0?this.length:c>>>0,n||(n=0);var K;if(typeof n=="number")for(K=s;K<c;++K)this[K]=n;else{var ht=a.isBuffer(n)?n:a.from(n,k),Tt=ht.length;if(Tt===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(K=0;K<c-s;++K)this[K+s]=ht[K%Tt]}return this};var gt=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,N("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(N,D,y){(function(g){(function(){function U(){let a;try{a=y.storage.getItem("debug")}catch(w){}return!a&&typeof g!="undefined"&&"env"in g&&(a=g.env.DEBUG),a}y.formatArgs=function(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+D.exports.humanize(this.diff),!this.useColors)return;const w="color: "+this.color;a.splice(1,0,w,"color: inherit");let d=0,h=0;a[0].replace(/%[a-zA-Z%]/g,L=>{L==="%%"||(d++,L==="%c"&&(h=d))}),a.splice(h,0,w)},y.save=function(a){try{a?y.storage.setItem("debug",a):y.storage.removeItem("debug")}catch(w){}},y.load=U,y.useColors=function(){return!!(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},y.storage=function(){try{return localStorage}catch(a){}}(),y.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),y.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],y.log=console.debug||console.log||(()=>{}),D.exports=N("./common")(y);const{formatters:M}=D.exports;M.j=function(a){try{return JSON.stringify(a)}catch(w){return"[UnexpectedJSONParseError]: "+w.message}}}).call(this)}).call(this,N("_process"))},{"./common":5,_process:12}],5:[function(N,D){D.exports=function(y){function g(a){function w(...L){if(!w.enabled)return;const R=w,S=+new Date,B=S-(d||S);R.diff=B,R.prev=d,R.curr=S,d=S,L[0]=g.coerce(L[0]),typeof L[0]!="string"&&L.unshift("%O");let u=0;L[0]=L[0].replace(/%([a-zA-Z%])/g,(m,C)=>{if(m==="%%")return"%";u++;const v=g.formatters[C];if(typeof v=="function"){const A=L[u];m=v.call(R,A),L.splice(u,1),u--}return m}),g.formatArgs.call(R,L),(R.log||g.log).apply(R,L)}let d,h=null;return w.namespace=a,w.useColors=g.useColors(),w.color=g.selectColor(a),w.extend=U,w.destroy=g.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>h===null?g.enabled(a):h,set:L=>{h=L}}),typeof g.init=="function"&&g.init(w),w}function U(a,w){const d=g(this.namespace+(typeof w=="undefined"?":":w)+a);return d.log=this.log,d}function M(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}return g.debug=g,g.default=g,g.coerce=function(a){return a instanceof Error?a.stack||a.message:a},g.disable=function(){const a=[...g.names.map(M),...g.skips.map(M).map(w=>"-"+w)].join(",");return g.enable(""),a},g.enable=function(a){g.save(a),g.names=[],g.skips=[];let w;const d=(typeof a=="string"?a:"").split(/[\s,]+/),h=d.length;for(w=0;w<h;w++)d[w]&&(a=d[w].replace(/\*/g,".*?"),a[0]==="-"?g.skips.push(new RegExp("^"+a.substr(1)+"$")):g.names.push(new RegExp("^"+a+"$")))},g.enabled=function(a){if(a[a.length-1]==="*")return!0;let w,d;for(w=0,d=g.skips.length;w<d;w++)if(g.skips[w].test(a))return!1;for(w=0,d=g.names.length;w<d;w++)if(g.names[w].test(a))return!0;return!1},g.humanize=N("ms"),g.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(y).forEach(a=>{g[a]=y[a]}),g.names=[],g.skips=[],g.formatters={},g.selectColor=function(a){let w=0;for(let d=0;d<a.length;d++)w=(w<<5)-w+a.charCodeAt(d),w|=0;return g.colors[pt(w)%g.colors.length]},g.enable(g.load()),g}},{ms:11}],6:[function(N,D){"use strict";function y(g,U){for(const M in U)Object.defineProperty(g,M,{value:U[M],enumerable:!0,configurable:!0});return g}D.exports=function(g,U,M){if(!g||typeof g=="string")throw new TypeError("Please pass an Error to err-code");M||(M={}),typeof U=="object"&&(M=U,U=""),U&&(M.code=U);try{return y(g,M)}catch(a){M.message=g.message,M.stack=g.stack;const w=function(){};return w.prototype=Object.create(Object.getPrototypeOf(g)),y(new w,M)}}},{}],7:[function(N,D){"use strict";function y(x){console&&console.warn&&console.warn(x)}function g(){g.init.call(this)}function U(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function M(x){return x._maxListeners===void 0?g.defaultMaxListeners:x._maxListeners}function a(x,P,q,ot){var wt,Ct,Dt;if(U(q),Ct=x._events,Ct===void 0?(Ct=x._events=Object.create(null),x._eventsCount=0):(Ct.newListener!==void 0&&(x.emit("newListener",P,q.listener?q.listener:q),Ct=x._events),Dt=Ct[P]),Dt===void 0)Dt=Ct[P]=q,++x._eventsCount;else if(typeof Dt=="function"?Dt=Ct[P]=ot?[q,Dt]:[Dt,q]:ot?Dt.unshift(q):Dt.push(q),wt=M(x),0<wt&&Dt.length>wt&&!Dt.warned){Dt.warned=!0;var It=new Error("Possible EventEmitter memory leak detected. "+Dt.length+" "+(P+" listeners added. Use emitter.setMaxListeners() to increase limit"));It.name="MaxListenersExceededWarning",It.emitter=x,It.type=P,It.count=Dt.length,y(It)}return x}function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(x,P,q){var ot={fired:!1,wrapFn:void 0,target:x,type:P,listener:q},wt=w.bind(ot);return wt.listener=q,ot.wrapFn=wt,wt}function h(x,P,q){var ot=x._events;if(ot===void 0)return[];var wt=ot[P];return wt===void 0?[]:typeof wt=="function"?q?[wt.listener||wt]:[wt]:q?B(wt):R(wt,wt.length)}function L(x){var P=this._events;if(P!==void 0){var q=P[x];if(typeof q=="function")return 1;if(q!==void 0)return q.length}return 0}function R(x,P){for(var q=Array(P),ot=0;ot<P;++ot)q[ot]=x[ot];return q}function S(x,P){for(;P+1<x.length;P++)x[P]=x[P+1];x.pop()}function B(x){for(var P=Array(x.length),q=0;q<P.length;++q)P[q]=x[q].listener||x[q];return P}function u(x,P,q){typeof x.on=="function"&&_(x,"error",P,q)}function _(x,P,q,ot){if(typeof x.on=="function")ot.once?x.once(P,q):x.on(P,q);else if(typeof x.addEventListener=="function")x.addEventListener(P,function wt(Ct){ot.once&&x.removeEventListener(P,wt),q(Ct)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}var m,C=typeof Reflect=="object"?Reflect:null,v=C&&typeof C.apply=="function"?C.apply:function(x,P,q){return Function.prototype.apply.call(x,P,q)};m=C&&typeof C.ownKeys=="function"?C.ownKeys:Object.getOwnPropertySymbols?function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:function(x){return Object.getOwnPropertyNames(x)};var A=Number.isNaN||function(x){return x!==x};D.exports=g,D.exports.once=function(x,P){return new Promise(function(q,ot){function wt(Dt){x.removeListener(P,Ct),ot(Dt)}function Ct(){typeof x.removeListener=="function"&&x.removeListener("error",wt),q([].slice.call(arguments))}_(x,P,Ct,{once:!0}),P!=="error"&&u(x,wt,{once:!0})})},g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var Y=10;Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return Y},set:function(x){if(typeof x!="number"||0>x||A(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");Y=x}}),g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(x){if(typeof x!="number"||0>x||A(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},g.prototype.getMaxListeners=function(){return M(this)},g.prototype.emit=function(x){for(var P=[],q=1;q<arguments.length;q++)P.push(arguments[q]);var ot=x==="error",wt=this._events;if(wt!==void 0)ot=ot&&wt.error===void 0;else if(!ot)return!1;if(ot){var Ct;if(0<P.length&&(Ct=P[0]),Ct instanceof Error)throw Ct;var Dt=new Error("Unhandled error."+(Ct?" ("+Ct.message+")":""));throw Dt.context=Ct,Dt}var It=wt[x];if(It===void 0)return!1;if(typeof It=="function")v(It,this,P);else for(var Mt=It.length,St=R(It,Mt),q=0;q<Mt;++q)v(St[q],this,P);return!0},g.prototype.addListener=function(x,P){return a(this,x,P,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(x,P){return a(this,x,P,!0)},g.prototype.once=function(x,P){return U(P),this.on(x,d(this,x,P)),this},g.prototype.prependOnceListener=function(x,P){return U(P),this.prependListener(x,d(this,x,P)),this},g.prototype.removeListener=function(x,P){var q,ot,wt,Ct,Dt;if(U(P),ot=this._events,ot===void 0)return this;if(q=ot[x],q===void 0)return this;if(q===P||q.listener===P)--this._eventsCount==0?this._events=Object.create(null):(delete ot[x],ot.removeListener&&this.emit("removeListener",x,q.listener||P));else if(typeof q!="function"){for(wt=-1,Ct=q.length-1;0<=Ct;Ct--)if(q[Ct]===P||q[Ct].listener===P){Dt=q[Ct].listener,wt=Ct;break}if(0>wt)return this;wt===0?q.shift():S(q,wt),q.length===1&&(ot[x]=q[0]),ot.removeListener!==void 0&&this.emit("removeListener",x,Dt||P)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(x){var P,q,ot;if(q=this._events,q===void 0)return this;if(q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):q[x]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete q[x]),this;if(arguments.length===0){var wt,Ct=Object.keys(q);for(ot=0;ot<Ct.length;++ot)wt=Ct[ot],wt!=="removeListener"&&this.removeAllListeners(wt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(P=q[x],typeof P=="function")this.removeListener(x,P);else if(P!==void 0)for(ot=P.length-1;0<=ot;ot--)this.removeListener(x,P[ot]);return this},g.prototype.listeners=function(x){return h(this,x,!0)},g.prototype.rawListeners=function(x){return h(this,x,!1)},g.listenerCount=function(x,P){return typeof x.listenerCount=="function"?x.listenerCount(P):L.call(x,P)},g.prototype.listenerCount=L,g.prototype.eventNames=function(){return 0<this._eventsCount?m(this._events):[]}},{}],8:[function(N,D){D.exports=function(){if(typeof globalThis=="undefined")return null;var y={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return y.RTCPeerConnection?y:null}},{}],9:[function(N,D,y){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */y.read=function(g,U,M,a,w){var d,h,L=8*w-a-1,R=(1<<L)-1,S=R>>1,B=-7,u=M?w-1:0,_=M?-1:1,m=g[U+u];for(u+=_,d=m&(1<<-B)-1,m>>=-B,B+=L;0<B;d=256*d+g[U+u],u+=_,B-=8);for(h=d&(1<<-B)-1,d>>=-B,B+=a;0<B;h=256*h+g[U+u],u+=_,B-=8);if(d===0)d=1-S;else{if(d===R)return h?NaN:(m?-1:1)*(1/0);h+=it(2,a),d-=S}return(m?-1:1)*h*it(2,d-a)},y.write=function(g,U,M,a,w,d){var h,L,R,S=Math.LN2,B=Math.log,u=8*d-w-1,_=(1<<u)-1,m=_>>1,C=w===23?it(2,-24)-it(2,-77):0,v=a?0:d-1,A=a?1:-1,Y=0>U||U===0&&0>1/U?1:0;for(U=pt(U),isNaN(U)||U===1/0?(L=isNaN(U)?1:0,h=_):(h=ct(B(U)/S),1>U*(R=it(2,-h))&&(h--,R*=2),U+=1<=h+m?C/R:C*it(2,1-m),2<=U*R&&(h++,R/=2),h+m>=_?(L=0,h=_):1<=h+m?(L=(U*R-1)*it(2,w),h+=m):(L=U*it(2,m-1)*it(2,w),h=0));8<=w;g[M+v]=255&L,v+=A,L/=256,w-=8);for(h=h<<w|L,u+=w;0<u;g[M+v]=255&h,v+=A,h/=256,u-=8);g[M+v-A]|=128*Y}},{}],10:[function(N,D){D.exports=typeof Object.create=="function"?function(y,g){g&&(y.super_=g,y.prototype=Object.create(g.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}))}:function(y,g){if(g){y.super_=g;var U=function(){};U.prototype=g.prototype,y.prototype=new U,y.prototype.constructor=y}}},{}],11:[function(N,D){var y=Math.round;function g(d){if(d+="",!(100<d.length)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var L=parseFloat(h[1]),R=(h[2]||"ms").toLowerCase();return R==="years"||R==="year"||R==="yrs"||R==="yr"||R==="y"?315576e5*L:R==="weeks"||R==="week"||R==="w"?6048e5*L:R==="days"||R==="day"||R==="d"?864e5*L:R==="hours"||R==="hour"||R==="hrs"||R==="hr"||R==="h"?36e5*L:R==="minutes"||R==="minute"||R==="mins"||R==="min"||R==="m"?6e4*L:R==="seconds"||R==="second"||R==="secs"||R==="sec"||R==="s"?1e3*L:R==="milliseconds"||R==="millisecond"||R==="msecs"||R==="msec"||R==="ms"?L:void 0}}}function U(d){var h=pt(d);return 864e5<=h?y(d/864e5)+"d":36e5<=h?y(d/36e5)+"h":6e4<=h?y(d/6e4)+"m":1e3<=h?y(d/1e3)+"s":d+"ms"}function M(d){var h=pt(d);return 864e5<=h?a(d,h,864e5,"day"):36e5<=h?a(d,h,36e5,"hour"):6e4<=h?a(d,h,6e4,"minute"):1e3<=h?a(d,h,1e3,"second"):d+" ms"}function a(d,h,L,R){return y(d/L)+" "+R+(h>=1.5*L?"s":"")}var w=24*(60*6e4);D.exports=function(d,h){h=h||{};var L=typeof d;if(L=="string"&&0<d.length)return g(d);if(L==="number"&&isFinite(d))return h.long?M(d):U(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],12:[function(N,D){function y(){throw new Error("setTimeout has not been defined")}function g(){throw new Error("clearTimeout has not been defined")}function U(C){if(L===setTimeout)return setTimeout(C,0);if((L===y||!L)&&setTimeout)return L=setTimeout,setTimeout(C,0);try{return L(C,0)}catch(v){try{return L.call(null,C,0)}catch(A){return L.call(this,C,0)}}}function M(C){if(R===clearTimeout)return clearTimeout(C);if((R===g||!R)&&clearTimeout)return R=clearTimeout,clearTimeout(C);try{return R(C)}catch(v){try{return R.call(null,C)}catch(A){return R.call(this,C)}}}function a(){_&&B&&(_=!1,B.length?u=B.concat(u):m=-1,u.length&&w())}function w(){if(!_){var C=U(a);_=!0;for(var v=u.length;v;){for(B=u,u=[];++m<v;)B&&B[m].run();m=-1,v=u.length}B=null,_=!1,M(C)}}function d(C,v){this.fun=C,this.array=v}function h(){}var L,R,S=D.exports={};(function(){try{L=typeof setTimeout=="function"?setTimeout:y}catch(C){L=y}try{R=typeof clearTimeout=="function"?clearTimeout:g}catch(C){R=g}})();var B,u=[],_=!1,m=-1;S.nextTick=function(C){var v=Array(arguments.length-1);if(1<arguments.length)for(var A=1;A<arguments.length;A++)v[A-1]=arguments[A];u.push(new d(C,v)),u.length!==1||_||U(w)},d.prototype.run=function(){this.fun.apply(null,this.array)},S.title="browser",S.browser=!0,S.env={},S.argv=[],S.version="",S.versions={},S.on=h,S.addListener=h,S.once=h,S.off=h,S.removeListener=h,S.removeAllListeners=h,S.emit=h,S.prependListener=h,S.prependOnceListener=h,S.listeners=function(){return[]},S.binding=function(){throw new Error("process.binding is not supported")},S.cwd=function(){return"/"},S.chdir=function(){throw new Error("process.chdir is not supported")},S.umask=function(){return 0}},{}],13:[function(N,D){(function(y){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let g;D.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window=="undefined"?y:window):U=>(g||(g=Promise.resolve())).then(U).catch(M=>setTimeout(()=>{throw M},0))}).call(this)}).call(this,typeof $.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:$.g)},{}],14:[function(N,D){(function(y,g){(function(){"use strict";var U=N("safe-buffer").Buffer,M=g.crypto||g.msCrypto;D.exports=M&&M.getRandomValues?function(a,w){if(a>4294967295)throw new RangeError("requested too many random bytes");var d=U.allocUnsafe(a);if(0<a)if(65536<a)for(var h=0;h<a;h+=65536)M.getRandomValues(d.slice(h,h+65536));else M.getRandomValues(d);return typeof w=="function"?y.nextTick(function(){w(null,d)}):d}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,N("_process"),typeof $.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:$.g)},{_process:12,"safe-buffer":30}],15:[function(N,D){"use strict";function y(h,L){h.prototype=Object.create(L.prototype),h.prototype.constructor=h,h.__proto__=L}function g(h,L,R){function S(u,_,m){return typeof L=="string"?L:L(u,_,m)}R||(R=Error);var B=function(u){function _(m,C,v){return u.call(this,S(m,C,v))||this}return y(_,u),_}(R);B.prototype.name=R.name,B.prototype.code=h,d[h]=B}function U(h,L){if(Array.isArray(h)){var R=h.length;return h=h.map(function(S){return S+""}),2<R?"one of ".concat(L," ").concat(h.slice(0,R-1).join(", "),", or ")+h[R-1]:R===2?"one of ".concat(L," ").concat(h[0]," or ").concat(h[1]):"of ".concat(L," ").concat(h[0])}return"of ".concat(L," ").concat(h+"")}function M(h,L,R){return h.substr(!R||0>R?0:+R,L.length)===L}function a(h,L,R){return(R===void 0||R>h.length)&&(R=h.length),h.substring(R-L.length,R)===L}function w(h,L,R){return typeof R!="number"&&(R=0),!(R+L.length>h.length)&&h.indexOf(L,R)!==-1}var d={};g("ERR_INVALID_OPT_VALUE",function(h,L){return'The value "'+L+'" is invalid for option "'+h+'"'},TypeError),g("ERR_INVALID_ARG_TYPE",function(h,L,R){var S;typeof L=="string"&&M(L,"not ")?(S="must not be",L=L.replace(/^not /,"")):S="must be";var B;if(a(h," argument"))B="The ".concat(h," ").concat(S," ").concat(U(L,"type"));else{var u=w(h,".")?"property":"argument";B='The "'.concat(h,'" ').concat(u," ").concat(S," ").concat(U(L,"type"))}return B+=". Received type ".concat(typeof R),B},TypeError),g("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),g("ERR_METHOD_NOT_IMPLEMENTED",function(h){return"The "+h+" method is not implemented"}),g("ERR_STREAM_PREMATURE_CLOSE","Premature close"),g("ERR_STREAM_DESTROYED",function(h){return"Cannot call "+h+" after a stream was destroyed"}),g("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),g("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),g("ERR_STREAM_WRITE_AFTER_END","write after end"),g("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),g("ERR_UNKNOWN_ENCODING",function(h){return"Unknown encoding: "+h},TypeError),g("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),D.exports.codes=d},{}],16:[function(N,D){(function(y){(function(){"use strict";function g(S){return this instanceof g?(w.call(this,S),d.call(this,S),this.allowHalfOpen=!0,void(S&&(S.readable===!1&&(this.readable=!1),S.writable===!1&&(this.writable=!1),S.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",U))))):new g(S)}function U(){this._writableState.ended||y.nextTick(M,this)}function M(S){S.end()}var a=Object.keys||function(S){var B=[];for(var u in S)B.push(u);return B};D.exports=g;var w=N("./_stream_readable"),d=N("./_stream_writable");N("inherits")(g,w);for(var h,L=a(d.prototype),R=0;R<L.length;R++)h=L[R],g.prototype[h]||(g.prototype[h]=d.prototype[h]);Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(S){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=S,this._writableState.destroyed=S)}})}).call(this)}).call(this,N("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(N,D){"use strict";function y(U){return this instanceof y?void g.call(this,U):new y(U)}D.exports=y;var g=N("./_stream_transform");N("inherits")(y,g),y.prototype._transform=function(U,M,a){a(null,U)}},{"./_stream_transform":19,inherits:10}],18:[function(N,D){(function(y,g){(function(){"use strict";function U(n){return nt.from(n)}function M(n){return nt.isBuffer(n)||n instanceof ut}function a(n,s,c){return typeof n.prependListener=="function"?n.prependListener(s,c):void(n._events&&n._events[s]?Array.isArray(n._events[s])?n._events[s].unshift(c):n._events[s]=[c,n._events[s]]:n.on(s,c))}function w(n,s,c){Mt=Mt||N("./_stream_duplex"),n=n||{},typeof c!="boolean"&&(c=s instanceof Mt),this.objectMode=!!n.objectMode,c&&(this.objectMode=this.objectMode||!!n.readableObjectMode),this.highWaterMark=G(this,n,"readableHighWaterMark",c),this.buffer=new te,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=n.emitClose!==!1,this.autoDestroy=!!n.autoDestroy,this.destroyed=!1,this.defaultEncoding=n.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,n.encoding&&(!vt&&(vt=N("string_decoder/").StringDecoder),this.decoder=new vt(n.encoding),this.encoding=n.encoding)}function d(n){if(Mt=Mt||N("./_stream_duplex"),!(this instanceof d))return new d(n);var s=this instanceof Mt;this._readableState=new w(n,this,s),this.readable=!0,n&&(typeof n.read=="function"&&(this._read=n.read),typeof n.destroy=="function"&&(this._destroy=n.destroy)),at.call(this)}function h(n,s,c,k,z){St("readableAddChunk",s);var K=n._readableState;if(s===null)K.reading=!1,u(n,K);else{var ht;if(z||(ht=R(K,s)),ht)Z(n,ht);else if(!(K.objectMode||s&&0<s.length))k||(K.reading=!1,C(n,K));else if(typeof s=="string"||K.objectMode||Object.getPrototypeOf(s)===nt.prototype||(s=U(s)),k)K.endEmitted?Z(n,new T):L(n,K,s,!0);else if(K.ended)Z(n,new V);else{if(K.destroyed)return!1;K.reading=!1,K.decoder&&!c?(s=K.decoder.write(s),K.objectMode||s.length!==0?L(n,K,s,!1):C(n,K)):L(n,K,s,!1)}}return!K.ended&&(K.length<K.highWaterMark||K.length===0)}function L(n,s,c,k){s.flowing&&s.length===0&&!s.sync?(s.awaitDrain=0,n.emit("data",c)):(s.length+=s.objectMode?1:c.length,k?s.buffer.unshift(c):s.buffer.push(c),s.needReadable&&_(n)),C(n,s)}function R(n,s){var c;return M(s)||typeof s=="string"||s===void 0||n.objectMode||(c=new bt("chunk",["string","Buffer","Uint8Array"],s)),c}function S(n){return 1073741824<=n?n=1073741824:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function B(n,s){return 0>=n||s.length===0&&s.ended?0:s.objectMode?1:n===n?(n>s.highWaterMark&&(s.highWaterMark=S(n)),n<=s.length?n:s.ended?s.length:(s.needReadable=!0,0)):s.flowing&&s.length?s.buffer.head.data.length:s.length}function u(n,s){if(St("onEofChunk"),!s.ended){if(s.decoder){var c=s.decoder.end();c&&c.length&&(s.buffer.push(c),s.length+=s.objectMode?1:c.length)}s.ended=!0,s.sync?_(n):(s.needReadable=!1,!s.emittedReadable&&(s.emittedReadable=!0,m(n)))}}function _(n){var s=n._readableState;St("emitReadable",s.needReadable,s.emittedReadable),s.needReadable=!1,s.emittedReadable||(St("emitReadable",s.flowing),s.emittedReadable=!0,y.nextTick(m,n))}function m(n){var s=n._readableState;St("emitReadable_",s.destroyed,s.length,s.ended),!s.destroyed&&(s.length||s.ended)&&(n.emit("readable"),s.emittedReadable=!1),s.needReadable=!s.flowing&&!s.ended&&s.length<=s.highWaterMark,ot(n)}function C(n,s){s.readingMore||(s.readingMore=!0,y.nextTick(v,n,s))}function v(n,s){for(;!s.reading&&!s.ended&&(s.length<s.highWaterMark||s.flowing&&s.length===0);){var c=s.length;if(St("maybeReadMore read 0"),n.read(0),c===s.length)break}s.readingMore=!1}function A(n){return function(){var s=n._readableState;St("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&Xt(n,"data")&&(s.flowing=!0,ot(n))}}function Y(n){var s=n._readableState;s.readableListening=0<n.listenerCount("readable"),s.resumeScheduled&&!s.paused?s.flowing=!0:0<n.listenerCount("data")&&n.resume()}function x(n){St("readable nexttick read 0"),n.read(0)}function P(n,s){s.resumeScheduled||(s.resumeScheduled=!0,y.nextTick(q,n,s))}function q(n,s){St("resume",s.reading),s.reading||n.read(0),s.resumeScheduled=!1,n.emit("resume"),ot(n),s.flowing&&!s.reading&&n.read(0)}function ot(n){var s=n._readableState;for(St("flow",s.flowing);s.flowing&&n.read()!==null;);}function wt(n,s){if(s.length===0)return null;var c;return s.objectMode?c=s.buffer.shift():!n||n>=s.length?(c=s.decoder?s.buffer.join(""):s.buffer.length===1?s.buffer.first():s.buffer.concat(s.length),s.buffer.clear()):c=s.buffer.consume(n,s.decoder),c}function Ct(n){var s=n._readableState;St("endReadable",s.endEmitted),s.endEmitted||(s.ended=!0,y.nextTick(Dt,s,n))}function Dt(n,s){if(St("endReadableNT",n.endEmitted,n.length),!n.endEmitted&&n.length===0&&(n.endEmitted=!0,s.readable=!1,s.emit("end"),n.autoDestroy)){var c=s._writableState;(!c||c.autoDestroy&&c.finished)&&s.destroy()}}function It(n,s){for(var c=0,k=n.length;c<k;c++)if(n[c]===s)return c;return-1}D.exports=d;var Mt;d.ReadableState=w;var St,ee=N("events").EventEmitter,Xt=function(n,s){return n.listeners(s).length},at=N("./internal/streams/stream"),nt=N("buffer").Buffer,ut=g.Uint8Array||function(){},_t=N("util");St=_t&&_t.debuglog?_t.debuglog("stream"):function(){};var vt,Ut,Ft,te=N("./internal/streams/buffer_list"),Pt=N("./internal/streams/destroy"),re=N("./internal/streams/state"),G=re.getHighWaterMark,tt=N("../errors").codes,bt=tt.ERR_INVALID_ARG_TYPE,V=tt.ERR_STREAM_PUSH_AFTER_EOF,b=tt.ERR_METHOD_NOT_IMPLEMENTED,T=tt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;N("inherits")(d,at);var Z=Pt.errorOrDestroy,gt=["error","close","destroy","pause","resume"];Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(n){this._readableState&&(this._readableState.destroyed=n)}}),d.prototype.destroy=Pt.destroy,d.prototype._undestroy=Pt.undestroy,d.prototype._destroy=function(n,s){s(n)},d.prototype.push=function(n,s){var c,k=this._readableState;return k.objectMode?c=!0:typeof n=="string"&&(s=s||k.defaultEncoding,s!==k.encoding&&(n=nt.from(n,s),s=""),c=!0),h(this,n,s,!1,c)},d.prototype.unshift=function(n){return h(this,n,null,!0,!1)},d.prototype.isPaused=function(){return this._readableState.flowing===!1},d.prototype.setEncoding=function(n){vt||(vt=N("string_decoder/").StringDecoder);var s=new vt(n);this._readableState.decoder=s,this._readableState.encoding=this._readableState.decoder.encoding;for(var c=this._readableState.buffer.head,k="";c!==null;)k+=s.write(c.data),c=c.next;return this._readableState.buffer.clear(),k!==""&&this._readableState.buffer.push(k),this._readableState.length=k.length,this},d.prototype.read=function(n){St("read",n),n=parseInt(n,10);var s=this._readableState,c=n;if(n!==0&&(s.emittedReadable=!1),n===0&&s.needReadable&&((s.highWaterMark===0?0<s.length:s.length>=s.highWaterMark)||s.ended))return St("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?Ct(this):_(this),null;if(n=B(n,s),n===0&&s.ended)return s.length===0&&Ct(this),null;var k=s.needReadable;St("need readable",k),(s.length===0||s.length-n<s.highWaterMark)&&(k=!0,St("length less than watermark",k)),s.ended||s.reading?(k=!1,St("reading or ended",k)):k&&(St("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,!s.reading&&(n=B(c,s)));var z;return z=0<n?wt(n,s):null,z===null?(s.needReadable=s.length<=s.highWaterMark,n=0):(s.length-=n,s.awaitDrain=0),s.length===0&&(!s.ended&&(s.needReadable=!0),c!==n&&s.ended&&Ct(this)),z!==null&&this.emit("data",z),z},d.prototype._read=function(){Z(this,new b("_read()"))},d.prototype.pipe=function(n,s){function c(mt,Wt){St("onunpipe"),mt===Ot&&Wt&&Wt.hasUnpiped===!1&&(Wt.hasUnpiped=!0,z())}function k(){St("onend"),n.end()}function z(){St("cleanup"),n.removeListener("close",Tt),n.removeListener("finish",Vt),n.removeListener("drain",st),n.removeListener("error",ht),n.removeListener("unpipe",c),Ot.removeListener("end",k),Ot.removeListener("end",Nt),Ot.removeListener("data",K),yt=!0,xt.awaitDrain&&(!n._writableState||n._writableState.needDrain)&&st()}function K(mt){St("ondata");var Wt=n.write(mt);St("dest.write",Wt),Wt===!1&&((xt.pipesCount===1&&xt.pipes===n||1<xt.pipesCount&&It(xt.pipes,n)!==-1)&&!yt&&(St("false write response, pause",xt.awaitDrain),xt.awaitDrain++),Ot.pause())}function ht(mt){St("onerror",mt),Nt(),n.removeListener("error",ht),Xt(n,"error")===0&&Z(n,mt)}function Tt(){n.removeListener("finish",Vt),Nt()}function Vt(){St("onfinish"),n.removeListener("close",Tt),Nt()}function Nt(){St("unpipe"),Ot.unpipe(n)}var Ot=this,xt=this._readableState;switch(xt.pipesCount){case 0:xt.pipes=n;break;case 1:xt.pipes=[xt.pipes,n];break;default:xt.pipes.push(n)}xt.pipesCount+=1,St("pipe count=%d opts=%j",xt.pipesCount,s);var se=(!s||s.end!==!1)&&n!==y.stdout&&n!==y.stderr,X=se?k:Nt;xt.endEmitted?y.nextTick(X):Ot.once("end",X),n.on("unpipe",c);var st=A(Ot);n.on("drain",st);var yt=!1;return Ot.on("data",K),a(n,"error",ht),n.once("close",Tt),n.once("finish",Vt),n.emit("pipe",Ot),xt.flowing||(St("pipe resume"),Ot.resume()),n},d.prototype.unpipe=function(n){var s=this._readableState,c={hasUnpiped:!1};if(s.pipesCount===0)return this;if(s.pipesCount===1)return n&&n!==s.pipes?this:(n||(n=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,n&&n.emit("unpipe",this,c),this);if(!n){var k=s.pipes,z=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var K=0;K<z;K++)k[K].emit("unpipe",this,{hasUnpiped:!1});return this}var ht=It(s.pipes,n);return ht===-1?this:(s.pipes.splice(ht,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),n.emit("unpipe",this,c),this)},d.prototype.on=function(n,s){var c=at.prototype.on.call(this,n,s),k=this._readableState;return n==="data"?(k.readableListening=0<this.listenerCount("readable"),k.flowing!==!1&&this.resume()):n=="readable"&&!k.endEmitted&&!k.readableListening&&(k.readableListening=k.needReadable=!0,k.flowing=!1,k.emittedReadable=!1,St("on readable",k.length,k.reading),k.length?_(this):!k.reading&&y.nextTick(x,this)),c},d.prototype.addListener=d.prototype.on,d.prototype.removeListener=function(n,s){var c=at.prototype.removeListener.call(this,n,s);return n==="readable"&&y.nextTick(Y,this),c},d.prototype.removeAllListeners=function(n){var s=at.prototype.removeAllListeners.apply(this,arguments);return(n==="readable"||n===void 0)&&y.nextTick(Y,this),s},d.prototype.resume=function(){var n=this._readableState;return n.flowing||(St("resume"),n.flowing=!n.readableListening,P(this,n)),n.paused=!1,this},d.prototype.pause=function(){return St("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(St("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},d.prototype.wrap=function(n){var s=this,c=this._readableState,k=!1;for(var z in n.on("end",function(){if(St("wrapped end"),c.decoder&&!c.ended){var ht=c.decoder.end();ht&&ht.length&&s.push(ht)}s.push(null)}),n.on("data",function(ht){if(St("wrapped data"),c.decoder&&(ht=c.decoder.write(ht)),!(c.objectMode&&ht==null)&&(c.objectMode||ht&&ht.length)){var Tt=s.push(ht);Tt||(k=!0,n.pause())}}),n)this[z]===void 0&&typeof n[z]=="function"&&(this[z]=function(ht){return function(){return n[ht].apply(n,arguments)}}(z));for(var K=0;K<gt.length;K++)n.on(gt[K],this.emit.bind(this,gt[K]));return this._read=function(ht){St("wrapped _read",ht),k&&(k=!1,n.resume())},this},typeof Symbol=="function"&&(d.prototype[Symbol.asyncIterator]=function(){return Ut===void 0&&(Ut=N("./internal/streams/async_iterator")),Ut(this)}),Object.defineProperty(d.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(d.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(d.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(n){this._readableState&&(this._readableState.flowing=n)}}),d._fromList=wt,Object.defineProperty(d.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(d.from=function(n,s){return Ft===void 0&&(Ft=N("./internal/streams/from")),Ft(d,n,s)})}).call(this)}).call(this,N("_process"),typeof $.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:$.g)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(N,D){"use strict";function y(S,B){var u=this._transformState;u.transforming=!1;var _=u.writecb;if(_===null)return this.emit("error",new d);u.writechunk=null,u.writecb=null,B!=null&&this.push(B),_(S);var m=this._readableState;m.reading=!1,(m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}function g(S){return this instanceof g?(R.call(this,S),this._transformState={afterTransform:y.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,S&&(typeof S.transform=="function"&&(this._transform=S.transform),typeof S.flush=="function"&&(this._flush=S.flush)),void this.on("prefinish",U)):new g(S)}function U(){var S=this;typeof this._flush!="function"||this._readableState.destroyed?M(this,null,null):this._flush(function(B,u){M(S,B,u)})}function M(S,B,u){if(B)return S.emit("error",B);if(u!=null&&S.push(u),S._writableState.length)throw new L;if(S._transformState.transforming)throw new h;return S.push(null)}D.exports=g;var a=N("../errors").codes,w=a.ERR_METHOD_NOT_IMPLEMENTED,d=a.ERR_MULTIPLE_CALLBACK,h=a.ERR_TRANSFORM_ALREADY_TRANSFORMING,L=a.ERR_TRANSFORM_WITH_LENGTH_0,R=N("./_stream_duplex");N("inherits")(g,R),g.prototype.push=function(S,B){return this._transformState.needTransform=!1,R.prototype.push.call(this,S,B)},g.prototype._transform=function(S,B,u){u(new w("_transform()"))},g.prototype._write=function(S,B,u){var _=this._transformState;if(_.writecb=u,_.writechunk=S,_.writeencoding=B,!_.transforming){var m=this._readableState;(_.needTransform||m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}},g.prototype._read=function(){var S=this._transformState;S.writechunk===null||S.transforming?S.needTransform=!0:(S.transforming=!0,this._transform(S.writechunk,S.writeencoding,S.afterTransform))},g.prototype._destroy=function(S,B){R.prototype._destroy.call(this,S,function(u){B(u)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(N,D){(function(y,g){(function(){"use strict";function U(V){var b=this;this.next=null,this.entry=null,this.finish=function(){Ct(b,V)}}function M(V){return St.from(V)}function a(V){return St.isBuffer(V)||V instanceof ee}function w(){}function d(V,b,T){Dt=Dt||N("./_stream_duplex"),V=V||{},typeof T!="boolean"&&(T=b instanceof Dt),this.objectMode=!!V.objectMode,T&&(this.objectMode=this.objectMode||!!V.writableObjectMode),this.highWaterMark=nt(this,V,"writableHighWaterMark",T),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Z=V.decodeStrings===!1;this.decodeStrings=!Z,this.defaultEncoding=V.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(gt){C(b,gt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=V.emitClose!==!1,this.autoDestroy=!!V.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new U(this)}function h(V){Dt=Dt||N("./_stream_duplex");var b=this instanceof Dt;return b||bt.call(h,this)?(this._writableState=new d(V,this,b),this.writable=!0,V&&(typeof V.write=="function"&&(this._write=V.write),typeof V.writev=="function"&&(this._writev=V.writev),typeof V.destroy=="function"&&(this._destroy=V.destroy),typeof V.final=="function"&&(this._final=V.final)),void Mt.call(this)):new h(V)}function L(V,b){var T=new re;tt(V,T),y.nextTick(b,T)}function R(V,b,T,Z){var gt;return T===null?gt=new Pt:typeof T!="string"&&!b.objectMode&&(gt=new _t("chunk",["string","Buffer"],T)),!gt||(tt(V,gt),y.nextTick(Z,gt),!1)}function S(V,b,T){return V.objectMode||V.decodeStrings===!1||typeof b!="string"||(b=St.from(b,T)),b}function B(V,b,T,Z,gt,n){if(!T){var s=S(b,Z,gt);Z!==s&&(T=!0,gt="buffer",Z=s)}var c=b.objectMode?1:Z.length;b.length+=c;var k=b.length<b.highWaterMark;if(k||(b.needDrain=!0),b.writing||b.corked){var z=b.lastBufferedRequest;b.lastBufferedRequest={chunk:Z,encoding:gt,isBuf:T,callback:n,next:null},z?z.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else u(V,b,!1,c,Z,gt,n);return k}function u(V,b,T,Z,gt,n,s){b.writelen=Z,b.writecb=s,b.writing=!0,b.sync=!0,b.destroyed?b.onwrite(new te("write")):T?V._writev(gt,b.onwrite):V._write(gt,n,b.onwrite),b.sync=!1}function _(V,b,T,Z,gt){--b.pendingcb,T?(y.nextTick(gt,Z),y.nextTick(ot,V,b),V._writableState.errorEmitted=!0,tt(V,Z)):(gt(Z),V._writableState.errorEmitted=!0,tt(V,Z),ot(V,b))}function m(V){V.writing=!1,V.writecb=null,V.length-=V.writelen,V.writelen=0}function C(V,b){var T=V._writableState,Z=T.sync,gt=T.writecb;if(typeof gt!="function")throw new Ut;if(m(T),b)_(V,T,Z,b,gt);else{var n=x(T)||V.destroyed;n||T.corked||T.bufferProcessing||!T.bufferedRequest||Y(V,T),Z?y.nextTick(v,V,T,n,gt):v(V,T,n,gt)}}function v(V,b,T,Z){T||A(V,b),b.pendingcb--,Z(),ot(V,b)}function A(V,b){b.length===0&&b.needDrain&&(b.needDrain=!1,V.emit("drain"))}function Y(V,b){b.bufferProcessing=!0;var T=b.bufferedRequest;if(V._writev&&T&&T.next){var Z=b.bufferedRequestCount,gt=Array(Z),n=b.corkedRequestsFree;n.entry=T;for(var s=0,c=!0;T;)gt[s]=T,T.isBuf||(c=!1),T=T.next,s+=1;gt.allBuffers=c,u(V,b,!0,b.length,gt,"",n.finish),b.pendingcb++,b.lastBufferedRequest=null,n.next?(b.corkedRequestsFree=n.next,n.next=null):b.corkedRequestsFree=new U(b),b.bufferedRequestCount=0}else{for(;T;){var k=T.chunk,z=T.encoding,K=T.callback,ht=b.objectMode?1:k.length;if(u(V,b,!1,ht,k,z,K),T=T.next,b.bufferedRequestCount--,b.writing)break}T===null&&(b.lastBufferedRequest=null)}b.bufferedRequest=T,b.bufferProcessing=!1}function x(V){return V.ending&&V.length===0&&V.bufferedRequest===null&&!V.finished&&!V.writing}function P(V,b){V._final(function(T){b.pendingcb--,T&&tt(V,T),b.prefinished=!0,V.emit("prefinish"),ot(V,b)})}function q(V,b){b.prefinished||b.finalCalled||(typeof V._final!="function"||b.destroyed?(b.prefinished=!0,V.emit("prefinish")):(b.pendingcb++,b.finalCalled=!0,y.nextTick(P,V,b)))}function ot(V,b){var T=x(b);if(T&&(q(V,b),b.pendingcb===0&&(b.finished=!0,V.emit("finish"),b.autoDestroy))){var Z=V._readableState;(!Z||Z.autoDestroy&&Z.endEmitted)&&V.destroy()}return T}function wt(V,b,T){b.ending=!0,ot(V,b),T&&(b.finished?y.nextTick(T):V.once("finish",T)),b.ended=!0,V.writable=!1}function Ct(V,b,T){var Z=V.entry;for(V.entry=null;Z;){var gt=Z.callback;b.pendingcb--,gt(T),Z=Z.next}b.corkedRequestsFree.next=V}D.exports=h;var Dt;h.WritableState=d;var It={deprecate:N("util-deprecate")},Mt=N("./internal/streams/stream"),St=N("buffer").Buffer,ee=g.Uint8Array||function(){},Xt=N("./internal/streams/destroy"),at=N("./internal/streams/state"),nt=at.getHighWaterMark,ut=N("../errors").codes,_t=ut.ERR_INVALID_ARG_TYPE,vt=ut.ERR_METHOD_NOT_IMPLEMENTED,Ut=ut.ERR_MULTIPLE_CALLBACK,Ft=ut.ERR_STREAM_CANNOT_PIPE,te=ut.ERR_STREAM_DESTROYED,Pt=ut.ERR_STREAM_NULL_VALUES,re=ut.ERR_STREAM_WRITE_AFTER_END,G=ut.ERR_UNKNOWN_ENCODING,tt=Xt.errorOrDestroy;N("inherits")(h,Mt),d.prototype.getBuffer=function(){for(var V=this.bufferedRequest,b=[];V;)b.push(V),V=V.next;return b},function(){try{Object.defineProperty(d.prototype,"buffer",{get:It.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(V){}}();var bt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(bt=Function.prototype[Symbol.hasInstance],Object.defineProperty(h,Symbol.hasInstance,{value:function(V){return!!bt.call(this,V)||this===h&&V&&V._writableState instanceof d}})):bt=function(V){return V instanceof this},h.prototype.pipe=function(){tt(this,new Ft)},h.prototype.write=function(V,b,T){var Z=this._writableState,gt=!1,n=!Z.objectMode&&a(V);return n&&!St.isBuffer(V)&&(V=M(V)),typeof b=="function"&&(T=b,b=null),n?b="buffer":!b&&(b=Z.defaultEncoding),typeof T!="function"&&(T=w),Z.ending?L(this,T):(n||R(this,Z,V,T))&&(Z.pendingcb++,gt=B(this,Z,n,V,b,T)),gt},h.prototype.cork=function(){this._writableState.corked++},h.prototype.uncork=function(){var V=this._writableState;V.corked&&(V.corked--,!V.writing&&!V.corked&&!V.bufferProcessing&&V.bufferedRequest&&Y(this,V))},h.prototype.setDefaultEncoding=function(V){if(typeof V=="string"&&(V=V.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((V+"").toLowerCase())))throw new G(V);return this._writableState.defaultEncoding=V,this},Object.defineProperty(h.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),h.prototype._write=function(V,b,T){T(new vt("_write()"))},h.prototype._writev=null,h.prototype.end=function(V,b,T){var Z=this._writableState;return typeof V=="function"?(T=V,V=null,b=null):typeof b=="function"&&(T=b,b=null),V!=null&&this.write(V,b),Z.corked&&(Z.corked=1,this.uncork()),Z.ending||wt(this,Z,T),this},Object.defineProperty(h.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(h.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(V){this._writableState&&(this._writableState.destroyed=V)}}),h.prototype.destroy=Xt.destroy,h.prototype._undestroy=Xt.undestroy,h.prototype._destroy=function(V,b){b(V)}}).call(this)}).call(this,N("_process"),typeof $.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:$.g)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(N,D){(function(y){(function(){"use strict";function g(A,Y,x){return Y in A?Object.defineProperty(A,Y,{value:x,enumerable:!0,configurable:!0,writable:!0}):A[Y]=x,A}function U(A,Y){return{value:A,done:Y}}function M(A){var Y=A[L];if(Y!==null){var x=A[m].read();x!==null&&(A[u]=null,A[L]=null,A[R]=null,Y(U(x,!1)))}}function a(A){y.nextTick(M,A)}function w(A,Y){return function(x,P){A.then(function(){return Y[B]?void x(U(void 0,!0)):void Y[_](x,P)},P)}}var d,h=N("./end-of-stream"),L=Symbol("lastResolve"),R=Symbol("lastReject"),S=Symbol("error"),B=Symbol("ended"),u=Symbol("lastPromise"),_=Symbol("handlePromise"),m=Symbol("stream"),C=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((d={get stream(){return this[m]},next:function(){var A=this,Y=this[S];if(Y!==null)return Promise.reject(Y);if(this[B])return Promise.resolve(U(void 0,!0));if(this[m].destroyed)return new Promise(function(ot,wt){y.nextTick(function(){A[S]?wt(A[S]):ot(U(void 0,!0))})});var x,P=this[u];if(P)x=new Promise(w(P,this));else{var q=this[m].read();if(q!==null)return Promise.resolve(U(q,!1));x=new Promise(this[_])}return this[u]=x,x}},g(d,Symbol.asyncIterator,function(){return this}),g(d,"return",function(){var A=this;return new Promise(function(Y,x){A[m].destroy(null,function(P){return P?void x(P):void Y(U(void 0,!0))})})}),d),C);D.exports=function(A){var Y,x=Object.create(v,(Y={},g(Y,m,{value:A,writable:!0}),g(Y,L,{value:null,writable:!0}),g(Y,R,{value:null,writable:!0}),g(Y,S,{value:null,writable:!0}),g(Y,B,{value:A._readableState.endEmitted,writable:!0}),g(Y,_,{value:function(P,q){var ot=x[m].read();ot?(x[u]=null,x[L]=null,x[R]=null,P(U(ot,!1))):(x[L]=P,x[R]=q)},writable:!0}),Y));return x[u]=null,h(A,function(P){if(P&&P.code!=="ERR_STREAM_PREMATURE_CLOSE"){var q=x[R];return q!==null&&(x[u]=null,x[L]=null,x[R]=null,q(P)),void(x[S]=P)}var ot=x[L];ot!==null&&(x[u]=null,x[L]=null,x[R]=null,ot(U(void 0,!0))),x[B]=!0}),A.on("readable",a.bind(null,x)),x}}).call(this)}).call(this,N("_process"))},{"./end-of-stream":24,_process:12}],22:[function(N,D){"use strict";function y(u,_){var m=Object.keys(u);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(u);_&&(C=C.filter(function(v){return Object.getOwnPropertyDescriptor(u,v).enumerable})),m.push.apply(m,C)}return m}function g(u){for(var _,m=1;m<arguments.length;m++)_=arguments[m]==null?{}:arguments[m],m%2?y(Object(_),!0).forEach(function(C){U(u,C,_[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(_)):y(Object(_)).forEach(function(C){Object.defineProperty(u,C,Object.getOwnPropertyDescriptor(_,C))});return u}function U(u,_,m){return _ in u?Object.defineProperty(u,_,{value:m,enumerable:!0,configurable:!0,writable:!0}):u[_]=m,u}function M(u,_){if(!(u instanceof _))throw new TypeError("Cannot call a class as a function")}function a(u,_){for(var m,C=0;C<_.length;C++)m=_[C],m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}function w(u,_,m){return _&&a(u.prototype,_),m&&a(u,m),u}function d(u,_,m){L.prototype.copy.call(u,_,m)}var h=N("buffer"),L=h.Buffer,R=N("util"),S=R.inspect,B=S&&S.custom||"inspect";D.exports=function(){function u(){M(this,u),this.head=null,this.tail=null,this.length=0}return w(u,[{key:"push",value:function(_){var m={data:_,next:null};0<this.length?this.tail.next=m:this.head=m,this.tail=m,++this.length}},{key:"unshift",value:function(_){var m={data:_,next:this.head};this.length===0&&(this.tail=m),this.head=m,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var m=this.head,C=""+m.data;m=m.next;)C+=_+m.data;return C}},{key:"concat",value:function(_){if(this.length===0)return L.alloc(0);for(var m=L.allocUnsafe(_>>>0),C=this.head,v=0;C;)d(C.data,m,v),v+=C.data.length,C=C.next;return m}},{key:"consume",value:function(_,m){var C;return _<this.head.data.length?(C=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?C=this.shift():C=m?this._getString(_):this._getBuffer(_),C}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var m=this.head,C=1,v=m.data;for(_-=v.length;m=m.next;){var A=m.data,Y=_>A.length?A.length:_;if(v+=Y===A.length?A:A.slice(0,_),_-=Y,_===0){Y===A.length?(++C,this.head=m.next?m.next:this.tail=null):(this.head=m,m.data=A.slice(Y));break}++C}return this.length-=C,v}},{key:"_getBuffer",value:function(_){var m=L.allocUnsafe(_),C=this.head,v=1;for(C.data.copy(m),_-=C.data.length;C=C.next;){var A=C.data,Y=_>A.length?A.length:_;if(A.copy(m,m.length-_,0,Y),_-=Y,_===0){Y===A.length?(++v,this.head=C.next?C.next:this.tail=null):(this.head=C,C.data=A.slice(Y));break}++v}return this.length-=v,m}},{key:B,value:function(_,m){return S(this,g({},m,{depth:0,customInspect:!1}))}}]),u}()},{buffer:3,util:2}],23:[function(N,D){(function(y){(function(){"use strict";function g(a,w){M(a,w),U(a)}function U(a){a._writableState&&!a._writableState.emitClose||a._readableState&&!a._readableState.emitClose||a.emit("close")}function M(a,w){a.emit("error",w)}D.exports={destroy:function(a,w){var d=this,h=this._readableState&&this._readableState.destroyed,L=this._writableState&&this._writableState.destroyed;return h||L?(w?w(a):a&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,y.nextTick(M,this,a)):y.nextTick(M,this,a)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(a||null,function(R){!w&&R?d._writableState?d._writableState.errorEmitted?y.nextTick(U,d):(d._writableState.errorEmitted=!0,y.nextTick(g,d,R)):y.nextTick(g,d,R):w?(y.nextTick(U,d),w(R)):y.nextTick(U,d)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(a,w){var d=a._readableState,h=a._writableState;d&&d.autoDestroy||h&&h.autoDestroy?a.destroy(w):a.emit("error",w)}}}).call(this)}).call(this,N("_process"))},{_process:12}],24:[function(N,D){"use strict";function y(w){var d=!1;return function(){if(!d){d=!0;for(var h=arguments.length,L=Array(h),R=0;R<h;R++)L[R]=arguments[R];w.apply(this,L)}}}function g(){}function U(w){return w.setHeader&&typeof w.abort=="function"}function M(w,d,h){if(typeof d=="function")return M(w,null,d);d||(d={}),h=y(h||g);var L=d.readable||d.readable!==!1&&w.readable,R=d.writable||d.writable!==!1&&w.writable,S=function(){w.writable||u()},B=w._writableState&&w._writableState.finished,u=function(){R=!1,B=!0,L||h.call(w)},_=w._readableState&&w._readableState.endEmitted,m=function(){L=!1,_=!0,R||h.call(w)},C=function(Y){h.call(w,Y)},v=function(){var Y;return L&&!_?(w._readableState&&w._readableState.ended||(Y=new a),h.call(w,Y)):R&&!B?(w._writableState&&w._writableState.ended||(Y=new a),h.call(w,Y)):void 0},A=function(){w.req.on("finish",u)};return U(w)?(w.on("complete",u),w.on("abort",v),w.req?A():w.on("request",A)):R&&!w._writableState&&(w.on("end",S),w.on("close",S)),w.on("end",m),w.on("finish",u),d.error!==!1&&w.on("error",C),w.on("close",v),function(){w.removeListener("complete",u),w.removeListener("abort",v),w.removeListener("request",A),w.req&&w.req.removeListener("finish",u),w.removeListener("end",S),w.removeListener("close",S),w.removeListener("finish",u),w.removeListener("end",m),w.removeListener("error",C),w.removeListener("close",v)}}var a=N("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;D.exports=M},{"../../../errors":15}],25:[function(N,D){D.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(N,D){"use strict";function y(B){var u=!1;return function(){u||(u=!0,B.apply(void 0,arguments))}}function g(B){if(B)throw B}function U(B){return B.setHeader&&typeof B.abort=="function"}function M(B,u,_,m){m=y(m);var C=!1;B.on("close",function(){C=!0}),h===void 0&&(h=N("./end-of-stream")),h(B,{readable:u,writable:_},function(A){return A?m(A):(C=!0,void m())});var v=!1;return function(A){if(!C)return v?void 0:(v=!0,U(B)?B.abort():typeof B.destroy=="function"?B.destroy():void m(A||new S("pipe")))}}function a(B){B()}function w(B,u){return B.pipe(u)}function d(B){return B.length&&typeof B[B.length-1]=="function"?B.pop():g}var h,L=N("../../../errors").codes,R=L.ERR_MISSING_ARGS,S=L.ERR_STREAM_DESTROYED;D.exports=function(){for(var B=arguments.length,u=Array(B),_=0;_<B;_++)u[_]=arguments[_];var m=d(u);if(Array.isArray(u[0])&&(u=u[0]),2>u.length)throw new R("streams");var C,v=u.map(function(A,Y){var x=Y<u.length-1;return M(A,x,0<Y,function(P){C||(C=P),P&&v.forEach(a),x||(v.forEach(a),m(C))})});return u.reduce(w)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(N,D){"use strict";function y(U,M,a){return U.highWaterMark==null?M?U[a]:null:U.highWaterMark}var g=N("../../../errors").codes.ERR_INVALID_OPT_VALUE;D.exports={getHighWaterMark:function(U,M,a,w){var d=y(M,w,a);if(d!=null){if(!(isFinite(d)&&ct(d)===d)||0>d){var h=w?a:"highWaterMark";throw new g(h,d)}return ct(d)}return U.objectMode?16:16384}}},{"../../../errors":15}],28:[function(N,D){D.exports=N("events").EventEmitter},{events:7}],29:[function(N,D,y){y=D.exports=N("./lib/_stream_readable.js"),y.Stream=y,y.Readable=y,y.Writable=N("./lib/_stream_writable.js"),y.Duplex=N("./lib/_stream_duplex.js"),y.Transform=N("./lib/_stream_transform.js"),y.PassThrough=N("./lib/_stream_passthrough.js"),y.finished=N("./lib/internal/streams/end-of-stream.js"),y.pipeline=N("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(N,D,y){function g(w,d){for(var h in w)d[h]=w[h]}function U(w,d,h){return a(w,d,h)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var M=N("buffer"),a=M.Buffer;a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?D.exports=M:(g(M,y),y.Buffer=U),U.prototype=Object.create(a.prototype),g(a,U),U.from=function(w,d,h){if(typeof w=="number")throw new TypeError("Argument must not be a number");return a(w,d,h)},U.alloc=function(w,d,h){if(typeof w!="number")throw new TypeError("Argument must be a number");var L=a(w);return d===void 0?L.fill(0):typeof h=="string"?L.fill(d,h):L.fill(d),L},U.allocUnsafe=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return a(w)},U.allocUnsafeSlow=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return M.SlowBuffer(w)}},{buffer:3}],31:[function(N,D,y){"use strict";function g(v){if(!v)return"utf8";for(var A;;)switch(v){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return v;default:if(A)return;v=(""+v).toLowerCase(),A=!0}}function U(v){var A=g(v);if(typeof A!="string"&&(m.isEncoding===C||!C(v)))throw new Error("Unknown encoding: "+v);return A||v}function M(v){this.encoding=U(v);var A;switch(this.encoding){case"utf16le":this.text=L,this.end=R,A=4;break;case"utf8":this.fillLast=h,A=4;break;case"base64":this.text=S,this.end=B,A=3;break;default:return this.write=u,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=m.allocUnsafe(A)}function a(v){return 127>=v?0:v>>5==6?2:v>>4==14?3:v>>3==30?4:v>>6==2?-1:-2}function w(v,A,Y){var x=A.length-1;if(x<Y)return 0;var P=a(A[x]);return 0<=P?(0<P&&(v.lastNeed=P-1),P):--x<Y||P===-2?0:(P=a(A[x]),0<=P?(0<P&&(v.lastNeed=P-2),P):--x<Y||P===-2?0:(P=a(A[x]),0<=P?(0<P&&(P===2?P=0:v.lastNeed=P-3),P):0))}function d(v,A){if((192&A[0])!=128)return v.lastNeed=0,"\uFFFD";if(1<v.lastNeed&&1<A.length){if((192&A[1])!=128)return v.lastNeed=1,"\uFFFD";if(2<v.lastNeed&&2<A.length&&(192&A[2])!=128)return v.lastNeed=2,"\uFFFD"}}function h(v){var A=this.lastTotal-this.lastNeed,Y=d(this,v,A);return Y===void 0?this.lastNeed<=v.length?(v.copy(this.lastChar,A,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(v.copy(this.lastChar,A,0,v.length),void(this.lastNeed-=v.length)):Y}function L(v,A){if((v.length-A)%2==0){var Y=v.toString("utf16le",A);if(Y){var x=Y.charCodeAt(Y.length-1);if(55296<=x&&56319>=x)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=v[v.length-2],this.lastChar[1]=v[v.length-1],Y.slice(0,-1)}return Y}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=v[v.length-1],v.toString("utf16le",A,v.length-1)}function R(v){var A=v&&v.length?this.write(v):"";if(this.lastNeed){var Y=this.lastTotal-this.lastNeed;return A+this.lastChar.toString("utf16le",0,Y)}return A}function S(v,A){var Y=(v.length-A)%3;return Y==0?v.toString("base64",A):(this.lastNeed=3-Y,this.lastTotal=3,Y==1?this.lastChar[0]=v[v.length-1]:(this.lastChar[0]=v[v.length-2],this.lastChar[1]=v[v.length-1]),v.toString("base64",A,v.length-Y))}function B(v){var A=v&&v.length?this.write(v):"";return this.lastNeed?A+this.lastChar.toString("base64",0,3-this.lastNeed):A}function u(v){return v.toString(this.encoding)}function _(v){return v&&v.length?this.write(v):""}var m=N("safe-buffer").Buffer,C=m.isEncoding||function(v){switch(v=""+v,v&&v.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};y.StringDecoder=M,M.prototype.write=function(v){if(v.length===0)return"";var A,Y;if(this.lastNeed){if(A=this.fillLast(v),A===void 0)return"";Y=this.lastNeed,this.lastNeed=0}else Y=0;return Y<v.length?A?A+this.text(v,Y):this.text(v,Y):A||""},M.prototype.end=function(v){var A=v&&v.length?this.write(v):"";return this.lastNeed?A+"\uFFFD":A},M.prototype.text=function(v,A){var Y=w(this,v,A);if(!this.lastNeed)return v.toString("utf8",A);this.lastTotal=Y;var x=v.length-(Y-this.lastNeed);return v.copy(this.lastChar,0,x),v.toString("utf8",A,x)},M.prototype.fillLast=function(v){return this.lastNeed<=v.length?(v.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(v.copy(this.lastChar,this.lastTotal-this.lastNeed,0,v.length),void(this.lastNeed-=v.length))}},{"safe-buffer":30}],32:[function(N,D){(function(y){(function(){function g(U){try{if(!y.localStorage)return!1}catch(a){return!1}var M=y.localStorage[U];return M!=null&&(M+"").toLowerCase()==="true"}D.exports=function(U,M){function a(){if(!w){if(g("throwDeprecation"))throw new Error(M);g("traceDeprecation")?console.trace(M):console.warn(M),w=!0}return U.apply(this,arguments)}if(g("noDeprecation"))return U;var w=!1;return a}}).call(this)}).call(this,typeof $.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:$.g)},{}],"/":[function(N,D){function y(B){return B.replace(/a=ice-options:trickle\s\n/g,"")}function g(B){console.warn(B)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const U=N("debug")("simple-peer"),M=N("get-browser-rtc"),a=N("randombytes"),w=N("readable-stream"),d=N("queue-microtask"),h=N("err-code"),{Buffer:L}=N("buffer"),R=65536;class S extends w.Duplex{constructor(u){if(u=Object.assign({allowHalfOpen:!1},u),super(u),this._id=a(4).toString("hex").slice(0,7),this._debug("new peer %o",u),this.channelName=u.initiator?u.channelName||a(20).toString("hex"):null,this.initiator=u.initiator||!1,this.channelConfig=u.channelConfig||S.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},S.config,u.config),this.offerOptions=u.offerOptions||{},this.answerOptions=u.answerOptions||{},this.sdpTransform=u.sdpTransform||(_=>_),this.streams=u.streams||(u.stream?[u.stream]:[]),this.trickle=u.trickle===void 0||u.trickle,this.allowHalfTrickle=u.allowHalfTrickle!==void 0&&u.allowHalfTrickle,this.iceCompleteTimeout=u.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=u.wrtc&&typeof u.wrtc=="object"?u.wrtc:M(),!this._wrtc)throw h(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(h(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(h(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(u){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof u=="string")try{u=JSON.parse(u)}catch(_){u={}}this._debug("signal()"),u.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),u.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(u.transceiverRequest.kind,u.transceiverRequest.init)),u.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(u.candidate):this._pendingCandidates.push(u.candidate)),u.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(u)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(h(_,"ERR_SET_REMOTE_DESCRIPTION"))}),u.sdp||u.candidate||u.renegotiate||u.transceiverRequest||this.destroy(h(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(u){const _=new this._wrtc.RTCIceCandidate(u);this._pc.addIceCandidate(_).catch(m=>{!_.address||_.address.endsWith(".local")?g("Ignoring unsupported ICE candidate."):this.destroy(h(m,"ERR_ADD_ICE_CANDIDATE"))})}send(u){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(u)}}addTransceiver(u,_){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(u,_),this._needsNegotiation()}catch(m){this.destroy(h(m,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:u,init:_}})}}addStream(u){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),u.getTracks().forEach(_=>{this.addTrack(_,u)})}}addTrack(u,_){if(this.destroying)return;if(this.destroyed)throw h(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const m=this._senderMap.get(u)||new Map;let C=m.get(_);if(!C)C=this._pc.addTrack(u,_),m.set(_,C),this._senderMap.set(u,m),this._needsNegotiation();else throw C.removed?h(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):h(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(u,_,m){if(this.destroying)return;if(this.destroyed)throw h(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const C=this._senderMap.get(u),v=C?C.get(m):null;if(!v)throw h(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,C),v.replaceTrack==null?this.destroy(h(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):v.replaceTrack(_)}removeTrack(u,_){if(this.destroying)return;if(this.destroyed)throw h(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const m=this._senderMap.get(u),C=m?m.get(_):null;if(!C)throw h(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{C.removed=!0,this._pc.removeTrack(C)}catch(v){v.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(C):this.destroy(h(v,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(u){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),u.getTracks().forEach(_=>{this.removeTrack(_,u)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,d(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw h(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(u){this._destroy(u,()=>{})}_destroy(u,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",u&&(u.message||u)),d(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",u&&(u.message||u)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(m){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(m){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,u&&this.emit("error",u),this.emit("close"),_()}))}_setupData(u){if(!u.channel)return this.destroy(h(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=u.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=R),this.channelName=this._channel.label,this._channel.onmessage=m=>{this._onChannelMessage(m)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=m=>{const C=m.error instanceof Error?m.error:new Error(`Datachannel error: ${m.message} ${m.filename}:${m.lineno}:${m.colno}`);this.destroy(h(C,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(u,_,m){if(this.destroyed)return m(h(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(u)}catch(C){return this.destroy(h(C,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>R?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=m):m(null)}else this._debug("write before connect"),this._chunk=u,this._cb=m}_onFinish(){if(!this.destroyed){const u=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?u():this.once("connect",u)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(u=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(u.sdp=y(u.sdp)),u.sdp=this.sdpTransform(u.sdp);const _=()=>{if(!this.destroyed){const m=this._pc.localDescription||u;this._debug("signal"),this.emit("signal",{type:m.type,sdp:m.sdp})}};this._pc.setLocalDescription(u).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(m=>{this.destroy(h(m,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(u=>{this.destroy(h(u,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(u=>{u.mid||!u.sender.track||u.requested||(u.requested=!0,this.addTransceiver(u.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(u=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(u.sdp=y(u.sdp)),u.sdp=this.sdpTransform(u.sdp);const _=()=>{if(!this.destroyed){const m=this._pc.localDescription||u;this._debug("signal"),this.emit("signal",{type:m.type,sdp:m.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(u).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(m=>{this.destroy(h(m,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(u=>{this.destroy(h(u,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(h(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const u=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",u,_),this.emit("iceStateChange",u,_),(u==="connected"||u==="completed")&&(this._pcReady=!0,this._maybeReady()),u==="failed"&&this.destroy(h(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),u==="closed"&&this.destroy(h(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(u){const _=m=>(Object.prototype.toString.call(m.values)==="[object Array]"&&m.values.forEach(C=>{Object.assign(m,C)}),m);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(m=>{const C=[];m.forEach(v=>{C.push(_(v))}),u(null,C)},m=>u(m)):0<this._pc.getStats.length?this._pc.getStats(m=>{if(this.destroyed)return;const C=[];m.result().forEach(v=>{const A={};v.names().forEach(Y=>{A[Y]=v.stat(Y)}),A.id=v.id,A.type=v.type,A.timestamp=v.timestamp,C.push(_(A))}),u(null,C)},m=>u(m)):u(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const u=()=>{this.destroyed||this.getStats((_,m)=>{if(this.destroyed)return;_&&(m=[]);const C={},v={},A={};let Y=!1;m.forEach(P=>{(P.type==="remotecandidate"||P.type==="remote-candidate")&&(C[P.id]=P),(P.type==="localcandidate"||P.type==="local-candidate")&&(v[P.id]=P),(P.type==="candidatepair"||P.type==="candidate-pair")&&(A[P.id]=P)});const x=P=>{Y=!0;let q=v[P.localCandidateId];q&&(q.ip||q.address)?(this.localAddress=q.ip||q.address,this.localPort=+q.port):q&&q.ipAddress?(this.localAddress=q.ipAddress,this.localPort=+q.portNumber):typeof P.googLocalAddress=="string"&&(q=P.googLocalAddress.split(":"),this.localAddress=q[0],this.localPort=+q[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let ot=C[P.remoteCandidateId];ot&&(ot.ip||ot.address)?(this.remoteAddress=ot.ip||ot.address,this.remotePort=+ot.port):ot&&ot.ipAddress?(this.remoteAddress=ot.ipAddress,this.remotePort=+ot.portNumber):typeof P.googRemoteAddress=="string"&&(ot=P.googRemoteAddress.split(":"),this.remoteAddress=ot[0],this.remotePort=+ot[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(m.forEach(P=>{P.type==="transport"&&P.selectedCandidatePairId&&x(A[P.selectedCandidatePairId]),(P.type==="googCandidatePair"&&P.googActiveConnection==="true"||(P.type==="candidatepair"||P.type==="candidate-pair")&&P.selected)&&x(P)}),!Y&&(!Object.keys(A).length||Object.keys(v).length))return void setTimeout(u,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(q){return this.destroy(h(q,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const P=this._cb;this._cb=null,P(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};u()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>R)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(u=>{this._pc.removeTrack(u),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(u){this.destroyed||(u.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:u.candidate.candidate,sdpMLineIndex:u.candidate.sdpMLineIndex,sdpMid:u.candidate.sdpMid}}):!u.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),u.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(u){if(this.destroyed)return;let _=u.data;_ instanceof ArrayBuffer&&(_=L.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const u=this._cb;this._cb=null,u(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(u){this.destroyed||u.streams.forEach(_=>{this._debug("on track"),this.emit("track",u.track,_),this._remoteTracks.push({track:u.track,stream:_}),this._remoteStreams.some(m=>m.id===_.id)||(this._remoteStreams.push(_),d(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const u=[].slice.call(arguments);u[0]="["+this._id+"] "+u[0],U.apply(null,u)}}S.WEBRTC_SUPPORT=!!M(),S.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},S.channelConfig={},D.exports=S},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})},"../../../node_modules/.pnpm/yjs@13.6.8/node_modules/yjs/dist/yjs.mjs":(Ht,kt,$)=>{"use strict";$.d(kt,{QW:()=>at,NG:()=>gt,D$:()=>c,gJ:()=>Vt,ay:()=>Yt});var ct=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/observable.js"),pt=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/array.js"),it=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/math.js"),N=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/map.js"),D=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/encoding.js"),y=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/decoding.js"),g=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/random.js"),U=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/promise.js"),M=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/buffer.js"),a=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/error.js"),w=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/binary.js"),d=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/function.js"),h=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/set.js"),L=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.js"),R=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/logging.common.js");const S=(i,t)=>({[Symbol.iterator](){return this},next(){const e=i.next();return{value:e.done?void 0:t(e.value),done:e.done}}}),B=i=>({[Symbol.iterator](){return this},next:i}),u=(i,t)=>B(()=>{let e;do e=i.next();while(!e.done&&!t(e.value));return e}),_=(i,t)=>B(()=>{const{done:e,value:r}=i.next();return{done:e,value:e?void 0:t(r)}});var m=$("../../../node_modules/.pnpm/lib0@0.2.87/node_modules/lib0/object.js");class C extends null{constructor(t,e){super(),this.doc=t,this.awareness=e}}class v{constructor(t,e){this.clock=t,this.len=e}}class A{constructor(){this.clients=new Map}}const Y=(i,t,e)=>t.clients.forEach((r,o)=>{const l=i.doc.store.clients.get(o);for(let p=0;p<r.length;p++){const E=r[p];_n(i,l,E.clock,E.len,e)}}),x=(i,t)=>{let e=0,r=i.length-1;for(;e<=r;){const o=it.GW((e+r)/2),l=i[o],p=l.clock;if(p<=t){if(t<p+l.len)return o;e=o+1}else r=o-1}return null},P=(i,t)=>{const e=i.clients.get(t.client);return e!==void 0&&x(e,t.clock)!==null},q=i=>{i.clients.forEach(t=>{t.sort((o,l)=>o.clock-l.clock);let e,r;for(e=1,r=1;e<t.length;e++){const o=t[r-1],l=t[e];o.clock+o.len>=l.clock?o.len=it.Fp(o.len,l.clock+l.len-o.clock):(r<e&&(t[r]=l),r++)}t.length=r})},ot=i=>{const t=new A;for(let e=0;e<i.length;e++)i[e].clients.forEach((r,o)=>{if(!t.clients.has(o)){const l=r.slice();for(let p=e+1;p<i.length;p++)pt.s7(l,i[p].clients.get(o)||[]);t.clients.set(o,l)}});return q(t),t},wt=(i,t,e,r)=>{N.Yu(i.clients,t,()=>[]).push(new v(e,r))},Ct=()=>new A,Dt=i=>{const t=Ct();return i.clients.forEach((e,r)=>{const o=[];for(let l=0;l<e.length;l++){const p=e[l];if(p.deleted){const E=p.id.clock;let I=p.length;if(l+1<e.length)for(let F=e[l+1];l+1<e.length&&F.deleted;F=e[++l+1])I+=F.length;o.push(new v(E,I))}}o.length>0&&t.clients.set(r,o)}),t},It=(i,t)=>{D.uE(i.restEncoder,t.clients.size),pt.Dp(t.clients.entries()).sort((e,r)=>r[0]-e[0]).forEach(([e,r])=>{i.resetDsCurVal(),D.uE(i.restEncoder,e);const o=r.length;D.uE(i.restEncoder,o);for(let l=0;l<o;l++){const p=r[l];i.writeDsClock(p.clock),i.writeDsLen(p.len)}})},Mt=i=>{const t=new A,e=y.yg(i.restDecoder);for(let r=0;r<e;r++){i.resetDsCurVal();const o=y.yg(i.restDecoder),l=y.yg(i.restDecoder);if(l>0){const p=N.Yu(t.clients,o,()=>[]);for(let E=0;E<l;E++)p.push(new v(i.readDsClock(),i.readDsLen()))}}return t},St=(i,t,e)=>{const r=new A,o=y.yg(i.restDecoder);for(let l=0;l<o;l++){i.resetDsCurVal();const p=y.yg(i.restDecoder),E=y.yg(i.restDecoder),I=e.clients.get(p)||[],F=$t(e,p);for(let j=0;j<E;j++){const W=i.readDsClock(),Q=W+i.readDsLen();if(W<F){F<Q&&wt(r,p,F,Q-F);let et=ue(I,W),ft=I[et];for(!ft.deleted&&ft.id.clock<W&&(I.splice(et+1,0,Ze(t,ft,W-ft.id.clock)),et++);et<I.length&&(ft=I[et++],ft.id.clock<Q);)ft.deleted||(Q<ft.id.clock+ft.length&&I.splice(et,0,Ze(t,ft,Q-ft.id.clock)),ft.delete(t))}else wt(r,p,W,Q-W)}}if(r.clients.size>0){const l=new Pt;return D.uE(l.restEncoder,0),It(l,r),l.toUint8Array()}return null},ee=(i,t)=>{if(i.clients.size!==t.clients.size)return!1;for(const[e,r]of i.clients.entries()){const o=t.clients.get(e);if(o===void 0||r.length!==o.length)return!1;for(let l=0;l<r.length;l++){const p=r[l],E=o[l];if(p.clock!==E.clock||p.len!==E.len)return!1}}return!0},Xt=g.U7;class at extends ct.y{constructor({guid:t=g.k$(),collectionid:e=null,gc:r=!0,gcFilter:o=()=>!0,meta:l=null,autoLoad:p=!1,shouldLoad:E=!0}={}){super(),this.gc=r,this.gcFilter=o,this.clientID=Xt(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new yn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=E,this.autoLoad=p,this.meta=l,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=U.Ue(F=>{this.on("load",()=>{this.isLoaded=!0,F(this)})});const I=()=>U.Ue(F=>{const j=W=>{(W===void 0||W===!0)&&(this.off("sync",j),F())};this.on("sync",j)});this.on("sync",F=>{F===!1&&this.isSynced&&(this.whenSynced=I()),this.isSynced=F===void 0||F===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=I()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Yt(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(pt.Dp(this.subdocs).map(t=>t.guid))}transact(t,e=null){return Yt(this,t,e)}get(t,e=ne){const r=N.Yu(this.share,t,()=>{const l=new e;return l._integrate(this,null),l}),o=r.constructor;if(e!==ne&&o!==e)if(o===ne){const l=new e;l._map=r._map,r._map.forEach(p=>{for(;p!==null;p=p.left)p.parent=l}),l._start=r._start;for(let p=l._start;p!==null;p=p.right)p.parent=l;return l._length=r._length,this.share.set(t,l),l._integrate(this,null),l}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,ye)}getText(t=""){return this.get(t,Te)}getMap(t=""){return this.get(t,ve)}getXmlFragment(t=""){return this.get(t,Ee)}toJSON(){const t={};return this.share.forEach((e,r)=>{t[r]=e.toJSON()}),t}destroy(){pt.Dp(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new at({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Yt(t.parent.doc,r=>{const o=e.doc;t.deleted||r.subdocsAdded.add(o),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class nt{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return y.yg(this.restDecoder)}readDsLen(){return y.yg(this.restDecoder)}}class ut extends nt{readLeftID(){return mt(y.yg(this.restDecoder),y.yg(this.restDecoder))}readRightID(){return mt(y.yg(this.restDecoder),y.yg(this.restDecoder))}readClient(){return y.yg(this.restDecoder)}readInfo(){return y.kj(this.restDecoder)}readString(){return y.kf(this.restDecoder)}readParentInfo(){return y.yg(this.restDecoder)===1}readTypeRef(){return y.yg(this.restDecoder)}readLen(){return y.yg(this.restDecoder)}readAny(){return y.v_(this.restDecoder)}readBuf(){return M.f9(y.HN(this.restDecoder))}readJSON(){return JSON.parse(y.kf(this.restDecoder))}readKey(){return y.kf(this.restDecoder)}}class _t{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=y.yg(this.restDecoder),this.dsCurrVal}readDsLen(){const t=y.yg(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class vt extends _t{constructor(t){super(t),this.keys=[],y.yg(t),this.keyClockDecoder=new y.dD(y.HN(t)),this.clientDecoder=new y.UF(y.HN(t)),this.leftClockDecoder=new y.dD(y.HN(t)),this.rightClockDecoder=new y.dD(y.HN(t)),this.infoDecoder=new y.XW(y.HN(t),y.kj),this.stringDecoder=new y.sO(y.HN(t)),this.parentInfoDecoder=new y.XW(y.HN(t),y.kj),this.typeRefDecoder=new y.UF(y.HN(t)),this.lenDecoder=new y.UF(y.HN(t))}readLeftID(){return new st(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new st(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return y.v_(this.restDecoder)}readBuf(){return y.HN(this.restDecoder)}readJSON(){return y.v_(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Ut{constructor(){this.restEncoder=D.Mf()}toUint8Array(){return D._f(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){D.uE(this.restEncoder,t)}writeDsLen(t){D.uE(this.restEncoder,t)}}class Ft extends Ut{writeLeftID(t){D.uE(this.restEncoder,t.client),D.uE(this.restEncoder,t.clock)}writeRightID(t){D.uE(this.restEncoder,t.client),D.uE(this.restEncoder,t.clock)}writeClient(t){D.uE(this.restEncoder,t)}writeInfo(t){D.$F(this.restEncoder,t)}writeString(t){D.uw(this.restEncoder,t)}writeParentInfo(t){D.uE(this.restEncoder,t?1:0)}writeTypeRef(t){D.uE(this.restEncoder,t)}writeLen(t){D.uE(this.restEncoder,t)}writeAny(t){D.EM(this.restEncoder,t)}writeBuf(t){D.mP(this.restEncoder,t)}writeJSON(t){D.uw(this.restEncoder,JSON.stringify(t))}writeKey(t){D.uw(this.restEncoder,t)}}class te{constructor(){this.restEncoder=D.Mf(),this.dsCurrVal=0}toUint8Array(){return D._f(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,D.uE(this.restEncoder,e)}writeDsLen(t){t===0&&a.zR(),D.uE(this.restEncoder,t-1),this.dsCurrVal+=t}}class Pt extends te{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new D.sX,this.clientEncoder=new D.HE,this.leftClockEncoder=new D.sX,this.rightClockEncoder=new D.sX,this.infoEncoder=new D.GF(D.$F),this.stringEncoder=new D.TS,this.parentInfoEncoder=new D.GF(D.$F),this.typeRefEncoder=new D.HE,this.lenEncoder=new D.HE}toUint8Array(){const t=D.Mf();return D.uE(t,0),D.mP(t,this.keyClockEncoder.toUint8Array()),D.mP(t,this.clientEncoder.toUint8Array()),D.mP(t,this.leftClockEncoder.toUint8Array()),D.mP(t,this.rightClockEncoder.toUint8Array()),D.mP(t,D._f(this.infoEncoder)),D.mP(t,this.stringEncoder.toUint8Array()),D.mP(t,D._f(this.parentInfoEncoder)),D.mP(t,this.typeRefEncoder.toUint8Array()),D.mP(t,this.lenEncoder.toUint8Array()),D.HK(t,D._f(this.restEncoder)),D._f(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){D.EM(this.restEncoder,t)}writeBuf(t){D.mP(this.restEncoder,t)}writeJSON(t){D.EM(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const re=(i,t,e,r)=>{r=it.Fp(r,t[0].id.clock);const o=ue(t,r);D.uE(i.restEncoder,t.length-o),i.writeClient(e),D.uE(i.restEncoder,r);const l=t[o];l.write(i,r-l.id.clock);for(let p=o+1;p<t.length;p++)t[p].write(i,0)},G=(i,t,e)=>{const r=new Map;e.forEach((o,l)=>{$t(t,l)>o&&r.set(l,o)}),Le(t).forEach((o,l)=>{e.has(l)||r.set(l,0)}),D.uE(i.restEncoder,r.size),pt.Dp(r.entries()).sort((o,l)=>l[0]-o[0]).forEach(([o,l])=>{re(i,t.clients.get(o),o,l)})},tt=(i,t)=>{const e=N.Ue(),r=y.yg(i.restDecoder);for(let o=0;o<r;o++){const l=y.yg(i.restDecoder),p=new Array(l),E=i.readClient();let I=y.yg(i.restDecoder);e.set(E,{i:0,refs:p});for(let F=0;F<l;F++){const j=i.readInfo();switch(w.kr&j){case 0:{const W=i.readLen();p[F]=new ae(mt(E,I),W),I+=W;break}case 10:{const W=y.yg(i.restDecoder);p[F]=new le(mt(E,I),W),I+=W;break}default:{const W=(j&(w.rc|w.x1))===0,Q=new Gt(mt(E,I),null,(j&w.x1)===w.x1?i.readLeftID():null,null,(j&w.rc)===w.rc?i.readRightID():null,W?i.readParentInfo()?t.get(i.readString()):i.readLeftID():null,W&&(j&w.cq)===w.cq?i.readString():null,Qn(i,j));p[F]=Q,I+=Q.length}}}}return e},bt=(i,t,e)=>{const r=[];let o=pt.Dp(e.keys()).sort((et,ft)=>et-ft);if(o.length===0)return null;const l=()=>{if(o.length===0)return null;let et=e.get(o[o.length-1]);for(;et.refs.length===et.i;)if(o.pop(),o.length>0)et=e.get(o[o.length-1]);else return null;return et};let p=l();if(p===null&&r.length===0)return null;const E=new yn,I=new Map,F=(et,ft)=>{const Lt=I.get(et);(Lt==null||Lt>ft)&&I.set(et,ft)};let j=p.refs[p.i++];const W=new Map,Q=()=>{for(const et of r){const ft=et.id.client,Lt=e.get(ft);Lt?(Lt.i--,E.clients.set(ft,Lt.refs.slice(Lt.i)),e.delete(ft),Lt.i=0,Lt.refs=[]):E.clients.set(ft,[et]),o=o.filter(Kt=>Kt!==ft)}r.length=0};for(;;){if(j.constructor!==le){const ft=N.Yu(W,j.id.client,()=>$t(t,j.id.client))-j.id.clock;if(ft<0)r.push(j),F(j.id.client,j.id.clock-1),Q();else{const Lt=j.getMissing(i,t);if(Lt!==null){r.push(j);const Kt=e.get(Lt)||{refs:[],i:0};if(Kt.refs.length===Kt.i)F(Lt,$t(t,Lt)),Q();else{j=Kt.refs[Kt.i++];continue}}else(ft===0||ft<j.length)&&(j.integrate(i,ft),W.set(j.id.client,j.id.clock+j.length))}}if(r.length>0)j=r.pop();else if(p!==null&&p.i<p.refs.length)j=p.refs[p.i++];else{if(p=l(),p===null)break;j=p.refs[p.i++]}}if(E.clients.size>0){const et=new Pt;return G(et,E,new Map),D.uE(et.restEncoder,0),{missing:I,update:et.toUint8Array()}}return null},V=(i,t)=>G(i,t.doc.store,t.beforeState),b=(i,t,e,r=new vt(i))=>Yt(t,o=>{o.local=!1;let l=!1;const p=o.doc,E=p.store,I=tt(r,p),F=bt(o,E,I),j=E.pendingStructs;if(j){for(const[Q,et]of j.missing)if(et<$t(E,Q)){l=!0;break}if(F){for(const[Q,et]of F.missing){const ft=j.missing.get(Q);(ft==null||ft>et)&&j.missing.set(Q,et)}j.update=Ve([j.update,F.update])}}else E.pendingStructs=F;const W=St(r,o,E);if(E.pendingDs){const Q=new vt(y.l1(E.pendingDs));y.yg(Q.restDecoder);const et=St(Q,o,E);W&&et?E.pendingDs=Ve([W,et]):E.pendingDs=W||et}else E.pendingDs=W;if(l){const Q=E.pendingStructs.update;E.pendingStructs=null,Z(o.doc,Q)}},e,!1),T=(i,t,e)=>b(i,t,e,new ut(i)),Z=(i,t,e,r=vt)=>{const o=y.l1(t);b(o,i,e,new r(o))},gt=(i,t,e)=>Z(i,t,e,ut),n=(i,t,e=new Map)=>{G(i,t.store,e),It(i,Dt(t.store))},s=(i,t=new Uint8Array([0]),e=new Pt)=>{const r=z(t);n(e,i,r);const o=[e.toUint8Array()];if(i.store.pendingDs&&o.push(i.store.pendingDs),i.store.pendingStructs&&o.push(Dn(i.store.pendingStructs.update,t)),o.length>1){if(e.constructor===Ft)return hs(o.map((l,p)=>p===0?l:gs(l)));if(e.constructor===Pt)return Ve(o)}return o[0]},c=(i,t)=>s(i,t,new Ft),k=i=>{const t=new Map,e=y.yg(i.restDecoder);for(let r=0;r<e;r++){const o=y.yg(i.restDecoder),l=y.yg(i.restDecoder);t.set(o,l)}return t},z=i=>k(new nt(y.l1(i))),K=(i,t)=>(D.uE(i.restEncoder,t.size),pt.Dp(t.entries()).sort((e,r)=>r[0]-e[0]).forEach(([e,r])=>{D.uE(i.restEncoder,e),D.uE(i.restEncoder,r)}),i),ht=(i,t)=>K(i,Le(t.store)),Tt=(i,t=new te)=>(i instanceof Map?K(t,i):ht(t,i),t.toUint8Array()),Vt=i=>Tt(i,new Ut);class Nt{constructor(){this.l=[]}}const Ot=()=>new Nt,xt=(i,t)=>i.l.push(t),se=(i,t)=>{const e=i.l,r=e.length;i.l=e.filter(o=>t!==o),r===i.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},X=(i,t,e)=>d.PP(i.l,[t,e]);class st{constructor(t,e){this.client=t,this.clock=e}}const yt=(i,t)=>i===t||i!==null&&t!==null&&i.client===t.client&&i.clock===t.clock,mt=(i,t)=>new st(i,t),Wt=(i,t)=>{encoding.writeVarUint(i,t.client),encoding.writeVarUint(i,t.clock)},Zt=i=>mt(decoding.readVarUint(i),decoding.readVarUint(i)),zt=i=>{for(const[t,e]of i.doc.share.entries())if(e===i)return t;throw a.zR()},ce=(i,t)=>{for(;t!==null;){if(t.parent===i)return!0;t=t.parent._item}return!1},Se=i=>{const t=[];let e=i._start;for(;e;)t.push(e),e=e.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))};class gn{constructor(t,e=t.getMap("users")){const r=new Map;this.yusers=e,this.doc=t,this.clients=new Map,this.dss=r;const o=(l,p)=>{const E=l.get("ds"),I=l.get("ids"),F=j=>this.clients.set(j,p);E.observe(j=>{j.changes.added.forEach(W=>{W.content.getContent().forEach(Q=>{Q instanceof Uint8Array&&this.dss.set(p,ot([this.dss.get(p)||Ct(),Mt(new nt(decoding.createDecoder(Q)))]))})})}),this.dss.set(p,ot(E.map(j=>Mt(new nt(decoding.createDecoder(j)))))),I.observe(j=>j.changes.added.forEach(W=>W.content.getContent().forEach(F))),I.forEach(F)};e.observe(l=>{l.keysChanged.forEach(p=>o(e.get(p),p))}),e.forEach(o)}setUserMapping(t,e,r,{filter:o=()=>!0}={}){const l=this.yusers;let p=l.get(r);p||(p=new ve,p.set("ids",new ye),p.set("ds",new ye),l.set(r,p)),p.get("ids").push([e]),l.observe(E=>{setTimeout(()=>{const I=l.get(r);if(I!==p){p=I,this.clients.forEach((W,Q)=>{r===W&&p.get("ids").push([Q])});const F=new Ut,j=this.dss.get(r);j&&(It(F,j),p.get("ds").push([F.toUint8Array()]))}},0)}),t.on("afterTransaction",E=>{setTimeout(()=>{const I=p.get("ds"),F=E.deleteSet;if(E.local&&F.clients.size>0&&o(E,F)){const j=new Ut;It(j,F),I.push([j.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[e,r]of this.dss.entries())if(P(r,t))return e;return null}}class Ue{constructor(t,e,r,o=0){this.type=t,this.tname=e,this.item=r,this.assoc=o}}const qe=i=>{const t={};return i.type&&(t.type=i.type),i.tname&&(t.tname=i.tname),i.item&&(t.item=i.item),i.assoc!=null&&(t.assoc=i.assoc),t},Oe=i=>new Ue(i.type==null?null:mt(i.type.client,i.type.clock),i.tname||null,i.item==null?null:mt(i.item.client,i.item.clock),i.assoc==null?0:i.assoc);class Qe{constructor(t,e,r=0){this.type=t,this.index=e,this.assoc=r}}const tn=(i,t,e=0)=>new Qe(i,t,e),Ce=(i,t,e)=>{let r=null,o=null;return i._item===null?o=zt(i):r=mt(i._item.id.client,i._item.id.clock),new Ue(r,o,t,e)},O=(i,t,e=0)=>{let r=i._start;if(e<0){if(t===0)return Ce(i,null,e);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return Ce(i,mt(r.id.client,r.id.clock+t),e);t-=r.length}if(r.right===null&&e<0)return Ce(i,r.lastId,e);r=r.right}return Ce(i,null,e)},H=(i,t)=>{const{type:e,tname:r,item:o,assoc:l}=t;if(o!==null)encoding.writeVarUint(i,0),Wt(i,o);else if(r!==null)encoding.writeUint8(i,1),encoding.writeVarString(i,r);else if(e!==null)encoding.writeUint8(i,2),Wt(i,e);else throw error.unexpectedCase();return encoding.writeVarInt(i,l),i},J=i=>{const t=encoding.createEncoder();return H(t,i),encoding.toUint8Array(t)},lt=i=>{let t=null,e=null,r=null;switch(decoding.readVarUint(i)){case 0:r=Zt(i);break;case 1:e=decoding.readVarString(i);break;case 2:t=Zt(i)}const o=decoding.hasContent(i)?decoding.readVarInt(i):0;return new Ue(t,e,r,o)},rt=i=>lt(decoding.createDecoder(i)),Et=(i,t)=>{const e=t.store,r=i.item,o=i.type,l=i.tname,p=i.assoc;let E=null,I=0;if(r!==null){if($t(e,r.client)<=r.clock)return null;const F=fn(e,r),j=F.item;if(!(j instanceof Gt))return null;if(E=j.parent,E._item===null||!E._item.deleted){I=j.deleted||!j.countable?0:F.diff+(p>=0?0:1);let W=j.left;for(;W!==null;)!W.deleted&&W.countable&&(I+=W.length),W=W.left}}else{if(l!==null)E=t.get(l);else if(o!==null){if($t(e,o.client)<=o.clock)return null;const{item:F}=fn(e,o);if(F instanceof Gt&&F.content instanceof de)E=F.content.type;else return null}else throw error.unexpectedCase();p>=0?I=E._length:I=0}return tn(E,I,i.assoc)},dt=(i,t)=>i===t||i!==null&&t!==null&&i.tname===t.tname&&yt(i.item,t.item)&&yt(i.type,t.type)&&i.assoc===t.assoc;class Rt{constructor(t,e){this.ds=t,this.sv=e}}const At=(i,t)=>{const e=i.ds.clients,r=t.ds.clients,o=i.sv,l=t.sv;if(o.size!==l.size||e.size!==r.size)return!1;for(const[p,E]of o.entries())if(l.get(p)!==E)return!1;for(const[p,E]of e.entries()){const I=r.get(p)||[];if(E.length!==I.length)return!1;for(let F=0;F<E.length;F++){const j=E[F],W=I[F];if(j.clock!==W.clock||j.len!==W.len)return!1}}return!0},Bt=(i,t=new te)=>(It(t,i.ds),K(t,i.sv),t.toUint8Array()),jt=i=>Bt(i,new Ut),qt=(i,t=new _t(decoding.createDecoder(i)))=>new Rt(Mt(t),k(t)),oe=i=>qt(i,new nt(decoding.createDecoder(i))),fe=(i,t)=>new Rt(i,t),Me=fe(Ct(),new Map),mn=i=>fe(Dt(i.store),Le(i.store)),pe=(i,t)=>t===void 0?!i.deleted:t.sv.has(i.id.client)&&(t.sv.get(i.id.client)||0)>i.id.clock&&!P(t.ds,i.id),en=(i,t)=>{const e=N.Yu(i.meta,en,h.Ue),r=i.doc.store;e.has(t)||(t.sv.forEach((o,l)=>{o<$t(r,l)&&ie(i,mt(l,o))}),Y(i,t.ds,o=>{}),e.add(t))},nr=(i,t,e=new at)=>{if(i.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:r,ds:o}=t,l=new Pt;return i.transact(p=>{let E=0;r.forEach(I=>{I>0&&E++}),encoding.writeVarUint(l.restEncoder,E);for(const[I,F]of r){if(F===0)continue;F<$t(i.store,I)&&ie(p,mt(I,F));const j=i.store.clients.get(I)||[],W=ue(j,F-1);encoding.writeVarUint(l.restEncoder,W+1),l.writeClient(I),encoding.writeVarUint(l.restEncoder,0);for(let Q=0;Q<=W;Q++)j[Q].write(l,0)}It(l,o)}),Z(e,l.toUint8Array(),"snapshot"),e},rs=(i,t,e=vt)=>{const r=new e(decoding.createDecoder(t)),o=new ge(r,!1);for(let p=o.curr;p!==null;p=o.next())if((i.sv.get(p.id.client)||0)<p.id.clock+p.length)return!1;const l=ot([i.ds,Mt(r)]);return ee(i.ds,l)},sr=(i,t)=>rs(i,t,ut);class yn{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Le=i=>{const t=new Map;return i.clients.forEach((e,r)=>{const o=e[e.length-1];t.set(r,o.id.clock+o.length)}),t},$t=(i,t)=>{const e=i.clients.get(t);if(e===void 0)return 0;const r=e[e.length-1];return r.id.clock+r.length},bn=(i,t)=>{let e=i.clients.get(t.id.client);if(e===void 0)e=[],i.clients.set(t.id.client,e);else{const r=e[e.length-1];if(r.id.clock+r.length!==t.id.clock)throw a.zR()}e.push(t)},ue=(i,t)=>{let e=0,r=i.length-1,o=i[r],l=o.id.clock;if(l===t)return r;let p=it.GW(t/(l+o.length-1)*r);for(;e<=r;){if(o=i[p],l=o.id.clock,l<=t){if(t<l+o.length)return p;e=p+1}else r=p-1;p=it.GW((e+r)/2)}throw a.zR()},Pe=(i,t)=>{const e=i.clients.get(t.client);return e[ue(e,t.clock)]},nn=(i,t,e)=>{const r=ue(t,e),o=t[r];return o.id.clock<e&&o instanceof Gt?(t.splice(r+1,0,Ze(i,o,e-o.id.clock)),r+1):r},ie=(i,t)=>{const e=i.doc.store.clients.get(t.client);return e[nn(i,e,t.clock)]},wn=(i,t,e)=>{const r=t.clients.get(e.client),o=ue(r,e.clock),l=r[o];return e.clock!==l.id.clock+l.length-1&&l.constructor!==ae&&r.splice(o+1,0,Ze(i,l,e.clock-l.id.clock+1)),l},is=(i,t,e)=>{const r=i.clients.get(t.id.client);r[ue(r,t.id.clock)]=e},_n=(i,t,e,r,o)=>{if(r===0)return;const l=e+r;let p=nn(i,t,e),E;do E=t[p++],l<E.id.clock+E.length&&nn(i,t,l),o(E);while(p<t.length&&t[p].id.clock<l)};class os{constructor(t,e,r){this.doc=t,this.deleteSet=new A,this.beforeState=Le(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const vn=(i,t)=>t.deleteSet.clients.size===0&&!N.Yj(t.afterState,(e,r)=>t.beforeState.get(r)!==e)?!1:(q(t.deleteSet),V(i,t),It(i,t.deleteSet),!0),En=(i,t,e)=>{const r=t._item;(r===null||r.id.clock<(i.beforeState.get(r.id.client)||0)&&!r.deleted)&&N.Yu(i.changed,t,h.Ue).add(e)},Fe=(i,t)=>{let e=i[t],r=i[t-1],o=t;for(;o>0;e=r,r=i[--o-1]){if(r.deleted===e.deleted&&r.constructor===e.constructor&&r.mergeWith(e)){e instanceof Gt&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,r);continue}break}const l=t-o;return l&&i.splice(t+1-l,l),l},Sn=(i,t,e)=>{for(const[r,o]of i.clients.entries()){const l=t.clients.get(r);for(let p=o.length-1;p>=0;p--){const E=o[p],I=E.clock+E.len;for(let F=ue(l,E.clock),j=l[F];F<l.length&&j.id.clock<I;j=l[++F]){const W=l[F];if(E.clock+E.len<=W.id.clock)break;W instanceof Gt&&W.deleted&&!W.keep&&e(W)&&W.gc(t,!1)}}}},Cn=(i,t)=>{i.clients.forEach((e,r)=>{const o=t.clients.get(r);for(let l=e.length-1;l>=0;l--){const p=e[l],E=it.VV(o.length-1,1+ue(o,p.clock+p.len-1));for(let I=E,F=o[I];I>0&&F.id.clock>=p.clock;F=o[I])I-=1+Fe(o,I)}})},ir=(i,t,e)=>{Sn(i,t,e),Cn(i,t)},kn=(i,t)=>{if(t<i.length){const e=i[t],r=e.doc,o=r.store,l=e.deleteSet,p=e._mergeStructs;try{q(l),e.afterState=Le(e.doc.store),r.emit("beforeObserverCalls",[e,r]);const E=[];e.changed.forEach((I,F)=>E.push(()=>{(F._item===null||!F._item.deleted)&&F._callObserver(e,I)})),E.push(()=>{e.changedParentTypes.forEach((I,F)=>{F._dEH.l.length>0&&(F._item===null||!F._item.deleted)&&(I=I.filter(j=>j.target._item===null||!j.target._item.deleted),I.forEach(j=>{j.currentTarget=F,j._path=null}),I.sort((j,W)=>j.path.length-W.path.length),X(F._dEH,I,e))})}),E.push(()=>r.emit("afterTransaction",[e,r])),(0,d.PP)(E,[]),e._needFormattingCleanup&&Ds(e)}finally{r.gc&&Sn(l,o,r.gcFilter),Cn(l,o),e.afterState.forEach((j,W)=>{const Q=e.beforeState.get(W)||0;if(Q!==j){const et=o.clients.get(W),ft=it.Fp(ue(et,Q),1);for(let Lt=et.length-1;Lt>=ft;)Lt-=1+Fe(et,Lt)}});for(let j=p.length-1;j>=0;j--){const{client:W,clock:Q}=p[j].id,et=o.clients.get(W),ft=ue(et,Q);ft+1<et.length&&Fe(et,ft+1)>1||ft>0&&Fe(et,ft)}if(!e.local&&e.afterState.get(r.clientID)!==e.beforeState.get(r.clientID)&&(L.S0(R.ud,R.Pl,"[yjs] ",R.YW,R.hM,"Changed the client-id because another client seems to be using it."),r.clientID=Xt()),r.emit("afterTransactionCleanup",[e,r]),r._observers.has("update")){const j=new Ft;vn(j,e)&&r.emit("update",[j.toUint8Array(),e.origin,r,e])}if(r._observers.has("updateV2")){const j=new Pt;vn(j,e)&&r.emit("updateV2",[j.toUint8Array(),e.origin,r,e])}const{subdocsAdded:E,subdocsLoaded:I,subdocsRemoved:F}=e;(E.size>0||F.size>0||I.size>0)&&(E.forEach(j=>{j.clientID=r.clientID,j.collectionid==null&&(j.collectionid=r.collectionid),r.subdocs.add(j)}),F.forEach(j=>r.subdocs.delete(j)),r.emit("subdocs",[{loaded:I,added:E,removed:F},r,e]),F.forEach(j=>j.destroy())),i.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,i])):kn(i,t+1)}}},Yt=(i,t,e=null,r=!0)=>{const o=i._transactionCleanups;let l=!1,p=null;i._transaction===null&&(l=!0,i._transaction=new os(i,e,r),o.push(i._transaction),o.length===1&&i.emit("beforeAllTransactions",[i]),i.emit("beforeTransaction",[i._transaction,i]));try{p=t(i._transaction)}finally{if(l){const E=i._transaction===o[0];i._transaction=null,E&&kn(o,0)}}return p};class ls{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const Tn=(i,t,e)=>{Y(i,e.deletions,r=>{r instanceof Gt&&t.scope.some(o=>ce(o,r))&&pn(r,!1)})},Rn=(i,t,e)=>{let r=null,o=null;const l=i.doc,p=i.scope;if(Yt(l,E=>{for(;t.length>0&&r===null;){const I=l.store,F=t.pop(),j=new Set,W=[];let Q=!1;Y(E,F.insertions,et=>{if(et instanceof Gt){if(et.redone!==null){let{item:ft,diff:Lt}=fn(I,et.id);Lt>0&&(ft=ie(E,mt(ft.id.client,ft.id.clock+Lt))),et=ft}!et.deleted&&p.some(ft=>ce(ft,et))&&W.push(et)}}),Y(E,F.deletions,et=>{et instanceof Gt&&p.some(ft=>ce(ft,et))&&!P(F.insertions,et.id)&&j.add(et)}),j.forEach(et=>{Q=qn(E,et,j,F.insertions,i.ignoreRemoteMapChanges,i)!==null||Q});for(let et=W.length-1;et>=0;et--){const ft=W[et];i.deleteFilter(ft)&&(ft.delete(E),Q=!0)}r=Q?F:null}E.changed.forEach((I,F)=>{I.has(null)&&F._searchMarker&&(F._searchMarker.length=0)}),o=E},i),r!=null){const E=o.changedParentTypes;i.emit("stack-item-popped",[{stackItem:r,type:e,changedParentTypes:E},i])}return r};class or extends null{constructor(t,{captureTimeout:e=500,captureTransaction:r=I=>!0,deleteFilter:o=()=>!0,trackedOrigins:l=new Set([null]),ignoreRemoteMapChanges:p=!1,doc:E=array.isArray(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.doc=E,this.addToScope(t),this.deleteFilter=o,l.add(this),this.trackedOrigins=l,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.lastChange=0,this.ignoreRemoteMapChanges=p,this.captureTimeout=e,this.afterTransactionHandler=I=>{if(!this.captureTransaction(I)||!this.scope.some(Kt=>I.changedParentTypes.has(Kt))||!this.trackedOrigins.has(I.origin)&&(!I.origin||!this.trackedOrigins.has(I.origin.constructor)))return;const F=this.undoing,j=this.redoing,W=F?this.redoStack:this.undoStack;F?this.stopCapturing():j||this.clear(!1,!0);const Q=new A;I.afterState.forEach((Kt,Jt)=>{const ns=I.beforeState.get(Jt)||0,ss=Kt-ns;ss>0&&wt(Q,Jt,ns,ss)});const et=time.getUnixTime();let ft=!1;if(this.lastChange>0&&et-this.lastChange<this.captureTimeout&&W.length>0&&!F&&!j){const Kt=W[W.length-1];Kt.deletions=ot([Kt.deletions,I.deleteSet]),Kt.insertions=ot([Kt.insertions,Q])}else W.push(new ls(I.deleteSet,Q)),ft=!0;!F&&!j&&(this.lastChange=et),Y(I,I.deleteSet,Kt=>{Kt instanceof Gt&&this.scope.some(Jt=>ce(Jt,Kt))&&pn(Kt,!0)});const Lt=[{stackItem:W[W.length-1],origin:I.origin,type:F?"redo":"undo",changedParentTypes:I.changedParentTypes},this];ft?this.emit("stack-item-added",Lt):this.emit("stack-item-updated",Lt)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=array.isArray(t)?t:[t],t.forEach(e=>{this.scope.every(r=>r!==e)&&(e.doc!==this.doc&&logging.warn("[yjs#509] Not same Y.Doc"),this.scope.push(e))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(o=>Tn(r,this,o)),this.undoStack=[]),e&&(this.redoStack.forEach(o=>Tn(r,this,o)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=Rn(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=Rn(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*cs(i){const t=y.yg(i.restDecoder);for(let e=0;e<t;e++){const r=y.yg(i.restDecoder),o=i.readClient();let l=y.yg(i.restDecoder);for(let p=0;p<r;p++){const E=i.readInfo();if(E===10){const I=y.yg(i.restDecoder);yield new le(mt(o,l),I),l+=I}else if(w.kr&E){const I=(E&(w.rc|w.x1))===0,F=new Gt(mt(o,l),null,(E&w.x1)===w.x1?i.readLeftID():null,null,(E&w.rc)===w.rc?i.readRightID():null,I?i.readParentInfo()?i.readString():i.readLeftID():null,I&&(E&w.cq)===w.cq?i.readString():null,Qn(i,E));yield F,l+=F.length}else{const I=i.readLen();yield new ae(mt(o,l),I),l+=I}}}}class ge{constructor(t,e){this.gen=cs(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===le);return this.curr}}const lr=i=>as(i,ut),as=(i,t=vt)=>{const e=[],r=new t(decoding.createDecoder(i)),o=new ge(r,!1);for(let p=o.curr;p!==null;p=o.next())e.push(p);logging.print("Structs: ",e);const l=Mt(r);logging.print("DeleteSet: ",l)},cr=i=>us(i,ut),us=(i,t=vt)=>{const e=[],r=new t(decoding.createDecoder(i)),o=new ge(r,!1);for(let l=o.curr;l!==null;l=o.next())e.push(l);return{structs:e,ds:Mt(r)}};class sn{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const hs=i=>Ve(i,ut,Ft),ds=(i,t=te,e=vt)=>{const r=new t,o=new ge(new e(decoding.createDecoder(i)),!1);let l=o.curr;if(l!==null){let p=0,E=l.id.client,I=l.id.clock!==0,F=I?0:l.id.clock+l.length;for(;l!==null;l=o.next())E!==l.id.client&&(F!==0&&(p++,encoding.writeVarUint(r.restEncoder,E),encoding.writeVarUint(r.restEncoder,F)),E=l.id.client,F=0,I=l.id.clock!==0),l.constructor===le&&(I=!0),I||(F=l.id.clock+l.length);F!==0&&(p++,encoding.writeVarUint(r.restEncoder,E),encoding.writeVarUint(r.restEncoder,F));const j=encoding.createEncoder();return encoding.writeVarUint(j,p),encoding.writeBinaryEncoder(j,r.restEncoder),r.restEncoder=j,r.toUint8Array()}else return encoding.writeVarUint(r.restEncoder,0),r.toUint8Array()},ar=i=>ds(i,Ut,ut),fs=(i,t=vt)=>{const e=new Map,r=new Map,o=new ge(new t(decoding.createDecoder(i)),!1);let l=o.curr;if(l!==null){let p=l.id.client,E=l.id.clock;for(e.set(p,E);l!==null;l=o.next())p!==l.id.client&&(r.set(p,E),e.set(l.id.client,l.id.clock),p=l.id.client),E=l.id.clock+l.length;r.set(p,E)}return{from:e,to:r}},ur=i=>fs(i,ut),ps=(i,t)=>{if(i.constructor===ae){const{client:e,clock:r}=i.id;return new ae(mt(e,r+t),i.length-t)}else if(i.constructor===le){const{client:e,clock:r}=i.id;return new le(mt(e,r+t),i.length-t)}else{const e=i,{client:r,clock:o}=e.id;return new Gt(mt(r,o+t),null,mt(r,o+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},Ve=(i,t=vt,e=Pt)=>{if(i.length===1)return i[0];const r=i.map(j=>new t(y.l1(j)));let o=r.map(j=>new ge(j,!0)),l=null;const p=new e,E=new sn(p);for(;o=o.filter(Q=>Q.curr!==null),o.sort((Q,et)=>{if(Q.curr.id.client===et.curr.id.client){const ft=Q.curr.id.clock-et.curr.id.clock;return ft===0?Q.curr.constructor===et.curr.constructor?0:Q.curr.constructor===le?1:-1:ft}else return et.curr.id.client-Q.curr.id.client}),o.length!==0;){const j=o[0],W=j.curr.id.client;if(l!==null){let Q=j.curr,et=!1;for(;Q!==null&&Q.id.clock+Q.length<=l.struct.id.clock+l.struct.length&&Q.id.client>=l.struct.id.client;)Q=j.next(),et=!0;if(Q===null||Q.id.client!==W||et&&Q.id.clock>l.struct.id.clock+l.struct.length)continue;if(W!==l.struct.id.client)me(E,l.struct,l.offset),l={struct:Q,offset:0},j.next();else if(l.struct.id.clock+l.struct.length<Q.id.clock)if(l.struct.constructor===le)l.struct.length=Q.id.clock+Q.length-l.struct.id.clock;else{me(E,l.struct,l.offset);const ft=Q.id.clock-l.struct.id.clock-l.struct.length;l={struct:new le(mt(W,l.struct.id.clock+l.struct.length),ft),offset:0}}else{const ft=l.struct.id.clock+l.struct.length-Q.id.clock;ft>0&&(l.struct.constructor===le?l.struct.length-=ft:Q=ps(Q,ft)),l.struct.mergeWith(Q)||(me(E,l.struct,l.offset),l={struct:Q,offset:0},j.next())}}else l={struct:j.curr,offset:0},j.next();for(let Q=j.curr;Q!==null&&Q.id.client===W&&Q.id.clock===l.struct.id.clock+l.struct.length&&Q.constructor!==le;Q=j.next())me(E,l.struct,l.offset),l={struct:Q,offset:0}}l!==null&&(me(E,l.struct,l.offset),l=null),rn(E);const I=r.map(j=>Mt(j)),F=ot(I);return It(p,F),p.toUint8Array()},Dn=(i,t,e=vt,r=Pt)=>{const o=z(t),l=new r,p=new sn(l),E=new e(y.l1(i)),I=new ge(E,!1);for(;I.curr;){const j=I.curr,W=j.id.client,Q=o.get(W)||0;if(I.curr.constructor===le){I.next();continue}if(j.id.clock+j.length>Q)for(me(p,j,it.Fp(Q-j.id.clock,0)),I.next();I.curr&&I.curr.id.client===W;)me(p,I.curr,0),I.next();else for(;I.curr&&I.curr.id.client===W&&I.curr.id.clock+I.curr.length<=Q;)I.next()}rn(p);const F=Mt(E);return It(l,F),l.toUint8Array()},hr=(i,t)=>Dn(i,t,ut,Ft),An=i=>{i.written>0&&(i.clientStructs.push({written:i.written,restEncoder:D._f(i.encoder.restEncoder)}),i.encoder.restEncoder=D.Mf(),i.written=0)},me=(i,t,e)=>{i.written>0&&i.currClient!==t.id.client&&An(i),i.written===0&&(i.currClient=t.id.client,i.encoder.writeClient(t.id.client),D.uE(i.encoder.restEncoder,t.id.clock+e)),t.write(i.encoder,e),i.written++},rn=i=>{An(i);const t=i.encoder.restEncoder;D.uE(t,i.clientStructs.length);for(let e=0;e<i.clientStructs.length;e++){const r=i.clientStructs[e];D.uE(t,r.written),D.HK(t,r.restEncoder)}},We=(i,t,e,r)=>{const o=new e(y.l1(i)),l=new ge(o,!1),p=new r,E=new sn(p);for(let F=l.curr;F!==null;F=l.next())me(E,t(F),0);rn(E);const I=Mt(o);return It(p,I),p.toUint8Array()},In=({formatting:i=!0,subdocs:t=!0,yxml:e=!0}={})=>{let r=0;const o=map.create(),l=map.create(),p=map.create(),E=map.create();return E.set(null,null),I=>{switch(I.constructor){case ae:case le:return I;case Gt:{const F=I,j=F.content;switch(j.constructor){case Ae:break;case de:{if(e){const W=j.type;W instanceof Re&&(W.nodeName=map.setIfUndefined(l,W.nodeName,()=>"node-"+r)),W instanceof Be&&(W.hookName=map.setIfUndefined(l,W.hookName,()=>"hook-"+r))}break}case _e:{const W=j;W.arr=W.arr.map(()=>r);break}case De:{const W=j;W.content=new Uint8Array([r]);break}case Ie:{const W=j;t&&(W.opts={},W.doc.guid=r+"");break}case we:{const W=j;W.embed={};break}case Qt:{const W=j;i&&(W.key=map.setIfUndefined(p,W.key,()=>r+""),W.value=map.setIfUndefined(E,W.value,()=>({i:r})));break}case je:{const W=j;W.arr=W.arr.map(()=>r);break}case he:{const W=j;W.str=string.repeat(r%10+"",W.str.length);break}default:error.unexpectedCase()}return F.parentSub&&(F.parentSub=map.setIfUndefined(o,F.parentSub,()=>r+"")),r++,I}default:error.unexpectedCase()}}},dr=(i,t)=>We(i,In(t),ut,Ft),fr=(i,t)=>We(i,In(t),vt,Pt),pr=i=>We(i,f.id,ut,Pt),gs=i=>We(i,d.id,vt,Ft),Un="You must not compute changes after the event-handler fired.";class He{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ms(this.currentTarget,this.target))}deletes(t){return P(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw a.Ue(Un);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(o=>{if(o!==null){const l=e._map.get(o);let p,E;if(this.adds(l)){let I=l.left;for(;I!==null&&this.adds(I);)I=I.left;if(this.deletes(l))if(I!==null&&this.deletes(I))p="delete",E=pt.Z$(I.content.getContent());else return;else I!==null&&this.deletes(I)?(p="update",E=pt.Z$(I.content.getContent())):(p="add",E=void 0)}else if(this.deletes(l))p="delete",E=pt.Z$(l.content.getContent());else return;t.set(o,{action:p,oldValue:E})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw a.Ue(Un);const e=this.target,r=h.Ue(),o=h.Ue(),l=[];if(t={added:r,deleted:o,delta:l,keys:this.keys},this.transaction.changed.get(e).has(null)){let E=null;const I=()=>{E&&l.push(E)};for(let F=e._start;F!==null;F=F.right)F.deleted?this.deletes(F)&&!this.adds(F)&&((E===null||E.delete===void 0)&&(I(),E={delete:0}),E.delete+=F.length,o.add(F)):this.adds(F)?((E===null||E.insert===void 0)&&(I(),E={insert:[]}),E.insert=E.insert.concat(F.content.getContent()),r.add(F)):((E===null||E.retain===void 0)&&(I(),E={retain:0}),E.retain+=F.length);E!==null&&E.retain===void 0&&I()}this._changes=t}return t}}const ms=(i,t)=>{const e=[];for(;t._item!==null&&t!==i;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let r=0,o=t._item.parent._start;for(;o!==t._item&&o!==null;)o.deleted||r++,o=o.right;e.unshift(r)}t=t._item.parent}return e},On=80;let on=0;class ys{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=on++}}const bs=i=>{i.timestamp=on++},Mn=(i,t,e)=>{i.p.marker=!1,i.p=t,t.marker=!0,i.index=e,i.timestamp=on++},ws=(i,t,e)=>{if(i.length>=On){const r=i.reduce((o,l)=>o.timestamp<l.timestamp?o:l);return Mn(r,t,e),r}else{const r=new ys(t,e);return i.push(r),r}},Ye=(i,t)=>{if(i._start===null||t===0||i._searchMarker===null)return null;const e=i._searchMarker.length===0?null:i._searchMarker.reduce((l,p)=>it.Wn(t-l.index)<it.Wn(t-p.index)?l:p);let r=i._start,o=0;for(e!==null&&(r=e.p,o=e.index,bs(e));r.right!==null&&o<t;){if(!r.deleted&&r.countable){if(t<o+r.length)break;o+=r.length}r=r.right}for(;r.left!==null&&o>t;)r=r.left,!r.deleted&&r.countable&&(o-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(o-=r.length);return e!==null&&it.Wn(e.index-o)<r.parent.length/On?(Mn(e,r,o),e):ws(i._searchMarker,r,o)},Ne=(i,t,e)=>{for(let r=i.length-1;r>=0;r--){const o=i[r];if(e>0){let l=o.p;for(l.marker=!1;l&&(l.deleted||!l.countable);)l=l.left,l&&!l.deleted&&l.countable&&(o.index-=l.length);if(l===null||l.marker===!0){i.splice(r,1);continue}o.p=l,l.marker=!0}(t<o.index||e>0&&t===o.index)&&(o.index=it.Fp(t,o.index+e))}},gr=i=>{let t=i._start;const e=[];for(;t;)e.push(t),t=t.right;return e},Ge=(i,t,e)=>{const r=i,o=t.changedParentTypes;for(;N.Yu(o,i,()=>[]).push(e),i._item!==null;)i=i._item.parent;X(r._eH,e,t)};class ne{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ot(),this._dEH=Ot(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw a.Nw()}clone(){throw a.Nw()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){xt(this._eH,t)}observeDeep(t){xt(this._dEH,t)}unobserve(t){se(this._eH,t)}unobserveDeep(t){se(this._dEH,t)}toJSON(){}}const Ln=(i,t,e)=>{t<0&&(t=i._length+t),e<0&&(e=i._length+e);let r=e-t;const o=[];let l=i._start;for(;l!==null&&r>0;){if(l.countable&&!l.deleted){const p=l.content.getContent();if(p.length<=t)t-=p.length;else{for(let E=t;E<p.length&&r>0;E++)o.push(p[E]),r--;t=0}}l=l.right}return o},Nn=i=>{const t=[];let e=i._start;for(;e!==null;){if(e.countable&&!e.deleted){const r=e.content.getContent();for(let o=0;o<r.length;o++)t.push(r[o])}e=e.right}return t},mr=(i,t)=>{const e=[];let r=i._start;for(;r!==null;){if(r.countable&&pe(r,t)){const o=r.content.getContent();for(let l=0;l<o.length;l++)e.push(o[l])}r=r.right}return e},xe=(i,t)=>{let e=0,r=i._start;for(;r!==null;){if(r.countable&&!r.deleted){const o=r.content.getContent();for(let l=0;l<o.length;l++)t(o[l],e++,i)}r=r.right}},xn=(i,t)=>{const e=[];return xe(i,(r,o)=>{e.push(t(r,o,i))}),e},_s=i=>{let t=i._start,e=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),r=0,t=t.right}const o=e[r++];return e.length<=r&&(e=null),{done:!1,value:o}}}},Bn=(i,t)=>{const e=Ye(i,t);let r=i._start;for(e!==null&&(r=e.p,t-=e.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},ze=(i,t,e,r)=>{let o=e;const l=i.doc,p=l.clientID,E=l.store,I=e===null?t._start:e.right;let F=[];const j=()=>{F.length>0&&(o=new Gt(mt(p,$t(E,p)),o,o&&o.lastId,I,I&&I.id,t,null,new _e(F)),o.integrate(i,0),F=[])};r.forEach(W=>{if(W===null)F.push(W);else switch(W.constructor){case Number:case Object:case Boolean:case Array:case String:F.push(W);break;default:switch(j(),W.constructor){case Uint8Array:case ArrayBuffer:o=new Gt(mt(p,$t(E,p)),o,o&&o.lastId,I,I&&I.id,t,null,new De(new Uint8Array(W))),o.integrate(i,0);break;case at:o=new Gt(mt(p,$t(E,p)),o,o&&o.lastId,I,I&&I.id,t,null,new Ie(W)),o.integrate(i,0);break;default:if(W instanceof ne)o=new Gt(mt(p,$t(E,p)),o,o&&o.lastId,I,I&&I.id,t,null,new de(W)),o.integrate(i,0);else throw new Error("Unexpected content type in insert operation")}}}),j()},jn=()=>a.Ue("Length exceeded!"),Pn=(i,t,e,r)=>{if(e>t._length)throw jn();if(e===0)return t._searchMarker&&Ne(t._searchMarker,e,r.length),ze(i,t,null,r);const o=e,l=Ye(t,e);let p=t._start;for(l!==null&&(p=l.p,e-=l.index,e===0&&(p=p.prev,e+=p&&p.countable&&!p.deleted?p.length:0));p!==null;p=p.right)if(!p.deleted&&p.countable){if(e<=p.length){e<p.length&&ie(i,mt(p.id.client,p.id.clock+e));break}e-=p.length}return t._searchMarker&&Ne(t._searchMarker,o,r.length),ze(i,t,p,r)},vs=(i,t,e)=>{let o=(t._searchMarker||[]).reduce((l,p)=>p.index>l.index?p:l,{index:0,p:t._start}).p;if(o)for(;o.right;)o=o.right;return ze(i,t,o,e)},Fn=(i,t,e,r)=>{if(r===0)return;const o=e,l=r,p=Ye(t,e);let E=t._start;for(p!==null&&(E=p.p,e-=p.index);E!==null&&e>0;E=E.right)!E.deleted&&E.countable&&(e<E.length&&ie(i,mt(E.id.client,E.id.clock+e)),e-=E.length);for(;r>0&&E!==null;)E.deleted||(r<E.length&&ie(i,mt(E.id.client,E.id.clock+r)),E.delete(i),r-=E.length),E=E.right;if(r>0)throw jn();t._searchMarker&&Ne(t._searchMarker,o,-l+r)},Ke=(i,t,e)=>{const r=t._map.get(e);r!==void 0&&r.delete(i)},ln=(i,t,e,r)=>{const o=t._map.get(e)||null,l=i.doc,p=l.clientID;let E;if(r==null)E=new _e([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:E=new _e([r]);break;case Uint8Array:E=new De(r);break;case at:E=new Ie(r);break;default:if(r instanceof ne)E=new de(r);else throw new Error("Unexpected content type")}new Gt(mt(p,$t(l.store,p)),o,o&&o.lastId,null,null,t,e,E).integrate(i,0)},cn=(i,t)=>{const e=i._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},Vn=i=>{const t={};return i._map.forEach((e,r)=>{e.deleted||(t[r]=e.content.getContent()[e.length-1])}),t},Wn=(i,t)=>{const e=i._map.get(t);return e!==void 0&&!e.deleted},yr=(i,t,e)=>{let r=i._map.get(t)||null;for(;r!==null&&(!e.sv.has(r.id.client)||r.id.clock>=(e.sv.get(r.id.client)||0));)r=r.left;return r!==null&&pe(r,e)?r.content.getContent()[r.length-1]:void 0},$e=i=>u(i.entries(),t=>!t[1].deleted);class Es extends He{constructor(t,e){super(t,e),this._transaction=e}}class ye extends ne{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new ye;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ye}clone(){const t=new ye;return t.insert(0,this.toArray().map(e=>e instanceof ne?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Ge(this,t,new Es(this,t))}insert(t,e){this.doc!==null?Yt(this.doc,r=>{Pn(r,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?Yt(this.doc,e=>{vs(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?Yt(this.doc,r=>{Fn(r,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return Bn(this,t)}toArray(){return Nn(this)}slice(t=0,e=this.length){return Ln(this,t,e)}toJSON(){return this.map(t=>t instanceof ne?t.toJSON():t)}map(t){return xn(this,t)}forEach(t){xe(this,t)}[Symbol.iterator](){return _s(this)}_write(t){t.writeTypeRef(zs)}}const Ss=i=>new ye;class Cs extends He{constructor(t,e,r){super(t,e),this.keysChanged=r}}class ve extends ne{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((r,o)=>{this.set(o,r)}),this._prelimContent=null}_copy(){return new ve}clone(){const t=new ve;return this.forEach((e,r)=>{t.set(r,e instanceof ne?e.clone():e)}),t}_callObserver(t,e){Ge(this,t,new Cs(this,t,e))}toJSON(){const t={};return this._map.forEach((e,r)=>{if(!e.deleted){const o=e.content.getContent()[e.length-1];t[r]=o instanceof ne?o.toJSON():o}}),t}get size(){return[...$e(this._map)].length}keys(){return _($e(this._map),t=>t[0])}values(){return _($e(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return _($e(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,r)=>{e.deleted||t(e.content.getContent()[e.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Yt(this.doc,e=>{Ke(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?Yt(this.doc,r=>{ln(r,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return cn(this,t)}has(t){return Wn(this,t)}clear(){this.doc!==null?Yt(this.doc,t=>{this.forEach(function(e,r,o){Ke(t,o,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ks)}}const ks=i=>new ve,be=(i,t)=>i===t||typeof i=="object"&&typeof t=="object"&&i&&t&&m.$m(i,t);class an{constructor(t,e,r,o){this.left=t,this.right=e,this.index=r,this.currentAttributes=o}forward(){switch(this.right===null&&a.zR(),this.right.content.constructor){case Qt:this.right.deleted||ke(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Hn=(i,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case Qt:t.right.deleted||ke(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&ie(i,mt(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Je=(i,t,e)=>{const r=new Map,o=Ye(t,e);if(o){const l=new an(o.p.left,o.p,o.index,r);return Hn(i,l,e-o.index)}else{const l=new an(null,t._start,0,r);return Hn(i,l,e)}},Yn=(i,t,e,r)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===Qt&&be(r.get(e.right.content.key),e.right.content.value));)e.right.deleted||r.delete(e.right.content.key),e.forward();const o=i.doc,l=o.clientID;r.forEach((p,E)=>{const I=e.left,F=e.right,j=new Gt(mt(l,$t(o.store,l)),I,I&&I.lastId,F,F&&F.id,t,null,new Qt(E,p));j.integrate(i,0),e.right=j,e.forward()})},ke=(i,t)=>{const{key:e,value:r}=t;r===null?i.delete(e):i.set(e,r)},Gn=(i,t)=>{for(;i.right!==null;){if(!(i.right.deleted||i.right.content.constructor===Qt&&be(t[i.right.content.key]||null,i.right.content.value)))break;i.forward()}},zn=(i,t,e,r)=>{const o=i.doc,l=o.clientID,p=new Map;for(const E in r){const I=r[E],F=e.currentAttributes.get(E)||null;if(!be(F,I)){p.set(E,F);const{left:j,right:W}=e;e.right=new Gt(mt(l,$t(o.store,l)),j,j&&j.lastId,W,W&&W.id,t,null,new Qt(E,I)),e.right.integrate(i,0),e.forward()}}return p},un=(i,t,e,r,o)=>{e.currentAttributes.forEach((Q,et)=>{o[et]===void 0&&(o[et]=null)});const l=i.doc,p=l.clientID;Gn(e,o);const E=zn(i,t,e,o),I=r.constructor===String?new he(r):r instanceof ne?new de(r):new we(r);let{left:F,right:j,index:W}=e;t._searchMarker&&Ne(t._searchMarker,e.index,I.getLength()),j=new Gt(mt(p,$t(l.store,p)),F,F&&F.lastId,j,j&&j.id,t,null,I),j.integrate(i,0),e.right=j,e.index=W,e.forward(),Yn(i,t,e,E)},Kn=(i,t,e,r,o)=>{const l=i.doc,p=l.clientID;Gn(e,o);const E=zn(i,t,e,o);t:for(;e.right!==null&&(r>0||E.size>0&&(e.right.deleted||e.right.content.constructor===Qt));){if(!e.right.deleted)switch(e.right.content.constructor){case Qt:{const{key:I,value:F}=e.right.content,j=o[I];if(j!==void 0){if(be(j,F))E.delete(I);else{if(r===0)break t;E.set(I,F)}e.right.delete(i)}else e.currentAttributes.set(I,F);break}default:r<e.right.length&&ie(i,mt(e.right.id.client,e.right.id.clock+r)),r-=e.right.length;break}e.forward()}if(r>0){let I="";for(;r>0;r--)I+=`
`;e.right=new Gt(mt(p,$t(l.store,p)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new he(I)),e.right.integrate(i,0),e.forward()}Yn(i,t,e,E)},$n=(i,t,e,r,o)=>{let l=t;const p=N.Ue();for(;l&&(!l.countable||l.deleted);){if(!l.deleted&&l.content.constructor===Qt){const F=l.content;p.set(F.key,F)}l=l.right}let E=0,I=!1;for(;t!==l;){if(e===t&&(I=!0),!t.deleted){const F=t.content;switch(F.constructor){case Qt:{const{key:j,value:W}=F,Q=r.get(j)||null;(p.get(j)!==F||Q===W)&&(t.delete(i),E++,!I&&(o.get(j)||null)===W&&Q!==W&&(Q===null?o.delete(j):o.set(j,Q))),!I&&!t.deleted&&ke(o,F);break}}}t=t.right}return E},Ts=(i,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Qt){const r=t.content.key;e.has(r)?t.delete(i):e.add(r)}t=t.left}},Rs=i=>{let t=0;return Yt(i.doc,e=>{let r=i._start,o=i._start,l=N.Ue();const p=N.JG(l);for(;o;){if(o.deleted===!1)switch(o.content.constructor){case Qt:ke(p,o.content);break;default:t+=$n(e,r,o,l,p),l=N.JG(p),r=o;break}o=o.right}}),t},Ds=i=>{const t=new Set,e=i.doc;for(const[r,o]of i.afterState.entries()){const l=i.beforeState.get(r)||0;o!==l&&_n(i,e.store.clients.get(r),l,o,p=>{!p.deleted&&p.content.constructor===Qt&&p.constructor!==ae&&t.add(p.parent)})}Yt(e,r=>{Y(i,i.deleteSet,o=>{if(o instanceof ae||!o.parent._hasFormatting||t.has(o.parent))return;const l=o.parent;o.content.constructor===Qt?t.add(l):Ts(r,o)});for(const o of t)Rs(o)})},Jn=(i,t,e)=>{const r=e,o=N.JG(t.currentAttributes),l=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case de:case we:case he:e<t.right.length&&ie(i,mt(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(i);break}t.forward()}l&&$n(i,l,t.right,o,t.currentAttributes);const p=(t.left||t.right).parent;return p._searchMarker&&Ne(p._searchMarker,t.index,-r+e),t};class As extends He{constructor(t,e,r){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(o=>{o===null?this.childListChanged=!0:this.keysChanged.add(o)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];Yt(t,r=>{const o=new Map,l=new Map;let p=this.target._start,E=null;const I={};let F="",j=0,W=0;const Q=()=>{if(E!==null){let et=null;switch(E){case"delete":W>0&&(et={delete:W}),W=0;break;case"insert":(typeof F=="object"||F.length>0)&&(et={insert:F},o.size>0&&(et.attributes={},o.forEach((ft,Lt)=>{ft!==null&&(et.attributes[Lt]=ft)}))),F="";break;case"retain":j>0&&(et={retain:j},m.xb(I)||(et.attributes=m.f0({},I))),j=0;break}et&&e.push(et),E=null}};for(;p!==null;){switch(p.content.constructor){case de:case we:this.adds(p)?this.deletes(p)||(Q(),E="insert",F=p.content.getContent()[0],Q()):this.deletes(p)?(E!=="delete"&&(Q(),E="delete"),W+=1):p.deleted||(E!=="retain"&&(Q(),E="retain"),j+=1);break;case he:this.adds(p)?this.deletes(p)||(E!=="insert"&&(Q(),E="insert"),F+=p.content.str):this.deletes(p)?(E!=="delete"&&(Q(),E="delete"),W+=p.length):p.deleted||(E!=="retain"&&(Q(),E="retain"),j+=p.length);break;case Qt:{const{key:et,value:ft}=p.content;if(this.adds(p)){if(!this.deletes(p)){const Lt=o.get(et)||null;be(Lt,ft)?ft!==null&&p.delete(r):(E==="retain"&&Q(),be(ft,l.get(et)||null)?delete I[et]:I[et]=ft)}}else if(this.deletes(p)){l.set(et,ft);const Lt=o.get(et)||null;be(Lt,ft)||(E==="retain"&&Q(),I[et]=Lt)}else if(!p.deleted){l.set(et,ft);const Lt=I[et];Lt!==void 0&&(be(Lt,ft)?Lt!==null&&p.delete(r):(E==="retain"&&Q(),ft===null?delete I[et]:I[et]=ft))}p.deleted||(E==="insert"&&Q(),ke(o,p.content));break}}p=p.right}for(Q();e.length>0;){const et=e[e.length-1];if(et.retain!==void 0&&et.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Te extends ne{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Te}clone(){const t=new Te;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const r=new As(this,t,e);Ge(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===he&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?Yt(this.doc,r=>{const o=new an(null,this._start,0,new Map);for(let l=0;l<t.length;l++){const p=t[l];if(p.insert!==void 0){const E=!e&&typeof p.insert=="string"&&l===t.length-1&&o.right===null&&p.insert.slice(-1)===`
`?p.insert.slice(0,-1):p.insert;(typeof E!="string"||E.length>0)&&un(r,this,o,E,p.attributes||{})}else p.retain!==void 0?Kn(r,this,o,p.retain,p.attributes||{}):p.delete!==void 0&&Jn(r,o,p.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,r){const o=[],l=new Map,p=this.doc;let E="",I=this._start;function F(){if(E.length>0){const W={};let Q=!1;l.forEach((ft,Lt)=>{Q=!0,W[Lt]=ft});const et={insert:E};Q&&(et.attributes=W),o.push(et),E=""}}const j=()=>{for(;I!==null;){if(pe(I,t)||e!==void 0&&pe(I,e))switch(I.content.constructor){case he:{const W=l.get("ychange");t!==void 0&&!pe(I,t)?(W===void 0||W.user!==I.id.client||W.type!=="removed")&&(F(),l.set("ychange",r?r("removed",I.id):{type:"removed"})):e!==void 0&&!pe(I,e)?(W===void 0||W.user!==I.id.client||W.type!=="added")&&(F(),l.set("ychange",r?r("added",I.id):{type:"added"})):W!==void 0&&(F(),l.delete("ychange")),E+=I.content.str;break}case de:case we:{F();const W={insert:I.content.getContent()[0]};if(l.size>0){const Q={};W.attributes=Q,l.forEach((et,ft)=>{Q[ft]=et})}o.push(W);break}case Qt:pe(I,t)&&(F(),ke(l,I.content));break}I=I.right}F()};return t||e?Yt(p,W=>{t&&en(W,t),e&&en(W,e),j()},"cleanup"):j(),o}insert(t,e,r){if(e.length<=0)return;const o=this.doc;o!==null?Yt(o,l=>{const p=Je(l,this,t);r||(r={},p.currentAttributes.forEach((E,I)=>{r[I]=E})),un(l,this,p,e,r)}):this._pending.push(()=>this.insert(t,e,r))}insertEmbed(t,e,r={}){const o=this.doc;o!==null?Yt(o,l=>{const p=Je(l,this,t);un(l,this,p,e,r)}):this._pending.push(()=>this.insertEmbed(t,e,r))}delete(t,e){if(e===0)return;const r=this.doc;r!==null?Yt(r,o=>{Jn(o,Je(o,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,r){if(e===0)return;const o=this.doc;o!==null?Yt(o,l=>{const p=Je(l,this,t);p.right!==null&&Kn(l,this,p,e,r)}):this._pending.push(()=>this.format(t,e,r))}removeAttribute(t){this.doc!==null?Yt(this.doc,e=>{Ke(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?Yt(this.doc,r=>{ln(r,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return cn(this,t)}getAttributes(){return Vn(this)}_write(t){t.writeTypeRef($s)}}const Is=i=>new Te;class hn{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Re||e.constructor===Ee)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Ee extends ne{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ee}clone(){const t=new Ee;return t.insert(0,this.toArray().map(e=>e instanceof ne?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new hn(this,t)}querySelector(t){t=t.toUpperCase();const r=new hn(this,o=>o.nodeName&&o.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),pt.Dp(new hn(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Ge(this,t,new Ms(this,e,t))}toString(){return xn(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},r){const o=t.createDocumentFragment();return r!==void 0&&r._createAssociation(o,this),xe(this,l=>{o.insertBefore(l.toDOM(t,e,r),null)}),o}insert(t,e){this.doc!==null?Yt(this.doc,r=>{Pn(r,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)Yt(this.doc,r=>{const o=t&&t instanceof ne?t._item:t;ze(r,this,o,e)});else{const r=this._prelimContent,o=t===null?0:r.findIndex(l=>l===t)+1;if(o===0&&t!==null)throw a.Ue("Reference item not found");r.splice(o,0,...e)}}delete(t,e=1){this.doc!==null?Yt(this.doc,r=>{Fn(r,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return Nn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Bn(this,t)}slice(t=0,e=this.length){return Ln(this,t,e)}forEach(t){xe(this,t)}_write(t){t.writeTypeRef(Xs)}}const Us=i=>new Ee;class Re extends Ee{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((r,o)=>{this.setAttribute(o,r)}),this._prelimAttrs=null}_copy(){return new Re(this.nodeName)}clone(){const t=new Re(this.nodeName),e=this.getAttributes();return m.Ed(e,(r,o)=>{typeof r=="string"&&t.setAttribute(o,r)}),t.insert(0,this.toArray().map(r=>r instanceof ne?r.clone():r)),t}toString(){const t=this.getAttributes(),e=[],r=[];for(const E in t)r.push(E);r.sort();const o=r.length;for(let E=0;E<o;E++){const I=r[E];e.push(I+'="'+t[I]+'"')}const l=this.nodeName.toLocaleLowerCase(),p=e.length>0?" "+e.join(" "):"";return`<${l}${p}>${super.toString()}</${l}>`}removeAttribute(t){this.doc!==null?Yt(this.doc,e=>{Ke(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?Yt(this.doc,r=>{ln(r,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return cn(this,t)}hasAttribute(t){return Wn(this,t)}getAttributes(){return Vn(this)}toDOM(t=document,e={},r){const o=t.createElement(this.nodeName),l=this.getAttributes();for(const p in l){const E=l[p];typeof E=="string"&&o.setAttribute(p,E)}return xe(this,p=>{o.appendChild(p.toDOM(t,e,r))}),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(Js),t.writeKey(this.nodeName)}}const Os=i=>new Re(i.readKey());class Ms extends He{constructor(t,e,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(o=>{o===null?this.childListChanged=!0:this.attributesChanged.add(o)})}}class Be extends ve{constructor(t){super(),this.hookName=t}_copy(){return new Be(this.hookName)}clone(){const t=new Be(this.hookName);return this.forEach((e,r)=>{t.set(r,e)}),t}toDOM(t=document,e={},r){const o=e[this.hookName];let l;return o!==void 0?l=o.createDom(this):l=document.createElement(this.hookName),l.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(l,this),l}_write(t){t.writeTypeRef(Zs),t.writeKey(this.hookName)}}const Ls=i=>new Be(i.readKey());class Xe extends Te{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Xe}clone(){const t=new Xe;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,r){const o=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(o,this),o}toString(){return this.toDelta().map(t=>{const e=[];for(const o in t.attributes){const l=[];for(const p in t.attributes[o])l.push({key:p,value:t.attributes[o][p]});l.sort((p,E)=>p.key<E.key?-1:1),e.push({nodeName:o,attrs:l})}e.sort((o,l)=>o.nodeName<l.nodeName?-1:1);let r="";for(let o=0;o<e.length;o++){const l=e[o];r+=`<${l.nodeName}`;for(let p=0;p<l.attrs.length;p++){const E=l.attrs[p];r+=` ${E.key}="${E.value}"`}r+=">"}r+=t.insert;for(let o=e.length-1;o>=0;o--)r+=`</${e[o].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(qs)}}const Ns=i=>new Xe;class dn{constructor(t,e){this.id=t,this.length=e}get deleted(){throw a.Nw()}mergeWith(t){return!1}write(t,e,r){throw a.Nw()}integrate(t,e){throw a.Nw()}}const xs=0;class ae extends dn{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),bn(t.doc.store,this)}write(t,e){t.writeInfo(xs),t.writeLen(this.length-e)}getMissing(t,e){return null}}class De{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new De(this.content)}splice(t){throw a.Nw()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const Bs=i=>new De(i.readBuf());class Ae{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ae(this.len)}splice(t){const e=new Ae(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){wt(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const js=i=>new Ae(i.readLen()),Xn=(i,t)=>new at({guid:i,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ie{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ie(Xn(this.doc.guid,this.opts))}splice(t){throw a.Nw()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Ps=i=>new Ie(Xn(i.readString(),i.readAny()));class we{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new we(this.embed)}splice(t){throw a.Nw()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const Fs=i=>new we(i.readJSON());class Qt{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Qt(this.key,this.value)}splice(t){throw a.Nw()}mergeWith(t){return!1}integrate(t,e){const r=e.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Vs=i=>new Qt(i.readKey(),i.readJSON());class je{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new je(this.arr)}splice(t){const e=new je(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const r=this.arr.length;t.writeLen(r-e);for(let o=e;o<r;o++){const l=this.arr[o];t.writeString(l===void 0?"undefined":JSON.stringify(l))}}getRef(){return 2}}const Ws=i=>{const t=i.readLen(),e=[];for(let r=0;r<t;r++){const o=i.readString();o==="undefined"?e.push(void 0):e.push(JSON.parse(o))}return new je(e)};class _e{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _e(this.arr)}splice(t){const e=new _e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const r=this.arr.length;t.writeLen(r-e);for(let o=e;o<r;o++){const l=this.arr[o];t.writeAny(l)}}getRef(){return 8}}const Hs=i=>{const t=i.readLen(),e=[];for(let r=0;r<t;r++)e.push(i.readAny());return new _e(e)};class he{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new he(this.str)}splice(t){const e=new he(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",e.str="\uFFFD"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Ys=i=>new he(i.readString()),Gs=[Ss,ks,Is,Os,Us,Ls,Ns],zs=0,Ks=1,$s=2,Js=3,Xs=4,Zs=5,qs=6;class de{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new de(this.type._copy())}splice(t){throw a.Nw()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Qs=i=>new de(Gs[i.readTypeRef()](i)),fn=(i,t)=>{let e=t,r=0,o;do r>0&&(e=mt(e.client,e.clock+r)),o=Pe(i,e),r=e.clock-o.id.clock,e=o.redone;while(e!==null&&o instanceof Gt);return{item:o,diff:r}},pn=(i,t)=>{for(;i!==null&&i.keep!==t;)i.keep=t,i=i.parent._item},Ze=(i,t,e)=>{const{client:r,clock:o}=t.id,l=new Gt(mt(r,o+e),t,mt(r,o+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&l.markDeleted(),t.keep&&(l.keep=!0),t.redone!==null&&(l.redone=mt(t.redone.client,t.redone.clock+e)),t.right=l,l.right!==null&&(l.right.left=l),i._mergeStructs.push(l),l.parentSub!==null&&l.right===null&&l.parent._map.set(l.parentSub,l),t.length=e,l},Zn=(i,t)=>array.some(i,e=>P(e.deletions,t)),qn=(i,t,e,r,o,l)=>{const p=i.doc,E=p.store,I=p.clientID,F=t.redone;if(F!==null)return ie(i,F);let j=t.parent._item,W=null,Q;if(j!==null&&j.deleted===!0){if(j.redone===null&&(!e.has(j)||qn(i,j,e,r,o,l)===null))return null;for(;j.redone!==null;)j=ie(i,j.redone)}const et=j===null?t.parent:j.content.type;if(t.parentSub===null){for(W=t.left,Q=t;W!==null;){let Jt=W;for(;Jt!==null&&Jt.parent._item!==j;)Jt=Jt.redone===null?null:ie(i,Jt.redone);if(Jt!==null&&Jt.parent._item===j){W=Jt;break}W=W.left}for(;Q!==null;){let Jt=Q;for(;Jt!==null&&Jt.parent._item!==j;)Jt=Jt.redone===null?null:ie(i,Jt.redone);if(Jt!==null&&Jt.parent._item===j){Q=Jt;break}Q=Q.right}}else if(Q=null,t.right&&!o){for(W=t;W!==null&&W.right!==null&&(W.right.redone||P(r,W.right.id)||Zn(l.undoStack,W.right.id)||Zn(l.redoStack,W.right.id));)for(W=W.right;W.redone;)W=ie(i,W.redone);if(W&&W.right!==null)return null}else W=et._map.get(t.parentSub)||null;const ft=$t(E,I),Lt=mt(I,ft),Kt=new Gt(Lt,W,W&&W.lastId,Q,Q&&Q.id,et,t.parentSub,t.content.copy());return t.redone=Lt,pn(Kt,!0),Kt.integrate(i,0),Kt};class Gt extends dn{constructor(t,e,r,o,l,p,E,I){super(t,I.getLength()),this.origin=r,this.left=e,this.right=o,this.rightOrigin=l,this.parent=p,this.parentSub=E,this.redone=null,this.content=I,this.info=this.content.isCountable()?w.Qn:0}set marker(t){(this.info&w.Ko)>0!==t&&(this.info^=w.Ko)}get marker(){return(this.info&w.Ko)>0}get keep(){return(this.info&w.Vw)>0}set keep(t){this.keep!==t&&(this.info^=w.Vw)}get countable(){return(this.info&w.Qn)>0}get deleted(){return(this.info&w.CY)>0}set deleted(t){this.deleted!==t&&(this.info^=w.CY)}markDeleted(){this.info|=w.CY}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=$t(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=$t(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===st&&this.id.client!==this.parent.client&&this.parent.clock>=$t(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=wn(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ie(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ae||this.right&&this.right.constructor===ae)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Gt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Gt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===st){const r=Pe(e,this.parent);r.constructor===ae?this.parent=null:this.parent=r.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=wn(t,t.doc.store,mt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,o;if(r!==null)o=r.right;else if(this.parentSub!==null)for(o=this.parent._map.get(this.parentSub)||null;o!==null&&o.left!==null;)o=o.left;else o=this.parent._start;const l=new Set,p=new Set;for(;o!==null&&o!==this.right;){if(p.add(o),l.add(o),yt(this.origin,o.origin)){if(o.id.client<this.id.client)r=o,l.clear();else if(yt(this.rightOrigin,o.rightOrigin))break}else if(o.origin!==null&&p.has(Pe(t.doc.store,o.origin)))l.has(Pe(t.doc.store,o.origin))||(r=o,l.clear());else break;o=o.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),bn(t.doc.store,this),this.content.integrate(t,this),En(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ae(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:mt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&yt(t.origin,this.lastId)&&this.right===t&&yt(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),wt(t.deleteSet,this.id.client,this.id.clock,this.length),En(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw a.zR();this.content.gc(t),e?is(t,this,new ae(this.id,this.length)):this.content=new Ae(this.length)}write(t,e){const r=e>0?mt(this.id.client,this.id.clock+e-1):this.origin,o=this.rightOrigin,l=this.parentSub,p=this.content.getRef()&w.kr|(r===null?0:w.x1)|(o===null?0:w.rc)|(l===null?0:w.cq);if(t.writeInfo(p),r!==null&&t.writeLeftID(r),o!==null&&t.writeRightID(o),r===null&&o===null){const E=this.parent;if(E._item!==void 0){const I=E._item;if(I===null){const F=zt(E);t.writeParentInfo(!0),t.writeString(F)}else t.writeParentInfo(!1),t.writeLeftID(I.id)}else E.constructor===String?(t.writeParentInfo(!0),t.writeString(E)):E.constructor===st?(t.writeParentInfo(!1),t.writeLeftID(E)):a.zR();l!==null&&t.writeString(l)}this.content.write(t,e)}}const Qn=(i,t)=>tr[t&w.kr](i),tr=[()=>{a.zR()},js,Ws,Bs,Ys,Fs,Vs,Qs,Hs,Ps,()=>{a.zR()}],er=10;class le extends dn{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){a.zR()}write(t,e){t.writeInfo(er),D.uE(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const ts=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof $.g!="undefined"?$.g:{},es="__ $YJS$ __";ts[es]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),ts[es]=!0}}]);})();
