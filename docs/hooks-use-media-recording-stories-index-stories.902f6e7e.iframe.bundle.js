"use strict";(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[8260],{"../ai-client/src/hooks/use-media-recording/stories/index.stories.tsx":(re,S,y)=>{var C,_,k;y.r(S),y.d(S,{Default:()=>f,__namedExportsOrder:()=>G,default:()=>W});var v=y("../../../node_modules/.pnpm/@wordpress+components@27.3.0_@types+react@18.2.74_react-dom@18.2.0_react@18.2.0/node_modules/@wordpress/components/build-module/button/index.js"),n=y("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");function z(s,{addDecimalPart:e=!1,showMinutes:c=!0,showHours:i=!1}={}){const u=Math.floor(s/36e5),o=Math.floor(s/6e4)%60,g=Math.floor(s/1e3)%60,l=Math.floor(s/10)%100,p=[u>0||i?u.toString().padStart(2,"0")+":":"",u>0||o>0||c?o.toString().padStart(2,"0")+":":"",g.toString().padStart(2,"0")];return e&&p.push("."+l.toString().padStart(2,"0")),p.join("")}var r=y("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function K({duration:s,className:e}){return(0,r.jsx)("span",{className:e,children:z(s,{addDecimalPart:!1})})}try{audiodurationdisplay.displayName="audiodurationdisplay",audiodurationdisplay.__docgenInfo={description:"AudioDurationDisplay component.",displayName:"audiodurationdisplay",props:{duration:{defaultValue:null,description:"",name:"duration",required:!0,type:{name:"number"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["../ai-client/src/components/audio-duration-display/index.tsx#audiodurationdisplay"]={docgenInfo:audiodurationdisplay.__docgenInfo,name:"audiodurationdisplay",path:"../ai-client/src/components/audio-duration-display/index.tsx#audiodurationdisplay"})}catch(s){}const h="audio/mp4;codecs=mp4a",U="audio/mp4",j="audio/webm";function V({onDone:s}={}){const e=(0,n.useRef)(null),[c,i]=(0,n.useState)("inactive"),u=(0,n.useRef)(!1),o=(0,n.useRef)(0),[g,l]=(0,n.useState)(0),p=(0,n.useRef)(null),[H,D]=(0,n.useState)(null),x=(0,n.useRef)([]).current,[Q,M]=(0,n.useState)(null),b=(0,n.useRef)(null);function L(){return MediaRecorder.isTypeSupported(h)?new Blob(x,{type:U}):new Blob(x,{type:j})}const X=(0,n.useCallback)(t=>{var a,m;if(A(),!t)return(a=e==null?void 0:e.current)==null?void 0:a.start();t<100&&(t=100),o.current=Date.now(),(m=e==null?void 0:e.current)==null||m.start(t)},[]),q=(0,n.useCallback)(()=>{var t;u.current=!0,(t=e==null?void 0:e.current)==null||t.pause(),l(a=>a+Date.now()-o.current)},[]),R=(0,n.useCallback)(()=>{var t;u.current=!1,(t=e==null?void 0:e.current)==null||t.resume(),o.current=Date.now()},[]),T=(0,n.useCallback)(()=>{var t;(t=e==null?void 0:e.current)==null||t.stop(),c==="recording"&&l(a=>a+Date.now()-o.current)},[]),A=(0,n.useCallback)(()=>{x.length=0,D(null),M(null),l(0),u.current=!1,o.current=0},[]),P=(0,n.useCallback)(()=>{e!=null&&e.current&&(e.current.removeEventListener("start",B),e.current.removeEventListener("stop",O),e.current.removeEventListener("pause",I),e.current.removeEventListener("resume",N),e.current.removeEventListener("dataavailable",Y),e.current=null)},[]),w=(0,n.useCallback)(()=>{var m;if(i("inactive"),A(),P(),!((m=navigator.mediaDevices)!=null&&m.getUserMedia))return;const t=new AudioContext;b.current=t.createAnalyser();const a={audio:!0};navigator.mediaDevices.getUserMedia(a).then(d=>{p.current=d,t.createMediaStreamSource(d).connect(b.current),MediaRecorder.isTypeSupported(h)?e.current=new MediaRecorder(d,{mimeType:h}):e.current=new MediaRecorder(d,{mimeType:j}),e.current.addEventListener("start",B),e.current.addEventListener("stop",O),e.current.addEventListener("pause",I),e.current.addEventListener("resume",N),e.current.addEventListener("dataavailable",Y)}).catch(d=>{throw d})},[]),ee=(0,n.useCallback)(t=>{T(),M(typeof t=="string"?t:t.message),i("error")},[]);function B(){i("recording")}function O(){const t=L();s==null||s(t),x.length=0}function I(){i("paused")}function N(){i("recording")}function Y(t){const{data:a}=t;a!=null&&a.size&&(x.push(a),D(L()),u.current||l(m=>{const d=Date.now(),Z=d-o.current;return o.current=d,m+Z}))}function te(){p.current&&p.current.getTracks().forEach(a=>a.stop())}return(0,n.useEffect)(()=>(w(),()=>{te(),P()}),[]),{state:c,blob:H,error:Q,duration:g,analyser:b.current,onError:ee,controls:{start:X,pause:q,resume:R,stop:T,reset:w}}}const E=({timeslice:s})=>{const{controls:e,state:c,blob:i,duration:u}=V(),{start:o,pause:g,resume:l,stop:p}=e;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{fontFamily:"monospace",display:"flex",flexDirection:"column",gap:"10px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:"State: "}),(0,r.jsx)("strong",{children:c})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("span",{children:["Blob: ",(0,r.jsx)("strong",{children:i?`${i.size} - type: ${i.type}`:"No blob"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:"Duration: "}),(0,r.jsx)("strong",{children:(0,r.jsx)(K,{duration:u})})]})]}),(0,r.jsx)("br",{}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"1px"},children:[(0,r.jsx)(v.ZP,{variant:"primary",onClick:()=>o(s),disabled:c!=="inactive",children:"Begin recording"}),(0,r.jsx)(v.ZP,{variant:"primary",onClick:()=>g(),disabled:c!=="recording",children:"Pause"}),(0,r.jsx)(v.ZP,{variant:"primary",onClick:()=>l(),disabled:c!=="paused",children:"Resume"}),(0,r.jsx)(v.ZP,{variant:"primary",onClick:()=>p(),disabled:c==="inactive",children:"Stop"})]})]})},$={title:"JS Packages/AI Client/useMediaRecording",component:E,argTypes:{timeslice:{control:{type:"number"}}}},F=s=>(0,r.jsx)(E,{...s}),J={timeslice:1e3},f=F.bind({});f.args=J;const W=$;f.parameters={...f.parameters,docs:{...(C=f.parameters)==null?void 0:C.docs,source:{originalSource:"args => <RecorderComponent {...args} />",...(k=(_=f.parameters)==null?void 0:_.docs)==null?void 0:k.source}}};const G=["Default"]}}]);})();
