"use strict";(()=>{var Nt=Object.defineProperty;var Ot=(C,c,n)=>c in C?Nt(C,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):C[c]=n;var Z=(C,c,n)=>(Ot(C,typeof c!="symbol"?c+"":c,n),n);(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[630],{"../connection/components/use-connection/index.jsx":(C,c,n)=>{n.d(c,{Z:()=>p});var r=n("../api/index.jsx"),u=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-dispatch/use-dispatch.js"),T=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),i=n("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),s=n("../connection/state/store.jsx");const a=window!=null&&window.JP_CONNECTION_INITIAL_STATE?window.JP_CONNECTION_INITIAL_STATE:{},p=({registrationNonce:N=a.registrationNonce,apiRoot:m=a.apiRoot,apiNonce:g=a.apiNonce,redirectUri:E,autoTrigger:A,from:h,skipUserConnection:U}={})=>{const{registerSite:I,connectUser:d,refreshConnectedPlugins:l}=(0,u.Z)(s.t),R=(0,T.Z)(_=>_(s.t).getRegistrationError()),{siteIsRegistering:S,userIsConnecting:O,userConnectionData:f,connectedPlugins:y,connectionErrors:D,isRegistered:P,isUserConnected:v,hasConnectedOwner:Y,isOfflineMode:H}=(0,T.Z)(_=>({siteIsRegistering:_(s.t).getSiteIsRegistering(),userIsConnecting:_(s.t).getUserIsConnecting(),userConnectionData:_(s.t).getUserConnectionData(),connectedPlugins:_(s.t).getConnectedPlugins(),connectionErrors:_(s.t).getConnectionErrors(),isOfflineMode:_(s.t).getIsOfflineMode(),..._(s.t).getConnectionStatus()})),w=()=>{if(U){if(E)return window.location=E,Promise.resolve(E)}else return d({from:h,redirectUri:E});return Promise.resolve()},j=_=>(_&&_.preventDefault(),P?w():I({registrationNonce:N,redirectUri:E}).then(()=>w()));return(0,i.useEffect)(()=>{r.ZP.setApiRoot(m),r.ZP.setApiNonce(g)},[m,g]),(0,i.useEffect)(()=>{A&&!S&&!O&&j()},[]),{handleRegisterSite:j,handleConnectUser:w,refreshConnectedPlugins:l,isRegistered:P,isUserConnected:v,siteIsRegistering:S,userIsConnecting:O,registrationError:R,userConnectionData:f,hasConnectedOwner:Y,connectedPlugins:y,connectionErrors:D,isOfflineMode:H}}},"../connection/state/store.jsx":(C,c,n)=>{n.d(c,{t:()=>x});var r=n("../api/index.jsx");const u="SET_CONNECTION_STATUS",T="SET_CONNECTION_STATUS_IS_FETCHING",i="FETCH_CONNECTION_STATUS",s="SET_SITE_IS_REGISTERING",a="SET_USER_IS_CONNECTING",p="SET_REGISTRATION_ERROR",N="CLEAR_REGISTRATION_ERROR",m="REGISTER_SITE",g="SET_AUTHORIZATION_URL",E="CONNECT_USER",A="DISCONNECT_USER_SUCCESS",h="FETCH_AUTHORIZATION_URL",U="SET_CONNECTED_PLUGINS",I="REFRESH_CONNECTED_PLUGINS",d="SET_CONNECTION_ERRORS",l="SET_IS_OFFLINE_MODE",R=t=>({type:u,connectionStatus:t}),S=t=>({type:T,isFetching:t}),O=()=>({type:i}),f=t=>({type:s,isRegistering:t}),y=t=>({type:a,isConnecting:t}),D=()=>({type:A}),P=t=>({type:p,registrationError:t}),v=()=>({type:N}),Y=t=>({type:g,authorizationUrl:t}),H=t=>({type:h,redirectUri:t}),w=t=>({type:U,connectedPlugins:t}),j=t=>({type:d,connectionErrors:t}),_=t=>({type:l,isOfflineMode:t});function*W({from:t,redirectFunc:e,redirectUri:o}={}){yield y(!0),yield{type:E,from:t,redirectFunc:e,redirectUri:o}}function*Q({registrationNonce:t,redirectUri:e}){yield v(),yield f(!0);try{const o=yield{type:m,registrationNonce:t,redirectUri:e};return yield R({isRegistered:!0}),yield Y(o.authorizeUrl),yield f(!1),Promise.resolve(o)}catch(o){return yield P(o),yield f(!1),Promise.reject(o)}}const M={setConnectionStatus:R,setConnectionStatusIsFetching:S,fetchConnectionStatus:O,fetchAuthorizationUrl:H,setSiteIsRegistering:f,setUserIsConnecting:y,setRegistrationError:P,clearRegistrationError:v,setAuthorizationUrl:Y,registerSite:Q,connectUser:W,disconnectUserSuccess:D,setConnectedPlugins:w,refreshConnectedPlugins:()=>async({dispatch:t})=>await new Promise(e=>r.ZP.fetchConnectedPlugins().then(o=>{t(w(o)),e(o)})),setConnectionErrors:j,setIsOfflineMode:_};var J=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/factory.js");const x="jetpack-connection",$=({registrationNonce:t,redirectUri:e})=>r.ZP.registerSite(t,e),V=(0,J.R)(({resolveSelect:t})=>({from:e,redirectFunc:o,redirectUri:F}={})=>new Promise((St,Ct)=>{t(x).getAuthorizationUrl(F).then(K=>{const Rt=o||(pt=>window.location.assign(pt)),b=new URL(K);e&&b.searchParams.set("from",encodeURIComponent(e));const z=b.toString();Rt(z),St(z)}).catch(K=>{Ct(K)})})),X={FETCH_AUTHORIZATION_URL:({redirectUri:t})=>r.ZP.fetchAuthorizationUrl(t),REGISTER_SITE:$,CONNECT_USER:V};var B=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const q=(t={},e)=>{switch(e.type){case u:return{...t,...e.connectionStatus};case A:return{...t,isUserConnected:!1}}return t},tt=(t={},e)=>{switch(e.type){case U:return e.connectedPlugins}return t},et=(t=!1,e)=>{switch(e.type){case T:return e.isFetching}return t},nt=(t=!1,e)=>{switch(e.type){case s:return e.isRegistering}return t},ot=(t=!1,e)=>{switch(e.type){case a:return e.isConnecting}return t},st=(t,e)=>{switch(e.type){case N:return!1;case p:return e.registrationError;default:return t}},rt=(t,e)=>{switch(e.type){case g:return e.authorizationUrl;default:return t}},ct=(t,e)=>{switch(e.type){default:return t}},it=(t={},e)=>{switch(e.type){case d:return e.connectionErrors}return t},at=(t=!1,e)=>{switch(e.type){case l:return e.isConnecting}return t},_t=(0,B.UY)({connectionStatus:q,connectionStatusIsFetching:et,siteIsRegistering:nt,userIsConnecting:ot,registrationError:st,authorizationUrl:rt,userConnectionData:ct,connectedPlugins:tt,connectionErrors:it,isOfflineMode:at});var ut=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/select.js"),Et=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/dispatch.js");const dt={...{getAuthorizationUrl:{isFulfilled:(t,...e)=>{const o=!!t.authorizationUrl,F=(0,ut.Y)(x).hasFinishedResolution("getAuthorizationUrl",e);return o&&!F&&(0,Et.W)(x).finishResolution("getAuthorizationUrl",e),o},*fulfill(t){const e=yield M.fetchAuthorizationUrl(t);yield M.setAuthorizationUrl(e.authorizeUrl)}}}},lt={...{getConnectionStatus:t=>t.connectionStatus||{},getConnectionStatusIsFetching:()=>!1,getSiteIsRegistering:t=>t.siteIsRegistering||!1,getUserIsConnecting:t=>t.userIsConnecting||!1,getRegistrationError:t=>t.registrationError||!1,getAuthorizationUrl:t=>t.authorizationUrl||!1,getUserConnectionData:t=>t.userConnectionData||!1,getConnectedPlugins:t=>t.connectedPlugins||[],getConnectionErrors:t=>t.connectionErrors||[],getIsOfflineMode:t=>t.isOfflineMode||!1,getWpcomUser:t=>{var e,o;return(o=(e=t==null?void 0:t.userConnectionData)==null?void 0:e.currentUser)==null?void 0:o.wpcomUser},getBlogId:t=>{var e,o;return(o=(e=t==null?void 0:t.userConnectionData)==null?void 0:e.currentUser)==null?void 0:o.blogId}}};var Tt=n("../../../node_modules/.pnpm/@wordpress+data@9.24.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");const L=class{static mayBeInit(e,o){L.store===null&&(L.store=(0,Tt.Z)(e,o),(0,B.z2)(L.store))}};let k=L;Z(k,"store",null);const It=k,G=window.JP_CONNECTION_INITIAL_STATE;G||console.error("Jetpack Connection package: Initial state is missing. Check documentation to see how to use the Connection composer package to set up the initial state."),It.mayBeInit(x,{__experimentalUseThunks:!0,reducer:_t,actions:M,selectors:lt,resolvers:dt,controls:X,initialState:G||{}})},"../../packages/my-jetpack/_inc/data/constants.ts":(C,c,n)=>{n.d(c,{Jk:()=>N,Kf:()=>S,LQ:()=>T,RQ:()=>O,Vu:()=>y,YF:()=>g,_H:()=>i,db:()=>I,h3:()=>D,hd:()=>s,iG:()=>h,n2:()=>m,q9:()=>A,yv:()=>U});const r="my-jetpack/v1",u="jetpack/v4/stats-app",T=`${r}/site/purchases`,i=`${r}/site/backup/undo-event`,s=`${r}/site/backup/count-items`,a=`${r}/chat/availability`,p=`${r}/chat/authentication`,N=`${r}/site/products`,m="videopress/v1/stats/featured",g=`${r}/site/dismiss-welcome-banner`,E=P=>`${u}/sites/${P}/stats/highlights`,A="product",h="activate product",U="install product",I="videopress stats",d="available licenses",l="chat availability",R="chat authentication",S="backup history",O="backup stats",f="stats counts",y="dismiss welcome banner",D="purchases"},"../../packages/my-jetpack/_inc/data/notices/use-fetching-error-notice.ts":(C,c,n)=>{n.d(c,{o:()=>U});var r=n("../../../node_modules/.pnpm/@wordpress+i18n@4.54.0/node_modules/@wordpress/i18n/build-module/index.js"),u=n("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");const T=100,i=200,s=300;var a=n("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const p={message:"",options:{level:"",priority:0,isRedBubble:!1}},N=(0,u.createContext)({currentNotice:p,setNotice:null,resetNotice:null}),m=({children:I})=>{const[d,l]=useState(p),R=O=>{(!d.message||O.options.priority>d.options.priority)&&l(O)},S=()=>{l(p)};return _jsx(N.Provider,{value:{currentNotice:d,setNotice:R,resetNotice:S},children:I})},g=null;try{noticeContext.displayName="noticeContext",noticeContext.__docgenInfo={description:"",displayName:"noticeContext",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["../../packages/my-jetpack/_inc/context/notices/noticeContext.tsx#noticeContext"]={docgenInfo:noticeContext.__docgenInfo,name:"noticeContext",path:"../../packages/my-jetpack/_inc/context/notices/noticeContext.tsx#noticeContext"})}catch(I){}var E=n("../../packages/my-jetpack/_inc/data/constants.ts");const A=r.__,h=[E.h3,E.iG,E.yv],U=({infoName:I,isError:d,overrideMessage:l})=>{const{setNotice:R}=(0,u.useContext)(N),S=l!=null?l:(0,r.gB)(A("There was an error fetching your %s information. Check your site connectivity and try again.","jetpack-my-jetpack"),I);(0,u.useEffect)(()=>{d&&h.includes(I)&&R({message:S,options:{level:"error",priority:T}})},[S,R,d,I])}},"../../packages/my-jetpack/_inc/data/utils/get-my-jetpack-window-state.ts":(C,c,n)=>{n.d(c,{$9:()=>r,M_:()=>u,vH:()=>T});const r=i=>{var s,a;return i?(a=(s=window==null?void 0:window.myJetpackInitialState)==null?void 0:s[i])!=null?a:{}:window==null?void 0:window.myJetpackInitialState},u=()=>{var i;return(i=window==null?void 0:window.myJetpackRest)!=null?i:{}},T=i=>{var s,a;return i?(a=(s=window==null?void 0:window.JP_CONNECTION_INITIAL_STATE)==null?void 0:s[i])!=null?a:{}:window==null?void 0:window.JP_CONNECTION_INITIAL_STATE}}}]);})();
