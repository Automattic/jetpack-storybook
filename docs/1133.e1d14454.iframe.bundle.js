"use strict";(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[1133],{"../connection/components/use-connection/index.jsx":(ot,L,i)=>{i.d(L,{Z:()=>p});var m=i("../api/index.jsx"),u=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-dispatch/use-dispatch.js"),S=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),A=i("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),c=i("../connection/state/store.jsx");const l=window!=null&&window.JP_CONNECTION_INITIAL_STATE?window.JP_CONNECTION_INITIAL_STATE:{},p=function(){let{registrationNonce:R=l.registrationNonce,apiRoot:v=l.apiRoot,apiNonce:f=l.apiNonce,redirectUri:g,autoTrigger:O,from:F,skipUserConnection:I}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{registerSite:K,connectUser:D,refreshConnectedPlugins:M}=(0,u.Z)(c.t),w=(0,S.Z)(_=>_(c.t).getRegistrationError()),{siteIsRegistering:b,userIsConnecting:k,userConnectionData:N,connectedPlugins:Z,connectionErrors:V,isRegistered:y,isUserConnected:U,hasConnectedOwner:H,isOfflineMode:x}=(0,S.Z)(_=>({siteIsRegistering:_(c.t).getSiteIsRegistering(),userIsConnecting:_(c.t).getUserIsConnecting(),userConnectionData:_(c.t).getUserConnectionData(),connectedPlugins:_(c.t).getConnectedPlugins(),connectionErrors:_(c.t).getConnectionErrors(),isOfflineMode:_(c.t).getIsOfflineMode(),..._(c.t).getConnectionStatus()})),T=()=>{if(I){if(g)return window.location=g,Promise.resolve(g)}else return D({from:F,redirectUri:g});return Promise.resolve()},j=_=>(_&&_.preventDefault(),y?T():K({registrationNonce:R,redirectUri:g}).then(()=>T()));return(0,A.useEffect)(()=>{m.ZP.setApiRoot(v),m.ZP.setApiNonce(f)},[v,f]),(0,A.useEffect)(()=>{O&&!b&&!k&&j()},[]),{handleRegisterSite:j,handleConnectUser:T,refreshConnectedPlugins:M,isRegistered:y,isUserConnected:U,siteIsRegistering:b,userIsConnecting:k,registrationError:w,userConnectionData:N,hasConnectedOwner:H,connectedPlugins:Z,connectionErrors:V,isOfflineMode:x}}},"../connection/state/store.jsx":(ot,L,i)=>{i.d(L,{t:()=>J});var m=i("../api/index.jsx");const u="SET_CONNECTION_STATUS",S="SET_CONNECTION_STATUS_IS_FETCHING",A="FETCH_CONNECTION_STATUS",c="SET_SITE_IS_REGISTERING",l="SET_USER_IS_CONNECTING",p="SET_REGISTRATION_ERROR",R="CLEAR_REGISTRATION_ERROR",v="REGISTER_SITE",f="SET_AUTHORIZATION_URL",g="CONNECT_USER",O="DISCONNECT_USER_SUCCESS",F="FETCH_AUTHORIZATION_URL",I="SET_CONNECTED_PLUGINS",K="REFRESH_CONNECTED_PLUGINS",D="SET_CONNECTION_ERRORS",M="SET_IS_OFFLINE_MODE",w=n=>({type:u,connectionStatus:n}),b=n=>({type:S,isFetching:n}),k=()=>({type:A}),N=n=>({type:c,isRegistering:n}),Z=n=>({type:l,isConnecting:n}),V=()=>({type:O}),y=n=>({type:p,registrationError:n}),U=()=>({type:R}),H=n=>({type:f,authorizationUrl:n}),x=n=>({type:F,redirectUri:n}),T=n=>({type:I,connectedPlugins:n}),j=n=>({type:D,connectionErrors:n}),_=n=>({type:M,isOfflineMode:n});function z(){let{from:n,redirectFunc:o,redirectUri:d}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){yield Z(!0),yield{type:g,from:n,redirectFunc:o,redirectUri:d}}()}function _t(n){let{registrationNonce:o,redirectUri:d}=n;return function*(){yield U(),yield N(!0);try{const C=yield{type:v,registrationNonce:o,redirectUri:d};return yield w({isRegistered:!0}),yield H(C.authorizeUrl),yield N(!1),Promise.resolve(C)}catch(C){return yield y(C),yield N(!1),Promise.reject(C)}}()}const nt={setConnectionStatus:w,setConnectionStatusIsFetching:b,fetchConnectionStatus:k,fetchAuthorizationUrl:x,setSiteIsRegistering:N,setUserIsConnecting:Z,setRegistrationError:y,clearRegistrationError:U,setAuthorizationUrl:H,registerSite:_t,connectUser:z,disconnectUserSuccess:V,setConnectedPlugins:T,refreshConnectedPlugins:()=>async n=>{let{dispatch:o}=n;return await new Promise(d=>m.ZP.fetchConnectedPlugins().then(C=>{o(T(C)),d(C)}))},setConnectionErrors:j,setIsOfflineMode:_};var Et=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/factory.js");const J="jetpack-connection",ht=n=>{let{registrationNonce:o,redirectUri:d}=n;return m.ZP.registerSite(o,d)},mt=(0,Et.R)(n=>{let{resolveSelect:o}=n;return function(){let{from:d,redirectFunc:C,redirectUri:X}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((rt,Nt)=>{o(J).getAuthorizationUrl(X).then(ct=>{const Zt=C||(yt=>window.location.assign(yt)),ut=new URL(ct);d&&ut.searchParams.set("from",encodeURIComponent(d));const lt=ut.toString();Zt(lt),rt(lt)}).catch(ct=>{Nt(ct)})})}}),pt={FETCH_AUTHORIZATION_URL:n=>{let{redirectUri:o}=n;return m.ZP.fetchAuthorizationUrl(o)},REGISTER_SITE:ht,CONNECT_USER:mt};var tt=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const Y=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case u:return{...n,...o.connectionStatus};case O:return{...n,isUserConnected:!1}}return n},Tt=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case I:return o.connectedPlugins}return n},Q=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case S:return o.isFetching}return n},St=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case c:return o.isRegistering}return n},B=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case l:return o.isConnecting}return n},it=(n,o)=>{switch(o.type){case R:return!1;case p:return o.registrationError;default:return n}},jt=(n,o)=>{switch(o.type){case f:return o.authorizationUrl;default:return n}},Lt=(n,o)=>{switch(o.type){default:return n}},Dt=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case D:return o.connectionErrors}return n},wt=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case M:return o.isConnecting}return n},bt=(0,tt.UY)({connectionStatus:Y,connectionStatusIsFetching:Q,siteIsRegistering:St,userIsConnecting:B,registrationError:it,authorizationUrl:jt,userConnectionData:Lt,connectedPlugins:Tt,connectionErrors:Dt,isOfflineMode:wt});var kt=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/select.js"),Ct=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/dispatch.js");const At={...{getAuthorizationUrl:{isFulfilled:function(n){const o=!!n.authorizationUrl;for(var d=arguments.length,C=new Array(d>1?d-1:0),X=1;X<d;X++)C[X-1]=arguments[X];const rt=(0,kt.Y)(J).hasFinishedResolution("getAuthorizationUrl",C);return o&&!rt&&(0,Ct.W)(J).finishResolution("getAuthorizationUrl",C),o},*fulfill(n){const o=yield nt.fetchAuthorizationUrl(n);yield nt.setAuthorizationUrl(o.authorizeUrl)}}}},It={...{getConnectionStatus:n=>n.connectionStatus||{},getConnectionStatusIsFetching:()=>!1,getSiteIsRegistering:n=>n.siteIsRegistering||!1,getUserIsConnecting:n=>n.userIsConnecting||!1,getRegistrationError:n=>n.registrationError||!1,getAuthorizationUrl:n=>n.authorizationUrl||!1,getUserConnectionData:n=>n.userConnectionData||!1,getConnectedPlugins:n=>n.connectedPlugins||[],getConnectionErrors:n=>n.connectionErrors||[],getIsOfflineMode:n=>n.isOfflineMode||!1,getWpcomUser:n=>{var o,d;return(d=(o=n==null?void 0:n.userConnectionData)==null?void 0:o.currentUser)==null?void 0:d.wpcomUser},getBlogId:n=>{var o,d;return(d=(o=n==null?void 0:n.userConnectionData)==null?void 0:o.currentUser)==null?void 0:d.blogId}}};var Pt=i("../../../node_modules/.pnpm/@babel+runtime@7.22.6/node_modules/@babel/runtime/helpers/defineProperty.js"),Rt=i.n(Pt),Ot=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");class W{static mayBeInit(o,d){W.store===null&&(W.store=(0,Ot.Z)(o,d),(0,tt.z2)(W.store))}}Rt()(W,"store",null);const Mt=W,at=window.JP_CONNECTION_INITIAL_STATE;at||console.error("Jetpack Connection package: Initial state is missing. Check documentation to see how to use the Connection composer package to set up the initial state."),Mt.mayBeInit(J,{__experimentalUseThunks:!0,reducer:bt,actions:nt,selectors:It,resolvers:At,controls:pt,initialState:at||{}})},"../../packages/my-jetpack/_inc/components/product-card/action-buton.jsx":(ot,L,i)=>{i.d(L,{N:()=>p,Z:()=>v});var m=i("../components/components/button/index.tsx"),u=i("../../../node_modules/.pnpm/@wordpress+i18n@4.38.0/node_modules/@wordpress/i18n/build-module/index.js"),S=i("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),A=i("../../packages/my-jetpack/_inc/hooks/use-product/index.js"),c=i("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const l=u.__,p={ACTIVE:"active",INACTIVE:"inactive",ERROR:"error",ABSENT:"plugin_absent",ABSENT_WITH_PLAN:"plugin_absent_with_plan",NEEDS_PURCHASE:"needs_purchase",NEEDS_PURCHASE_OR_FREE:"needs_purchase_or_free"},R=f=>{let{status:g,admin:O,name:F,slug:I,onActivate:K,onManage:D,onFixConnection:M,isFetching:w,isInstallingStandalone:b,isDeactivatingStandalone:k,className:N,onAdd:Z}=f;const{detail:V}=(0,A.i)(I),{manageUrl:y,purchaseUrl:U}=V,H=!y;if(!O)return(0,c.jsx)(m.Z,{...T,size:"small",variant:"link",weight:"regular",children:(0,u.gB)(l("Learn about %s","jetpack-my-jetpack"),F)});const x=w||b||k,T={variant:x?void 0:"primary",disabled:x,className:N};switch(g){case p.ABSENT:case p.ABSENT_WITH_PLAN:return(0,c.jsxs)(m.Z,{...T,href:`#/add-${I}`,size:"small",variant:"link",weight:"regular",children:[g===p.ABSENT&&(0,u.gB)(l("Get %s","jetpack-my-jetpack"),F),g===p.ABSENT_WITH_PLAN&&(0,u.gB)(l("Install %s","jetpack-my-jetpack"),F)]});case p.NEEDS_PURCHASE:{const j=l("Upgrade","jetpack-my-jetpack"),_=l("Purchase","jetpack-my-jetpack"),z=U?j:_;return(0,c.jsx)(m.Z,{...T,href:U||`#/add-${I}`,size:"small",weight:"regular",onClick:Z,children:z})}case p.NEEDS_PURCHASE_OR_FREE:return(0,c.jsx)(m.Z,{...T,href:`#/add-${I}`,size:"small",weight:"regular",onClick:Z,children:l("Start for free","jetpack-my-jetpack")});case p.ACTIVE:{const j=l("View","jetpack-my-jetpack"),_=l("Manage","jetpack-my-jetpack"),z=U?j:_;return(0,c.jsx)(m.Z,{...T,disabled:H||(T==null?void 0:T.disabled),size:"small",weight:"regular",variant:"secondary",href:y,onClick:D,children:z})}case p.ERROR:return(0,c.jsx)(m.Z,{...T,href:"#/connection",size:"small",weight:"regular",onClick:M,children:l("Fix connection","jetpack-my-jetpack")});case p.INACTIVE:return(0,c.jsx)(m.Z,{...T,size:"small",weight:"regular",variant:"secondary",onClick:K,children:l("Activate","jetpack-my-jetpack")});default:return null}};R.__docgenInfo={description:"",methods:[],displayName:"ActionButton"};const v=R},"../../packages/my-jetpack/_inc/hooks/use-product/index.js":(ot,L,i)=>{i.d(L,{i:()=>A});var m=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-dispatch/use-dispatch.js"),u=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),S=i("../../packages/my-jetpack/_inc/state/store.js");function A(c){const{activateProduct:l,deactivateProduct:p,installStandalonePluginForProduct:R,deactivateStandalonePluginForProduct:v}=(0,m.Z)(S.t),f=(0,u.Z)(g=>g(S.t).getProduct(c));return{activate:()=>l(c),deactivate:()=>p(c),deactivateStandalonePlugin:()=>v(c),installStandalonePlugin:()=>R(c),productsList:(0,u.Z)(g=>g(S.t).getProducts()),detail:f,isActive:f.status==="active",isFetching:(0,u.Z)(g=>g(S.t).isFetching(c)),stats:(0,u.Z)(g=>g(S.t).getProductStats(c))}}},"../../packages/my-jetpack/_inc/state/store.js":(ot,L,i)=>{i.d(L,{t:()=>zt,N:()=>Xt});var m=i("../connection/state/store.jsx"),u=i("../../../node_modules/.pnpm/@wordpress+api-fetch@6.35.0/node_modules/@wordpress/api-fetch/build-module/index.js"),S=i("../../../node_modules/.pnpm/@wordpress+i18n@4.38.0/node_modules/@wordpress/i18n/build-module/index.js");const A="my-jetpack/v1",c=`${A}/site/purchases`,l=`${A}/site/products`,p=`${A}/chat/availability`,R=`${A}/chat/authentication`,v=["scan"],f="videopress",g="videopress/v1/stats/featured",O=S.__,F="SET_PURCHASES_IS_FETCHING",I="FETCH_PURCHASES",K="SET_PURCHASES",D="SET_AVAILABLE_LICENSES_IS_FETCHING",M="FETCH_AVAILABLE_LICENSES",w="SET_AVAILABLE_LICENSES",b="SET_IS_FETCHING_PRODUCT",k="SET_PRODUCT",N="SET_PRODUCT_REQUEST_ERROR",Z="ACTIVATE_PRODUCT",V="SET_PRODUCT_STATUS",y="SET_CHAT_AVAILABILITY_IS_FETCHING",U="SET_CHAT_AVAILABILITY",H="SET_CHAT_AUTHENTICATION_IS_FETCHING",x="SET_CHAT_AUTHENTICATION",T="SET_GLOBAL_NOTICE",j="CLEAN_GLOBAL_NOTICE",_="SET_PRODUCT_STATS",z="SET_IS_FETCHING_PRODUCT_STATS",_t=t=>({type:F,isFetching:t}),Ut=t=>({type:y,isFetching:t}),nt=t=>({type:H,isFetching:t}),Et=()=>({type:I}),vt=t=>({type:K,purchases:t}),J=t=>({type:U,chatAvailability:t}),ht=t=>({type:x,chatAuthentication:t}),mt=t=>({type:D,isFetching:t}),Ft=()=>({type:M}),pt=t=>({type:w,availableLicenses:t}),tt=t=>({type:k,product:t}),Y=(t,e)=>({type:N,productId:t,error:e}),Tt=(t,e)=>({type:V,productId:t,status:e}),Q=(t,e)=>({type:"SET_GLOBAL_NOTICE",message:t,options:e}),St=()=>({type:"CLEAN_GLOBAL_NOTICE"});function B(t,e){return{type:b,productId:t,isFetching:e}}function it(t,e,r){let{select:s,dispatch:a,registry:E}=r;return new Promise((G,$)=>{if(!s.isValidProduct(t)){const P=O("Invalid product name","jetpack-my-jetpack"),gt=new Error(P);a(Y(t,gt)),a(Q(P,{status:"error",isDismissible:!0})),$(gt);return}const st=e.activate?"POST":"DELETE";return a(B(t,!0)),(0,u.Z)({path:`${l}/${t}`,method:st}).then(P=>{a(B(t,!1)),a(tt(P)),E.dispatch(m.t).refreshConnectedPlugins(),G(P==null?void 0:P.status)}).catch(P=>{const{name:gt}=s.getProduct(t),qt=(0,S.gB)(O("Failed to activate %1$s. Please try again","jetpack-my-jetpack"),gt);a(B(t,!1)),a(Y(t,P)),a(Q(qt,{status:"error",isDismissible:!0})),$(P)})})}const Ct={setPurchasesIsFetching:_t,setChatAvailabilityIsFetching:Ut,setChatAuthenticationIsFetching:nt,fetchPurchases:Et,setPurchases:vt,setChatAvailability:J,setChatAuthentication:ht,setAvailableLicensesIsFetching:mt,fetchAvailableLicenses:Ft,setAvailableLicenses:pt,setProductStats:(t,e)=>({type:_,productId:t,stats:e}),setIsFetchingProductStats:(t,e)=>({type:z,productId:t,isFetching:e}),...{setGlobalNotice:Q,cleanGlobalNotice:St},...{setProduct:tt,activateProduct:t=>async e=>await it(t,{activate:!0},e),deactivateStandalonePluginForProduct:t=>async e=>await it(t,{activate:!1},e),installStandalonePluginForProduct:t=>async e=>{const{select:r,dispatch:s,registry:a}=e;return await new Promise((E,G)=>{if(!r.isValidProduct(t)){const h=O("Invalid product name","jetpack-my-jetpack"),st=new Error(h);s(Y(t,st)),s(Q(h,{status:"error",isDismissible:!0})),G(st);return}return s(B(t,!0)),(0,u.Z)({path:`${l}/${t}/install-standalone`,method:"POST"}).then(h=>{s(B(t,!1)),s(tt(h)),a.dispatch(m.t).refreshConnectedPlugins(),E(h==null?void 0:h.standalone_plugin_info)}).catch(h=>{const{name:st}=r.getProduct(t),P=(0,S.gB)(O("Failed to install standalone plugin for %1$s: %2$s. Please try again","jetpack-my-jetpack"),st,h.message);s(B(t,!1)),s(Y(t,h)),s(Q(P,{status:"error",isDismissible:!0})),G(h)})})},setIsFetchingProduct:B,setRequestProductError:Y,setProductStatus:Tt}};function Ht(){return new Promise((t,e)=>{(0,u.Z)({path:c}).then(t).catch(e)})}const At={[I]:Ht};var ft=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const xt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case b:{const{productId:r,isFetching:s}=e;return{...t,isFetching:{...t.isFetching,[r]:s},errors:{...t.errors,[r]:s?void 0:t.errors[r]}}}case V:{const{productId:r,status:s}=e;return{...t,items:{...t.items,[r]:{...t.items[r],status:s}}}}case k:{const{product:r}=e,{slug:s}=r;return{...t,items:{...t.items,[s]:r}}}case N:{const{productId:r,error:s}=e;return{...t,errors:{...t.errors,[r]:s}}}default:return t}},Bt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case F:return{...t,isFetching:e.isFetching};case K:return{...t,items:(e==null?void 0:e.purchases)||[]};default:return t}},Gt=function(){var r;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{isFetching:!1,isAvailable:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case y:return{...t,isFetching:e.isFetching};case U:return{...t,isAvailable:(r=e==null?void 0:e.chatAvailability)==null?void 0:r.is_available};default:return t}},It=function(){var r,s;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{isFetching:!1,jwt:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case H:return{...t,isFetching:e.isFetching};case x:return{...t,jwt:(s=(r=e==null?void 0:e.chatAuthentication)==null?void 0:r.user)==null?void 0:s.jwt};default:return t}},Pt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case D:return{...t,isFetching:e.isFetching};case w:return{...t,items:(e==null?void 0:e.availableLicenses)||[]};default:return t}},Rt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{global:{}},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case T:{const{message:r,options:s}=e;return{...t,global:{message:r,options:s}}}case j:return{...t,global:{}};default:return t}},Ot=function(){return arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}},W=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case z:{const{productId:r,isFetching:s}=e;return{...t,isFetching:{...t.isFetching,[r]:s}}}case _:{const{productId:r,stats:s}=e;return{...t,items:{...t.items,[r]:s}}}default:return t}},at=(0,ft.UY)({products:xt,purchases:Bt,chatAvailability:Gt,chatAuthentication:It,availableLicenses:Pt,notices:Rt,plugins:Ot,stats:W});var n=i("../api/index.jsx"),o=i("../../packages/my-jetpack/_inc/components/product-card/action-buton.jsx");const C=async()=>(0,u.Z)({path:g}),rt=async t=>t===f?C():null,Nt=S.__,ut={...{getProduct:{isFulfilled:(t,e)=>{var s;return(((s=t==null?void 0:t.products)==null?void 0:s.items)||{}).hasOwnProperty(e)&&!v.includes(e)},fulfill:t=>async e=>{let{dispatch:r}=e;try{r.setIsFetchingProduct(t,!0);const s=await(0,u.Z)({path:`${l}/${t}`});return r.setProduct(s),r.setIsFetchingProduct(t,!1),Promise.resolve()}catch(s){if(r.setIsFetchingProduct(t,!1),s!=null&&s.code&&(s!=null&&s.message))return r.setRequestProductError(t,s),Promise.reject(s);throw new Error(s)}}},getPurchases:()=>async t=>{let{dispatch:e}=t;e.setPurchasesIsFetching(!0);try{e.setPurchases(await(0,u.Z)({path:c})),e.setPurchasesIsFetching(!1)}catch(r){e.setPurchasesIsFetching(!1),r.code!=="not_connected"&&e.setGlobalNotice(Nt("There was an error fetching your purchases information. Check your site connectivity and try again.","jetpack-my-jetpack"),{status:"error"})}},getChatAvailability:()=>async t=>{let{dispatch:e}=t;e.setChatAvailabilityIsFetching(!0);try{e.setChatAvailability(await(0,u.Z)({path:p})),e.setChatAvailabilityIsFetching(!1)}catch(r){e.setChatAvailabilityIsFetching(!1)}},getChatAuthentication:()=>async t=>{let{dispatch:e}=t;e.setChatAuthenticationIsFetching(!0);try{e.setChatAuthentication(await(0,u.Z)({path:R})),e.setChatAuthenticationIsFetching(!1)}catch(r){e.setChatAuthenticationIsFetching(!1)}},getAvailableLicenses:()=>async t=>{let{dispatch:e}=t;e.setAvailableLicensesIsFetching(!0);try{const{apiRoot:r,apiNonce:s}=(window==null?void 0:window.myJetpackRest)||{};n.ZP.setApiRoot(r),n.ZP.setApiNonce(s);const a=await n.ZP.getUserLicenses();a&&a.items?e.setAvailableLicenses(a.items.filter(E=>{let{attached_at:G,revoked_at:$}=E;return G===null&&$===null})):e.setAvailableLicenses([])}catch(r){e.setAvailableLicenses([])}finally{e.setAvailableLicensesIsFetching(!1)}}},getProductStats:{isFulfilled:(t,e)=>{var r,s;return((s=(r=t.stats)==null?void 0:r.items)==null?void 0:s.hasOwnProperty(e))||!1},fulfill:t=>async e=>{let{dispatch:r,select:s}=e;const{status:a}=s.getProduct(t);if(a!==o.N.ACTIVE)return r.setProductStats(t,null),Promise.resolve();try{r.setIsFetchingProductStats(t,!0);const E=await rt(t);return r.setProductStats(t,E),r.setIsFetchingProductStats(t,!1),Promise.resolve()}catch(E){if(r.setProductStats(t,null),r.setIsFetchingProductStats(t,!1),E!=null&&E.code&&(E!=null&&E.message))return Promise.reject(E);throw new Error(E)}}}};function lt(t){return t.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace("_",""))}function yt(t){return t.indexOf("_")!==-1}function q(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=Object.assign({},t);for(const s in r)r.hasOwnProperty(s)&&yt(s)&&(r[lt(s)]=r[s],e&&delete r[s]);return r}const dt=t=>{var e;return((e=t.products)==null?void 0:e.items)||{}},Vt=t=>Object.keys(dt(t)),$t={...{getProducts:dt,getProductNames:Vt,getProduct:(t,e)=>{var a,E;const r=((a=dt(t))==null?void 0:a[e])||{},s=q(r,!0);return s.standalonePluginInfo=q(s.standalonePluginInfo||{},!0),s.pricingForUi=q(s.pricingForUi||{},!0),s.pricingForUi.introductoryOffer=s.pricingForUi.isIntroductoryOffer?q(s.pricingForUi.introductoryOffer,!0):null,(E=s.pricingForUi)!=null&&E.tiers&&(s.pricingForUi.tiers=q(s.pricingForUi.tiers,!0),s.pricingForUi.tiers=Object.keys(s.pricingForUi.tiers).reduce((G,$)=>{const h=q(s.pricingForUi.tiers[$],!0)||{};return G[$]={...h,introductoryOffer:h!=null&&h.isIntroductoryOffer?q(h==null?void 0:h.introductoryOffer,!0):null},G},{})),s.features=s.features||[],s.supportedProducts=s.supportedProducts||[],s.pricingForUi.fullPricePerMonth=s.pricingForUi.productTerm==="year"?Math.ceil(s.pricingForUi.fullPrice/12*100)/100:s.pricingForUi.fullPrice,s.pricingForUi.discountPricePerMonth=s.pricingForUi.productTerm==="year"?Math.ceil(s.pricingForUi.discountPrice/12*100)/100:s.pricingForUi.discountPrice,s},isValidProduct:(t,e)=>Vt(t).includes(e),isFetching:(t,e)=>{var r,s;return((s=(r=t.products)==null?void 0:r.isFetching)==null?void 0:s[e])||!1},getProductsThatRequiresUserConnection:t=>{const e=dt(t);return Object.keys(e).reduce((r,s)=>{const a=e[s];return(a==null?void 0:a.requires_user_connection)&&((a==null?void 0:a.status)===o.N.ACTIVE||(a==null?void 0:a.status)===o.N.ERROR)&&r.push(a==null?void 0:a.name),r},[])}},...{getPurchases:t=>{var e;return((e=t.purchases)==null?void 0:e.items)||[]},isRequestingPurchases:t=>{var e;return((e=t.purchases)==null?void 0:e.isFetching)||!1}},...{getChatAvailability:t=>t.chatAvailability.isAvailable,isRequestingChatAvailability:t=>t.chatAvailability.isFetching},...{getChatAuthentication:t=>t.chatAuthentication.jwt,isRequestingChatAuthentication:t=>t.chatAuthentication.isFetching},...{getAvailableLicenses:t=>{var e;return((e=t.availableLicenses)==null?void 0:e.items)||[]},isFetchingAvailableLicenses:t=>{var e;return((e=t.availableLicenses)==null?void 0:e.isFetching)||!1}},...{getGlobalNotice:t=>{var e;return(e=t.notices)==null?void 0:e.global}},...{hasStandalonePluginInstalled:t=>Object.values(t.plugins).filter(e=>["jetpack-backup","jetpack-boost","jetpack-protect","jetpack-search","jetpack-social","jetpack-videopress"].indexOf(e.TextDomain)>=0).length>0},...{getProductStats:(t,e)=>{var r,s;return(s=(r=t.stats)==null?void 0:r.items)==null?void 0:s[e]},isFetchingProductStats:(t,e)=>{var r,s;return((s=(r=t.stats)==null?void 0:r.isFetching)==null?void 0:s[e])||!1}}};var Kt=i("../../../node_modules/.pnpm/@babel+runtime@7.22.6/node_modules/@babel/runtime/helpers/defineProperty.js"),Jt=i.n(Kt),Yt=i("../../../node_modules/.pnpm/@wordpress+data@9.8.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");class et{static mayBeInit(e,r){et.store===null&&(et.store=(0,Yt.Z)(e,r),(0,ft.z2)(et.store))}}Jt()(et,"store",null);const Qt=et,zt="my-jetpack";function Xt(){Qt.mayBeInit(zt,{__experimentalUseThunks:!0,reducer:at,actions:Ct,selectors:$t,resolvers:ut,controls:At,initialState:window.myJetpackInitialState||{}})}}}]);})();
