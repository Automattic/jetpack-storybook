(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[5627],{"../../../node_modules/.pnpm/@wordpress+compose@7.5.0_react@18.3.1/node_modules/@wordpress/compose/build-module/hooks/use-focusable-iframe/index.js":(Ht,kt,J)=>{"use strict";J.d(kt,{A:()=>ft});var rt=J("../../../node_modules/.pnpm/@wordpress+compose@7.5.0_react@18.3.1/node_modules/@wordpress/compose/build-module/hooks/use-ref-effect/index.js");function ft(){return(0,rt.A)(st=>{const{ownerDocument:N}=st;if(!N)return;const{defaultView:I}=N;if(!I)return;function b(){N&&N.activeElement===st&&st.focus()}return I.addEventListener("blur",b),()=>{I.removeEventListener("blur",b)}},[])}},"../../../node_modules/.pnpm/@wordpress+sync@1.5.0/node_modules/@wordpress/sync/build-module/connect-indexdb.js":(Ht,kt,J)=>{"use strict";J.d(kt,{d:()=>Xt});var rt=J("../../../node_modules/.pnpm/yjs@13.6.18/node_modules/yjs/dist/yjs.mjs"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/promise.js"),st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/error.js");const N=at=>ft.vt((et,ut)=>{at.onerror=mt=>ut(new Error(mt.target.error)),at.onsuccess=mt=>et(mt.target.result)}),I=(at,et)=>ft.vt((ut,mt)=>{const Tt=indexedDB.open(at);Tt.onupgradeneeded=Dt=>et(Dt.target.result),Tt.onerror=Dt=>mt(st.vt(Dt.target.error)),Tt.onsuccess=Dt=>{const zt=Dt.target.result;zt.onversionchange=()=>{zt.close()},ut(zt)}}),b=at=>N(indexedDB.deleteDatabase(at)),g=(at,et)=>et.forEach(ut=>at.createObjectStore.apply(at,ut)),L=(at,et,ut="readwrite")=>{const mt=at.transaction(et,ut);return et.map(Tt=>z(mt,Tt))},M=(at,et)=>N(at.count(et)),d=(at,et)=>N(at.get(et)),m=(at,et)=>N(at.delete(et)),h=(at,et,ut)=>N(at.put(et,ut)),u=(at,et,ut)=>N(at.add(et,ut)),x=(at,et)=>N(at.add(et)),T=(at,et,ut)=>N(at.getAll(et,ut)),E=(at,et,ut)=>N(at.getAllKeys(et,ut)),j=(at,et,ut)=>{let mt=null;return D(at,et,Tt=>(mt=Tt,!1),ut).then(()=>mt)},a=(at,et=null)=>j(at,et,"prev"),v=(at,et=null)=>j(at,et,"next"),y=(at,et,ut)=>promise.all([E(at,et,ut),T(at,et,ut)]).then(([mt,Tt])=>mt.map((Dt,zt)=>({k:Dt,v:Tt[zt]}))),R=(at,et)=>ft.vt((ut,mt)=>{at.onerror=mt,at.onsuccess=async Tt=>{const Dt=Tt.target.result;if(Dt===null||await et(Dt)===!1)return ut();Dt.continue()}}),_=(at,et,ut,mt="next")=>R(at.openCursor(et,mt),Tt=>ut(Tt.value,Tt.key)),D=(at,et,ut,mt="next")=>R(at.openKeyCursor(et,mt),Tt=>ut(Tt.key)),z=(at,et)=>at.objectStore(et),O=(at,et,ut,mt)=>IDBKeyRange.bound(at,et,ut,mt),V=(at,et)=>IDBKeyRange.upperBound(at,et),X=(at,et)=>IDBKeyRange.lowerBound(at,et);var lt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/observable.js");const wt="custom",St="updates",Ct=500,Nt=(at,et=()=>{},ut=()=>{})=>{const[mt]=L(at.db,[St]);return T(mt,X(at._dbref,!1)).then(Tt=>{at._destroyed||(et(mt),rt.hL(at.doc,()=>{Tt.forEach(Dt=>rt.QE(at.doc,Dt))},at,!1),ut(mt))}).then(()=>a(mt).then(Tt=>{at._dbref=Tt+1})).then(()=>M(mt).then(Tt=>{at._dbsize=Tt})).then(()=>mt)},Lt=(at,et=!0)=>Nt(at).then(ut=>{(et||at._dbsize>=Ct)&&x(ut,rt.PR(at.doc)).then(()=>m(ut,V(at._dbref,!0))).then(()=>M(ut).then(mt=>{at._dbsize=mt}))}),_t=at=>idb.deleteDB(at);class ee extends lt.c{constructor(et,ut){super(),this.doc=ut,this.name=et,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=I(et,mt=>g(mt,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=ft.vt(mt=>this.on("synced",()=>mt(this))),this._db.then(mt=>{this.db=mt,Nt(this,zt=>x(zt,rt.PR(ut)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(mt,Tt)=>{if(this.db&&Tt!==this){const[Dt]=L(this.db,[St]);x(Dt,mt),++this._dbsize>=Ct&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{Lt(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},ut.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),ut.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(et=>{et.close()})}clearData(){return this.destroy().then(()=>{b(this.name)})}get(et){return this._db.then(ut=>{const[mt]=L(ut,[wt],"readonly");return d(mt,et)})}set(et,ut){return this._db.then(mt=>{const[Tt]=L(mt,[wt]);return h(Tt,ut,et)})}del(et){return this._db.then(ut=>{const[mt]=L(ut,[wt]);return m(mt,et)})}}function Xt(at,et,ut){const mt=`${et}-${at}`,Tt=new ee(mt,ut);return new Promise(Dt=>{Tt.on("synced",()=>{Dt(()=>Tt.destroy())})})}},"../../../node_modules/.pnpm/@wordpress+sync@1.5.0/node_modules/@wordpress/sync/build-module/create-webrtc-connection.js":(Ht,kt,J)=>{"use strict";J.d(kt,{q:()=>tn});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/observable.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/time.js"),st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/math.js");const N=1200,I=2500,b=3e4,g=U=>{if(U.shouldConnect&&U.ws===null){const H=new WebSocket(U.url),$=U.binaryType;let ot=null;$&&(H.binaryType=$),U.ws=H,U.connecting=!0,U.connected=!1,H.onmessage=ht=>{U.lastMessageReceived=ft._g();const At=ht.data,It=typeof At=="string"?JSON.parse(At):At;It&&It.type==="pong"&&(clearTimeout(ot),ot=setTimeout(Et,b/2)),U.emit("message",[It,U])};const nt=ht=>{U.ws!==null&&(U.ws=null,U.connecting=!1,U.connected?(U.connected=!1,U.emit("disconnect",[{type:"disconnect",error:ht},U])):U.unsuccessfulReconnects++,setTimeout(g,st.jk(st.YL(U.unsuccessfulReconnects+1)*N,I),U)),clearTimeout(ot)},Et=()=>{U.ws===H&&U.send({type:"ping"})};H.onclose=()=>nt(null),H.onerror=ht=>nt(ht),H.onopen=()=>{U.lastMessageReceived=ft._g(),U.connecting=!1,U.connected=!0,U.unsuccessfulReconnects=0,U.emit("connect",[{type:"connect"},U]),ot=setTimeout(Et,b/2)}}};class L extends rt.c{constructor(H,{binaryType:$}={}){super(),this.url=H,this.ws=null,this.binaryType=$||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&b<ft._g()-this.lastMessageReceived&&this.ws.close()},b/2),g(this)}send(H){this.ws&&this.ws.send(JSON.stringify(H))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&g(this)}}var M=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/map.js"),d=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/error.js"),m=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/random.js"),h=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/encoding.js"),u=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/decoding.js"),x=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.js"),T=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.common.js"),E=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/promise.js"),j=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/set.js"),a=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/buffer.js"),v=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/storage.js");const y=new Map;class R{constructor(H){this.room=H,this.onmessage=null,this._onChange=$=>$.key===H&&this.onmessage!==null&&this.onmessage({data:a.Ey($.newValue||"")}),v.k9(this._onChange)}postMessage(H){v.JT.setItem(this.room,a.nk(a.zS(H)))}close(){v.o6(this._onChange)}}const _=typeof BroadcastChannel=="undefined"?R:BroadcastChannel,D=U=>M._4(y,U,()=>{const H=j.vt(),$=new _(U);return $.onmessage=ot=>H.forEach(nt=>nt(ot.data,"broadcastchannel")),{bc:$,subs:H}}),z=(U,H)=>(D(U).subs.add(H),H),O=(U,H)=>{const $=D(U),ot=$.subs.delete(H);return ot&&$.subs.size===0&&($.bc.close(),y.delete(U)),ot},V=(U,H,$=null)=>{const ot=D(U);ot.bc.postMessage(H),ot.subs.forEach(nt=>nt(H,$))},X=()=>{let U=!0;return(H,$)=>{if(U){U=!1;try{H()}finally{U=!0}}else $!==void 0&&$()}};var lt=J("../../../node_modules/.pnpm/simple-peer@9.11.1/node_modules/simple-peer/simplepeer.min.js"),wt=J.n(lt),St=J("../../../node_modules/.pnpm/yjs@13.6.18/node_modules/yjs/dist/yjs.mjs");const Ct=0,Nt=1,Lt=2,_t=(U,H)=>{h.zd(U,Ct);const $=St.FX(H);h.Gu(U,$)},ee=(U,H,$)=>{h.zd(U,Nt),h.Gu(U,St.PR(H,$))},Xt=(U,H,$)=>ee(H,$,u.bo(U)),at=(U,H,$)=>{try{St.QE(H,u.bo(U),$)}catch(ot){console.error("Caught error while handling a Yjs update",ot)}},et=(U,H)=>{h.zd(U,Lt),h.Gu(U,H)},ut=at,mt=(U,H,$,ot)=>{const nt=u.cw(U);switch(nt){case Ct:Xt(U,H,$);break;case Nt:at(U,$,ot);break;case Lt:ut(U,$,ot);break;default:throw new Error("Unknown message type")}return nt};var Tt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/function.js");const Dt=3e4;class zt extends rt.c{constructor(H){super(),this.doc=H,this.clientID=H.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const $=ft._g();this.getLocalState()!==null&&Dt/2<=$-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const ot=[];this.meta.forEach((nt,Et)=>{Et!==this.clientID&&Dt<=$-nt.lastUpdated&&this.states.has(Et)&&ot.push(Et)}),ot.length>0&&Qt(this,ot,"timeout")},st.RI(Dt/10)),H.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(H){const $=this.clientID,ot=this.meta.get($),nt=ot===void 0?0:ot.clock+1,Et=this.states.get($);H===null?this.states.delete($):this.states.set($,H),this.meta.set($,{clock:nt,lastUpdated:ft._g()});const ht=[],At=[],It=[],Pt=[];H===null?Pt.push($):Et==null?H!=null&&ht.push($):(At.push($),Tt.vo(Et,H)||It.push($)),(ht.length>0||It.length>0||Pt.length>0)&&this.emit("change",[{added:ht,updated:It,removed:Pt},"local"]),this.emit("update",[{added:ht,updated:At,removed:Pt},"local"])}setLocalStateField(H,$){const ot=this.getLocalState();ot!==null&&this.setLocalState({...ot,[H]:$})}getStates(){return this.states}}const Qt=(U,H,$)=>{const ot=[];for(let nt=0;nt<H.length;nt++){const Et=H[nt];if(U.states.has(Et)){if(U.states.delete(Et),Et===U.clientID){const ht=U.meta.get(Et);U.meta.set(Et,{clock:ht.clock+1,lastUpdated:ft._g()})}ot.push(Et)}}ot.length>0&&(U.emit("change",[{added:[],updated:[],removed:ot},$]),U.emit("update",[{added:[],updated:[],removed:ot},$]))},Kt=(U,H,$=U.states)=>{const ot=H.length,nt=h.xv();h.zd(nt,ot);for(let Et=0;Et<ot;Et++){const ht=H[Et],At=$.get(ht)||null,It=U.meta.get(ht).clock;h.zd(nt,ht),h.zd(nt,It),h.Qj(nt,JSON.stringify(At))}return h.Fo(nt)},Jt=(U,H)=>{const $=decoding.createDecoder(U),ot=encoding.createEncoder(),nt=decoding.readVarUint($);encoding.writeVarUint(ot,nt);for(let Et=0;Et<nt;Et++){const ht=decoding.readVarUint($),At=decoding.readVarUint($),It=JSON.parse(decoding.readVarString($)),Pt=H(It);encoding.writeVarUint(ot,ht),encoding.writeVarUint(ot,At),encoding.writeVarString(ot,JSON.stringify(Pt))}return encoding.toUint8Array(ot)},Y=(U,H,$)=>{const ot=u.$C(H),nt=ft._g(),Et=[],ht=[],At=[],It=[],Pt=u.cw(ot);for(let Bt=0;Bt<Pt;Bt++){const te=u.cw(ot);let oe=u.cw(ot);const ge=JSON.parse(u.t3(ot)),Se=U.meta.get(te),bn=U.states.get(te),en=Se===void 0?0:Se.clock;(en<oe||en===oe&&ge===null&&U.states.has(te))&&(ge===null?te===U.clientID&&U.getLocalState()!=null?oe++:U.states.delete(te):U.states.set(te,ge),U.meta.set(te,{clock:oe,lastUpdated:nt}),Se===void 0&&ge!==null?Et.push(te):Se!==void 0&&ge===null?It.push(te):ge!==null&&(Tt.vo(ge,bn)||At.push(te),ht.push(te)))}(Et.length>0||At.length>0||It.length>0)&&U.emit("change",[{added:Et,updated:At,removed:It},$]),(Et.length>0||ht.length>0||It.length>0)&&U.emit("update",[{added:Et,updated:ht,removed:It},$])};var tt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/string.js");const vt=(U,H)=>{const $=tt.Af(U).buffer,ot=tt.Af(H).buffer;return crypto.subtle.importKey("raw",$,"PBKDF2",!1,["deriveKey"]).then(nt=>crypto.subtle.deriveKey({name:"PBKDF2",salt:ot,iterations:1e5,hash:"SHA-256"},nt,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},P=(U,H)=>{if(!H)return E.hd(U);const $=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:$},H,U).then(ot=>{const nt=h.xv();return h.Qj(nt,"AES-GCM"),h.Gu(nt,$),h.Gu(nt,new Uint8Array(ot)),h.Fo(nt)})},w=(U,H)=>{const $=h.xv();return h.IO($,U),P(h.Fo($),H)},k=(U,H)=>{if(!H)return E.hd(U);const $=u.$C(U);u.t3($)!=="AES-GCM"&&E.ku(d.vt("Unknown encryption algorithm"));const nt=u.bo($),Et=u.bo($);return crypto.subtle.decrypt({name:"AES-GCM",iv:nt},H,Et).then(ht=>new Uint8Array(ht))},Z=(U,H)=>k(U,H).then($=>u.Jg(u.$C(new Uint8Array($))));var pt=J("../../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");const n=x.Xv("y-webrtc"),s=0,l=3,C=1,K=4,G=new Map,ct=new Map,Rt=U=>{let H=!0;U.webrtcConns.forEach($=>{$.synced||(H=!1)}),(!H&&U.synced||H&&!U.synced)&&(U.synced=H,U.provider.emit("synced",[{synced:H}]),n("synced ",T.Y,U.name,T.Ny," with all peers"))},Wt=(U,H,$)=>{const ot=u.$C(H),nt=h.xv(),Et=u.cw(ot);if(U===void 0)return null;const ht=U.awareness,At=U.doc;let It=!1;switch(Et){case s:{h.zd(nt,s);const Pt=mt(ot,nt,At,U);Pt===Nt&&!U.synced&&$(),Pt===Ct&&(It=!0);break}case l:h.zd(nt,C),h.Gu(nt,Kt(ht,Array.from(ht.getStates().keys()))),It=!0;break;case C:Y(ht,u.bo(ot),U);break;case K:{const Pt=u.xh(ot)===1,Bt=u.t3(ot);if(Bt!==U.peerId&&(U.bcConns.has(Bt)&&!Pt||!U.bcConns.has(Bt)&&Pt)){const te=[],oe=[];Pt?(U.bcConns.add(Bt),oe.push(Bt)):(U.bcConns.delete(Bt),te.push(Bt)),U.provider.emit("peers",[{added:oe,removed:te,webrtcPeers:Array.from(U.webrtcConns.keys()),bcPeers:Array.from(U.bcConns)}]),Mt(U)}break}default:return console.error("Unable to compute message"),nt}return It?nt:null},xt=(U,H)=>{const $=U.room;return n("received message from ",T.Y,U.remotePeerId,T.Qu," (",$.name,")",T.Ny,T.Tx),Wt($,H,()=>{U.synced=!0,n("synced ",T.Y,$.name,T.Ny," with ",T.Y,U.remotePeerId),Rt($)})},Ut=(U,H)=>{n("send message to ",T.Y,U.remotePeerId,T.Ny,T.Qu," (",U.room.name,")",T.Tx);try{U.peer.send(h.Fo(H))}catch($){}},jt=(U,H)=>{n("broadcast message in ",T.Y,U.name,T.Ny),U.webrtcConns.forEach($=>{try{$.peer.send(H)}catch(ot){}})};class ie{constructor(H,$,ot,nt){n("establishing connection to ",T.Y,ot),this.room=nt,this.remotePeerId=ot,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new(wt())({initiator:$,...nt.provider.peerOpts}),this.peer.on("signal",Et=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),ne(H,nt,{to:ot,from:nt.peerId,type:"signal",token:this.glareToken,signal:Et})}),this.peer.on("connect",()=>{n("connected to ",T.Y,ot),this.connected=!0;const ht=nt.provider.doc,At=nt.awareness,It=h.xv();h.zd(It,s),_t(It,ht),Ut(this,It);const Pt=At.getStates();if(Pt.size>0){const Bt=h.xv();h.zd(Bt,C),h.Gu(Bt,Kt(At,Array.from(Pt.keys()))),Ut(this,Bt)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,nt.webrtcConns.has(this.remotePeerId)&&(nt.webrtcConns.delete(this.remotePeerId),nt.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(nt.webrtcConns.keys()),bcPeers:Array.from(nt.bcConns)}])),Rt(nt),this.peer.destroy(),n("closed connection to ",T.Y,ot),bt(nt)}),this.peer.on("error",Et=>{n("Error in connection to ",T.Y,ot,": ",Et),bt(nt)}),this.peer.on("data",Et=>{const ht=xt(this,Et);ht!==null&&Ut(this,ht)})}destroy(){this.peer.destroy()}}const Q=(U,H)=>P(H,U.key).then($=>U.mux(()=>V(U.name,$))),it=(U,H)=>{U.bcconnected&&Q(U,H),jt(U,H)},bt=U=>{G.forEach(H=>{H.connected&&(H.send({type:"subscribe",topics:[U.name]}),U.webrtcConns.size<U.provider.maxConns&&ne(H,U,{type:"announce",from:U.peerId}))})},Mt=U=>{if(U.provider.filterBcConns){const H=h.xv();h.zd(H,K),h.QJ(H,1),h.Qj(H,U.peerId),Q(U,h.Fo(H))}};class yt{constructor(H,$,ot,nt){this.peerId=m.gZ(),this.doc=H,this.awareness=$.awareness,this.provider=$,this.synced=!1,this.name=ot,this.key=nt,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=X(),this.bcconnected=!1,this._bcSubscriber=Et=>k(new Uint8Array(Et),nt).then(ht=>this.mux(()=>{const At=Wt(this,ht,()=>{});At&&Q(this,h.Fo(At))})),this._docUpdateHandler=(Et,ht)=>{const At=h.xv();h.zd(At,s),et(At,Et),it(this,h.Fo(At))},this._awarenessUpdateHandler=({added:Et,updated:ht,removed:At},It)=>{const Pt=Et.concat(ht).concat(At),Bt=h.xv();h.zd(Bt,C),h.Gu(Bt,Kt(this.awareness,Pt)),it(this,h.Fo(Bt))},this._beforeUnloadHandler=()=>{Qt(this.awareness,[H.clientID],"window unload"),ct.forEach(Et=>{Et.disconnect()})},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof pt!="undefined"&&pt.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),bt(this);const H=this.name;z(H,this._bcSubscriber),this.bcconnected=!0,Mt(this);const $=h.xv();h.zd($,s),_t($,this.doc),Q(this,h.Fo($));const ot=h.xv();h.zd(ot,s),ee(ot,this.doc),Q(this,h.Fo(ot));const nt=h.xv();h.zd(nt,l),Q(this,h.Fo(nt));const Et=h.xv();h.zd(Et,C),h.Gu(Et,Kt(this.awareness,[this.doc.clientID])),Q(this,h.Fo(Et))}disconnect(){G.forEach($=>{$.connected&&$.send({type:"unsubscribe",topics:[this.name]})}),Qt(this.awareness,[this.doc.clientID],"disconnect");const H=h.xv();h.zd(H,K),h.QJ(H,0),h.Qj(H,this.peerId),Q(this,h.Fo(H)),O(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach($=>$.destroy())}destroy(){this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof pt!="undefined"&&pt.off("exit",this._beforeUnloadHandler)}}const qt=(U,H,$,ot)=>{if(ct.has($))throw d.vt(`A Yjs Doc connected to room "${$}" already exists!`);const nt=new yt(U,H,$,ot);return ct.set($,nt),nt},ne=(U,H,$)=>{H.key?w($,H.key).then(ot=>{U.send({type:"publish",topic:H.name,data:a.nk(ot)})}):U.send({type:"publish",topic:H.name,data:$})};class se extends L{constructor(H){super(H),this.providers=new Set,this.on("connect",()=>{n(`connected (${H})`);const $=Array.from(ct.keys());this.send({type:"subscribe",topics:$}),ct.forEach(ot=>ne(this,ot,{type:"announce",from:ot.peerId}))}),this.on("message",$=>{switch($.type){case"publish":{const ot=$.topic,nt=ct.get(ot);if(nt==null||typeof ot!="string")return;const Et=ht=>{const At=nt.webrtcConns,It=nt.peerId;if(ht==null||ht.from===It||ht.to!==void 0&&ht.to!==It||nt.bcConns.has(ht.from))return;const Pt=At.has(ht.from)?()=>{}:()=>nt.provider.emit("peers",[{removed:[],added:[ht.from],webrtcPeers:Array.from(nt.webrtcConns.keys()),bcPeers:Array.from(nt.bcConns)}]);switch(ht.type){case"announce":At.size<nt.provider.maxConns&&(M._4(At,ht.from,()=>new ie(this,!0,ht.from,nt)),Pt());break;case"signal":if(ht.signal.type==="offer"){const Bt=At.get(ht.from);if(Bt){const te=ht.token,oe=Bt.glareToken;if(oe&&oe>te){n("offer rejected: ",ht.from);return}Bt.glareToken=void 0}}if(ht.signal.type==="answer"){n("offer answered by: ",ht.from);const Bt=At.get(ht.from);Bt.glareToken=void 0}ht.to===It&&(M._4(At,ht.from,()=>new ie(this,!1,ht.from,nt)).peer.signal(ht.signal),Pt());break}};nt.key?typeof $.data=="string"&&Z(a.Ey($.data),nt.key).then(Et):Et($.data)}}}),this.on("disconnect",()=>n(`disconnect (${H})`))}}class de extends rt.c{constructor(H,$,{signaling:ot=["wss://y-webrtc-eu.fly.dev"],password:nt=null,awareness:Et=new zt($),maxConns:ht=20+st.RI(m._9()*15),filterBcConns:At=!0,peerOpts:It={}}={}){super(),this.roomName=H,this.doc=$,this.filterBcConns=At,this.awareness=Et,this.shouldConnect=!1,this.signalingUrls=ot,this.signalingConns=[],this.maxConns=ht,this.peerOpts=It,this.key=nt?vt(nt,H):E.hd(null),this.room=null,this.key.then(Pt=>{this.room=qt($,this,H,Pt),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),$.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(H=>{const $=M._4(G,H,()=>new se(H));this.signalingConns.push($),$.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(H=>{H.providers.delete(this),H.providers.size===0&&(H.destroy(),G.delete(H.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),ct.delete(this.roomName)}),super.destroy()}}var xe=J("../../../node_modules/.pnpm/@wordpress+url@4.5.0/node_modules/@wordpress/url/build-module/add-query-args.js");function mn(U,H){U.on("connect",()=>{n(`connected (${H})`);const $=Array.from(ct.keys());U.send({type:"subscribe",topics:$}),ct.forEach(ot=>ne(U,ot,{type:"announce",from:ot.peerId}))}),U.on("message",$=>{switch($.type){case"publish":{const ot=$.topic,nt=ct.get(ot);if(nt===null||typeof ot!="string"||nt===void 0)return;const Et=ht=>{const At=nt.webrtcConns,It=nt.peerId;if(ht===null||ht.from===It||ht.to!==void 0&&ht.to!==It||nt.bcConns.has(ht.from))return;const Pt=At.has(ht.from)?()=>{}:()=>nt.provider.emit("peers",[{removed:[],added:[ht.from],webrtcPeers:Array.from(nt.webrtcConns.keys()),bcPeers:Array.from(nt.bcConns)}]);switch(ht.type){case"announce":At.size<nt.provider.maxConns&&(M._4(At,ht.from,()=>new ie(U,!0,ht.from,nt)),Pt());break;case"signal":if(ht.signal.type==="offer"){const Bt=At.get(ht.from);if(Bt){const te=ht.token,oe=Bt.glareToken;if(oe&&oe>te){n("offer rejected: ",ht.from);return}Bt.glareToken=void 0}}if(ht.signal.type==="answer"){n("offer answered by: ",ht.from);const Bt=At.get(ht.from);Bt&&(Bt.glareToken=void 0)}ht.to===It&&(M._4(At,ht.from,()=>new ie(U,!1,ht.from,nt)).peer.signal(ht.signal),Pt());break}};nt.key?typeof $.data=="string"&&Z(a.Ey($.data),nt.key).then(Et):Et($.data)}}}),U.on("disconnect",()=>n(`disconnect (${H})`))}function Re(U){if(U.shouldConnect&&U.ws===null){const H=Math.floor(1e5+Math.random()*9e5),$=U.url,ot=new window.EventSource((0,xe.F)($,{subscriber_id:H,action:"gutenberg_signaling_server"}));let nt=null;ot.onmessage=It=>{U.lastMessageReceived=Date.now();const Pt=It.data;if(Pt){const Bt=JSON.parse(Pt);Array.isArray(Bt)&&Bt.forEach(Et)}},U.ws=ot,U.connecting=!0,U.connected=!1;const Et=It=>{It&&It.type==="pong"&&(clearTimeout(nt),nt=setTimeout(At,Me/2)),U.emit("message",[It,U])},ht=It=>{U.ws!==null&&(U.ws.close(),U.ws=null,U.connecting=!1,U.connected?(U.connected=!1,U.emit("disconnect",[{type:"disconnect",error:It},U])):U.unsuccessfulReconnects++),clearTimeout(nt)},At=()=>{U.ws&&U.ws.readyState===window.EventSource.OPEN&&U.send({type:"ping"})};U.ws&&(U.ws.onclose=()=>{ht(null)},U.ws.send=function(Pt){window.fetch($,{body:new URLSearchParams({subscriber_id:H.toString(),action:"gutenberg_signaling_server",message:Pt}),method:"POST"}).catch(()=>{n("Error sending to server with message: "+Pt)})}),ot.onerror=()=>{},ot.onopen=()=>{U.connected||ot.readyState===window.EventSource.OPEN&&(U.lastMessageReceived=Date.now(),U.connecting=!1,U.connected=!0,U.unsuccessfulReconnects=0,U.emit("connect",[{type:"connect"},U]),nt=setTimeout(At,Me/2))}}}const Me=3e4;class yn extends rt.c{constructor(H){super(),this.url=H,this.ws=null,this.binaryType=null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Me<Date.now()-this.lastMessageReceived&&this.ws&&this.ws.close()},Me/2),Re(this),this.providers=new Set,mn(this,H)}send(H){this.ws&&this.ws.send(JSON.stringify(H))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&Re(this)}}class Ze extends de{connect(){this.shouldConnect=!0,this.signalingUrls.forEach(H=>{const $=M._4(G,H,H.startsWith("ws://")||H.startsWith("wss://")?()=>new se(H):()=>new yn(H));this.signalingConns.push($),$.providers.add(this)}),this.room&&this.room.connect()}}function tn({signaling:U,password:H}){return function($,ot,nt){const Et=`${ot}-${$}`;return new Ze(Et,nt,{signaling:U,password:H}),Promise.resolve(()=>!0)}}},"../../../node_modules/.pnpm/@wordpress+sync@1.5.0/node_modules/@wordpress/sync/build-module/provider.js":(Ht,kt,J)=>{"use strict";J.d(kt,{f:()=>ft});var rt=J("../../../node_modules/.pnpm/yjs@13.6.18/node_modules/yjs/dist/yjs.mjs");const ft=(st,N)=>{const I={},b={},g={};function L(h,u){I[h]=u}async function M(h,u,x){const T=new rt.JA;g[h]=g[h]||{},g[h][u]=T;const E=()=>{const v=I[h].fromCRDTDoc(T);x(v)};T.on("update",E);const j=await st(u,h,T);N&&await N(u,h,T);const a=I[h].fetch;a&&a(u).then(v=>{T.transact(()=>{I[h].applyChangesToDoc(T,v)})}),b[h]=b[h]||{},b[h][u]=()=>{j(),T.off("update",E)}}async function d(h,u,x){const T=g[h][u];if(!T)throw"Error doc "+h+" "+u+" not found";T.transact(()=>{I[h].applyChangesToDoc(T,x)})}async function m(h,u){var x;(x=b==null?void 0:b[h])!=null&&x[u]&&b[h][u]()}return{register:L,bootstrap:M,update:d,discard:m}}},"../../../node_modules/.pnpm/@wordpress+undo-manager@1.5.0/node_modules/@wordpress/undo-manager/build-module/index.js":(Ht,kt,J)=>{"use strict";J.d(kt,{u:()=>N});var rt=J("../../../node_modules/.pnpm/@wordpress+is-shallow-equal@5.5.0/node_modules/@wordpress/is-shallow-equal/build-module/index.js");function ft(I,b){const g={...I};return Object.entries(b).forEach(([L,M])=>{g[L]?g[L]={...g[L],to:M.to}:g[L]=M}),g}const st=(I,b)=>{const g=I==null?void 0:I.findIndex(({id:M})=>typeof M=="string"?M===b.id:(0,rt.Ay)(M,b.id)),L=[...I];return g!==-1?L[g]={id:b.id,changes:ft(L[g].changes,b.changes)}:L.push(b),L};function N(){let I=[],b=[],g=0;const L=()=>{I=I.slice(0,g||void 0),g=0},M=()=>{var m;const h=I.length===0?0:I.length-1;let u=(m=I[h])!==null&&m!==void 0?m:[];b.forEach(x=>{u=st(u,x)}),b=[],I[h]=u},d=m=>!m.filter(({changes:u})=>Object.values(u).some(({from:x,to:T})=>typeof x!="function"&&typeof T!="function"&&!(0,rt.Ay)(x,T))).length;return{addRecord(m,h=!1){const u=!m||d(m);if(h){if(u)return;m.forEach(x=>{b=st(b,x)})}else{if(L(),b.length&&M(),u)return;I.push(m)}},undo(){b.length&&(L(),M());const m=I[I.length-1+g];if(m)return g-=1,m},redo(){const m=I[I.length+g];if(m)return g+=1,m},hasUndo(){return!!I[I.length-1+g]},hasRedo(){return!!I[I.length+g]}}}},"../../../node_modules/.pnpm/capital-case@1.0.4/node_modules/capital-case/dist.es2015/index.js":(Ht,kt,J)=>{"use strict";J.d(kt,{D:()=>I});var rt=J("../../../node_modules/.pnpm/tslib@2.5.0/node_modules/tslib/tslib.es6.js"),ft=J("../../../node_modules/.pnpm/no-case@3.0.4/node_modules/no-case/dist.es2015/index.js");function st(b){return b.charAt(0).toUpperCase()+b.substr(1)}function N(b){return st(b.toLowerCase())}function I(b,g){return g===void 0&&(g={}),(0,ft.W)(b,(0,rt.Cl)({delimiter:" ",transform:N},g))}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/array.js":(Ht,kt,J)=>{"use strict";J.d(kt,{HT:()=>I,HV:()=>rt,S2:()=>N,cy:()=>h,zN:()=>g});const rt=E=>E[E.length-1],ft=()=>[],st=E=>E.slice(),N=(E,j)=>{for(let a=0;a<j.length;a++)E.push(j[a])},I=Array.from,b=(E,j)=>{for(let a=0;a<E.length;a++)if(!j(E[a],a,E))return!1;return!0},g=(E,j)=>{for(let a=0;a<E.length;a++)if(j(E[a],a,E))return!0;return!1},L=(E,j)=>E.length===j.length&&b(E,(a,v)=>a===j[v]),M=E=>m(E,[],(j,a)=>j.concat(a)),d=(E,j)=>{const a=new Array(E);for(let v=0;v<E;v++)a[v]=j(v,a);return a},m=(E,j,a)=>E.reduce(a,j),h=Array.isArray,u=E=>I(set.from(E)),x=(E,j)=>{const a=set.create(),v=[];for(let y=0;y<E.length;y++){const R=E[y],_=j(R);a.has(_)||(a.add(_),v.push(R))}return v},T=(E,j)=>{const a=Array(E.length);for(let v=0;v<E.length;v++)a[v]=j(E[v],v,E);return a}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/binary.js":(Ht,kt,J)=>{"use strict";J.d(kt,{CW:()=>Ut,D1:()=>st,D7:()=>g,Dk:()=>rt,KD:()=>ft,KJ:()=>b,P1:()=>ut,WD:()=>mt,WY:()=>et,vZ:()=>xt,wn:()=>N,wt:()=>L});const rt=1,ft=2,st=4,N=8,I=16,b=32,g=64,L=128,M=256,d=512,m=1024,h=2048,u=4096,x=8192,T=16384,E=32768,j=65536,a=1<<17,v=1<<18,y=1<<19,R=1<<20,_=1<<21,D=1<<22,z=1<<23,O=1<<24,V=1<<25,X=1<<26,lt=1<<27,wt=1<<28,St=1<<29,Ct=1<<30,Nt=null,Lt=0,_t=1,ee=3,Xt=7,at=15,et=31,ut=63,mt=127,Tt=255,Dt=511,zt=1023,Qt=2047,Kt=4095,Jt=8191,Y=16383,tt=32767,vt=65535,P=a-1,w=v-1,k=y-1,Z=R-1,pt=_-1,n=D-1,s=z-1,l=O-1,C=V-1,K=X-1,G=lt-1,ct=wt-1,Rt=St-1,Wt=Ct-1,xt=2147483647,Ut=4294967295},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/buffer.js":(Ht,kt,J)=>{"use strict";J.d(kt,{Ey:()=>m,HR:()=>E,nk:()=>d,zS:()=>I});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/string.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/environment.js");const st=y=>new Uint8Array(y),N=(y,R,_)=>new Uint8Array(y,R,_),I=y=>new Uint8Array(y),b=y=>{let R="";for(let _=0;_<y.byteLength;_++)R+=rt.QV(y[_]);return btoa(R)},g=y=>Buffer.from(y.buffer,y.byteOffset,y.byteLength).toString("base64"),L=y=>{const R=atob(y),_=st(R.length);for(let D=0;D<R.length;D++)_[D]=R.charCodeAt(D);return _},M=y=>{const R=Buffer.from(y,"base64");return N(R.buffer,R.byteOffset,R.byteLength)},d=ft.Bd?b:g,m=ft.Bd?L:M,h=y=>d(y).replaceAll("+","-").replaceAll("/","_").replaceAll("=",""),u=y=>m(y.replaceAll("-","+").replaceAll("_","/")),x=y=>array.map(y,R=>R.toString(16).padStart(2,"0")).join(""),T=y=>{const R=y.length,_=new Uint8Array(math.ceil(R/2));for(let D=0;D<R;D+=2)_[_.length-D/2-1]=Number.parseInt(y.slice(R-D-2,R-D),16);return _},E=y=>{const R=st(y.byteLength);return R.set(y),R},j=y=>encoding.encode(R=>encoding.writeAny(R,y)),a=y=>decoding.readAny(decoding.createDecoder(y)),v=(y,R)=>{if(R===0)return y;y=new Uint8Array(y),y[0]<<=R;for(let _=1;_<y.length;_++)y[_-1]|=y[_]>>>8-R,y[_]<<=R;return y}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/decoding.js":(Ht,kt,J)=>{"use strict";J.d(kt,{$C:()=>M,Ib:()=>Jt,Jg:()=>ut,VQ:()=>zt,bo:()=>u,cQ:()=>mt,cw:()=>D,t3:()=>wt,xK:()=>Kt,xh:()=>E});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/binary.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/math.js"),st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/number.js"),N=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/string.js"),I=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/error.js");const b=I.vt("Unexpected end of array"),g=I.vt("Integer out of Range");class L{constructor(tt){this.arr=tt,this.pos=0}}const M=Y=>new L(Y),d=Y=>Y.pos!==Y.arr.length,m=(Y,tt=Y.pos)=>{const vt=M(Y.arr);return vt.pos=tt,vt},h=(Y,tt)=>{const vt=new Uint8Array(Y.arr.buffer,Y.pos+Y.arr.byteOffset,tt);return Y.pos+=tt,vt},u=Y=>h(Y,D(Y)),x=Y=>h(Y,Y.arr.length-Y.pos),T=Y=>Y.pos++,E=Y=>Y.arr[Y.pos++],j=Y=>{const tt=Y.arr[Y.pos]+(Y.arr[Y.pos+1]<<8);return Y.pos+=2,tt},a=Y=>{const tt=Y.arr[Y.pos]+(Y.arr[Y.pos+1]<<8)+(Y.arr[Y.pos+2]<<16)+(Y.arr[Y.pos+3]<<24)>>>0;return Y.pos+=4,tt},v=Y=>{const tt=Y.arr[Y.pos+3]+(Y.arr[Y.pos+2]<<8)+(Y.arr[Y.pos+1]<<16)+(Y.arr[Y.pos]<<24)>>>0;return Y.pos+=4,tt},y=Y=>Y.arr[Y.pos],R=Y=>Y.arr[Y.pos]+(Y.arr[Y.pos+1]<<8),_=Y=>Y.arr[Y.pos]+(Y.arr[Y.pos+1]<<8)+(Y.arr[Y.pos+2]<<16)+(Y.arr[Y.pos+3]<<24)>>>0,D=Y=>{let tt=0,vt=1;const P=Y.arr.length;for(;Y.pos<P;){const w=Y.arr[Y.pos++];if(tt=tt+(w&rt.WD)*vt,vt*=128,w<rt.wt)return tt;if(tt>st.Is)throw g}throw b},z=Y=>{let tt=Y.arr[Y.pos++],vt=tt&rt.P1,P=64;const w=(tt&rt.D7)>0?-1:1;if(!(tt&rt.wt))return w*vt;const k=Y.arr.length;for(;Y.pos<k;){if(tt=Y.arr[Y.pos++],vt=vt+(tt&rt.WD)*P,P*=128,tt<rt.wt)return w*vt;if(vt>st.Is)throw g}throw b},O=Y=>{const tt=Y.pos,vt=D(Y);return Y.pos=tt,vt},V=Y=>{const tt=Y.pos,vt=z(Y);return Y.pos=tt,vt},X=Y=>{let tt=D(Y);if(tt===0)return"";{let vt=String.fromCodePoint(E(Y));if(--tt<100)for(;tt--;)vt+=String.fromCodePoint(E(Y));else for(;tt>0;){const P=tt<1e4?tt:1e4,w=Y.arr.subarray(Y.pos,Y.pos+P);Y.pos+=P,vt+=String.fromCodePoint.apply(null,w),tt-=P}return decodeURIComponent(escape(vt))}},lt=Y=>N.tv.decode(u(Y)),wt=N.tv?lt:X,St=Y=>{const tt=encoding.createEncoder();let vt;for(;;){if(vt=E(Y),vt===0)return encoding.toUint8Array(tt);vt===1&&(vt=E(Y)),encoding.write(tt,vt)}},Ct=Y=>string.decodeUtf8(St(Y)),Nt=Y=>{const tt=Y.pos,vt=wt(Y);return Y.pos=tt,vt},Lt=(Y,tt)=>{const vt=new DataView(Y.arr.buffer,Y.arr.byteOffset+Y.pos,tt);return Y.pos+=tt,vt},_t=Y=>Lt(Y,4).getFloat32(0,!1),ee=Y=>Lt(Y,8).getFloat64(0,!1),Xt=Y=>Lt(Y,8).getBigInt64(0,!1),at=Y=>Lt(Y,8).getBigUint64(0,!1),et=[Y=>{},Y=>null,z,_t,ee,Xt,Y=>!1,Y=>!0,wt,Y=>{const tt=D(Y),vt={};for(let P=0;P<tt;P++){const w=wt(Y);vt[w]=ut(Y)}return vt},Y=>{const tt=D(Y),vt=[];for(let P=0;P<tt;P++)vt.push(ut(Y));return vt},u],ut=Y=>et[127-E(Y)](Y);class mt extends L{constructor(tt,vt){super(tt),this.reader=vt,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),d(this)?this.count=D(this)+1:this.count=-1),this.count--,this.s}}class Tt extends L{constructor(tt,vt){super(tt),this.s=vt}read(){return this.s+=z(this),this.s}}class Dt extends L{constructor(tt,vt){super(tt),this.s=vt,this.count=0}read(){return this.count===0&&(this.s+=z(this),d(this)?this.count=D(this)+1:this.count=-1),this.count--,this.s}}class zt extends L{constructor(tt){super(tt),this.s=0,this.count=0}read(){if(this.count===0){this.s=z(this);const tt=ft.sj(this.s);this.count=1,tt&&(this.s=-this.s,this.count=D(this)+2)}return this.count--,this.s}}class Qt extends L{constructor(tt){super(tt),this.s=0,this.count=0}read(){if(this.count===0){this.s=z(this);const tt=ft.sj(this.s);this.count=1,tt&&(this.s=-this.s,this.count=D(this)+2)}return this.count--,this.s++}}class Kt extends L{constructor(tt){super(tt),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const tt=z(this),vt=tt&1;this.diff=ft.RI(tt/2),this.count=1,vt&&(this.count=D(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Jt{constructor(tt){this.decoder=new zt(tt),this.str=wt(this.decoder),this.spos=0}read(){const tt=this.spos+this.decoder.read(),vt=this.str.slice(this.spos,tt);return this.spos=tt,vt}}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/encoding.js":(Ht,kt,J)=>{"use strict";J.d(kt,{D$:()=>Jt,FA:()=>vt,Fo:()=>m,Gu:()=>Lt,IO:()=>Tt,LH:()=>Nt,QJ:()=>T,Qj:()=>lt,Sw:()=>P,cq:()=>Dt,xv:()=>g,zd:()=>_});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/math.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/number.js"),st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/binary.js"),N=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/string.js"),I=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/array.js");class b{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const g=()=>new b,L=w=>{const k=g();return w(k),m(k)},M=w=>{let k=w.cpos;for(let Z=0;Z<w.bufs.length;Z++)k+=w.bufs[Z].length;return k},d=w=>w.cpos>0||w.bufs.length>0,m=w=>{const k=new Uint8Array(M(w));let Z=0;for(let pt=0;pt<w.bufs.length;pt++){const n=w.bufs[pt];k.set(n,Z),Z+=n.length}return k.set(new Uint8Array(w.cbuf.buffer,0,w.cpos),Z),k},h=(w,k)=>{const Z=w.cbuf.length;Z-w.cpos<k&&(w.bufs.push(new Uint8Array(w.cbuf.buffer,0,w.cpos)),w.cbuf=new Uint8Array(rt.T9(Z,k)*2),w.cpos=0)},u=(w,k)=>{const Z=w.cbuf.length;w.cpos===Z&&(w.bufs.push(w.cbuf),w.cbuf=new Uint8Array(Z*2),w.cpos=0),w.cbuf[w.cpos++]=k},x=(w,k,Z)=>{let pt=null;for(let n=0;n<w.bufs.length&&pt===null;n++){const s=w.bufs[n];k<s.length?pt=s:k-=s.length}pt===null&&(pt=w.cbuf),pt[k]=Z},T=u,E=null,j=(w,k)=>{u(w,k&binary.BITS8),u(w,k>>>8&binary.BITS8)},a=(w,k,Z)=>{x(w,k,Z&binary.BITS8),x(w,k+1,Z>>>8&binary.BITS8)},v=(w,k)=>{for(let Z=0;Z<4;Z++)u(w,k&binary.BITS8),k>>>=8},y=(w,k)=>{for(let Z=3;Z>=0;Z--)u(w,k>>>8*Z&binary.BITS8)},R=(w,k,Z)=>{for(let pt=0;pt<4;pt++)x(w,k+pt,Z&binary.BITS8),Z>>>=8},_=(w,k)=>{for(;k>st.WD;)u(w,st.wt|st.WD&k),k=rt.RI(k/128);u(w,st.WD&k)},D=(w,k)=>{const Z=rt.sj(k);for(Z&&(k=-k),u(w,(k>st.P1?st.wt:0)|(Z?st.D7:0)|st.P1&k),k=rt.RI(k/64);k>0;)u(w,(k>st.WD?st.wt:0)|st.WD&k),k=rt.RI(k/128)},z=new Uint8Array(3e4),O=z.length/3,V=(w,k)=>{if(k.length<O){const Z=N.db.encodeInto(k,z).written||0;_(w,Z);for(let pt=0;pt<Z;pt++)u(w,z[pt])}else Lt(w,N.Af(k))},X=(w,k)=>{const Z=unescape(encodeURIComponent(k)),pt=Z.length;_(w,pt);for(let n=0;n<pt;n++)u(w,Z.codePointAt(n))},lt=N.db&&N.db.encodeInto?V:X,wt=(w,k)=>St(w,string.encodeUtf8(k)),St=(w,k)=>{for(let Z=0;Z<k.length;Z++){const pt=k[Z];(pt===0||pt===1)&&u(w,1),u(w,k[Z])}u(w,0)},Ct=(w,k)=>Nt(w,m(k)),Nt=(w,k)=>{const Z=w.cbuf.length,pt=w.cpos,n=rt.jk(Z-pt,k.length),s=k.length-n;w.cbuf.set(k.subarray(0,n),pt),w.cpos+=n,s>0&&(w.bufs.push(w.cbuf),w.cbuf=new Uint8Array(rt.T9(Z*2,s)),w.cbuf.set(k.subarray(n)),w.cpos=s)},Lt=(w,k)=>{_(w,k.byteLength),Nt(w,k)},_t=(w,k)=>{h(w,k);const Z=new DataView(w.cbuf.buffer,w.cpos,k);return w.cpos+=k,Z},ee=(w,k)=>_t(w,4).setFloat32(0,k,!1),Xt=(w,k)=>_t(w,8).setFloat64(0,k,!1),at=(w,k)=>_t(w,8).setBigInt64(0,k,!1),et=(w,k)=>_t(w,8).setBigUint64(0,k,!1),ut=new DataView(new ArrayBuffer(4)),mt=w=>(ut.setFloat32(0,w),ut.getFloat32(0)===w),Tt=(w,k)=>{switch(typeof k){case"string":u(w,119),lt(w,k);break;case"number":ft.Fq(k)&&rt.tn(k)<=st.vZ?(u(w,125),D(w,k)):mt(k)?(u(w,124),ee(w,k)):(u(w,123),Xt(w,k));break;case"bigint":u(w,122),at(w,k);break;case"object":if(k===null)u(w,126);else if(I.cy(k)){u(w,117),_(w,k.length);for(let Z=0;Z<k.length;Z++)Tt(w,k[Z])}else if(k instanceof Uint8Array)u(w,116),Lt(w,k);else{u(w,118);const Z=Object.keys(k);_(w,Z.length);for(let pt=0;pt<Z.length;pt++){const n=Z[pt];lt(w,n),Tt(w,k[n])}}break;case"boolean":u(w,k?120:121);break;default:u(w,127)}};class Dt extends b{constructor(k){super(),this.w=k,this.s=null,this.count=0}write(k){this.s===k?this.count++:(this.count>0&&_(this,this.count-1),this.count=1,this.w(this,k),this.s=k)}}class zt extends b{constructor(k){super(),this.s=k}write(k){D(this,k-this.s),this.s=k}}class Qt extends b{constructor(k){super(),this.s=k,this.count=0}write(k){this.s===k&&this.count>0?this.count++:(this.count>0&&_(this,this.count-1),this.count=1,D(this,k-this.s),this.s=k)}}const Kt=w=>{w.count>0&&(D(w.encoder,w.count===1?w.s:-w.s),w.count>1&&_(w.encoder,w.count-2))};class Jt{constructor(){this.encoder=new b,this.s=0,this.count=0}write(k){this.s===k?this.count++:(Kt(this),this.count=1,this.s=k)}toUint8Array(){return Kt(this),m(this.encoder)}}class Y{constructor(){this.encoder=new b,this.s=0,this.count=0}write(k){this.s+this.count===k?this.count++:(Kt(this),this.count=1,this.s=k)}toUint8Array(){return Kt(this),m(this.encoder)}}const tt=w=>{if(w.count>0){const k=w.diff*2+(w.count===1?0:1);D(w.encoder,k),w.count>1&&_(w.encoder,w.count-2)}};class vt{constructor(){this.encoder=new b,this.s=0,this.count=0,this.diff=0}write(k){this.diff===k-this.s?(this.s=k,this.count++):(tt(this),this.count=1,this.diff=k-this.s,this.s=k)}toUint8Array(){return tt(this),m(this.encoder)}}class P{constructor(){this.sarr=[],this.s="",this.lensE=new Jt}write(k){this.s+=k,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(k.length)}toUint8Array(){const k=new b;return this.sarr.push(this.s),this.s="",lt(k,this.sarr.join("")),Nt(k,this.lensE.toUint8Array()),m(k)}}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/environment.js":(Ht,kt,J)=>{"use strict";J.d(kt,{dn:()=>T,Bd:()=>L,WI:()=>R});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/map.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/string.js");const st=_=>_===void 0?null:_;var N=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/storage.js"),I=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/function.js"),b=J("../../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");const g=typeof b!="undefined"&&b.release&&/node|io\.js/.test(b.release.name)&&Object.prototype.toString.call(typeof b!="undefined"?b:0)==="[object process]",L=typeof window!="undefined"&&typeof document!="undefined"&&!g,M=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;let d;const m=[],h=()=>{if(d===void 0)if(g){d=rt.vt();const _=b.argv;let D=null;for(let z=0;z<_.length;z++){const O=_[z];O[0]==="-"?(D!==null&&d.set(D,""),D=O):D!==null?(d.set(D,O),D=null):m.push(O)}D!==null&&d.set(D,"")}else typeof location=="object"?(d=rt.vt(),(location.search||"?").slice(1).split("&").forEach(_=>{if(_.length!==0){const[D,z]=_.split("=");d.set(`--${ft.jN(D,"-")}`,z),d.set(`-${ft.jN(D,"-")}`,z)}})):d=rt.vt();return d},u=_=>h().has(_),x=(_,D)=>h().get(_)||D,T=_=>st(g?b.env[_.toUpperCase().replaceAll("-","_")]:N.JT.getItem(_)),E=_=>h().get("--"+_)||T(_),j=_=>{const D=E(_);if(D==null)throw new Error(`Expected configuration "${_.toUpperCase().replaceAll("-","_")}"`);return D},a=_=>u("--"+_)||T(_)!==null,v=a("production"),R=g&&I.EK(b.env.FORCE_COLOR,["true","1","2"])||!u("--no-colors")&&!a("no-color")&&(!g||b.stdout.isTTY)&&(!g||u("--color")||T("COLORTERM")!==null||(T("TERM")||"").includes("color"))},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/error.js":(Ht,kt,J)=>{"use strict";J.d(kt,{Mq:()=>st,bD:()=>ft,vt:()=>rt});const rt=N=>new Error(N),ft=()=>{throw rt("Method unimplemented")},st=()=>{throw rt("Unexpected case")}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/function.js":(Ht,kt,J)=>{"use strict";J.d(kt,{EK:()=>d,OK:()=>st,id:()=>b,mT:()=>N,vo:()=>M});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/array.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/object.js");const st=(E,j,a=0)=>{try{for(;a<E.length;a++)E[a](...j)}finally{a<E.length&&st(E,j,a+1)}},N=()=>{},I=E=>E(),b=E=>E,g=(E,j)=>E===j,L=(E,j)=>E===j||E!=null&&j!=null&&E.constructor===j.constructor&&(array.isArray(E)&&array.equalFlat(E,j)||typeof E=="object"&&object.equalFlat(E,j)),M=(E,j)=>{if(E==null||j==null)return g(E,j);if(E.constructor!==j.constructor)return!1;if(E===j)return!0;switch(E.constructor){case ArrayBuffer:E=new Uint8Array(E),j=new Uint8Array(j);case Uint8Array:{if(E.byteLength!==j.byteLength)return!1;for(let a=0;a<E.length;a++)if(E[a]!==j[a])return!1;break}case Set:{if(E.size!==j.size)return!1;for(const a of E)if(!j.has(a))return!1;break}case Map:{if(E.size!==j.size)return!1;for(const a of E.keys())if(!j.has(a)||!M(E.get(a),j.get(a)))return!1;break}case Object:if(ft.Bw(E)!==ft.Bw(j))return!1;for(const a in E)if(!ft.i5(E,a)||!M(E[a],j[a]))return!1;break;case Array:if(E.length!==j.length)return!1;for(let a=0;a<E.length;a++)if(!M(E[a],j[a]))return!1;break;default:return!1}return!0},d=(E,j)=>j.includes(E),m=rt.cy,h=E=>E&&E.constructor===String,u=E=>E!=null&&E.constructor===Number,x=(E,j)=>E&&E.constructor===j,T=E=>j=>j&&j.constructor===E},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.common.js":(Ht,kt,J)=>{"use strict";J.d(kt,{ft:()=>d,Y:()=>L,AV:()=>h,Qu:()=>m,hN:()=>T,hr:()=>x,UH:()=>u,Ny:()=>M,Tx:()=>E,ET:()=>j,Xv:()=>R});const rt=Symbol,ft=_=>typeof _=="symbol";var st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/time.js"),N=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/environment.js"),I=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/function.js");const b=JSON.stringify,g=JSON.parse,L=rt(),M=rt(),d=rt(),m=rt(),h=rt(),u=rt(),x=rt(),T=rt(),E=rt(),j=_=>{var V;_.length===1&&((V=_[0])==null?void 0:V.constructor)===Function&&(_=_[0]());const D=[],z=[];let O=0;for(;O<_.length;O++){const X=_[O];if(X===void 0)break;if(X.constructor===String||X.constructor===Number)D.push(X);else if(X.constructor===Object)break}for(O>0&&z.push(D.join(""));O<_.length;O++){const X=_[O];X instanceof Symbol||z.push(X)}return z},a=[h,x,T,d];let v=0,y=st._g();const R=(_,D)=>{const z=a[v],O=N.dn("log"),V=O!==null&&(O==="*"||O==="true"||new RegExp(O,"gi").test(D));return v=(v+1)%a.length,D+=": ",V?(...X)=>{var St;X.length===1&&((St=X[0])==null?void 0:St.constructor)===Function&&(X=X[0]());const lt=st._g(),wt=lt-y;y=lt,_(z,D,E,...X.map(Ct=>{switch(Ct!=null&&Ct.constructor===Uint8Array&&(Ct=Array.from(Ct)),typeof Ct){case"string":case"symbol":return Ct;default:return b(Ct)}}),z," +"+wt+"ms")}:I.mT}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.js":(Ht,kt,J)=>{"use strict";J.d(kt,{Xv:()=>ie,yy:()=>k,R8:()=>Z});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/environment.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/set.js");class st{constructor(it,bt){this.left=it,this.right=bt}}const N=(Q,it)=>new st(Q,it),I=(Q,it)=>new st(it,Q),b=(Q,it)=>Q.forEach(bt=>it(bt.left,bt.right)),g=(Q,it)=>Q.map(bt=>it(bt.left,bt.right));var L=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/map.js");const M=typeof document!="undefined"?document:{},d=Q=>M.createElement(Q),m=()=>M.createDocumentFragment(),h=Q=>M.createTextNode(Q),u=typeof DOMParser!="undefined"?new DOMParser:null,x=(Q,it,bt)=>Q.dispatchEvent(new CustomEvent(it,bt)),T=(Q,it)=>(pair.forEach(it,(bt,Mt)=>{Mt===!1?Q.removeAttribute(bt):Mt===!0?Q.setAttribute(bt,""):Q.setAttribute(bt,Mt)}),Q),E=(Q,it)=>(it.forEach((bt,Mt)=>{Q.setAttribute(Mt,bt)}),Q),j=Q=>{const it=m();for(let bt=0;bt<Q.length;bt++)et(it,Q[bt]);return it},a=(Q,it)=>(et(Q,j(it)),Q),v=Q=>Q.remove(),y=(Q,it,bt)=>Q.addEventListener(it,bt),R=(Q,it,bt)=>Q.removeEventListener(it,bt),_=(Q,it)=>(pair.forEach(it,(bt,Mt)=>y(Q,bt,Mt)),Q),D=(Q,it)=>(pair.forEach(it,(bt,Mt)=>R(Q,bt,Mt)),Q),z=(Q,it=[],bt=[])=>a(T(d(Q),it),bt),O=(Q,it)=>{const bt=d("canvas");return bt.height=it,bt.width=Q,bt},V=null,X=Q=>`${Q.left}:${Q.right};`,lt=Q=>Q.map(X).join(""),wt=Q=>L.Tj(Q,(it,bt)=>`${bt}:${it};`).join(""),St=(Q,it)=>Q.querySelector(it),Ct=(Q,it)=>Q.querySelectorAll(it),Nt=Q=>M.getElementById(Q),Lt=Q=>u.parseFromString(`<html><body>${Q}</body></html>`,"text/html").body,_t=Q=>j(Lt(Q).childNodes),ee=Q=>Lt(Q).firstElementChild,Xt=(Q,it)=>Q.replaceWith(it),at=(Q,it,bt)=>Q.insertBefore(it,bt),et=(Q,it)=>Q.appendChild(it),ut=M.ELEMENT_NODE,mt=M.TEXT_NODE,Tt=M.CDATA_SECTION_NODE,Dt=M.COMMENT_NODE,zt=M.DOCUMENT_NODE,Qt=M.DOCUMENT_TYPE_NODE,Kt=M.DOCUMENT_FRAGMENT_NODE,Jt=(Q,it)=>Q.nodeType===it,Y=(Q,it)=>{let bt=it.parentNode;for(;bt&&bt!==Q;)bt=bt.parentNode;return bt===Q};var tt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.common.js");const vt={[tt.Y]:N("font-weight","bold"),[tt.Ny]:N("font-weight","normal"),[tt.ft]:N("color","blue"),[tt.AV]:N("color","green"),[tt.Qu]:N("color","grey"),[tt.UH]:N("color","red"),[tt.hr]:N("color","purple"),[tt.hN]:N("color","orange"),[tt.Tx]:N("color","black")},P=Q=>{var ne;Q.length===1&&((ne=Q[0])==null?void 0:ne.constructor)===Function&&(Q=Q[0]());const it=[],bt=[],Mt=L.vt();let yt=[],qt=0;for(;qt<Q.length;qt++){const se=Q[qt],de=vt[se];if(de!==void 0)Mt.set(de.left,de.right);else{if(se===void 0)break;if(se.constructor===String||se.constructor===Number){const xe=wt(Mt);qt>0||xe.length>0?(it.push("%c"+se),bt.push(xe)):it.push(se)}else break}}for(qt>0&&(yt=bt,yt.unshift(it.join("")));qt<Q.length;qt++){const se=Q[qt];se instanceof Symbol||yt.push(se)}return yt},w=rt.WI?P:tt.ET,k=(...Q)=>{console.log(...w(Q)),Rt.forEach(it=>it.print(Q))},Z=(...Q)=>{console.warn(...w(Q)),Q.unshift(tt.hN),Rt.forEach(it=>it.print(Q))},pt=Q=>{console.error(Q),Rt.forEach(it=>it.printError(Q))},n=(Q,it)=>{env.isBrowser&&console.log("%c                      ",`font-size: ${it}px; background-size: contain; background-repeat: no-repeat; background-image: url(${Q})`),Rt.forEach(bt=>bt.printImg(Q,it))},s=(Q,it)=>n(`data:image/gif;base64,${Q}`,it),l=(...Q)=>{console.group(...w(Q)),Rt.forEach(it=>it.group(Q))},C=(...Q)=>{console.groupCollapsed(...w(Q)),Rt.forEach(it=>it.groupCollapsed(Q))},K=()=>{console.groupEnd(),Rt.forEach(Q=>Q.groupEnd())},G=Q=>Rt.forEach(it=>it.printDom(Q())),ct=(Q,it)=>n(Q.toDataURL(),it),Rt=ft.vt(),Wt=Q=>{const it=[],bt=new Map;let Mt=0;for(;Mt<Q.length;Mt++){let yt=Q[Mt];const qt=vt[yt];if(qt!==void 0)bt.set(qt.left,qt.right);else if(yt===void 0&&(yt="undefined "),yt.constructor===String||yt.constructor===Number){const ne=dom.element("span",[pair.create("style",dom.mapToStyleString(bt))],[dom.text(yt.toString())]);ne.innerHTML===""&&(ne.innerHTML="&nbsp;"),it.push(ne)}else break}for(;Mt<Q.length;Mt++){let yt=Q[Mt];yt instanceof Symbol||(yt.constructor!==String&&yt.constructor!==Number&&(yt=" "+json.stringify(yt)+" "),it.push(dom.element("span",[],[dom.text(yt)])))}return it},xt="font-family:monospace;border-bottom:1px solid #e2e2e2;padding:2px;";class Ut{constructor(it){this.dom=it,this.ccontainer=this.dom,this.depth=0,Rt.add(this)}group(it,bt=!1){eventloop.enqueue(()=>{const Mt=dom.element("span",[pair.create("hidden",bt),pair.create("style","color:grey;font-size:120%;")],[dom.text("\u25BC")]),yt=dom.element("span",[pair.create("hidden",!bt),pair.create("style","color:grey;font-size:125%;")],[dom.text("\u25B6")]),qt=dom.element("div",[pair.create("style",`${xt};padding-left:${this.depth*10}px`)],[Mt,yt,dom.text(" ")].concat(Wt(it))),ne=dom.element("div",[pair.create("hidden",bt)]),se=dom.element("div",[],[qt,ne]);dom.append(this.ccontainer,[se]),this.ccontainer=ne,this.depth++,dom.addEventListener(qt,"click",de=>{ne.toggleAttribute("hidden"),Mt.toggleAttribute("hidden"),yt.toggleAttribute("hidden")})})}groupCollapsed(it){this.group(it,!0)}groupEnd(){eventloop.enqueue(()=>{this.depth>0&&(this.depth--,this.ccontainer=this.ccontainer.parentElement.parentElement)})}print(it){eventloop.enqueue(()=>{dom.append(this.ccontainer,[dom.element("div",[pair.create("style",`${xt};padding-left:${this.depth*10}px`)],Wt(it))])})}printError(it){this.print([common.RED,common.BOLD,it.toString()])}printImg(it,bt){eventloop.enqueue(()=>{dom.append(this.ccontainer,[dom.element("img",[pair.create("src",it),pair.create("height",`${math.round(bt*1.5)}px`)])])})}printDom(it){eventloop.enqueue(()=>{dom.append(this.ccontainer,[it])})}destroy(){eventloop.enqueue(()=>{Rt.delete(this)})}}const jt=Q=>new Ut(Q),ie=Q=>tt.Xv(k,Q)},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/map.js":(Ht,kt,J)=>{"use strict";J.d(kt,{C:()=>ft,Tj:()=>N,_4:()=>st,bz:()=>I,vt:()=>rt});const rt=()=>new Map,ft=g=>{const L=rt();return g.forEach((M,d)=>{L.set(d,M)}),L},st=(g,L,M)=>{let d=g.get(L);return d===void 0&&g.set(L,d=M()),d},N=(g,L)=>{const M=[];for(const[d,m]of g)M.push(L(m,d));return M},I=(g,L)=>{for(const[M,d]of g)if(L(d,M))return!0;return!1},b=(g,L)=>{for(const[M,d]of g)if(!L(d,M))return!1;return!0}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/math.js":(Ht,kt,J)=>{"use strict";J.d(kt,{RI:()=>rt,T9:()=>h,YL:()=>b,jk:()=>m,sj:()=>j,tn:()=>st});const rt=Math.floor,ft=Math.ceil,st=Math.abs,N=Math.imul,I=Math.round,b=Math.log10,g=Math.log2,L=Math.log,M=Math.sqrt,d=(a,v)=>a+v,m=(a,v)=>a<v?a:v,h=(a,v)=>a>v?a:v,u=Number.isNaN,x=Math.pow,T=a=>Math.pow(10,a),E=Math.sign,j=a=>a!==0?a<0:1/a<0},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/number.js":(Ht,kt,J)=>{"use strict";J.d(kt,{Fq:()=>L,Is:()=>st});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/math.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/binary.js");const st=Number.MAX_SAFE_INTEGER,N=Number.MIN_SAFE_INTEGER,I=null,b=ft.vZ,g=ft.CW,L=Number.isInteger||(h=>typeof h=="number"&&isFinite(h)&&rt.RI(h)===h),M=Number.isNaN,d=Number.parseInt,m=h=>{h&=binary.BITS32;let u=0;for(;h;)h&=h-1,u++;return u}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/object.js":(Ht,kt,J)=>{"use strict";J.d(kt,{Bw:()=>b,Im:()=>M,SQ:()=>h,i5:()=>m,jJ:()=>N,kp:()=>ft});const rt=()=>Object.create(null),ft=Object.assign,st=Object.keys,N=(u,x)=>{for(const T in u)x(u[T],T)},I=(u,x)=>{const T=[];for(const E in u)T.push(x(u[E],E));return T},b=u=>st(u).length,g=u=>st(u).length,L=(u,x)=>{for(const T in u)if(x(u[T],T))return!0;return!1},M=u=>{for(const x in u)return!1;return!0},d=(u,x)=>{for(const T in u)if(!x(u[T],T))return!1;return!0},m=(u,x)=>Object.prototype.hasOwnProperty.call(u,x),h=(u,x)=>u===x||g(u)===g(x)&&d(u,(T,E)=>(T!==void 0||m(x,E))&&x[E]===T)},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/observable.js":(Ht,kt,J)=>{"use strict";J.d(kt,{W:()=>N,c:()=>I});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/map.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/set.js"),st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/array.js");class N{constructor(){this._observers=rt.vt()}on(g,L){return rt._4(this._observers,g,ft.vt).add(L),L}once(g,L){const M=(...d)=>{this.off(g,M),L(...d)};this.on(g,M)}off(g,L){const M=this._observers.get(g);M!==void 0&&(M.delete(L),M.size===0&&this._observers.delete(g))}emit(g,L){return st.HT((this._observers.get(g)||rt.vt()).values()).forEach(M=>M(...L))}destroy(){this._observers=rt.vt()}}class I{constructor(){this._observers=rt.vt()}on(g,L){rt._4(this._observers,g,ft.vt).add(L)}once(g,L){const M=(...d)=>{this.off(g,M),L(...d)};this.on(g,M)}off(g,L){const M=this._observers.get(g);M!==void 0&&(M.delete(L),M.size===0&&this._observers.delete(g))}emit(g,L){return st.HT((this._observers.get(g)||rt.vt()).values()).forEach(M=>M(...L))}destroy(){this._observers=rt.vt()}}},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/promise.js":(Ht,kt,J)=>{"use strict";J.d(kt,{hd:()=>I,ku:()=>N,vt:()=>rt});const rt=m=>new Promise(m),ft=m=>new Promise(m),st=Promise.all.bind(Promise),N=m=>Promise.reject(m),I=m=>Promise.resolve(m),b=m=>Promise.resolve(m),g=(m,h,u=10)=>rt((x,T)=>{const E=time.getUnixTime(),j=m>0,v=setInterval(()=>{h()?(clearInterval(v),x()):j&&time.getUnixTime()-E>m&&(clearInterval(v),T(new Error("Timeout")))},u)}),L=async(m,h=0,u=10)=>{const x=time.getUnixTime(),T=h<=0;for(;T||time.getUnixTime()-x<=h;){if(await m())return;await M(u)}throw new Error("Timeout")},M=m=>rt((h,u)=>setTimeout(h,m)),d=m=>m instanceof Promise||m&&m.then&&m.catch&&m.finally},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/random.js":(Ht,kt,J)=>{"use strict";J.d(kt,{_9:()=>st,S8:()=>N,gZ:()=>L});const rt=crypto.subtle,ft=crypto.getRandomValues.bind(crypto),st=Math.random,N=()=>ft(new Uint32Array(1))[0],I=()=>{const M=getRandomValues(new Uint32Array(8));return(M[0]&binary.BITS21)*(binary.BITS32+1)+(M[1]>>>0)},b=M=>M[math.floor(st()*M.length)],g=[1e7]+-1e3+-4e3+-8e3+-1e11,L=()=>g.replace(/[018]/g,M=>(M^N()&15>>M/4).toString(16))},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/set.js":(Ht,kt,J)=>{"use strict";J.d(kt,{vt:()=>rt});const rt=()=>new Set,ft=I=>Array.from(I),st=I=>{var b;return(b=I.values().next().value)!=null?b:void 0},N=I=>new Set(I)},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/storage.js":(Ht,kt,J)=>{"use strict";J.d(kt,{JT:()=>N,k9:()=>I,o6:()=>b});class rt{constructor(){this.map=new Map}setItem(L,M){this.map.set(L,M)}getItem(L){return this.map.get(L)}}let ft=new rt,st=!0;try{typeof localStorage!="undefined"&&localStorage&&(ft=localStorage,st=!1)}catch(g){}const N=ft,I=g=>st||addEventListener("storage",g),b=g=>st||removeEventListener("storage",g)},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/string.js":(Ht,kt,J)=>{"use strict";J.d(kt,{Af:()=>u,QV:()=>rt,db:()=>m,jN:()=>L,tv:()=>T});const rt=String.fromCharCode,ft=String.fromCodePoint,st=rt(65535),N=y=>y.toLowerCase(),I=/^\s*/g,b=y=>y.replace(I,""),g=/([A-Z])/g,L=(y,R)=>b(y.replace(g,_=>`${R}${N(_)}`)),M=y=>unescape(encodeURIComponent(y)).length,d=y=>{const R=unescape(encodeURIComponent(y)),_=R.length,D=new Uint8Array(_);for(let z=0;z<_;z++)D[z]=R.codePointAt(z);return D},m=typeof TextEncoder!="undefined"?new TextEncoder:null,u=m?y=>m.encode(y):d,x=y=>{let R=y.length,_="",D=0;for(;R>0;){const z=R<1e4?R:1e4,O=y.subarray(D,D+z);D+=z,_+=String.fromCodePoint.apply(null,O),R-=z}return decodeURIComponent(escape(_))};let T=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});T&&T.decode(new Uint8Array).length===1&&(T=null);const E=y=>T.decode(y),j=null,a=(y,R,_,D="")=>y.slice(0,R)+D+y.slice(R+_),v=(y,R)=>array.unfold(R,()=>y).join("")},"../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/time.js":(Ht,kt,J)=>{"use strict";J.d(kt,{_g:()=>ft});const rt=()=>new Date,ft=Date.now,st=N=>{if(N<6e4){const M=metric.prefix(N,-1);return math.round(M.n*100)/100+M.prefix+"s"}N=math.floor(N/1e3);const I=N%60,b=math.floor(N/60)%60,g=math.floor(N/3600)%24,L=math.floor(N/86400);return L>0?L+"d"+(g>0||b>30?" "+(b>30?g+1:g)+"h":""):g>0?g+"h"+(b>0||I>30?" "+(I>30?b+1:b)+"min":""):b+"min"+(I>0?" "+I+"s":"")}},"../../../node_modules/.pnpm/simple-peer@9.11.1/node_modules/simple-peer/simplepeer.min.js":(Ht,kt,J)=>{(function(rt){if(!0)Ht.exports=rt();else var ft})(function(){var rt=Math.floor,ft=Math.abs,st=Math.pow;return function(){function N(I,b,g){function L(m,h){if(!b[m]){if(!I[m]){var u=void 0;if(!h&&J("../../../node_modules/.pnpm/simple-peer@9.11.1/node_modules/simple-peer sync recursive"))return require(m,!0);if(M)return M(m,!0);var x=new Error("Cannot find module '"+m+"'");throw x.code="MODULE_NOT_FOUND",x}var T=b[m]={exports:{}};I[m][0].call(T.exports,function(E){var j=I[m][1][E];return L(j||E)},T,T.exports,N,I,b,g)}return b[m].exports}for(var M=void 0,d=0;d<g.length;d++)L(g[d]);return L}return N}()({1:[function(N,I,b){"use strict";function g(v){var y=v.length;if(0<y%4)throw new Error("Invalid string. Length must be a multiple of 4");var R=v.indexOf("=");R===-1&&(R=y);var _=R===y?0:4-R%4;return[R,_]}function L(v,y,R){return 3*(y+R)/4-R}function M(v){var y,R,_=g(v),D=_[0],z=_[1],O=new T(L(v,D,z)),V=0,X=0<z?D-4:D;for(R=0;R<X;R+=4)y=x[v.charCodeAt(R)]<<18|x[v.charCodeAt(R+1)]<<12|x[v.charCodeAt(R+2)]<<6|x[v.charCodeAt(R+3)],O[V++]=255&y>>16,O[V++]=255&y>>8,O[V++]=255&y;return z===2&&(y=x[v.charCodeAt(R)]<<2|x[v.charCodeAt(R+1)]>>4,O[V++]=255&y),z===1&&(y=x[v.charCodeAt(R)]<<10|x[v.charCodeAt(R+1)]<<4|x[v.charCodeAt(R+2)]>>2,O[V++]=255&y>>8,O[V++]=255&y),O}function d(v){return u[63&v>>18]+u[63&v>>12]+u[63&v>>6]+u[63&v]}function m(v,y,R){for(var _,D=[],z=y;z<R;z+=3)_=(16711680&v[z]<<16)+(65280&v[z+1]<<8)+(255&v[z+2]),D.push(d(_));return D.join("")}function h(v){for(var y,R=v.length,_=R%3,D=[],z=16383,O=0,V=R-_;O<V;O+=z)D.push(m(v,O,O+z>V?V:O+z));return _===1?(y=v[R-1],D.push(u[y>>2]+u[63&y<<4]+"==")):_===2&&(y=(v[R-2]<<8)+v[R-1],D.push(u[y>>10]+u[63&y>>4]+u[63&y<<2]+"=")),D.join("")}b.byteLength=function(v){var y=g(v),R=y[0],_=y[1];return 3*(R+_)/4-_},b.toByteArray=M,b.fromByteArray=h;for(var u=[],x=[],T=typeof Uint8Array=="undefined"?Array:Uint8Array,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",j=0,a=E.length;j<a;++j)u[j]=E[j],x[E.charCodeAt(j)]=j;x[45]=62,x[95]=63},{}],2:[function(){},{}],3:[function(N,I,b){(function(){(function(){/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <https://feross.org>
* @license  MIT
*/"use strict";var g=String.fromCharCode,L=Math.min;function M(n){if(2147483647<n)throw new RangeError('The value "'+n+'" is invalid for option "size"');var s=new Uint8Array(n);return s.__proto__=d.prototype,s}function d(n,s,l){if(typeof n=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return x(n)}return m(n,s,l)}function m(n,s,l){if(typeof n=="string")return T(n,s);if(ArrayBuffer.isView(n))return E(n);if(n==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(P(n,ArrayBuffer)||n&&P(n.buffer,ArrayBuffer))return j(n,s,l);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var C=n.valueOf&&n.valueOf();if(C!=null&&C!==n)return d.from(C,s,l);var K=a(n);if(K)return K;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return d.from(n[Symbol.toPrimitive]("string"),s,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}function h(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(0>n)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function u(n,s,l){return h(n),0>=n||s===void 0?M(n):typeof l=="string"?M(n).fill(s,l):M(n).fill(s)}function x(n){return h(n),M(0>n?0:0|v(n))}function T(n,s){if((typeof s!="string"||s==="")&&(s="utf8"),!d.isEncoding(s))throw new TypeError("Unknown encoding: "+s);var l=0|y(n,s),C=M(l),K=C.write(n,s);return K!==l&&(C=C.slice(0,K)),C}function E(n){for(var s=0>n.length?0:0|v(n.length),l=M(s),C=0;C<s;C+=1)l[C]=255&n[C];return l}function j(n,s,l){if(0>s||n.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<s+(l||0))throw new RangeError('"length" is outside of buffer bounds');var C;return C=s===void 0&&l===void 0?new Uint8Array(n):l===void 0?new Uint8Array(n,s):new Uint8Array(n,s,l),C.__proto__=d.prototype,C}function a(n){if(d.isBuffer(n)){var s=0|v(n.length),l=M(s);return l.length===0||n.copy(l,0,0,s),l}return n.length===void 0?n.type==="Buffer"&&Array.isArray(n.data)?E(n.data):void 0:typeof n.length!="number"||w(n.length)?M(0):E(n)}function v(n){if(n>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|n}function y(n,s){if(d.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||P(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);var l=n.length,C=2<arguments.length&&arguments[2]===!0;if(!C&&l===0)return 0;for(var K=!1;;)switch(s){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return Kt(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*l;case"hex":return l>>>1;case"base64":return tt(n).length;default:if(K)return C?-1:Kt(n).length;s=(""+s).toLowerCase(),K=!0}}function R(n,s,l){var C=!1;if((s===void 0||0>s)&&(s=0),s>this.length||((l===void 0||l>this.length)&&(l=this.length),0>=l)||(l>>>=0,s>>>=0,l<=s))return"";for(n||(n="utf8");;)switch(n){case"hex":return Xt(this,s,l);case"utf8":case"utf-8":return Nt(this,s,l);case"ascii":return _t(this,s,l);case"latin1":case"binary":return ee(this,s,l);case"base64":return Ct(this,s,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return at(this,s,l);default:if(C)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),C=!0}}function _(n,s,l){var C=n[s];n[s]=n[l],n[l]=C}function D(n,s,l,C,K){if(n.length===0)return-1;if(typeof l=="string"?(C=l,l=0):2147483647<l?l=2147483647:-2147483648>l&&(l=-2147483648),l=+l,w(l)&&(l=K?0:n.length-1),0>l&&(l=n.length+l),l>=n.length){if(K)return-1;l=n.length-1}else if(0>l)if(K)l=0;else return-1;if(typeof s=="string"&&(s=d.from(s,C)),d.isBuffer(s))return s.length===0?-1:z(n,s,l,C,K);if(typeof s=="number")return s&=255,typeof Uint8Array.prototype.indexOf=="function"?K?Uint8Array.prototype.indexOf.call(n,s,l):Uint8Array.prototype.lastIndexOf.call(n,s,l):z(n,[s],l,C,K);throw new TypeError("val must be string, number or Buffer")}function z(n,s,l,C,K){function G(Q,it){return ct===1?Q[it]:Q.readUInt16BE(it*ct)}var ct=1,Rt=n.length,Wt=s.length;if(C!==void 0&&(C=(C+"").toLowerCase(),C==="ucs2"||C==="ucs-2"||C==="utf16le"||C==="utf-16le")){if(2>n.length||2>s.length)return-1;ct=2,Rt/=2,Wt/=2,l/=2}var xt;if(K){var Ut=-1;for(xt=l;xt<Rt;xt++)if(G(n,xt)!==G(s,Ut===-1?0:xt-Ut))Ut!==-1&&(xt-=xt-Ut),Ut=-1;else if(Ut===-1&&(Ut=xt),xt-Ut+1===Wt)return Ut*ct}else for(l+Wt>Rt&&(l=Rt-Wt),xt=l;0<=xt;xt--){for(var jt=!0,ie=0;ie<Wt;ie++)if(G(n,xt+ie)!==G(s,ie)){jt=!1;break}if(jt)return xt}return-1}function O(n,s,l,C){l=+l||0;var K=n.length-l;C?(C=+C,C>K&&(C=K)):C=K;var G=s.length;C>G/2&&(C=G/2);for(var ct,Rt=0;Rt<C;++Rt){if(ct=parseInt(s.substr(2*Rt,2),16),w(ct))return Rt;n[l+Rt]=ct}return Rt}function V(n,s,l,C){return vt(Kt(s,n.length-l),n,l,C)}function X(n,s,l,C){return vt(Jt(s),n,l,C)}function lt(n,s,l,C){return X(n,s,l,C)}function wt(n,s,l,C){return vt(tt(s),n,l,C)}function St(n,s,l,C){return vt(Y(s,n.length-l),n,l,C)}function Ct(n,s,l){return s===0&&l===n.length?k.fromByteArray(n):k.fromByteArray(n.slice(s,l))}function Nt(n,s,l){l=L(n.length,l);for(var C=[],K=s;K<l;){var G=n[K],ct=null,Rt=239<G?4:223<G?3:191<G?2:1;if(K+Rt<=l){var Wt,xt,Ut,jt;Rt===1?128>G&&(ct=G):Rt===2?(Wt=n[K+1],(192&Wt)==128&&(jt=(31&G)<<6|63&Wt,127<jt&&(ct=jt))):Rt===3?(Wt=n[K+1],xt=n[K+2],(192&Wt)==128&&(192&xt)==128&&(jt=(15&G)<<12|(63&Wt)<<6|63&xt,2047<jt&&(55296>jt||57343<jt)&&(ct=jt))):Rt===4&&(Wt=n[K+1],xt=n[K+2],Ut=n[K+3],(192&Wt)==128&&(192&xt)==128&&(192&Ut)==128&&(jt=(15&G)<<18|(63&Wt)<<12|(63&xt)<<6|63&Ut,65535<jt&&1114112>jt&&(ct=jt)))}ct===null?(ct=65533,Rt=1):65535<ct&&(ct-=65536,C.push(55296|1023&ct>>>10),ct=56320|1023&ct),C.push(ct),K+=Rt}return Lt(C)}function Lt(n){var s=n.length;if(s<=4096)return g.apply(String,n);for(var l="",C=0;C<s;)l+=g.apply(String,n.slice(C,C+=4096));return l}function _t(n,s,l){var C="";l=L(n.length,l);for(var K=s;K<l;++K)C+=g(127&n[K]);return C}function ee(n,s,l){var C="";l=L(n.length,l);for(var K=s;K<l;++K)C+=g(n[K]);return C}function Xt(n,s,l){var C=n.length;(!s||0>s)&&(s=0),(!l||0>l||l>C)&&(l=C);for(var K="",G=s;G<l;++G)K+=Qt(n[G]);return K}function at(n,s,l){for(var C=n.slice(s,l),K="",G=0;G<C.length;G+=2)K+=g(C[G]+256*C[G+1]);return K}function et(n,s,l){if(n%1!=0||0>n)throw new RangeError("offset is not uint");if(n+s>l)throw new RangeError("Trying to access beyond buffer length")}function ut(n,s,l,C,K,G){if(!d.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>K||s<G)throw new RangeError('"value" argument is out of bounds');if(l+C>n.length)throw new RangeError("Index out of range")}function mt(n,s,l,C){if(l+C>n.length)throw new RangeError("Index out of range");if(0>l)throw new RangeError("Index out of range")}function Tt(n,s,l,C,K){return s=+s,l>>>=0,K||mt(n,s,l,4,34028234663852886e22,-34028234663852886e22),Z.write(n,s,l,C,23,4),l+4}function Dt(n,s,l,C,K){return s=+s,l>>>=0,K||mt(n,s,l,8,17976931348623157e292,-17976931348623157e292),Z.write(n,s,l,C,52,8),l+8}function zt(n){if(n=n.split("=")[0],n=n.trim().replace(pt,""),2>n.length)return"";for(;n.length%4!=0;)n+="=";return n}function Qt(n){return 16>n?"0"+n.toString(16):n.toString(16)}function Kt(n,s){s=s||1/0;for(var l,C=n.length,K=null,G=[],ct=0;ct<C;++ct){if(l=n.charCodeAt(ct),55295<l&&57344>l){if(!K){if(56319<l){-1<(s-=3)&&G.push(239,191,189);continue}else if(ct+1===C){-1<(s-=3)&&G.push(239,191,189);continue}K=l;continue}if(56320>l){-1<(s-=3)&&G.push(239,191,189),K=l;continue}l=(K-55296<<10|l-56320)+65536}else K&&-1<(s-=3)&&G.push(239,191,189);if(K=null,128>l){if(0>(s-=1))break;G.push(l)}else if(2048>l){if(0>(s-=2))break;G.push(192|l>>6,128|63&l)}else if(65536>l){if(0>(s-=3))break;G.push(224|l>>12,128|63&l>>6,128|63&l)}else if(1114112>l){if(0>(s-=4))break;G.push(240|l>>18,128|63&l>>12,128|63&l>>6,128|63&l)}else throw new Error("Invalid code point")}return G}function Jt(n){for(var s=[],l=0;l<n.length;++l)s.push(255&n.charCodeAt(l));return s}function Y(n,s){for(var l,C,K,G=[],ct=0;ct<n.length&&!(0>(s-=2));++ct)l=n.charCodeAt(ct),C=l>>8,K=l%256,G.push(K),G.push(C);return G}function tt(n){return k.toByteArray(zt(n))}function vt(n,s,l,C){for(var K=0;K<C&&!(K+l>=s.length||K>=n.length);++K)s[K+l]=n[K];return K}function P(n,s){return n instanceof s||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===s.name}function w(n){return n!==n}var k=N("base64-js"),Z=N("ieee754");b.Buffer=d,b.SlowBuffer=function(n){return+n!=n&&(n=0),d.alloc(+n)},b.INSPECT_MAX_BYTES=50,b.kMaxLength=2147483647,d.TYPED_ARRAY_SUPPORT=function(){try{var n=new Uint8Array(1);return n.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},n.foo()===42}catch(s){return!1}}(),d.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){return d.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){return d.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol!="undefined"&&Symbol.species!=null&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),d.poolSize=8192,d.from=function(n,s,l){return m(n,s,l)},d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,d.alloc=function(n,s,l){return u(n,s,l)},d.allocUnsafe=function(n){return x(n)},d.allocUnsafeSlow=function(n){return x(n)},d.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==d.prototype},d.compare=function(n,s){if(P(n,Uint8Array)&&(n=d.from(n,n.offset,n.byteLength)),P(s,Uint8Array)&&(s=d.from(s,s.offset,s.byteLength)),!d.isBuffer(n)||!d.isBuffer(s))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===s)return 0;for(var l=n.length,C=s.length,K=0,G=L(l,C);K<G;++K)if(n[K]!==s[K]){l=n[K],C=s[K];break}return l<C?-1:C<l?1:0},d.isEncoding=function(n){switch((n+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(n,s){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return d.alloc(0);var l;if(s===void 0)for(s=0,l=0;l<n.length;++l)s+=n[l].length;var C=d.allocUnsafe(s),K=0;for(l=0;l<n.length;++l){var G=n[l];if(P(G,Uint8Array)&&(G=d.from(G)),!d.isBuffer(G))throw new TypeError('"list" argument must be an Array of Buffers');G.copy(C,K),K+=G.length}return C},d.byteLength=y,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var n=this.length;if(n%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var s=0;s<n;s+=2)_(this,s,s+1);return this},d.prototype.swap32=function(){var n=this.length;if(n%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var s=0;s<n;s+=4)_(this,s,s+3),_(this,s+1,s+2);return this},d.prototype.swap64=function(){var n=this.length;if(n%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var s=0;s<n;s+=8)_(this,s,s+7),_(this,s+1,s+6),_(this,s+2,s+5),_(this,s+3,s+4);return this},d.prototype.toString=function(){var n=this.length;return n===0?"":arguments.length===0?Nt(this,0,n):R.apply(this,arguments)},d.prototype.toLocaleString=d.prototype.toString,d.prototype.equals=function(n){if(!d.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n||d.compare(this,n)===0},d.prototype.inspect=function(){var n="",s=b.INSPECT_MAX_BYTES;return n=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(n+=" ... "),"<Buffer "+n+">"},d.prototype.compare=function(n,s,l,C,K){if(P(n,Uint8Array)&&(n=d.from(n,n.offset,n.byteLength)),!d.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(s===void 0&&(s=0),l===void 0&&(l=n?n.length:0),C===void 0&&(C=0),K===void 0&&(K=this.length),0>s||l>n.length||0>C||K>this.length)throw new RangeError("out of range index");if(C>=K&&s>=l)return 0;if(C>=K)return-1;if(s>=l)return 1;if(s>>>=0,l>>>=0,C>>>=0,K>>>=0,this===n)return 0;for(var G=K-C,ct=l-s,Rt=L(G,ct),Wt=this.slice(C,K),xt=n.slice(s,l),Ut=0;Ut<Rt;++Ut)if(Wt[Ut]!==xt[Ut]){G=Wt[Ut],ct=xt[Ut];break}return G<ct?-1:ct<G?1:0},d.prototype.includes=function(n,s,l){return this.indexOf(n,s,l)!==-1},d.prototype.indexOf=function(n,s,l){return D(this,n,s,l,!0)},d.prototype.lastIndexOf=function(n,s,l){return D(this,n,s,l,!1)},d.prototype.write=function(n,s,l,C){if(s===void 0)C="utf8",l=this.length,s=0;else if(l===void 0&&typeof s=="string")C=s,l=this.length,s=0;else if(isFinite(s))s>>>=0,isFinite(l)?(l>>>=0,C===void 0&&(C="utf8")):(C=l,l=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var K=this.length-s;if((l===void 0||l>K)&&(l=K),0<n.length&&(0>l||0>s)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");C||(C="utf8");for(var G=!1;;)switch(C){case"hex":return O(this,n,s,l);case"utf8":case"utf-8":return V(this,n,s,l);case"ascii":return X(this,n,s,l);case"latin1":case"binary":return lt(this,n,s,l);case"base64":return wt(this,n,s,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return St(this,n,s,l);default:if(G)throw new TypeError("Unknown encoding: "+C);C=(""+C).toLowerCase(),G=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(n,s){var l=this.length;n=~~n,s=s===void 0?l:~~s,0>n?(n+=l,0>n&&(n=0)):n>l&&(n=l),0>s?(s+=l,0>s&&(s=0)):s>l&&(s=l),s<n&&(s=n);var C=this.subarray(n,s);return C.__proto__=d.prototype,C},d.prototype.readUIntLE=function(n,s,l){n>>>=0,s>>>=0,l||et(n,s,this.length);for(var C=this[n],K=1,G=0;++G<s&&(K*=256);)C+=this[n+G]*K;return C},d.prototype.readUIntBE=function(n,s,l){n>>>=0,s>>>=0,l||et(n,s,this.length);for(var C=this[n+--s],K=1;0<s&&(K*=256);)C+=this[n+--s]*K;return C},d.prototype.readUInt8=function(n,s){return n>>>=0,s||et(n,1,this.length),this[n]},d.prototype.readUInt16LE=function(n,s){return n>>>=0,s||et(n,2,this.length),this[n]|this[n+1]<<8},d.prototype.readUInt16BE=function(n,s){return n>>>=0,s||et(n,2,this.length),this[n]<<8|this[n+1]},d.prototype.readUInt32LE=function(n,s){return n>>>=0,s||et(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+16777216*this[n+3]},d.prototype.readUInt32BE=function(n,s){return n>>>=0,s||et(n,4,this.length),16777216*this[n]+(this[n+1]<<16|this[n+2]<<8|this[n+3])},d.prototype.readIntLE=function(n,s,l){n>>>=0,s>>>=0,l||et(n,s,this.length);for(var C=this[n],K=1,G=0;++G<s&&(K*=256);)C+=this[n+G]*K;return K*=128,C>=K&&(C-=st(2,8*s)),C},d.prototype.readIntBE=function(n,s,l){n>>>=0,s>>>=0,l||et(n,s,this.length);for(var C=s,K=1,G=this[n+--C];0<C&&(K*=256);)G+=this[n+--C]*K;return K*=128,G>=K&&(G-=st(2,8*s)),G},d.prototype.readInt8=function(n,s){return n>>>=0,s||et(n,1,this.length),128&this[n]?-1*(255-this[n]+1):this[n]},d.prototype.readInt16LE=function(n,s){n>>>=0,s||et(n,2,this.length);var l=this[n]|this[n+1]<<8;return 32768&l?4294901760|l:l},d.prototype.readInt16BE=function(n,s){n>>>=0,s||et(n,2,this.length);var l=this[n+1]|this[n]<<8;return 32768&l?4294901760|l:l},d.prototype.readInt32LE=function(n,s){return n>>>=0,s||et(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},d.prototype.readInt32BE=function(n,s){return n>>>=0,s||et(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},d.prototype.readFloatLE=function(n,s){return n>>>=0,s||et(n,4,this.length),Z.read(this,n,!0,23,4)},d.prototype.readFloatBE=function(n,s){return n>>>=0,s||et(n,4,this.length),Z.read(this,n,!1,23,4)},d.prototype.readDoubleLE=function(n,s){return n>>>=0,s||et(n,8,this.length),Z.read(this,n,!0,52,8)},d.prototype.readDoubleBE=function(n,s){return n>>>=0,s||et(n,8,this.length),Z.read(this,n,!1,52,8)},d.prototype.writeUIntLE=function(n,s,l,C){if(n=+n,s>>>=0,l>>>=0,!C){var K=st(2,8*l)-1;ut(this,n,s,l,K,0)}var G=1,ct=0;for(this[s]=255&n;++ct<l&&(G*=256);)this[s+ct]=255&n/G;return s+l},d.prototype.writeUIntBE=function(n,s,l,C){if(n=+n,s>>>=0,l>>>=0,!C){var K=st(2,8*l)-1;ut(this,n,s,l,K,0)}var G=l-1,ct=1;for(this[s+G]=255&n;0<=--G&&(ct*=256);)this[s+G]=255&n/ct;return s+l},d.prototype.writeUInt8=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,1,255,0),this[s]=255&n,s+1},d.prototype.writeUInt16LE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,2,65535,0),this[s]=255&n,this[s+1]=n>>>8,s+2},d.prototype.writeUInt16BE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,2,65535,0),this[s]=n>>>8,this[s+1]=255&n,s+2},d.prototype.writeUInt32LE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,4,4294967295,0),this[s+3]=n>>>24,this[s+2]=n>>>16,this[s+1]=n>>>8,this[s]=255&n,s+4},d.prototype.writeUInt32BE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,4,4294967295,0),this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=255&n,s+4},d.prototype.writeIntLE=function(n,s,l,C){if(n=+n,s>>>=0,!C){var K=st(2,8*l-1);ut(this,n,s,l,K-1,-K)}var G=0,ct=1,Rt=0;for(this[s]=255&n;++G<l&&(ct*=256);)0>n&&Rt===0&&this[s+G-1]!==0&&(Rt=1),this[s+G]=255&(n/ct>>0)-Rt;return s+l},d.prototype.writeIntBE=function(n,s,l,C){if(n=+n,s>>>=0,!C){var K=st(2,8*l-1);ut(this,n,s,l,K-1,-K)}var G=l-1,ct=1,Rt=0;for(this[s+G]=255&n;0<=--G&&(ct*=256);)0>n&&Rt===0&&this[s+G+1]!==0&&(Rt=1),this[s+G]=255&(n/ct>>0)-Rt;return s+l},d.prototype.writeInt8=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,1,127,-128),0>n&&(n=255+n+1),this[s]=255&n,s+1},d.prototype.writeInt16LE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,2,32767,-32768),this[s]=255&n,this[s+1]=n>>>8,s+2},d.prototype.writeInt16BE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,2,32767,-32768),this[s]=n>>>8,this[s+1]=255&n,s+2},d.prototype.writeInt32LE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,4,2147483647,-2147483648),this[s]=255&n,this[s+1]=n>>>8,this[s+2]=n>>>16,this[s+3]=n>>>24,s+4},d.prototype.writeInt32BE=function(n,s,l){return n=+n,s>>>=0,l||ut(this,n,s,4,2147483647,-2147483648),0>n&&(n=4294967295+n+1),this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=255&n,s+4},d.prototype.writeFloatLE=function(n,s,l){return Tt(this,n,s,!0,l)},d.prototype.writeFloatBE=function(n,s,l){return Tt(this,n,s,!1,l)},d.prototype.writeDoubleLE=function(n,s,l){return Dt(this,n,s,!0,l)},d.prototype.writeDoubleBE=function(n,s,l){return Dt(this,n,s,!1,l)},d.prototype.copy=function(n,s,l,C){if(!d.isBuffer(n))throw new TypeError("argument should be a Buffer");if(l||(l=0),C||C===0||(C=this.length),s>=n.length&&(s=n.length),s||(s=0),0<C&&C<l&&(C=l),C===l||n.length===0||this.length===0)return 0;if(0>s)throw new RangeError("targetStart out of bounds");if(0>l||l>=this.length)throw new RangeError("Index out of range");if(0>C)throw new RangeError("sourceEnd out of bounds");C>this.length&&(C=this.length),n.length-s<C-l&&(C=n.length-s+l);var K=C-l;if(this===n&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(s,l,C);else if(this===n&&l<s&&s<C)for(var G=K-1;0<=G;--G)n[G+s]=this[G+l];else Uint8Array.prototype.set.call(n,this.subarray(l,C),s);return K},d.prototype.fill=function(n,s,l,C){if(typeof n=="string"){if(typeof s=="string"?(C=s,s=0,l=this.length):typeof l=="string"&&(C=l,l=this.length),C!==void 0&&typeof C!="string")throw new TypeError("encoding must be a string");if(typeof C=="string"&&!d.isEncoding(C))throw new TypeError("Unknown encoding: "+C);if(n.length===1){var K=n.charCodeAt(0);(C==="utf8"&&128>K||C==="latin1")&&(n=K)}}else typeof n=="number"&&(n&=255);if(0>s||this.length<s||this.length<l)throw new RangeError("Out of range index");if(l<=s)return this;s>>>=0,l=l===void 0?this.length:l>>>0,n||(n=0);var G;if(typeof n=="number")for(G=s;G<l;++G)this[G]=n;else{var ct=d.isBuffer(n)?n:d.from(n,C),Rt=ct.length;if(Rt===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(G=0;G<l-s;++G)this[G+s]=ct[G%Rt]}return this};var pt=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,N("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(N,I,b){(function(g){(function(){function L(){let d;try{d=b.storage.getItem("debug")}catch(m){}return!d&&typeof g!="undefined"&&"env"in g&&(d=g.env.DEBUG),d}b.formatArgs=function(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+I.exports.humanize(this.diff),!this.useColors)return;const m="color: "+this.color;d.splice(1,0,m,"color: inherit");let h=0,u=0;d[0].replace(/%[a-zA-Z%]/g,x=>{x==="%%"||(h++,x==="%c"&&(u=h))}),d.splice(u,0,m)},b.save=function(d){try{d?b.storage.setItem("debug",d):b.storage.removeItem("debug")}catch(m){}},b.load=L,b.useColors=function(){return!!(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},b.storage=function(){try{return localStorage}catch(d){}}(),b.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),b.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],b.log=console.debug||console.log||(()=>{}),I.exports=N("./common")(b);const{formatters:M}=I.exports;M.j=function(d){try{return JSON.stringify(d)}catch(m){return"[UnexpectedJSONParseError]: "+m.message}}}).call(this)}).call(this,N("_process"))},{"./common":5,_process:12}],5:[function(N,I){I.exports=function(b){function g(d){function m(...x){if(!m.enabled)return;const T=m,E=+new Date,j=E-(h||E);T.diff=j,T.prev=h,T.curr=E,h=E,x[0]=g.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let a=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(y,R)=>{if(y==="%%")return"%";a++;const _=g.formatters[R];if(typeof _=="function"){const D=x[a];y=_.call(T,D),x.splice(a,1),a--}return y}),g.formatArgs.call(T,x),(T.log||g.log).apply(T,x)}let h,u=null;return m.namespace=d,m.useColors=g.useColors(),m.color=g.selectColor(d),m.extend=L,m.destroy=g.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>u===null?g.enabled(d):u,set:x=>{u=x}}),typeof g.init=="function"&&g.init(m),m}function L(d,m){const h=g(this.namespace+(typeof m=="undefined"?":":m)+d);return h.log=this.log,h}function M(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}return g.debug=g,g.default=g,g.coerce=function(d){return d instanceof Error?d.stack||d.message:d},g.disable=function(){const d=[...g.names.map(M),...g.skips.map(M).map(m=>"-"+m)].join(",");return g.enable(""),d},g.enable=function(d){g.save(d),g.names=[],g.skips=[];let m;const h=(typeof d=="string"?d:"").split(/[\s,]+/),u=h.length;for(m=0;m<u;m++)h[m]&&(d=h[m].replace(/\*/g,".*?"),d[0]==="-"?g.skips.push(new RegExp("^"+d.substr(1)+"$")):g.names.push(new RegExp("^"+d+"$")))},g.enabled=function(d){if(d[d.length-1]==="*")return!0;let m,h;for(m=0,h=g.skips.length;m<h;m++)if(g.skips[m].test(d))return!1;for(m=0,h=g.names.length;m<h;m++)if(g.names[m].test(d))return!0;return!1},g.humanize=N("ms"),g.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(b).forEach(d=>{g[d]=b[d]}),g.names=[],g.skips=[],g.formatters={},g.selectColor=function(d){let m=0;for(let h=0;h<d.length;h++)m=(m<<5)-m+d.charCodeAt(h),m|=0;return g.colors[ft(m)%g.colors.length]},g.enable(g.load()),g}},{ms:11}],6:[function(N,I){"use strict";function b(g,L){for(const M in L)Object.defineProperty(g,M,{value:L[M],enumerable:!0,configurable:!0});return g}I.exports=function(g,L,M){if(!g||typeof g=="string")throw new TypeError("Please pass an Error to err-code");M||(M={}),typeof L=="object"&&(M=L,L=""),L&&(M.code=L);try{return b(g,M)}catch(d){M.message=g.message,M.stack=g.stack;const m=function(){};return m.prototype=Object.create(Object.getPrototypeOf(g)),b(new m,M)}}},{}],7:[function(N,I){"use strict";function b(O){console&&console.warn&&console.warn(O)}function g(){g.init.call(this)}function L(O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}function M(O){return O._maxListeners===void 0?g.defaultMaxListeners:O._maxListeners}function d(O,V,X,lt){var wt,St,Ct;if(L(X),St=O._events,St===void 0?(St=O._events=Object.create(null),O._eventsCount=0):(St.newListener!==void 0&&(O.emit("newListener",V,X.listener?X.listener:X),St=O._events),Ct=St[V]),Ct===void 0)Ct=St[V]=X,++O._eventsCount;else if(typeof Ct=="function"?Ct=St[V]=lt?[X,Ct]:[Ct,X]:lt?Ct.unshift(X):Ct.push(X),wt=M(O),0<wt&&Ct.length>wt&&!Ct.warned){Ct.warned=!0;var Nt=new Error("Possible EventEmitter memory leak detected. "+Ct.length+" "+(V+" listeners added. Use emitter.setMaxListeners() to increase limit"));Nt.name="MaxListenersExceededWarning",Nt.emitter=O,Nt.type=V,Nt.count=Ct.length,b(Nt)}return O}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(O,V,X){var lt={fired:!1,wrapFn:void 0,target:O,type:V,listener:X},wt=m.bind(lt);return wt.listener=X,lt.wrapFn=wt,wt}function u(O,V,X){var lt=O._events;if(lt===void 0)return[];var wt=lt[V];return wt===void 0?[]:typeof wt=="function"?X?[wt.listener||wt]:[wt]:X?j(wt):T(wt,wt.length)}function x(O){var V=this._events;if(V!==void 0){var X=V[O];if(typeof X=="function")return 1;if(X!==void 0)return X.length}return 0}function T(O,V){for(var X=Array(V),lt=0;lt<V;++lt)X[lt]=O[lt];return X}function E(O,V){for(;V+1<O.length;V++)O[V]=O[V+1];O.pop()}function j(O){for(var V=Array(O.length),X=0;X<V.length;++X)V[X]=O[X].listener||O[X];return V}function a(O,V,X){typeof O.on=="function"&&v(O,"error",V,X)}function v(O,V,X,lt){if(typeof O.on=="function")lt.once?O.once(V,X):O.on(V,X);else if(typeof O.addEventListener=="function")O.addEventListener(V,function wt(St){lt.once&&O.removeEventListener(V,wt),X(St)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O)}var y,R=typeof Reflect=="object"?Reflect:null,_=R&&typeof R.apply=="function"?R.apply:function(O,V,X){return Function.prototype.apply.call(O,V,X)};y=R&&typeof R.ownKeys=="function"?R.ownKeys:Object.getOwnPropertySymbols?function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:function(O){return Object.getOwnPropertyNames(O)};var D=Number.isNaN||function(O){return O!==O};I.exports=g,I.exports.once=function(O,V){return new Promise(function(X,lt){function wt(Ct){O.removeListener(V,St),lt(Ct)}function St(){typeof O.removeListener=="function"&&O.removeListener("error",wt),X([].slice.call(arguments))}v(O,V,St,{once:!0}),V!=="error"&&a(O,wt,{once:!0})})},g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var z=10;Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return z},set:function(O){if(typeof O!="number"||0>O||D(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");z=O}}),g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(O){if(typeof O!="number"||0>O||D(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this},g.prototype.getMaxListeners=function(){return M(this)},g.prototype.emit=function(O){for(var V=[],X=1;X<arguments.length;X++)V.push(arguments[X]);var lt=O==="error",wt=this._events;if(wt!==void 0)lt=lt&&wt.error===void 0;else if(!lt)return!1;if(lt){var St;if(0<V.length&&(St=V[0]),St instanceof Error)throw St;var Ct=new Error("Unhandled error."+(St?" ("+St.message+")":""));throw Ct.context=St,Ct}var Nt=wt[O];if(Nt===void 0)return!1;if(typeof Nt=="function")_(Nt,this,V);else for(var Lt=Nt.length,_t=T(Nt,Lt),X=0;X<Lt;++X)_(_t[X],this,V);return!0},g.prototype.addListener=function(O,V){return d(this,O,V,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(O,V){return d(this,O,V,!0)},g.prototype.once=function(O,V){return L(V),this.on(O,h(this,O,V)),this},g.prototype.prependOnceListener=function(O,V){return L(V),this.prependListener(O,h(this,O,V)),this},g.prototype.removeListener=function(O,V){var X,lt,wt,St,Ct;if(L(V),lt=this._events,lt===void 0)return this;if(X=lt[O],X===void 0)return this;if(X===V||X.listener===V)--this._eventsCount==0?this._events=Object.create(null):(delete lt[O],lt.removeListener&&this.emit("removeListener",O,X.listener||V));else if(typeof X!="function"){for(wt=-1,St=X.length-1;0<=St;St--)if(X[St]===V||X[St].listener===V){Ct=X[St].listener,wt=St;break}if(0>wt)return this;wt===0?X.shift():E(X,wt),X.length===1&&(lt[O]=X[0]),lt.removeListener!==void 0&&this.emit("removeListener",O,Ct||V)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(O){var V,X,lt;if(X=this._events,X===void 0)return this;if(X.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):X[O]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete X[O]),this;if(arguments.length===0){var wt,St=Object.keys(X);for(lt=0;lt<St.length;++lt)wt=St[lt],wt!=="removeListener"&&this.removeAllListeners(wt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(V=X[O],typeof V=="function")this.removeListener(O,V);else if(V!==void 0)for(lt=V.length-1;0<=lt;lt--)this.removeListener(O,V[lt]);return this},g.prototype.listeners=function(O){return u(this,O,!0)},g.prototype.rawListeners=function(O){return u(this,O,!1)},g.listenerCount=function(O,V){return typeof O.listenerCount=="function"?O.listenerCount(V):x.call(O,V)},g.prototype.listenerCount=x,g.prototype.eventNames=function(){return 0<this._eventsCount?y(this._events):[]}},{}],8:[function(N,I){I.exports=function(){if(typeof globalThis=="undefined")return null;var b={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return b.RTCPeerConnection?b:null}},{}],9:[function(N,I,b){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */b.read=function(g,L,M,d,m){var h,u,x=8*m-d-1,T=(1<<x)-1,E=T>>1,j=-7,a=M?m-1:0,v=M?-1:1,y=g[L+a];for(a+=v,h=y&(1<<-j)-1,y>>=-j,j+=x;0<j;h=256*h+g[L+a],a+=v,j-=8);for(u=h&(1<<-j)-1,h>>=-j,j+=d;0<j;u=256*u+g[L+a],a+=v,j-=8);if(h===0)h=1-E;else{if(h===T)return u?NaN:(y?-1:1)*(1/0);u+=st(2,d),h-=E}return(y?-1:1)*u*st(2,h-d)},b.write=function(g,L,M,d,m,h){var u,x,T,E=Math.LN2,j=Math.log,a=8*h-m-1,v=(1<<a)-1,y=v>>1,R=m===23?st(2,-24)-st(2,-77):0,_=d?0:h-1,D=d?1:-1,z=0>L||L===0&&0>1/L?1:0;for(L=ft(L),isNaN(L)||L===1/0?(x=isNaN(L)?1:0,u=v):(u=rt(j(L)/E),1>L*(T=st(2,-u))&&(u--,T*=2),L+=1<=u+y?R/T:R*st(2,1-y),2<=L*T&&(u++,T/=2),u+y>=v?(x=0,u=v):1<=u+y?(x=(L*T-1)*st(2,m),u+=y):(x=L*st(2,y-1)*st(2,m),u=0));8<=m;g[M+_]=255&x,_+=D,x/=256,m-=8);for(u=u<<m|x,a+=m;0<a;g[M+_]=255&u,_+=D,u/=256,a-=8);g[M+_-D]|=128*z}},{}],10:[function(N,I){I.exports=typeof Object.create=="function"?function(b,g){g&&(b.super_=g,b.prototype=Object.create(g.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}))}:function(b,g){if(g){b.super_=g;var L=function(){};L.prototype=g.prototype,b.prototype=new L,b.prototype.constructor=b}}},{}],11:[function(N,I){var b=Math.round;function g(h){if(h+="",!(100<h.length)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(u){var x=parseFloat(u[1]),T=(u[2]||"ms").toLowerCase();return T==="years"||T==="year"||T==="yrs"||T==="yr"||T==="y"?315576e5*x:T==="weeks"||T==="week"||T==="w"?6048e5*x:T==="days"||T==="day"||T==="d"?864e5*x:T==="hours"||T==="hour"||T==="hrs"||T==="hr"||T==="h"?36e5*x:T==="minutes"||T==="minute"||T==="mins"||T==="min"||T==="m"?6e4*x:T==="seconds"||T==="second"||T==="secs"||T==="sec"||T==="s"?1e3*x:T==="milliseconds"||T==="millisecond"||T==="msecs"||T==="msec"||T==="ms"?x:void 0}}}function L(h){var u=ft(h);return 864e5<=u?b(h/864e5)+"d":36e5<=u?b(h/36e5)+"h":6e4<=u?b(h/6e4)+"m":1e3<=u?b(h/1e3)+"s":h+"ms"}function M(h){var u=ft(h);return 864e5<=u?d(h,u,864e5,"day"):36e5<=u?d(h,u,36e5,"hour"):6e4<=u?d(h,u,6e4,"minute"):1e3<=u?d(h,u,1e3,"second"):h+" ms"}function d(h,u,x,T){return b(h/x)+" "+T+(u>=1.5*x?"s":"")}var m=24*(60*6e4);I.exports=function(h,u){u=u||{};var x=typeof h;if(x=="string"&&0<h.length)return g(h);if(x==="number"&&isFinite(h))return u.long?M(h):L(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},{}],12:[function(N,I){function b(){throw new Error("setTimeout has not been defined")}function g(){throw new Error("clearTimeout has not been defined")}function L(R){if(x===setTimeout)return setTimeout(R,0);if((x===b||!x)&&setTimeout)return x=setTimeout,setTimeout(R,0);try{return x(R,0)}catch(_){try{return x.call(null,R,0)}catch(D){return x.call(this,R,0)}}}function M(R){if(T===clearTimeout)return clearTimeout(R);if((T===g||!T)&&clearTimeout)return T=clearTimeout,clearTimeout(R);try{return T(R)}catch(_){try{return T.call(null,R)}catch(D){return T.call(this,R)}}}function d(){v&&j&&(v=!1,j.length?a=j.concat(a):y=-1,a.length&&m())}function m(){if(!v){var R=L(d);v=!0;for(var _=a.length;_;){for(j=a,a=[];++y<_;)j&&j[y].run();y=-1,_=a.length}j=null,v=!1,M(R)}}function h(R,_){this.fun=R,this.array=_}function u(){}var x,T,E=I.exports={};(function(){try{x=typeof setTimeout=="function"?setTimeout:b}catch(R){x=b}try{T=typeof clearTimeout=="function"?clearTimeout:g}catch(R){T=g}})();var j,a=[],v=!1,y=-1;E.nextTick=function(R){var _=Array(arguments.length-1);if(1<arguments.length)for(var D=1;D<arguments.length;D++)_[D-1]=arguments[D];a.push(new h(R,_)),a.length!==1||v||L(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},E.title="browser",E.browser=!0,E.env={},E.argv=[],E.version="",E.versions={},E.on=u,E.addListener=u,E.once=u,E.off=u,E.removeListener=u,E.removeAllListeners=u,E.emit=u,E.prependListener=u,E.prependOnceListener=u,E.listeners=function(){return[]},E.binding=function(){throw new Error("process.binding is not supported")},E.cwd=function(){return"/"},E.chdir=function(){throw new Error("process.chdir is not supported")},E.umask=function(){return 0}},{}],13:[function(N,I){(function(b){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let g;I.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window=="undefined"?b:window):L=>(g||(g=Promise.resolve())).then(L).catch(M=>setTimeout(()=>{throw M},0))}).call(this)}).call(this,typeof J.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:J.g)},{}],14:[function(N,I){(function(b,g){(function(){"use strict";var L=N("safe-buffer").Buffer,M=g.crypto||g.msCrypto;I.exports=M&&M.getRandomValues?function(d,m){if(d>4294967295)throw new RangeError("requested too many random bytes");var h=L.allocUnsafe(d);if(0<d)if(65536<d)for(var u=0;u<d;u+=65536)M.getRandomValues(h.slice(u,u+65536));else M.getRandomValues(h);return typeof m=="function"?b.nextTick(function(){m(null,h)}):h}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,N("_process"),typeof J.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:J.g)},{_process:12,"safe-buffer":30}],15:[function(N,I){"use strict";function b(u,x){u.prototype=Object.create(x.prototype),u.prototype.constructor=u,u.__proto__=x}function g(u,x,T){function E(a,v,y){return typeof x=="string"?x:x(a,v,y)}T||(T=Error);var j=function(a){function v(y,R,_){return a.call(this,E(y,R,_))||this}return b(v,a),v}(T);j.prototype.name=T.name,j.prototype.code=u,h[u]=j}function L(u,x){if(Array.isArray(u)){var T=u.length;return u=u.map(function(E){return E+""}),2<T?"one of ".concat(x," ").concat(u.slice(0,T-1).join(", "),", or ")+u[T-1]:T===2?"one of ".concat(x," ").concat(u[0]," or ").concat(u[1]):"of ".concat(x," ").concat(u[0])}return"of ".concat(x," ").concat(u+"")}function M(u,x,T){return u.substr(!T||0>T?0:+T,x.length)===x}function d(u,x,T){return(T===void 0||T>u.length)&&(T=u.length),u.substring(T-x.length,T)===x}function m(u,x,T){return typeof T!="number"&&(T=0),!(T+x.length>u.length)&&u.indexOf(x,T)!==-1}var h={};g("ERR_INVALID_OPT_VALUE",function(u,x){return'The value "'+x+'" is invalid for option "'+u+'"'},TypeError),g("ERR_INVALID_ARG_TYPE",function(u,x,T){var E;typeof x=="string"&&M(x,"not ")?(E="must not be",x=x.replace(/^not /,"")):E="must be";var j;if(d(u," argument"))j="The ".concat(u," ").concat(E," ").concat(L(x,"type"));else{var a=m(u,".")?"property":"argument";j='The "'.concat(u,'" ').concat(a," ").concat(E," ").concat(L(x,"type"))}return j+=". Received type ".concat(typeof T),j},TypeError),g("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),g("ERR_METHOD_NOT_IMPLEMENTED",function(u){return"The "+u+" method is not implemented"}),g("ERR_STREAM_PREMATURE_CLOSE","Premature close"),g("ERR_STREAM_DESTROYED",function(u){return"Cannot call "+u+" after a stream was destroyed"}),g("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),g("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),g("ERR_STREAM_WRITE_AFTER_END","write after end"),g("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),g("ERR_UNKNOWN_ENCODING",function(u){return"Unknown encoding: "+u},TypeError),g("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),I.exports.codes=h},{}],16:[function(N,I){(function(b){(function(){"use strict";function g(E){return this instanceof g?(m.call(this,E),h.call(this,E),this.allowHalfOpen=!0,void(E&&(E.readable===!1&&(this.readable=!1),E.writable===!1&&(this.writable=!1),E.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",L))))):new g(E)}function L(){this._writableState.ended||b.nextTick(M,this)}function M(E){E.end()}var d=Object.keys||function(E){var j=[];for(var a in E)j.push(a);return j};I.exports=g;var m=N("./_stream_readable"),h=N("./_stream_writable");N("inherits")(g,m);for(var u,x=d(h.prototype),T=0;T<x.length;T++)u=x[T],g.prototype[u]||(g.prototype[u]=h.prototype[u]);Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(E){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=E,this._writableState.destroyed=E)}})}).call(this)}).call(this,N("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(N,I){"use strict";function b(L){return this instanceof b?void g.call(this,L):new b(L)}I.exports=b;var g=N("./_stream_transform");N("inherits")(b,g),b.prototype._transform=function(L,M,d){d(null,L)}},{"./_stream_transform":19,inherits:10}],18:[function(N,I){(function(b,g){(function(){"use strict";function L(n){return et.from(n)}function M(n){return et.isBuffer(n)||n instanceof ut}function d(n,s,l){return typeof n.prependListener=="function"?n.prependListener(s,l):void(n._events&&n._events[s]?Array.isArray(n._events[s])?n._events[s].unshift(l):n._events[s]=[l,n._events[s]]:n.on(s,l))}function m(n,s,l){Lt=Lt||N("./_stream_duplex"),n=n||{},typeof l!="boolean"&&(l=s instanceof Lt),this.objectMode=!!n.objectMode,l&&(this.objectMode=this.objectMode||!!n.readableObjectMode),this.highWaterMark=Y(this,n,"readableHighWaterMark",l),this.buffer=new Qt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=n.emitClose!==!1,this.autoDestroy=!!n.autoDestroy,this.destroyed=!1,this.defaultEncoding=n.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,n.encoding&&(!Tt&&(Tt=N("string_decoder/").StringDecoder),this.decoder=new Tt(n.encoding),this.encoding=n.encoding)}function h(n){if(Lt=Lt||N("./_stream_duplex"),!(this instanceof h))return new h(n);var s=this instanceof Lt;this._readableState=new m(n,this,s),this.readable=!0,n&&(typeof n.read=="function"&&(this._read=n.read),typeof n.destroy=="function"&&(this._destroy=n.destroy)),at.call(this)}function u(n,s,l,C,K){_t("readableAddChunk",s);var G=n._readableState;if(s===null)G.reading=!1,a(n,G);else{var ct;if(K||(ct=T(G,s)),ct)Z(n,ct);else if(!(G.objectMode||s&&0<s.length))C||(G.reading=!1,R(n,G));else if(typeof s=="string"||G.objectMode||Object.getPrototypeOf(s)===et.prototype||(s=L(s)),C)G.endEmitted?Z(n,new k):x(n,G,s,!0);else if(G.ended)Z(n,new P);else{if(G.destroyed)return!1;G.reading=!1,G.decoder&&!l?(s=G.decoder.write(s),G.objectMode||s.length!==0?x(n,G,s,!1):R(n,G)):x(n,G,s,!1)}}return!G.ended&&(G.length<G.highWaterMark||G.length===0)}function x(n,s,l,C){s.flowing&&s.length===0&&!s.sync?(s.awaitDrain=0,n.emit("data",l)):(s.length+=s.objectMode?1:l.length,C?s.buffer.unshift(l):s.buffer.push(l),s.needReadable&&v(n)),R(n,s)}function T(n,s){var l;return M(s)||typeof s=="string"||s===void 0||n.objectMode||(l=new vt("chunk",["string","Buffer","Uint8Array"],s)),l}function E(n){return 1073741824<=n?n=1073741824:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function j(n,s){return 0>=n||s.length===0&&s.ended?0:s.objectMode?1:n===n?(n>s.highWaterMark&&(s.highWaterMark=E(n)),n<=s.length?n:s.ended?s.length:(s.needReadable=!0,0)):s.flowing&&s.length?s.buffer.head.data.length:s.length}function a(n,s){if(_t("onEofChunk"),!s.ended){if(s.decoder){var l=s.decoder.end();l&&l.length&&(s.buffer.push(l),s.length+=s.objectMode?1:l.length)}s.ended=!0,s.sync?v(n):(s.needReadable=!1,!s.emittedReadable&&(s.emittedReadable=!0,y(n)))}}function v(n){var s=n._readableState;_t("emitReadable",s.needReadable,s.emittedReadable),s.needReadable=!1,s.emittedReadable||(_t("emitReadable",s.flowing),s.emittedReadable=!0,b.nextTick(y,n))}function y(n){var s=n._readableState;_t("emitReadable_",s.destroyed,s.length,s.ended),!s.destroyed&&(s.length||s.ended)&&(n.emit("readable"),s.emittedReadable=!1),s.needReadable=!s.flowing&&!s.ended&&s.length<=s.highWaterMark,lt(n)}function R(n,s){s.readingMore||(s.readingMore=!0,b.nextTick(_,n,s))}function _(n,s){for(;!s.reading&&!s.ended&&(s.length<s.highWaterMark||s.flowing&&s.length===0);){var l=s.length;if(_t("maybeReadMore read 0"),n.read(0),l===s.length)break}s.readingMore=!1}function D(n){return function(){var s=n._readableState;_t("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&Xt(n,"data")&&(s.flowing=!0,lt(n))}}function z(n){var s=n._readableState;s.readableListening=0<n.listenerCount("readable"),s.resumeScheduled&&!s.paused?s.flowing=!0:0<n.listenerCount("data")&&n.resume()}function O(n){_t("readable nexttick read 0"),n.read(0)}function V(n,s){s.resumeScheduled||(s.resumeScheduled=!0,b.nextTick(X,n,s))}function X(n,s){_t("resume",s.reading),s.reading||n.read(0),s.resumeScheduled=!1,n.emit("resume"),lt(n),s.flowing&&!s.reading&&n.read(0)}function lt(n){var s=n._readableState;for(_t("flow",s.flowing);s.flowing&&n.read()!==null;);}function wt(n,s){if(s.length===0)return null;var l;return s.objectMode?l=s.buffer.shift():!n||n>=s.length?(l=s.decoder?s.buffer.join(""):s.buffer.length===1?s.buffer.first():s.buffer.concat(s.length),s.buffer.clear()):l=s.buffer.consume(n,s.decoder),l}function St(n){var s=n._readableState;_t("endReadable",s.endEmitted),s.endEmitted||(s.ended=!0,b.nextTick(Ct,s,n))}function Ct(n,s){if(_t("endReadableNT",n.endEmitted,n.length),!n.endEmitted&&n.length===0&&(n.endEmitted=!0,s.readable=!1,s.emit("end"),n.autoDestroy)){var l=s._writableState;(!l||l.autoDestroy&&l.finished)&&s.destroy()}}function Nt(n,s){for(var l=0,C=n.length;l<C;l++)if(n[l]===s)return l;return-1}I.exports=h;var Lt;h.ReadableState=m;var _t,ee=N("events").EventEmitter,Xt=function(n,s){return n.listeners(s).length},at=N("./internal/streams/stream"),et=N("buffer").Buffer,ut=g.Uint8Array||function(){},mt=N("util");_t=mt&&mt.debuglog?mt.debuglog("stream"):function(){};var Tt,Dt,zt,Qt=N("./internal/streams/buffer_list"),Kt=N("./internal/streams/destroy"),Jt=N("./internal/streams/state"),Y=Jt.getHighWaterMark,tt=N("../errors").codes,vt=tt.ERR_INVALID_ARG_TYPE,P=tt.ERR_STREAM_PUSH_AFTER_EOF,w=tt.ERR_METHOD_NOT_IMPLEMENTED,k=tt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;N("inherits")(h,at);var Z=Kt.errorOrDestroy,pt=["error","close","destroy","pause","resume"];Object.defineProperty(h.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(n){this._readableState&&(this._readableState.destroyed=n)}}),h.prototype.destroy=Kt.destroy,h.prototype._undestroy=Kt.undestroy,h.prototype._destroy=function(n,s){s(n)},h.prototype.push=function(n,s){var l,C=this._readableState;return C.objectMode?l=!0:typeof n=="string"&&(s=s||C.defaultEncoding,s!==C.encoding&&(n=et.from(n,s),s=""),l=!0),u(this,n,s,!1,l)},h.prototype.unshift=function(n){return u(this,n,null,!0,!1)},h.prototype.isPaused=function(){return this._readableState.flowing===!1},h.prototype.setEncoding=function(n){Tt||(Tt=N("string_decoder/").StringDecoder);var s=new Tt(n);this._readableState.decoder=s,this._readableState.encoding=this._readableState.decoder.encoding;for(var l=this._readableState.buffer.head,C="";l!==null;)C+=s.write(l.data),l=l.next;return this._readableState.buffer.clear(),C!==""&&this._readableState.buffer.push(C),this._readableState.length=C.length,this},h.prototype.read=function(n){_t("read",n),n=parseInt(n,10);var s=this._readableState,l=n;if(n!==0&&(s.emittedReadable=!1),n===0&&s.needReadable&&((s.highWaterMark===0?0<s.length:s.length>=s.highWaterMark)||s.ended))return _t("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?St(this):v(this),null;if(n=j(n,s),n===0&&s.ended)return s.length===0&&St(this),null;var C=s.needReadable;_t("need readable",C),(s.length===0||s.length-n<s.highWaterMark)&&(C=!0,_t("length less than watermark",C)),s.ended||s.reading?(C=!1,_t("reading or ended",C)):C&&(_t("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,!s.reading&&(n=j(l,s)));var K;return K=0<n?wt(n,s):null,K===null?(s.needReadable=s.length<=s.highWaterMark,n=0):(s.length-=n,s.awaitDrain=0),s.length===0&&(!s.ended&&(s.needReadable=!0),l!==n&&s.ended&&St(this)),K!==null&&this.emit("data",K),K},h.prototype._read=function(){Z(this,new w("_read()"))},h.prototype.pipe=function(n,s){function l(Mt,yt){_t("onunpipe"),Mt===Ut&&yt&&yt.hasUnpiped===!1&&(yt.hasUnpiped=!0,K())}function C(){_t("onend"),n.end()}function K(){_t("cleanup"),n.removeListener("close",Rt),n.removeListener("finish",Wt),n.removeListener("drain",it),n.removeListener("error",ct),n.removeListener("unpipe",l),Ut.removeListener("end",C),Ut.removeListener("end",xt),Ut.removeListener("data",G),bt=!0,jt.awaitDrain&&(!n._writableState||n._writableState.needDrain)&&it()}function G(Mt){_t("ondata");var yt=n.write(Mt);_t("dest.write",yt),yt===!1&&((jt.pipesCount===1&&jt.pipes===n||1<jt.pipesCount&&Nt(jt.pipes,n)!==-1)&&!bt&&(_t("false write response, pause",jt.awaitDrain),jt.awaitDrain++),Ut.pause())}function ct(Mt){_t("onerror",Mt),xt(),n.removeListener("error",ct),Xt(n,"error")===0&&Z(n,Mt)}function Rt(){n.removeListener("finish",Wt),xt()}function Wt(){_t("onfinish"),n.removeListener("close",Rt),xt()}function xt(){_t("unpipe"),Ut.unpipe(n)}var Ut=this,jt=this._readableState;switch(jt.pipesCount){case 0:jt.pipes=n;break;case 1:jt.pipes=[jt.pipes,n];break;default:jt.pipes.push(n)}jt.pipesCount+=1,_t("pipe count=%d opts=%j",jt.pipesCount,s);var ie=(!s||s.end!==!1)&&n!==b.stdout&&n!==b.stderr,Q=ie?C:xt;jt.endEmitted?b.nextTick(Q):Ut.once("end",Q),n.on("unpipe",l);var it=D(Ut);n.on("drain",it);var bt=!1;return Ut.on("data",G),d(n,"error",ct),n.once("close",Rt),n.once("finish",Wt),n.emit("pipe",Ut),jt.flowing||(_t("pipe resume"),Ut.resume()),n},h.prototype.unpipe=function(n){var s=this._readableState,l={hasUnpiped:!1};if(s.pipesCount===0)return this;if(s.pipesCount===1)return n&&n!==s.pipes?this:(n||(n=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,n&&n.emit("unpipe",this,l),this);if(!n){var C=s.pipes,K=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var G=0;G<K;G++)C[G].emit("unpipe",this,{hasUnpiped:!1});return this}var ct=Nt(s.pipes,n);return ct===-1?this:(s.pipes.splice(ct,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),n.emit("unpipe",this,l),this)},h.prototype.on=function(n,s){var l=at.prototype.on.call(this,n,s),C=this._readableState;return n==="data"?(C.readableListening=0<this.listenerCount("readable"),C.flowing!==!1&&this.resume()):n=="readable"&&!C.endEmitted&&!C.readableListening&&(C.readableListening=C.needReadable=!0,C.flowing=!1,C.emittedReadable=!1,_t("on readable",C.length,C.reading),C.length?v(this):!C.reading&&b.nextTick(O,this)),l},h.prototype.addListener=h.prototype.on,h.prototype.removeListener=function(n,s){var l=at.prototype.removeListener.call(this,n,s);return n==="readable"&&b.nextTick(z,this),l},h.prototype.removeAllListeners=function(n){var s=at.prototype.removeAllListeners.apply(this,arguments);return(n==="readable"||n===void 0)&&b.nextTick(z,this),s},h.prototype.resume=function(){var n=this._readableState;return n.flowing||(_t("resume"),n.flowing=!n.readableListening,V(this,n)),n.paused=!1,this},h.prototype.pause=function(){return _t("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(_t("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},h.prototype.wrap=function(n){var s=this,l=this._readableState,C=!1;for(var K in n.on("end",function(){if(_t("wrapped end"),l.decoder&&!l.ended){var ct=l.decoder.end();ct&&ct.length&&s.push(ct)}s.push(null)}),n.on("data",function(ct){if(_t("wrapped data"),l.decoder&&(ct=l.decoder.write(ct)),!(l.objectMode&&ct==null)&&(l.objectMode||ct&&ct.length)){var Rt=s.push(ct);Rt||(C=!0,n.pause())}}),n)this[K]===void 0&&typeof n[K]=="function"&&(this[K]=function(ct){return function(){return n[ct].apply(n,arguments)}}(K));for(var G=0;G<pt.length;G++)n.on(pt[G],this.emit.bind(this,pt[G]));return this._read=function(ct){_t("wrapped _read",ct),C&&(C=!1,n.resume())},this},typeof Symbol=="function"&&(h.prototype[Symbol.asyncIterator]=function(){return Dt===void 0&&(Dt=N("./internal/streams/async_iterator")),Dt(this)}),Object.defineProperty(h.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(h.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(h.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(n){this._readableState&&(this._readableState.flowing=n)}}),h._fromList=wt,Object.defineProperty(h.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(h.from=function(n,s){return zt===void 0&&(zt=N("./internal/streams/from")),zt(h,n,s)})}).call(this)}).call(this,N("_process"),typeof J.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:J.g)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(N,I){"use strict";function b(E,j){var a=this._transformState;a.transforming=!1;var v=a.writecb;if(v===null)return this.emit("error",new h);a.writechunk=null,a.writecb=null,j!=null&&this.push(j),v(E);var y=this._readableState;y.reading=!1,(y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}function g(E){return this instanceof g?(T.call(this,E),this._transformState={afterTransform:b.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,E&&(typeof E.transform=="function"&&(this._transform=E.transform),typeof E.flush=="function"&&(this._flush=E.flush)),void this.on("prefinish",L)):new g(E)}function L(){var E=this;typeof this._flush!="function"||this._readableState.destroyed?M(this,null,null):this._flush(function(j,a){M(E,j,a)})}function M(E,j,a){if(j)return E.emit("error",j);if(a!=null&&E.push(a),E._writableState.length)throw new x;if(E._transformState.transforming)throw new u;return E.push(null)}I.exports=g;var d=N("../errors").codes,m=d.ERR_METHOD_NOT_IMPLEMENTED,h=d.ERR_MULTIPLE_CALLBACK,u=d.ERR_TRANSFORM_ALREADY_TRANSFORMING,x=d.ERR_TRANSFORM_WITH_LENGTH_0,T=N("./_stream_duplex");N("inherits")(g,T),g.prototype.push=function(E,j){return this._transformState.needTransform=!1,T.prototype.push.call(this,E,j)},g.prototype._transform=function(E,j,a){a(new m("_transform()"))},g.prototype._write=function(E,j,a){var v=this._transformState;if(v.writecb=a,v.writechunk=E,v.writeencoding=j,!v.transforming){var y=this._readableState;(v.needTransform||y.needReadable||y.length<y.highWaterMark)&&this._read(y.highWaterMark)}},g.prototype._read=function(){var E=this._transformState;E.writechunk===null||E.transforming?E.needTransform=!0:(E.transforming=!0,this._transform(E.writechunk,E.writeencoding,E.afterTransform))},g.prototype._destroy=function(E,j){T.prototype._destroy.call(this,E,function(a){j(a)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(N,I){(function(b,g){(function(){"use strict";function L(P){var w=this;this.next=null,this.entry=null,this.finish=function(){St(w,P)}}function M(P){return _t.from(P)}function d(P){return _t.isBuffer(P)||P instanceof ee}function m(){}function h(P,w,k){Ct=Ct||N("./_stream_duplex"),P=P||{},typeof k!="boolean"&&(k=w instanceof Ct),this.objectMode=!!P.objectMode,k&&(this.objectMode=this.objectMode||!!P.writableObjectMode),this.highWaterMark=et(this,P,"writableHighWaterMark",k),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Z=P.decodeStrings===!1;this.decodeStrings=!Z,this.defaultEncoding=P.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(pt){R(w,pt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=P.emitClose!==!1,this.autoDestroy=!!P.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new L(this)}function u(P){Ct=Ct||N("./_stream_duplex");var w=this instanceof Ct;return w||vt.call(u,this)?(this._writableState=new h(P,this,w),this.writable=!0,P&&(typeof P.write=="function"&&(this._write=P.write),typeof P.writev=="function"&&(this._writev=P.writev),typeof P.destroy=="function"&&(this._destroy=P.destroy),typeof P.final=="function"&&(this._final=P.final)),void Lt.call(this)):new u(P)}function x(P,w){var k=new Jt;tt(P,k),b.nextTick(w,k)}function T(P,w,k,Z){var pt;return k===null?pt=new Kt:typeof k!="string"&&!w.objectMode&&(pt=new mt("chunk",["string","Buffer"],k)),!pt||(tt(P,pt),b.nextTick(Z,pt),!1)}function E(P,w,k){return P.objectMode||P.decodeStrings===!1||typeof w!="string"||(w=_t.from(w,k)),w}function j(P,w,k,Z,pt,n){if(!k){var s=E(w,Z,pt);Z!==s&&(k=!0,pt="buffer",Z=s)}var l=w.objectMode?1:Z.length;w.length+=l;var C=w.length<w.highWaterMark;if(C||(w.needDrain=!0),w.writing||w.corked){var K=w.lastBufferedRequest;w.lastBufferedRequest={chunk:Z,encoding:pt,isBuf:k,callback:n,next:null},K?K.next=w.lastBufferedRequest:w.bufferedRequest=w.lastBufferedRequest,w.bufferedRequestCount+=1}else a(P,w,!1,l,Z,pt,n);return C}function a(P,w,k,Z,pt,n,s){w.writelen=Z,w.writecb=s,w.writing=!0,w.sync=!0,w.destroyed?w.onwrite(new Qt("write")):k?P._writev(pt,w.onwrite):P._write(pt,n,w.onwrite),w.sync=!1}function v(P,w,k,Z,pt){--w.pendingcb,k?(b.nextTick(pt,Z),b.nextTick(lt,P,w),P._writableState.errorEmitted=!0,tt(P,Z)):(pt(Z),P._writableState.errorEmitted=!0,tt(P,Z),lt(P,w))}function y(P){P.writing=!1,P.writecb=null,P.length-=P.writelen,P.writelen=0}function R(P,w){var k=P._writableState,Z=k.sync,pt=k.writecb;if(typeof pt!="function")throw new Dt;if(y(k),w)v(P,k,Z,w,pt);else{var n=O(k)||P.destroyed;n||k.corked||k.bufferProcessing||!k.bufferedRequest||z(P,k),Z?b.nextTick(_,P,k,n,pt):_(P,k,n,pt)}}function _(P,w,k,Z){k||D(P,w),w.pendingcb--,Z(),lt(P,w)}function D(P,w){w.length===0&&w.needDrain&&(w.needDrain=!1,P.emit("drain"))}function z(P,w){w.bufferProcessing=!0;var k=w.bufferedRequest;if(P._writev&&k&&k.next){var Z=w.bufferedRequestCount,pt=Array(Z),n=w.corkedRequestsFree;n.entry=k;for(var s=0,l=!0;k;)pt[s]=k,k.isBuf||(l=!1),k=k.next,s+=1;pt.allBuffers=l,a(P,w,!0,w.length,pt,"",n.finish),w.pendingcb++,w.lastBufferedRequest=null,n.next?(w.corkedRequestsFree=n.next,n.next=null):w.corkedRequestsFree=new L(w),w.bufferedRequestCount=0}else{for(;k;){var C=k.chunk,K=k.encoding,G=k.callback,ct=w.objectMode?1:C.length;if(a(P,w,!1,ct,C,K,G),k=k.next,w.bufferedRequestCount--,w.writing)break}k===null&&(w.lastBufferedRequest=null)}w.bufferedRequest=k,w.bufferProcessing=!1}function O(P){return P.ending&&P.length===0&&P.bufferedRequest===null&&!P.finished&&!P.writing}function V(P,w){P._final(function(k){w.pendingcb--,k&&tt(P,k),w.prefinished=!0,P.emit("prefinish"),lt(P,w)})}function X(P,w){w.prefinished||w.finalCalled||(typeof P._final!="function"||w.destroyed?(w.prefinished=!0,P.emit("prefinish")):(w.pendingcb++,w.finalCalled=!0,b.nextTick(V,P,w)))}function lt(P,w){var k=O(w);if(k&&(X(P,w),w.pendingcb===0&&(w.finished=!0,P.emit("finish"),w.autoDestroy))){var Z=P._readableState;(!Z||Z.autoDestroy&&Z.endEmitted)&&P.destroy()}return k}function wt(P,w,k){w.ending=!0,lt(P,w),k&&(w.finished?b.nextTick(k):P.once("finish",k)),w.ended=!0,P.writable=!1}function St(P,w,k){var Z=P.entry;for(P.entry=null;Z;){var pt=Z.callback;w.pendingcb--,pt(k),Z=Z.next}w.corkedRequestsFree.next=P}I.exports=u;var Ct;u.WritableState=h;var Nt={deprecate:N("util-deprecate")},Lt=N("./internal/streams/stream"),_t=N("buffer").Buffer,ee=g.Uint8Array||function(){},Xt=N("./internal/streams/destroy"),at=N("./internal/streams/state"),et=at.getHighWaterMark,ut=N("../errors").codes,mt=ut.ERR_INVALID_ARG_TYPE,Tt=ut.ERR_METHOD_NOT_IMPLEMENTED,Dt=ut.ERR_MULTIPLE_CALLBACK,zt=ut.ERR_STREAM_CANNOT_PIPE,Qt=ut.ERR_STREAM_DESTROYED,Kt=ut.ERR_STREAM_NULL_VALUES,Jt=ut.ERR_STREAM_WRITE_AFTER_END,Y=ut.ERR_UNKNOWN_ENCODING,tt=Xt.errorOrDestroy;N("inherits")(u,Lt),h.prototype.getBuffer=function(){for(var P=this.bufferedRequest,w=[];P;)w.push(P),P=P.next;return w},function(){try{Object.defineProperty(h.prototype,"buffer",{get:Nt.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(P){}}();var vt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(vt=Function.prototype[Symbol.hasInstance],Object.defineProperty(u,Symbol.hasInstance,{value:function(P){return!!vt.call(this,P)||this===u&&P&&P._writableState instanceof h}})):vt=function(P){return P instanceof this},u.prototype.pipe=function(){tt(this,new zt)},u.prototype.write=function(P,w,k){var Z=this._writableState,pt=!1,n=!Z.objectMode&&d(P);return n&&!_t.isBuffer(P)&&(P=M(P)),typeof w=="function"&&(k=w,w=null),n?w="buffer":!w&&(w=Z.defaultEncoding),typeof k!="function"&&(k=m),Z.ending?x(this,k):(n||T(this,Z,P,k))&&(Z.pendingcb++,pt=j(this,Z,n,P,w,k)),pt},u.prototype.cork=function(){this._writableState.corked++},u.prototype.uncork=function(){var P=this._writableState;P.corked&&(P.corked--,!P.writing&&!P.corked&&!P.bufferProcessing&&P.bufferedRequest&&z(this,P))},u.prototype.setDefaultEncoding=function(P){if(typeof P=="string"&&(P=P.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((P+"").toLowerCase())))throw new Y(P);return this._writableState.defaultEncoding=P,this},Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),u.prototype._write=function(P,w,k){k(new Tt("_write()"))},u.prototype._writev=null,u.prototype.end=function(P,w,k){var Z=this._writableState;return typeof P=="function"?(k=P,P=null,w=null):typeof w=="function"&&(k=w,w=null),P!=null&&this.write(P,w),Z.corked&&(Z.corked=1,this.uncork()),Z.ending||wt(this,Z,k),this},Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(P){this._writableState&&(this._writableState.destroyed=P)}}),u.prototype.destroy=Xt.destroy,u.prototype._undestroy=Xt.undestroy,u.prototype._destroy=function(P,w){w(P)}}).call(this)}).call(this,N("_process"),typeof J.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:J.g)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(N,I){(function(b){(function(){"use strict";function g(D,z,O){return z in D?Object.defineProperty(D,z,{value:O,enumerable:!0,configurable:!0,writable:!0}):D[z]=O,D}function L(D,z){return{value:D,done:z}}function M(D){var z=D[x];if(z!==null){var O=D[y].read();O!==null&&(D[a]=null,D[x]=null,D[T]=null,z(L(O,!1)))}}function d(D){b.nextTick(M,D)}function m(D,z){return function(O,V){D.then(function(){return z[j]?void O(L(void 0,!0)):void z[v](O,V)},V)}}var h,u=N("./end-of-stream"),x=Symbol("lastResolve"),T=Symbol("lastReject"),E=Symbol("error"),j=Symbol("ended"),a=Symbol("lastPromise"),v=Symbol("handlePromise"),y=Symbol("stream"),R=Object.getPrototypeOf(function(){}),_=Object.setPrototypeOf((h={get stream(){return this[y]},next:function(){var D=this,z=this[E];if(z!==null)return Promise.reject(z);if(this[j])return Promise.resolve(L(void 0,!0));if(this[y].destroyed)return new Promise(function(lt,wt){b.nextTick(function(){D[E]?wt(D[E]):lt(L(void 0,!0))})});var O,V=this[a];if(V)O=new Promise(m(V,this));else{var X=this[y].read();if(X!==null)return Promise.resolve(L(X,!1));O=new Promise(this[v])}return this[a]=O,O}},g(h,Symbol.asyncIterator,function(){return this}),g(h,"return",function(){var D=this;return new Promise(function(z,O){D[y].destroy(null,function(V){return V?void O(V):void z(L(void 0,!0))})})}),h),R);I.exports=function(D){var z,O=Object.create(_,(z={},g(z,y,{value:D,writable:!0}),g(z,x,{value:null,writable:!0}),g(z,T,{value:null,writable:!0}),g(z,E,{value:null,writable:!0}),g(z,j,{value:D._readableState.endEmitted,writable:!0}),g(z,v,{value:function(V,X){var lt=O[y].read();lt?(O[a]=null,O[x]=null,O[T]=null,V(L(lt,!1))):(O[x]=V,O[T]=X)},writable:!0}),z));return O[a]=null,u(D,function(V){if(V&&V.code!=="ERR_STREAM_PREMATURE_CLOSE"){var X=O[T];return X!==null&&(O[a]=null,O[x]=null,O[T]=null,X(V)),void(O[E]=V)}var lt=O[x];lt!==null&&(O[a]=null,O[x]=null,O[T]=null,lt(L(void 0,!0))),O[j]=!0}),D.on("readable",d.bind(null,O)),O}}).call(this)}).call(this,N("_process"))},{"./end-of-stream":24,_process:12}],22:[function(N,I){"use strict";function b(a,v){var y=Object.keys(a);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(a);v&&(R=R.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),y.push.apply(y,R)}return y}function g(a){for(var v,y=1;y<arguments.length;y++)v=arguments[y]==null?{}:arguments[y],y%2?b(Object(v),!0).forEach(function(R){L(a,R,v[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(v)):b(Object(v)).forEach(function(R){Object.defineProperty(a,R,Object.getOwnPropertyDescriptor(v,R))});return a}function L(a,v,y){return v in a?Object.defineProperty(a,v,{value:y,enumerable:!0,configurable:!0,writable:!0}):a[v]=y,a}function M(a,v){if(!(a instanceof v))throw new TypeError("Cannot call a class as a function")}function d(a,v){for(var y,R=0;R<v.length;R++)y=v[R],y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(a,y.key,y)}function m(a,v,y){return v&&d(a.prototype,v),y&&d(a,y),a}function h(a,v,y){x.prototype.copy.call(a,v,y)}var u=N("buffer"),x=u.Buffer,T=N("util"),E=T.inspect,j=E&&E.custom||"inspect";I.exports=function(){function a(){M(this,a),this.head=null,this.tail=null,this.length=0}return m(a,[{key:"push",value:function(v){var y={data:v,next:null};0<this.length?this.tail.next=y:this.head=y,this.tail=y,++this.length}},{key:"unshift",value:function(v){var y={data:v,next:this.head};this.length===0&&(this.tail=y),this.head=y,++this.length}},{key:"shift",value:function(){if(this.length!==0){var v=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,v}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(v){if(this.length===0)return"";for(var y=this.head,R=""+y.data;y=y.next;)R+=v+y.data;return R}},{key:"concat",value:function(v){if(this.length===0)return x.alloc(0);for(var y=x.allocUnsafe(v>>>0),R=this.head,_=0;R;)h(R.data,y,_),_+=R.data.length,R=R.next;return y}},{key:"consume",value:function(v,y){var R;return v<this.head.data.length?(R=this.head.data.slice(0,v),this.head.data=this.head.data.slice(v)):v===this.head.data.length?R=this.shift():R=y?this._getString(v):this._getBuffer(v),R}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(v){var y=this.head,R=1,_=y.data;for(v-=_.length;y=y.next;){var D=y.data,z=v>D.length?D.length:v;if(_+=z===D.length?D:D.slice(0,v),v-=z,v===0){z===D.length?(++R,this.head=y.next?y.next:this.tail=null):(this.head=y,y.data=D.slice(z));break}++R}return this.length-=R,_}},{key:"_getBuffer",value:function(v){var y=x.allocUnsafe(v),R=this.head,_=1;for(R.data.copy(y),v-=R.data.length;R=R.next;){var D=R.data,z=v>D.length?D.length:v;if(D.copy(y,y.length-v,0,z),v-=z,v===0){z===D.length?(++_,this.head=R.next?R.next:this.tail=null):(this.head=R,R.data=D.slice(z));break}++_}return this.length-=_,y}},{key:j,value:function(v,y){return E(this,g({},y,{depth:0,customInspect:!1}))}}]),a}()},{buffer:3,util:2}],23:[function(N,I){(function(b){(function(){"use strict";function g(d,m){M(d,m),L(d)}function L(d){d._writableState&&!d._writableState.emitClose||d._readableState&&!d._readableState.emitClose||d.emit("close")}function M(d,m){d.emit("error",m)}I.exports={destroy:function(d,m){var h=this,u=this._readableState&&this._readableState.destroyed,x=this._writableState&&this._writableState.destroyed;return u||x?(m?m(d):d&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,b.nextTick(M,this,d)):b.nextTick(M,this,d)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(d||null,function(T){!m&&T?h._writableState?h._writableState.errorEmitted?b.nextTick(L,h):(h._writableState.errorEmitted=!0,b.nextTick(g,h,T)):b.nextTick(g,h,T):m?(b.nextTick(L,h),m(T)):b.nextTick(L,h)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(d,m){var h=d._readableState,u=d._writableState;h&&h.autoDestroy||u&&u.autoDestroy?d.destroy(m):d.emit("error",m)}}}).call(this)}).call(this,N("_process"))},{_process:12}],24:[function(N,I){"use strict";function b(m){var h=!1;return function(){if(!h){h=!0;for(var u=arguments.length,x=Array(u),T=0;T<u;T++)x[T]=arguments[T];m.apply(this,x)}}}function g(){}function L(m){return m.setHeader&&typeof m.abort=="function"}function M(m,h,u){if(typeof h=="function")return M(m,null,h);h||(h={}),u=b(u||g);var x=h.readable||h.readable!==!1&&m.readable,T=h.writable||h.writable!==!1&&m.writable,E=function(){m.writable||a()},j=m._writableState&&m._writableState.finished,a=function(){T=!1,j=!0,x||u.call(m)},v=m._readableState&&m._readableState.endEmitted,y=function(){x=!1,v=!0,T||u.call(m)},R=function(z){u.call(m,z)},_=function(){var z;return x&&!v?(m._readableState&&m._readableState.ended||(z=new d),u.call(m,z)):T&&!j?(m._writableState&&m._writableState.ended||(z=new d),u.call(m,z)):void 0},D=function(){m.req.on("finish",a)};return L(m)?(m.on("complete",a),m.on("abort",_),m.req?D():m.on("request",D)):T&&!m._writableState&&(m.on("end",E),m.on("close",E)),m.on("end",y),m.on("finish",a),h.error!==!1&&m.on("error",R),m.on("close",_),function(){m.removeListener("complete",a),m.removeListener("abort",_),m.removeListener("request",D),m.req&&m.req.removeListener("finish",a),m.removeListener("end",E),m.removeListener("close",E),m.removeListener("finish",a),m.removeListener("end",y),m.removeListener("error",R),m.removeListener("close",_)}}var d=N("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;I.exports=M},{"../../../errors":15}],25:[function(N,I){I.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(N,I){"use strict";function b(j){var a=!1;return function(){a||(a=!0,j.apply(void 0,arguments))}}function g(j){if(j)throw j}function L(j){return j.setHeader&&typeof j.abort=="function"}function M(j,a,v,y){y=b(y);var R=!1;j.on("close",function(){R=!0}),u===void 0&&(u=N("./end-of-stream")),u(j,{readable:a,writable:v},function(D){return D?y(D):(R=!0,void y())});var _=!1;return function(D){if(!R)return _?void 0:(_=!0,L(j)?j.abort():typeof j.destroy=="function"?j.destroy():void y(D||new E("pipe")))}}function d(j){j()}function m(j,a){return j.pipe(a)}function h(j){return j.length&&typeof j[j.length-1]=="function"?j.pop():g}var u,x=N("../../../errors").codes,T=x.ERR_MISSING_ARGS,E=x.ERR_STREAM_DESTROYED;I.exports=function(){for(var j=arguments.length,a=Array(j),v=0;v<j;v++)a[v]=arguments[v];var y=h(a);if(Array.isArray(a[0])&&(a=a[0]),2>a.length)throw new T("streams");var R,_=a.map(function(D,z){var O=z<a.length-1;return M(D,O,0<z,function(V){R||(R=V),V&&_.forEach(d),O||(_.forEach(d),y(R))})});return a.reduce(m)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(N,I){"use strict";function b(L,M,d){return L.highWaterMark==null?M?L[d]:null:L.highWaterMark}var g=N("../../../errors").codes.ERR_INVALID_OPT_VALUE;I.exports={getHighWaterMark:function(L,M,d,m){var h=b(M,m,d);if(h!=null){if(!(isFinite(h)&&rt(h)===h)||0>h){var u=m?d:"highWaterMark";throw new g(u,h)}return rt(h)}return L.objectMode?16:16384}}},{"../../../errors":15}],28:[function(N,I){I.exports=N("events").EventEmitter},{events:7}],29:[function(N,I,b){b=I.exports=N("./lib/_stream_readable.js"),b.Stream=b,b.Readable=b,b.Writable=N("./lib/_stream_writable.js"),b.Duplex=N("./lib/_stream_duplex.js"),b.Transform=N("./lib/_stream_transform.js"),b.PassThrough=N("./lib/_stream_passthrough.js"),b.finished=N("./lib/internal/streams/end-of-stream.js"),b.pipeline=N("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(N,I,b){function g(m,h){for(var u in m)h[u]=m[u]}function L(m,h,u){return d(m,h,u)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var M=N("buffer"),d=M.Buffer;d.from&&d.alloc&&d.allocUnsafe&&d.allocUnsafeSlow?I.exports=M:(g(M,b),b.Buffer=L),L.prototype=Object.create(d.prototype),g(d,L),L.from=function(m,h,u){if(typeof m=="number")throw new TypeError("Argument must not be a number");return d(m,h,u)},L.alloc=function(m,h,u){if(typeof m!="number")throw new TypeError("Argument must be a number");var x=d(m);return h===void 0?x.fill(0):typeof u=="string"?x.fill(h,u):x.fill(h),x},L.allocUnsafe=function(m){if(typeof m!="number")throw new TypeError("Argument must be a number");return d(m)},L.allocUnsafeSlow=function(m){if(typeof m!="number")throw new TypeError("Argument must be a number");return M.SlowBuffer(m)}},{buffer:3}],31:[function(N,I,b){"use strict";function g(_){if(!_)return"utf8";for(var D;;)switch(_){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return _;default:if(D)return;_=(""+_).toLowerCase(),D=!0}}function L(_){var D=g(_);if(typeof D!="string"&&(y.isEncoding===R||!R(_)))throw new Error("Unknown encoding: "+_);return D||_}function M(_){this.encoding=L(_);var D;switch(this.encoding){case"utf16le":this.text=x,this.end=T,D=4;break;case"utf8":this.fillLast=u,D=4;break;case"base64":this.text=E,this.end=j,D=3;break;default:return this.write=a,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=y.allocUnsafe(D)}function d(_){return 127>=_?0:_>>5==6?2:_>>4==14?3:_>>3==30?4:_>>6==2?-1:-2}function m(_,D,z){var O=D.length-1;if(O<z)return 0;var V=d(D[O]);return 0<=V?(0<V&&(_.lastNeed=V-1),V):--O<z||V===-2?0:(V=d(D[O]),0<=V?(0<V&&(_.lastNeed=V-2),V):--O<z||V===-2?0:(V=d(D[O]),0<=V?(0<V&&(V===2?V=0:_.lastNeed=V-3),V):0))}function h(_,D){if((192&D[0])!=128)return _.lastNeed=0,"\uFFFD";if(1<_.lastNeed&&1<D.length){if((192&D[1])!=128)return _.lastNeed=1,"\uFFFD";if(2<_.lastNeed&&2<D.length&&(192&D[2])!=128)return _.lastNeed=2,"\uFFFD"}}function u(_){var D=this.lastTotal-this.lastNeed,z=h(this,_,D);return z===void 0?this.lastNeed<=_.length?(_.copy(this.lastChar,D,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(_.copy(this.lastChar,D,0,_.length),void(this.lastNeed-=_.length)):z}function x(_,D){if((_.length-D)%2==0){var z=_.toString("utf16le",D);if(z){var O=z.charCodeAt(z.length-1);if(55296<=O&&56319>=O)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=_[_.length-2],this.lastChar[1]=_[_.length-1],z.slice(0,-1)}return z}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=_[_.length-1],_.toString("utf16le",D,_.length-1)}function T(_){var D=_&&_.length?this.write(_):"";if(this.lastNeed){var z=this.lastTotal-this.lastNeed;return D+this.lastChar.toString("utf16le",0,z)}return D}function E(_,D){var z=(_.length-D)%3;return z==0?_.toString("base64",D):(this.lastNeed=3-z,this.lastTotal=3,z==1?this.lastChar[0]=_[_.length-1]:(this.lastChar[0]=_[_.length-2],this.lastChar[1]=_[_.length-1]),_.toString("base64",D,_.length-z))}function j(_){var D=_&&_.length?this.write(_):"";return this.lastNeed?D+this.lastChar.toString("base64",0,3-this.lastNeed):D}function a(_){return _.toString(this.encoding)}function v(_){return _&&_.length?this.write(_):""}var y=N("safe-buffer").Buffer,R=y.isEncoding||function(_){switch(_=""+_,_&&_.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};b.StringDecoder=M,M.prototype.write=function(_){if(_.length===0)return"";var D,z;if(this.lastNeed){if(D=this.fillLast(_),D===void 0)return"";z=this.lastNeed,this.lastNeed=0}else z=0;return z<_.length?D?D+this.text(_,z):this.text(_,z):D||""},M.prototype.end=function(_){var D=_&&_.length?this.write(_):"";return this.lastNeed?D+"\uFFFD":D},M.prototype.text=function(_,D){var z=m(this,_,D);if(!this.lastNeed)return _.toString("utf8",D);this.lastTotal=z;var O=_.length-(z-this.lastNeed);return _.copy(this.lastChar,0,O),_.toString("utf8",D,O)},M.prototype.fillLast=function(_){return this.lastNeed<=_.length?(_.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(_.copy(this.lastChar,this.lastTotal-this.lastNeed,0,_.length),void(this.lastNeed-=_.length))}},{"safe-buffer":30}],32:[function(N,I){(function(b){(function(){function g(L){try{if(!b.localStorage)return!1}catch(d){return!1}var M=b.localStorage[L];return M!=null&&(M+"").toLowerCase()==="true"}I.exports=function(L,M){function d(){if(!m){if(g("throwDeprecation"))throw new Error(M);g("traceDeprecation")?console.trace(M):console.warn(M),m=!0}return L.apply(this,arguments)}if(g("noDeprecation"))return L;var m=!1;return d}}).call(this)}).call(this,typeof J.g=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:J.g)},{}],"/":[function(N,I){function b(j){return j.replace(/a=ice-options:trickle\s\n/g,"")}function g(j){console.warn(j)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const L=N("debug")("simple-peer"),M=N("get-browser-rtc"),d=N("randombytes"),m=N("readable-stream"),h=N("queue-microtask"),u=N("err-code"),{Buffer:x}=N("buffer"),T=65536;class E extends m.Duplex{constructor(a){if(a=Object.assign({allowHalfOpen:!1},a),super(a),this._id=d(4).toString("hex").slice(0,7),this._debug("new peer %o",a),this.channelName=a.initiator?a.channelName||d(20).toString("hex"):null,this.initiator=a.initiator||!1,this.channelConfig=a.channelConfig||E.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},E.config,a.config),this.offerOptions=a.offerOptions||{},this.answerOptions=a.answerOptions||{},this.sdpTransform=a.sdpTransform||(v=>v),this.streams=a.streams||(a.stream?[a.stream]:[]),this.trickle=a.trickle===void 0||a.trickle,this.allowHalfTrickle=a.allowHalfTrickle!==void 0&&a.allowHalfTrickle,this.iceCompleteTimeout=a.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=a.wrtc&&typeof a.wrtc=="object"?a.wrtc:M(),!this._wrtc)throw u(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(v){return void this.destroy(u(v,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=v=>{this._onIceCandidate(v)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(v=>{this.destroy(u(v,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=v=>{this._setupData(v)},this.streams&&this.streams.forEach(v=>{this.addStream(v)}),this._pc.ontrack=v=>{this._onTrack(v)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(a){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof a=="string")try{a=JSON.parse(a)}catch(v){a={}}this._debug("signal()"),a.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),a.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(a.transceiverRequest.kind,a.transceiverRequest.init)),a.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(a.candidate):this._pendingCandidates.push(a.candidate)),a.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(a)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(v=>{this._addIceCandidate(v)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(v=>{this.destroy(u(v,"ERR_SET_REMOTE_DESCRIPTION"))}),a.sdp||a.candidate||a.renegotiate||a.transceiverRequest||this.destroy(u(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(a){const v=new this._wrtc.RTCIceCandidate(a);this._pc.addIceCandidate(v).catch(y=>{!v.address||v.address.endsWith(".local")?g("Ignoring unsupported ICE candidate."):this.destroy(u(y,"ERR_ADD_ICE_CANDIDATE"))})}send(a){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(a)}}addTransceiver(a,v){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(a,v),this._needsNegotiation()}catch(y){this.destroy(u(y,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:a,init:v}})}}addStream(a){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),a.getTracks().forEach(v=>{this.addTrack(v,a)})}}addTrack(a,v){if(this.destroying)return;if(this.destroyed)throw u(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const y=this._senderMap.get(a)||new Map;let R=y.get(v);if(!R)R=this._pc.addTrack(a,v),y.set(v,R),this._senderMap.set(a,y),this._needsNegotiation();else throw R.removed?u(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):u(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(a,v,y){if(this.destroying)return;if(this.destroyed)throw u(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const R=this._senderMap.get(a),_=R?R.get(y):null;if(!_)throw u(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");v&&this._senderMap.set(v,R),_.replaceTrack==null?this.destroy(u(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):_.replaceTrack(v)}removeTrack(a,v){if(this.destroying)return;if(this.destroyed)throw u(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const y=this._senderMap.get(a),R=y?y.get(v):null;if(!R)throw u(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{R.removed=!0,this._pc.removeTrack(R)}catch(_){_.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(R):this.destroy(u(_,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(a){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),a.getTracks().forEach(v=>{this.removeTrack(v,a)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,h(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(a){this._destroy(a,()=>{})}_destroy(a,v){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",a&&(a.message||a)),h(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",a&&(a.message||a)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(y){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(y){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,a&&this.emit("error",a),this.emit("close"),v()}))}_setupData(a){if(!a.channel)return this.destroy(u(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=a.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=T),this.channelName=this._channel.label,this._channel.onmessage=y=>{this._onChannelMessage(y)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=y=>{const R=y.error instanceof Error?y.error:new Error(`Datachannel error: ${y.message} ${y.filename}:${y.lineno}:${y.colno}`);this.destroy(u(R,"ERR_DATA_CHANNEL"))};let v=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(v&&this._onChannelClose(),v=!0):v=!1},5e3)}_read(){}_write(a,v,y){if(this.destroyed)return y(u(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(a)}catch(R){return this.destroy(u(R,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>T?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=y):y(null)}else this._debug("write before connect"),this._chunk=a,this._cb=y}_onFinish(){if(!this.destroyed){const a=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?a():this.once("connect",a)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(a=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(a.sdp=b(a.sdp)),a.sdp=this.sdpTransform(a.sdp);const v=()=>{if(!this.destroyed){const y=this._pc.localDescription||a;this._debug("signal"),this.emit("signal",{type:y.type,sdp:y.sdp})}};this._pc.setLocalDescription(a).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?v():this.once("_iceComplete",v))}).catch(y=>{this.destroy(u(y,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(a=>{this.destroy(u(a,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(a=>{a.mid||!a.sender.track||a.requested||(a.requested=!0,this.addTransceiver(a.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(a=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(a.sdp=b(a.sdp)),a.sdp=this.sdpTransform(a.sdp);const v=()=>{if(!this.destroyed){const y=this._pc.localDescription||a;this._debug("signal"),this.emit("signal",{type:y.type,sdp:y.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(a).then(()=>{this.destroyed||(this.trickle||this._iceComplete?v():this.once("_iceComplete",v))}).catch(y=>{this.destroy(u(y,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(a=>{this.destroy(u(a,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(u(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const a=this._pc.iceConnectionState,v=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",a,v),this.emit("iceStateChange",a,v),(a==="connected"||a==="completed")&&(this._pcReady=!0,this._maybeReady()),a==="failed"&&this.destroy(u(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),a==="closed"&&this.destroy(u(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(a){const v=y=>(Object.prototype.toString.call(y.values)==="[object Array]"&&y.values.forEach(R=>{Object.assign(y,R)}),y);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(y=>{const R=[];y.forEach(_=>{R.push(v(_))}),a(null,R)},y=>a(y)):0<this._pc.getStats.length?this._pc.getStats(y=>{if(this.destroyed)return;const R=[];y.result().forEach(_=>{const D={};_.names().forEach(z=>{D[z]=_.stat(z)}),D.id=_.id,D.type=_.type,D.timestamp=_.timestamp,R.push(v(D))}),a(null,R)},y=>a(y)):a(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const a=()=>{this.destroyed||this.getStats((v,y)=>{if(this.destroyed)return;v&&(y=[]);const R={},_={},D={};let z=!1;y.forEach(V=>{(V.type==="remotecandidate"||V.type==="remote-candidate")&&(R[V.id]=V),(V.type==="localcandidate"||V.type==="local-candidate")&&(_[V.id]=V),(V.type==="candidatepair"||V.type==="candidate-pair")&&(D[V.id]=V)});const O=V=>{z=!0;let X=_[V.localCandidateId];X&&(X.ip||X.address)?(this.localAddress=X.ip||X.address,this.localPort=+X.port):X&&X.ipAddress?(this.localAddress=X.ipAddress,this.localPort=+X.portNumber):typeof V.googLocalAddress=="string"&&(X=V.googLocalAddress.split(":"),this.localAddress=X[0],this.localPort=+X[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let lt=R[V.remoteCandidateId];lt&&(lt.ip||lt.address)?(this.remoteAddress=lt.ip||lt.address,this.remotePort=+lt.port):lt&&lt.ipAddress?(this.remoteAddress=lt.ipAddress,this.remotePort=+lt.portNumber):typeof V.googRemoteAddress=="string"&&(lt=V.googRemoteAddress.split(":"),this.remoteAddress=lt[0],this.remotePort=+lt[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(y.forEach(V=>{V.type==="transport"&&V.selectedCandidatePairId&&O(D[V.selectedCandidatePairId]),(V.type==="googCandidatePair"&&V.googActiveConnection==="true"||(V.type==="candidatepair"||V.type==="candidate-pair")&&V.selected)&&O(V)}),!z&&(!Object.keys(D).length||Object.keys(_).length))return void setTimeout(a,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(X){return this.destroy(u(X,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const V=this._cb;this._cb=null,V(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};a()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>T)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(a=>{this._pc.removeTrack(a),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(a){this.destroyed||(a.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:a.candidate.candidate,sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid}}):!a.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),a.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(a){if(this.destroyed)return;let v=a.data;v instanceof ArrayBuffer&&(v=x.from(v)),this.push(v)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const a=this._cb;this._cb=null,a(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(a){this.destroyed||a.streams.forEach(v=>{this._debug("on track"),this.emit("track",a.track,v),this._remoteTracks.push({track:a.track,stream:v}),this._remoteStreams.some(y=>y.id===v.id)||(this._remoteStreams.push(v),h(()=>{this._debug("on stream"),this.emit("stream",v)}))})}_debug(){const a=[].slice.call(arguments);a[0]="["+this._id+"] "+a[0],L.apply(null,a)}}E.WEBRTC_SUPPORT=!!M(),E.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},E.channelConfig={},I.exports=E},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})},"../../../node_modules/.pnpm/yjs@13.6.18/node_modules/yjs/dist/yjs.mjs":(Ht,kt,J)=>{"use strict";J.d(kt,{JA:()=>et,QE:()=>n,PR:()=>C,FX:()=>xt,hL:()=>Yt});var rt=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/observable.js"),ft=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/array.js"),st=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/math.js"),N=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/map.js"),I=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/encoding.js"),b=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/decoding.js"),g=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/random.js"),L=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/promise.js"),M=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/buffer.js"),d=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/error.js"),m=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/binary.js"),h=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/function.js"),u=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/set.js"),x=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.js"),T=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/logging.common.js"),E=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/time.js");const j=(r,t)=>({[Symbol.iterator](){return this},next(){const e=r.next();return{value:e.done?void 0:t(e.value),done:e.done}}}),a=r=>({[Symbol.iterator](){return this},next:r}),v=(r,t)=>a(()=>{let e;do e=r.next();while(!e.done&&!t(e.value));return e}),y=(r,t)=>a(()=>{const{done:e,value:i}=r.next();return{done:e,value:e?void 0:t(i)}});var R=J("../../../node_modules/.pnpm/lib0@0.2.97/node_modules/lib0/object.js");class _ extends rt.W{constructor(t,e){super(),this.doc=t,this.awareness=e}}class D{constructor(t,e){this.clock=t,this.len=e}}class z{constructor(){this.clients=new Map}}const O=(r,t,e)=>t.clients.forEach((i,o)=>{const c=r.doc.store.clients.get(o);for(let p=0;p<i.length;p++){const S=i[p];En(r,c,S.clock,S.len,e)}}),V=(r,t)=>{let e=0,i=r.length-1;for(;e<=i;){const o=st.RI((e+i)/2),c=r[o],p=c.clock;if(p<=t){if(t<p+c.len)return o;e=o+1}else i=o-1}return null},X=(r,t)=>{const e=r.clients.get(t.client);return e!==void 0&&V(e,t.clock)!==null},lt=r=>{r.clients.forEach(t=>{t.sort((o,c)=>o.clock-c.clock);let e,i;for(e=1,i=1;e<t.length;e++){const o=t[i-1],c=t[e];o.clock+o.len>=c.clock?o.len=st.T9(o.len,c.clock+c.len-o.clock):(i<e&&(t[i]=c),i++)}t.length=i})},wt=r=>{const t=new z;for(let e=0;e<r.length;e++)r[e].clients.forEach((i,o)=>{if(!t.clients.has(o)){const c=i.slice();for(let p=e+1;p<r.length;p++)ft.S2(c,r[p].clients.get(o)||[]);t.clients.set(o,c)}});return lt(t),t},St=(r,t,e,i)=>{N._4(r.clients,t,()=>[]).push(new D(e,i))},Ct=()=>new z,Nt=r=>{const t=Ct();return r.clients.forEach((e,i)=>{const o=[];for(let c=0;c<e.length;c++){const p=e[c];if(p.deleted){const S=p.id.clock;let A=p.length;if(c+1<e.length)for(let W=e[c+1];c+1<e.length&&W.deleted;W=e[++c+1])A+=W.length;o.push(new D(S,A))}}o.length>0&&t.clients.set(i,o)}),t},Lt=(r,t)=>{I.zd(r.restEncoder,t.clients.size),ft.HT(t.clients.entries()).sort((e,i)=>i[0]-e[0]).forEach(([e,i])=>{r.resetDsCurVal(),I.zd(r.restEncoder,e);const o=i.length;I.zd(r.restEncoder,o);for(let c=0;c<o;c++){const p=i[c];r.writeDsClock(p.clock),r.writeDsLen(p.len)}})},_t=r=>{const t=new z,e=b.cw(r.restDecoder);for(let i=0;i<e;i++){r.resetDsCurVal();const o=b.cw(r.restDecoder),c=b.cw(r.restDecoder);if(c>0){const p=N._4(t.clients,o,()=>[]);for(let S=0;S<c;S++)p.push(new D(r.readDsClock(),r.readDsLen()))}}return t},ee=(r,t,e)=>{const i=new z,o=b.cw(r.restDecoder);for(let c=0;c<o;c++){r.resetDsCurVal();const p=b.cw(r.restDecoder),S=b.cw(r.restDecoder),A=e.clients.get(p)||[],W=$t(e,p);for(let B=0;B<S;B++){const F=r.readDsClock(),q=F+r.readDsLen();if(F<W){W<q&&St(i,p,W,q-W);let dt=he(A,F),gt=A[dt];for(!gt.deleted&&gt.id.clock<F&&(A.splice(dt+1,0,qe(t,gt,F-gt.id.clock)),dt++);dt<A.length&&(gt=A[dt++],gt.id.clock<q);)gt.deleted||(q<gt.id.clock+gt.length&&A.splice(dt,0,qe(t,gt,q-gt.id.clock)),gt.delete(t))}else St(i,p,F,q-F)}}if(i.clients.size>0){const c=new Jt;return I.zd(c.restEncoder,0),Lt(c,i),c.toUint8Array()}return null},Xt=(r,t)=>{if(r.clients.size!==t.clients.size)return!1;for(const[e,i]of r.clients.entries()){const o=t.clients.get(e);if(o===void 0||i.length!==o.length)return!1;for(let c=0;c<i.length;c++){const p=i[c],S=o[c];if(p.clock!==S.clock||p.len!==S.len)return!1}}return!0},at=g.S8;class et extends rt.W{constructor({guid:t=g.gZ(),collectionid:e=null,gc:i=!0,gcFilter:o=()=>!0,meta:c=null,autoLoad:p=!1,shouldLoad:S=!0}={}){super(),this.gc=i,this.gcFilter=o,this.clientID=at(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new wn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=S,this.autoLoad=p,this.meta=c,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=L.vt(W=>{this.on("load",()=>{this.isLoaded=!0,W(this)})});const A=()=>L.vt(W=>{const B=F=>{(F===void 0||F===!0)&&(this.off("sync",B),W())};this.on("sync",B)});this.on("sync",W=>{W===!1&&this.isSynced&&(this.whenSynced=A()),this.isSynced=W===void 0||W===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=A()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Yt(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ft.HT(this.subdocs).map(t=>t.guid))}transact(t,e=null){return Yt(this,t,e)}get(t,e=re){const i=N._4(this.share,t,()=>{const c=new e;return c._integrate(this,null),c}),o=i.constructor;if(e!==re&&o!==e)if(o===re){const c=new e;c._map=i._map,i._map.forEach(p=>{for(;p!==null;p=p.left)p.parent=c}),c._start=i._start;for(let p=c._start;p!==null;p=p.right)p.parent=c;return c._length=i._length,this.share.set(t,c),c._integrate(this,null),c}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return i}getArray(t=""){return this.get(t,we)}getText(t=""){return this.get(t,Ie)}getMap(t=""){return this.get(t,Ce)}getXmlElement(t=""){return this.get(t,Te)}getXmlFragment(t=""){return this.get(t,ke)}toJSON(){const t={};return this.share.forEach((e,i)=>{t[i]=e.toJSON()}),t}destroy(){ft.HT(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new et({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Yt(t.parent.doc,i=>{const o=e.doc;t.deleted||i.subdocsAdded.add(o),i.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class ut{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return b.cw(this.restDecoder)}readDsLen(){return b.cw(this.restDecoder)}}class mt extends ut{readLeftID(){return yt(b.cw(this.restDecoder),b.cw(this.restDecoder))}readRightID(){return yt(b.cw(this.restDecoder),b.cw(this.restDecoder))}readClient(){return b.cw(this.restDecoder)}readInfo(){return b.xh(this.restDecoder)}readString(){return b.t3(this.restDecoder)}readParentInfo(){return b.cw(this.restDecoder)===1}readTypeRef(){return b.cw(this.restDecoder)}readLen(){return b.cw(this.restDecoder)}readAny(){return b.Jg(this.restDecoder)}readBuf(){return M.HR(b.bo(this.restDecoder))}readJSON(){return JSON.parse(b.t3(this.restDecoder))}readKey(){return b.t3(this.restDecoder)}}class Tt{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=b.cw(this.restDecoder),this.dsCurrVal}readDsLen(){const t=b.cw(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Dt extends Tt{constructor(t){super(t),this.keys=[],b.cw(t),this.keyClockDecoder=new b.xK(b.bo(t)),this.clientDecoder=new b.VQ(b.bo(t)),this.leftClockDecoder=new b.xK(b.bo(t)),this.rightClockDecoder=new b.xK(b.bo(t)),this.infoDecoder=new b.cQ(b.bo(t),b.xh),this.stringDecoder=new b.Ib(b.bo(t)),this.parentInfoDecoder=new b.cQ(b.bo(t),b.xh),this.typeRefDecoder=new b.VQ(b.bo(t)),this.lenDecoder=new b.VQ(b.bo(t))}readLeftID(){return new bt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new bt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return b.Jg(this.restDecoder)}readBuf(){return b.bo(this.restDecoder)}readJSON(){return b.Jg(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class zt{constructor(){this.restEncoder=I.xv()}toUint8Array(){return I.Fo(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){I.zd(this.restEncoder,t)}writeDsLen(t){I.zd(this.restEncoder,t)}}class Qt extends zt{writeLeftID(t){I.zd(this.restEncoder,t.client),I.zd(this.restEncoder,t.clock)}writeRightID(t){I.zd(this.restEncoder,t.client),I.zd(this.restEncoder,t.clock)}writeClient(t){I.zd(this.restEncoder,t)}writeInfo(t){I.QJ(this.restEncoder,t)}writeString(t){I.Qj(this.restEncoder,t)}writeParentInfo(t){I.zd(this.restEncoder,t?1:0)}writeTypeRef(t){I.zd(this.restEncoder,t)}writeLen(t){I.zd(this.restEncoder,t)}writeAny(t){I.IO(this.restEncoder,t)}writeBuf(t){I.Gu(this.restEncoder,t)}writeJSON(t){I.Qj(this.restEncoder,JSON.stringify(t))}writeKey(t){I.Qj(this.restEncoder,t)}}class Kt{constructor(){this.restEncoder=I.xv(),this.dsCurrVal=0}toUint8Array(){return I.Fo(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,I.zd(this.restEncoder,e)}writeDsLen(t){t===0&&d.Mq(),I.zd(this.restEncoder,t-1),this.dsCurrVal+=t}}class Jt extends Kt{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new I.FA,this.clientEncoder=new I.D$,this.leftClockEncoder=new I.FA,this.rightClockEncoder=new I.FA,this.infoEncoder=new I.cq(I.QJ),this.stringEncoder=new I.Sw,this.parentInfoEncoder=new I.cq(I.QJ),this.typeRefEncoder=new I.D$,this.lenEncoder=new I.D$}toUint8Array(){const t=I.xv();return I.zd(t,0),I.Gu(t,this.keyClockEncoder.toUint8Array()),I.Gu(t,this.clientEncoder.toUint8Array()),I.Gu(t,this.leftClockEncoder.toUint8Array()),I.Gu(t,this.rightClockEncoder.toUint8Array()),I.Gu(t,I.Fo(this.infoEncoder)),I.Gu(t,this.stringEncoder.toUint8Array()),I.Gu(t,I.Fo(this.parentInfoEncoder)),I.Gu(t,this.typeRefEncoder.toUint8Array()),I.Gu(t,this.lenEncoder.toUint8Array()),I.LH(t,I.Fo(this.restEncoder)),I.Fo(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){I.IO(this.restEncoder,t)}writeBuf(t){I.Gu(this.restEncoder,t)}writeJSON(t){I.IO(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Y=(r,t,e,i)=>{i=st.T9(i,t[0].id.clock);const o=he(t,i);I.zd(r.restEncoder,t.length-o),r.writeClient(e),I.zd(r.restEncoder,i);const c=t[o];c.write(r,i-c.id.clock);for(let p=o+1;p<t.length;p++)t[p].write(r,0)},tt=(r,t,e)=>{const i=new Map;e.forEach((o,c)=>{$t(t,c)>o&&i.set(c,o)}),Ne(t).forEach((o,c)=>{e.has(c)||i.set(c,0)}),I.zd(r.restEncoder,i.size),ft.HT(i.entries()).sort((o,c)=>c[0]-o[0]).forEach(([o,c])=>{Y(r,t.clients.get(o),o,c)})},vt=(r,t)=>{const e=N.vt(),i=b.cw(r.restDecoder);for(let o=0;o<i;o++){const c=b.cw(r.restDecoder),p=new Array(c),S=r.readClient();let A=b.cw(r.restDecoder);e.set(S,{i:0,refs:p});for(let W=0;W<c;W++){const B=r.readInfo();switch(m.WY&B){case 0:{const F=r.readLen();p[W]=new ae(yt(S,A),F),A+=F;break}case 10:{const F=b.cw(r.restDecoder);p[W]=new le(yt(S,A),F),A+=F;break}default:{const F=(B&(m.D7|m.wt))===0,q=new Gt(yt(S,A),null,(B&m.wt)===m.wt?r.readLeftID():null,null,(B&m.D7)===m.D7?r.readRightID():null,F?r.readParentInfo()?t.get(r.readString()):r.readLeftID():null,F&&(B&m.KJ)===m.KJ?r.readString():null,es(r,B));p[W]=q,A+=q.length}}}}return e},P=(r,t,e)=>{const i=[];let o=ft.HT(e.keys()).sort((dt,gt)=>dt-gt);if(o.length===0)return null;const c=()=>{if(o.length===0)return null;let dt=e.get(o[o.length-1]);for(;dt.refs.length===dt.i;)if(o.pop(),o.length>0)dt=e.get(o[o.length-1]);else return null;return dt};let p=c();if(p===null)return null;const S=new wn,A=new Map,W=(dt,gt)=>{const Vt=A.get(dt);(Vt==null||Vt>gt)&&A.set(dt,gt)};let B=p.refs[p.i++];const F=new Map,q=()=>{for(const dt of i){const gt=dt.id.client,Vt=e.get(gt);Vt?(Vt.i--,S.clients.set(gt,Vt.refs.slice(Vt.i)),e.delete(gt),Vt.i=0,Vt.refs=[]):S.clients.set(gt,[dt]),o=o.filter(Ot=>Ot!==gt)}i.length=0};for(;;){if(B.constructor!==le){const gt=N._4(F,B.id.client,()=>$t(t,B.id.client))-B.id.clock;if(gt<0)i.push(B),W(B.id.client,B.id.clock-1),q();else{const Vt=B.getMissing(r,t);if(Vt!==null){i.push(B);const Ot=e.get(Vt)||{refs:[],i:0};if(Ot.refs.length===Ot.i)W(Vt,$t(t,Vt)),q();else{B=Ot.refs[Ot.i++];continue}}else(gt===0||gt<B.length)&&(B.integrate(r,gt),F.set(B.id.client,B.id.clock+B.length))}}if(i.length>0)B=i.pop();else if(p!==null&&p.i<p.refs.length)B=p.refs[p.i++];else{if(p=c(),p===null)break;B=p.refs[p.i++]}}if(S.clients.size>0){const dt=new Jt;return tt(dt,S,new Map),I.zd(dt.restEncoder,0),{missing:A,update:dt.toUint8Array()}}return null},w=(r,t)=>tt(r,t.doc.store,t.beforeState),k=(r,t,e,i=new Dt(r))=>Yt(t,o=>{o.local=!1;let c=!1;const p=o.doc,S=p.store,A=vt(i,p),W=P(o,S,A),B=S.pendingStructs;if(B){for(const[q,dt]of B.missing)if(dt<$t(S,q)){c=!0;break}if(W){for(const[q,dt]of W.missing){const gt=B.missing.get(q);(gt==null||gt>dt)&&B.missing.set(q,dt)}B.update=We([B.update,W.update])}}else S.pendingStructs=W;const F=ee(i,o,S);if(S.pendingDs){const q=new Dt(b.$C(S.pendingDs));b.cw(q.restDecoder);const dt=ee(q,o,S);F&&dt?S.pendingDs=We([F,dt]):S.pendingDs=F||dt}else S.pendingDs=F;if(c){const q=S.pendingStructs.update;S.pendingStructs=null,pt(o.doc,q)}},e,!1),Z=(r,t,e)=>k(r,t,e,new mt(r)),pt=(r,t,e,i=Dt)=>{const o=b.$C(t);k(o,r,e,new i(o))},n=(r,t,e)=>pt(r,t,e,mt),s=(r,t,e=new Map)=>{tt(r,t.store,e),Lt(r,Nt(t.store))},l=(r,t=new Uint8Array([0]),e=new Jt)=>{const i=G(t);s(e,r,i);const o=[e.toUint8Array()];if(r.store.pendingDs&&o.push(r.store.pendingDs),r.store.pendingStructs&&o.push(In(r.store.pendingStructs.update,t)),o.length>1){if(e.constructor===Qt)return hs(o.map((c,p)=>p===0?c:ms(c)));if(e.constructor===Jt)return We(o)}return o[0]},C=(r,t)=>l(r,t,new Qt),K=r=>{const t=new Map,e=b.cw(r.restDecoder);for(let i=0;i<e;i++){const o=b.cw(r.restDecoder),c=b.cw(r.restDecoder);t.set(o,c)}return t},G=r=>K(new ut(b.$C(r))),ct=(r,t)=>(I.zd(r.restEncoder,t.size),ft.HT(t.entries()).sort((e,i)=>i[0]-e[0]).forEach(([e,i])=>{I.zd(r.restEncoder,e),I.zd(r.restEncoder,i)}),r),Rt=(r,t)=>ct(r,Ne(t.store)),Wt=(r,t=new Kt)=>(r instanceof Map?ct(t,r):Rt(t,r),t.toUint8Array()),xt=r=>Wt(r,new zt);class Ut{constructor(){this.l=[]}}const jt=()=>new Ut,ie=(r,t)=>r.l.push(t),Q=(r,t)=>{const e=r.l,i=e.length;r.l=e.filter(o=>t!==o),i===r.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},it=(r,t,e)=>h.OK(r.l,[t,e]);class bt{constructor(t,e){this.client=t,this.clock=e}}const Mt=(r,t)=>r===t||r!==null&&t!==null&&r.client===t.client&&r.clock===t.clock,yt=(r,t)=>new bt(r,t),qt=(r,t)=>{encoding.writeVarUint(r,t.client),encoding.writeVarUint(r,t.clock)},ne=r=>yt(decoding.readVarUint(r),decoding.readVarUint(r)),se=r=>{for(const[t,e]of r.doc.share.entries())if(e===r)return t;throw d.Mq()},de=(r,t)=>{for(;t!==null;){if(t.parent===r)return!0;t=t.parent._item}return!1},xe=r=>{const t=[];let e=r._start;for(;e;)t.push(e),e=e.right;console.log("Children: ",t),console.log("Children content: ",t.filter(i=>!i.deleted).map(i=>i.content))};class mn{constructor(t,e=t.getMap("users")){const i=new Map;this.yusers=e,this.doc=t,this.clients=new Map,this.dss=i;const o=(c,p)=>{const S=c.get("ds"),A=c.get("ids"),W=B=>this.clients.set(B,p);S.observe(B=>{B.changes.added.forEach(F=>{F.content.getContent().forEach(q=>{q instanceof Uint8Array&&this.dss.set(p,wt([this.dss.get(p)||Ct(),_t(new ut(decoding.createDecoder(q)))]))})})}),this.dss.set(p,wt(S.map(B=>_t(new ut(decoding.createDecoder(B)))))),A.observe(B=>B.changes.added.forEach(F=>F.content.getContent().forEach(W))),A.forEach(W)};e.observe(c=>{c.keysChanged.forEach(p=>o(e.get(p),p))}),e.forEach(o)}setUserMapping(t,e,i,{filter:o=()=>!0}={}){const c=this.yusers;let p=c.get(i);p||(p=new Ce,p.set("ids",new we),p.set("ds",new we),c.set(i,p)),p.get("ids").push([e]),c.observe(S=>{setTimeout(()=>{const A=c.get(i);if(A!==p){p=A,this.clients.forEach((F,q)=>{i===F&&p.get("ids").push([q])});const W=new zt,B=this.dss.get(i);B&&(Lt(W,B),p.get("ds").push([W.toUint8Array()]))}},0)}),t.on("afterTransaction",S=>{setTimeout(()=>{const A=p.get("ds"),W=S.deleteSet;if(S.local&&W.clients.size>0&&o(S,W)){const B=new zt;Lt(B,W),A.push([B.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[e,i]of this.dss.entries())if(X(i,t))return e;return null}}class Re{constructor(t,e,i,o=0){this.type=t,this.tname=e,this.item=i,this.assoc=o}}const Me=r=>{const t={};return r.type&&(t.type=r.type),r.tname&&(t.tname=r.tname),r.item&&(t.item=r.item),r.assoc!=null&&(t.assoc=r.assoc),t},yn=r=>{var t;return new Re(r.type==null?null:yt(r.type.client,r.type.clock),(t=r.tname)!=null?t:null,r.item==null?null:yt(r.item.client,r.item.clock),r.assoc==null?0:r.assoc)};class Ze{constructor(t,e,i=0){this.type=t,this.index=e,this.assoc=i}}const tn=(r,t,e=0)=>new Ze(r,t,e),U=(r,t,e)=>{let i=null,o=null;return r._item===null?o=se(r):i=yt(r._item.id.client,r._item.id.clock),new Re(i,o,t,e)},H=(r,t,e=0)=>{let i=r._start;if(e<0){if(t===0)return U(r,null,e);t--}for(;i!==null;){if(!i.deleted&&i.countable){if(i.length>t)return U(r,yt(i.id.client,i.id.clock+t),e);t-=i.length}if(i.right===null&&e<0)return U(r,i.lastId,e);i=i.right}return U(r,null,e)},$=(r,t)=>{const{type:e,tname:i,item:o,assoc:c}=t;if(o!==null)encoding.writeVarUint(r,0),qt(r,o);else if(i!==null)encoding.writeUint8(r,1),encoding.writeVarString(r,i);else if(e!==null)encoding.writeUint8(r,2),qt(r,e);else throw error.unexpectedCase();return encoding.writeVarInt(r,c),r},ot=r=>{const t=encoding.createEncoder();return $(t,r),encoding.toUint8Array(t)},nt=r=>{let t=null,e=null,i=null;switch(decoding.readVarUint(r)){case 0:i=ne(r);break;case 1:e=decoding.readVarString(r);break;case 2:t=ne(r)}const o=decoding.hasContent(r)?decoding.readVarInt(r):0;return new Re(t,e,i,o)},Et=r=>nt(decoding.createDecoder(r)),ht=(r,t,e=!0)=>{const i=t.store,o=r.item,c=r.type,p=r.tname,S=r.assoc;let A=null,W=0;if(o!==null){if($t(i,o.client)<=o.clock)return null;const B=e?pn(i,o):{item:De(i,o),diff:0},F=B.item;if(!(F instanceof Gt))return null;if(A=F.parent,A._item===null||!A._item.deleted){W=F.deleted||!F.countable?0:B.diff+(S>=0?0:1);let q=F.left;for(;q!==null;)!q.deleted&&q.countable&&(W+=q.length),q=q.left}}else{if(p!==null)A=t.get(p);else if(c!==null){if($t(i,c.client)<=c.clock)return null;const{item:B}=e?pn(i,c):{item:De(i,c)};if(B instanceof Gt&&B.content instanceof pe)A=B.content.type;else return null}else throw error.unexpectedCase();S>=0?W=A._length:W=0}return tn(A,W,r.assoc)},At=(r,t)=>r===t||r!==null&&t!==null&&r.tname===t.tname&&Mt(r.item,t.item)&&Mt(r.type,t.type)&&r.assoc===t.assoc;class It{constructor(t,e){this.ds=t,this.sv=e}}const Pt=(r,t)=>{const e=r.ds.clients,i=t.ds.clients,o=r.sv,c=t.sv;if(o.size!==c.size||e.size!==i.size)return!1;for(const[p,S]of o.entries())if(c.get(p)!==S)return!1;for(const[p,S]of e.entries()){const A=i.get(p)||[];if(S.length!==A.length)return!1;for(let W=0;W<S.length;W++){const B=S[W],F=A[W];if(B.clock!==F.clock||B.len!==F.len)return!1}}return!0},Bt=(r,t=new Kt)=>(Lt(t,r.ds),ct(t,r.sv),t.toUint8Array()),te=r=>Bt(r,new zt),oe=(r,t=new Tt(decoding.createDecoder(r)))=>new It(_t(t),K(t)),ge=r=>oe(r,new ut(decoding.createDecoder(r))),Se=(r,t)=>new It(r,t),bn=Se(Ct(),new Map),en=r=>Se(Nt(r.store),Ne(r.store)),me=(r,t)=>t===void 0?!r.deleted:t.sv.has(r.id.client)&&(t.sv.get(r.id.client)||0)>r.id.clock&&!X(t.ds,r.id),nn=(r,t)=>{const e=N._4(r.meta,nn,u.vt),i=r.doc.store;e.has(t)||(t.sv.forEach((o,c)=>{o<$t(i,c)&&ce(r,yt(c,o))}),O(r,t.ds,o=>{}),e.add(t))},rr=(r,t,e=new et)=>{if(r.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:i,ds:o}=t,c=new Jt;return r.transact(p=>{let S=0;i.forEach(A=>{A>0&&S++}),encoding.writeVarUint(c.restEncoder,S);for(const[A,W]of i){if(W===0)continue;W<$t(r.store,A)&&ce(p,yt(A,W));const B=r.store.clients.get(A)||[],F=he(B,W-1);encoding.writeVarUint(c.restEncoder,F+1),c.writeClient(A),encoding.writeVarUint(c.restEncoder,0);for(let q=0;q<=F;q++)B[q].write(c,0)}Lt(c,o)}),pt(e,c.toUint8Array(),"snapshot"),e},is=(r,t,e=Dt)=>{const i=new e(decoding.createDecoder(t)),o=new ye(i,!1);for(let p=o.curr;p!==null;p=o.next())if((r.sv.get(p.id.client)||0)<p.id.clock+p.length)return!1;const c=wt([r.ds,_t(i)]);return Xt(r.ds,c)},ir=(r,t)=>is(r,t,mt);class wn{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ne=r=>{const t=new Map;return r.clients.forEach((e,i)=>{const o=e[e.length-1];t.set(i,o.id.clock+o.length)}),t},$t=(r,t)=>{const e=r.clients.get(t);if(e===void 0)return 0;const i=e[e.length-1];return i.id.clock+i.length},_n=(r,t)=>{let e=r.clients.get(t.id.client);if(e===void 0)e=[],r.clients.set(t.id.client,e);else{const i=e[e.length-1];if(i.id.clock+i.length!==t.id.clock)throw d.Mq()}e.push(t)},he=(r,t)=>{let e=0,i=r.length-1,o=r[i],c=o.id.clock;if(c===t)return i;let p=st.RI(t/(c+o.length-1)*i);for(;e<=i;){if(o=r[p],c=o.id.clock,c<=t){if(t<c+o.length)return p;e=p+1}else i=p-1;p=st.RI((e+i)/2)}throw d.Mq()},De=(r,t)=>{const e=r.clients.get(t.client);return e[he(e,t.clock)]},sn=(r,t,e)=>{const i=he(t,e),o=t[i];return o.id.clock<e&&o instanceof Gt?(t.splice(i+1,0,qe(r,o,e-o.id.clock)),i+1):i},ce=(r,t)=>{const e=r.doc.store.clients.get(t.client);return e[sn(r,e,t.clock)]},vn=(r,t,e)=>{const i=t.clients.get(e.client),o=he(i,e.clock),c=i[o];return e.clock!==c.id.clock+c.length-1&&c.constructor!==ae&&i.splice(o+1,0,qe(r,c,e.clock-c.id.clock+1)),c},os=(r,t,e)=>{const i=r.clients.get(t.id.client);i[he(i,t.id.clock)]=e},En=(r,t,e,i,o)=>{if(i===0)return;const c=e+i;let p=sn(r,t,e),S;do S=t[p++],c<S.id.clock+S.length&&sn(r,t,c),o(S);while(p<t.length&&t[p].id.clock<c)};class cs{constructor(t,e,i){this.doc=t,this.deleteSet=new z,this.beforeState=Ne(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=i,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Sn=(r,t)=>t.deleteSet.clients.size===0&&!N.bz(t.afterState,(e,i)=>t.beforeState.get(i)!==e)?!1:(lt(t.deleteSet),w(r,t),Lt(r,t.deleteSet),!0),Cn=(r,t,e)=>{const i=t._item;(i===null||i.id.clock<(r.beforeState.get(i.id.client)||0)&&!i.deleted)&&N._4(r.changed,t,u.vt).add(e)},Ve=(r,t)=>{let e=r[t],i=r[t-1],o=t;for(;o>0;e=i,i=r[--o-1]){if(i.deleted===e.deleted&&i.constructor===e.constructor&&i.mergeWith(e)){e instanceof Gt&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,i);continue}break}const c=t-o;return c&&r.splice(t+1-c,c),c},kn=(r,t,e)=>{for(const[i,o]of r.clients.entries()){const c=t.clients.get(i);for(let p=o.length-1;p>=0;p--){const S=o[p],A=S.clock+S.len;for(let W=he(c,S.clock),B=c[W];W<c.length&&B.id.clock<A;B=c[++W]){const F=c[W];if(S.clock+S.len<=F.id.clock)break;F instanceof Gt&&F.deleted&&!F.keep&&e(F)&&F.gc(t,!1)}}}},Tn=(r,t)=>{r.clients.forEach((e,i)=>{const o=t.clients.get(i);for(let c=e.length-1;c>=0;c--){const p=e[c],S=st.jk(o.length-1,1+he(o,p.clock+p.len-1));for(let A=S,W=o[A];A>0&&W.id.clock>=p.clock;W=o[A])A-=1+Ve(o,A)}})},cr=(r,t,e)=>{kn(r,t,e),Tn(r,t)},Rn=(r,t)=>{if(t<r.length){const e=r[t],i=e.doc,o=i.store,c=e.deleteSet,p=e._mergeStructs;try{lt(c),e.afterState=Ne(e.doc.store),i.emit("beforeObserverCalls",[e,i]);const S=[];e.changed.forEach((A,W)=>S.push(()=>{(W._item===null||!W._item.deleted)&&W._callObserver(e,A)})),S.push(()=>{e.changedParentTypes.forEach((A,W)=>{W._dEH.l.length>0&&(W._item===null||!W._item.deleted)&&(A=A.filter(B=>B.target._item===null||!B.target._item.deleted),A.forEach(B=>{B.currentTarget=W,B._path=null}),A.sort((B,F)=>B.path.length-F.path.length),it(W._dEH,A,e))})}),S.push(()=>i.emit("afterTransaction",[e,i])),(0,h.OK)(S,[]),e._needFormattingCleanup&&Is(e)}finally{i.gc&&kn(c,o,i.gcFilter),Tn(c,o),e.afterState.forEach((B,F)=>{const q=e.beforeState.get(F)||0;if(q!==B){const dt=o.clients.get(F),gt=st.T9(he(dt,q),1);for(let Vt=dt.length-1;Vt>=gt;)Vt-=1+Ve(dt,Vt)}});for(let B=p.length-1;B>=0;B--){const{client:F,clock:q}=p[B].id,dt=o.clients.get(F),gt=he(dt,q);gt+1<dt.length&&Ve(dt,gt+1)>1||gt>0&&Ve(dt,gt)}if(!e.local&&e.afterState.get(i.clientID)!==e.beforeState.get(i.clientID)&&(x.yy(T.hN,T.Y,"[yjs] ",T.Ny,T.UH,"Changed the client-id because another client seems to be using it."),i.clientID=at()),i.emit("afterTransactionCleanup",[e,i]),i._observers.has("update")){const B=new Qt;Sn(B,e)&&i.emit("update",[B.toUint8Array(),e.origin,i,e])}if(i._observers.has("updateV2")){const B=new Jt;Sn(B,e)&&i.emit("updateV2",[B.toUint8Array(),e.origin,i,e])}const{subdocsAdded:S,subdocsLoaded:A,subdocsRemoved:W}=e;(S.size>0||W.size>0||A.size>0)&&(S.forEach(B=>{B.clientID=i.clientID,B.collectionid==null&&(B.collectionid=i.collectionid),i.subdocs.add(B)}),W.forEach(B=>i.subdocs.delete(B)),i.emit("subdocs",[{loaded:A,added:S,removed:W},i,e]),W.forEach(B=>B.destroy())),r.length<=t+1?(i._transactionCleanups=[],i.emit("afterAllTransactions",[i,r])):Rn(r,t+1)}}},Yt=(r,t,e=null,i=!0)=>{const o=r._transactionCleanups;let c=!1,p=null;r._transaction===null&&(c=!0,r._transaction=new cs(r,e,i),o.push(r._transaction),o.length===1&&r.emit("beforeAllTransactions",[r]),r.emit("beforeTransaction",[r._transaction,r]));try{p=t(r._transaction)}finally{if(c){const S=r._transaction===o[0];r._transaction=null,S&&Rn(o,0)}}return p};class ls{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const Dn=(r,t,e)=>{O(r,e.deletions,i=>{i instanceof Gt&&t.scope.some(o=>de(o,i))&&gn(i,!1)})},An=(r,t,e)=>{let i=null;const o=r.doc,c=r.scope;Yt(o,S=>{for(;t.length>0&&r.currStackItem===null;){const A=o.store,W=t.pop(),B=new Set,F=[];let q=!1;O(S,W.insertions,dt=>{if(dt instanceof Gt){if(dt.redone!==null){let{item:gt,diff:Vt}=pn(A,dt.id);Vt>0&&(gt=ce(S,yt(gt.id.client,gt.id.clock+Vt))),dt=gt}!dt.deleted&&c.some(gt=>de(gt,dt))&&F.push(dt)}}),O(S,W.deletions,dt=>{dt instanceof Gt&&c.some(gt=>de(gt,dt))&&!X(W.insertions,dt.id)&&B.add(dt)}),B.forEach(dt=>{q=ts(S,dt,B,W.insertions,r.ignoreRemoteMapChanges,r)!==null||q});for(let dt=F.length-1;dt>=0;dt--){const gt=F[dt];r.deleteFilter(gt)&&(gt.delete(S),q=!0)}r.currStackItem=q?W:null}S.changed.forEach((A,W)=>{A.has(null)&&W._searchMarker&&(W._searchMarker.length=0)}),i=S},r);const p=r.currStackItem;if(p!=null){const S=i.changedParentTypes;r.emit("stack-item-popped",[{stackItem:p,type:e,changedParentTypes:S,origin:r},r]),r.currStackItem=null}return p};class lr extends rt.W{constructor(t,{captureTimeout:e=500,captureTransaction:i=A=>!0,deleteFilter:o=()=>!0,trackedOrigins:c=new Set([null]),ignoreRemoteMapChanges:p=!1,doc:S=ft.cy(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.doc=S,this.addToScope(t),this.deleteFilter=o,c.add(this),this.trackedOrigins=c,this.captureTransaction=i,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=p,this.captureTimeout=e,this.afterTransactionHandler=A=>{if(!this.captureTransaction(A)||!this.scope.some(Ot=>A.changedParentTypes.has(Ot))||!this.trackedOrigins.has(A.origin)&&(!A.origin||!this.trackedOrigins.has(A.origin.constructor)))return;const W=this.undoing,B=this.redoing,F=W?this.redoStack:this.undoStack;W?this.stopCapturing():B||this.clear(!1,!0);const q=new z;A.afterState.forEach((Ot,Ft)=>{const ue=A.beforeState.get(Ft)||0,rs=Ot-ue;rs>0&&St(q,Ft,ue,rs)});const dt=E._g();let gt=!1;if(this.lastChange>0&&dt-this.lastChange<this.captureTimeout&&F.length>0&&!W&&!B){const Ot=F[F.length-1];Ot.deletions=wt([Ot.deletions,A.deleteSet]),Ot.insertions=wt([Ot.insertions,q])}else F.push(new ls(A.deleteSet,q)),gt=!0;!W&&!B&&(this.lastChange=dt),O(A,A.deleteSet,Ot=>{Ot instanceof Gt&&this.scope.some(Ft=>de(Ft,Ot))&&gn(Ot,!0)});const Vt=[{stackItem:F[F.length-1],origin:A.origin,type:W?"redo":"undo",changedParentTypes:A.changedParentTypes},this];gt?this.emit("stack-item-added",Vt):this.emit("stack-item-updated",Vt)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=ft.cy(t)?t:[t],t.forEach(e=>{this.scope.every(i=>i!==e)&&(e.doc!==this.doc&&x.R8("[yjs#509] Not same Y.Doc"),this.scope.push(e))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(i=>{t&&(this.undoStack.forEach(o=>Dn(i,this,o)),this.undoStack=[]),e&&(this.redoStack.forEach(o=>Dn(i,this,o)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=An(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=An(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*as(r){const t=b.cw(r.restDecoder);for(let e=0;e<t;e++){const i=b.cw(r.restDecoder),o=r.readClient();let c=b.cw(r.restDecoder);for(let p=0;p<i;p++){const S=r.readInfo();if(S===10){const A=b.cw(r.restDecoder);yield new le(yt(o,c),A),c+=A}else if(m.WY&S){const A=(S&(m.D7|m.wt))===0,W=new Gt(yt(o,c),null,(S&m.wt)===m.wt?r.readLeftID():null,null,(S&m.D7)===m.D7?r.readRightID():null,A?r.readParentInfo()?r.readString():r.readLeftID():null,A&&(S&m.KJ)===m.KJ?r.readString():null,es(r,S));yield W,c+=W.length}else{const A=r.readLen();yield new ae(yt(o,c),A),c+=A}}}}class ye{constructor(t,e){this.gen=as(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===le);return this.curr}}const ar=r=>us(r,mt),us=(r,t=Dt)=>{const e=[],i=new t(decoding.createDecoder(r)),o=new ye(i,!1);for(let p=o.curr;p!==null;p=o.next())e.push(p);logging.print("Structs: ",e);const c=_t(i);logging.print("DeleteSet: ",c)},ur=r=>ds(r,mt),ds=(r,t=Dt)=>{const e=[],i=new t(decoding.createDecoder(r)),o=new ye(i,!1);for(let c=o.curr;c!==null;c=o.next())e.push(c);return{structs:e,ds:_t(i)}};class rn{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const hs=r=>We(r,mt,Qt),fs=(r,t=Kt,e=Dt)=>{const i=new t,o=new ye(new e(decoding.createDecoder(r)),!1);let c=o.curr;if(c!==null){let p=0,S=c.id.client,A=c.id.clock!==0,W=A?0:c.id.clock+c.length;for(;c!==null;c=o.next())S!==c.id.client&&(W!==0&&(p++,encoding.writeVarUint(i.restEncoder,S),encoding.writeVarUint(i.restEncoder,W)),S=c.id.client,W=0,A=c.id.clock!==0),c.constructor===le&&(A=!0),A||(W=c.id.clock+c.length);W!==0&&(p++,encoding.writeVarUint(i.restEncoder,S),encoding.writeVarUint(i.restEncoder,W));const B=encoding.createEncoder();return encoding.writeVarUint(B,p),encoding.writeBinaryEncoder(B,i.restEncoder),i.restEncoder=B,i.toUint8Array()}else return encoding.writeVarUint(i.restEncoder,0),i.toUint8Array()},dr=r=>fs(r,zt,mt),ps=(r,t=Dt)=>{const e=new Map,i=new Map,o=new ye(new t(decoding.createDecoder(r)),!1);let c=o.curr;if(c!==null){let p=c.id.client,S=c.id.clock;for(e.set(p,S);c!==null;c=o.next())p!==c.id.client&&(i.set(p,S),e.set(c.id.client,c.id.clock),p=c.id.client),S=c.id.clock+c.length;i.set(p,S)}return{from:e,to:i}},hr=r=>ps(r,mt),gs=(r,t)=>{if(r.constructor===ae){const{client:e,clock:i}=r.id;return new ae(yt(e,i+t),r.length-t)}else if(r.constructor===le){const{client:e,clock:i}=r.id;return new le(yt(e,i+t),r.length-t)}else{const e=r,{client:i,clock:o}=e.id;return new Gt(yt(i,o+t),null,yt(i,o+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},We=(r,t=Dt,e=Jt)=>{if(r.length===1)return r[0];const i=r.map(B=>new t(b.$C(B)));let o=i.map(B=>new ye(B,!0)),c=null;const p=new e,S=new rn(p);for(;o=o.filter(q=>q.curr!==null),o.sort((q,dt)=>{if(q.curr.id.client===dt.curr.id.client){const gt=q.curr.id.clock-dt.curr.id.clock;return gt===0?q.curr.constructor===dt.curr.constructor?0:q.curr.constructor===le?1:-1:gt}else return dt.curr.id.client-q.curr.id.client}),o.length!==0;){const B=o[0],F=B.curr.id.client;if(c!==null){let q=B.curr,dt=!1;for(;q!==null&&q.id.clock+q.length<=c.struct.id.clock+c.struct.length&&q.id.client>=c.struct.id.client;)q=B.next(),dt=!0;if(q===null||q.id.client!==F||dt&&q.id.clock>c.struct.id.clock+c.struct.length)continue;if(F!==c.struct.id.client)be(S,c.struct,c.offset),c={struct:q,offset:0},B.next();else if(c.struct.id.clock+c.struct.length<q.id.clock)if(c.struct.constructor===le)c.struct.length=q.id.clock+q.length-c.struct.id.clock;else{be(S,c.struct,c.offset);const gt=q.id.clock-c.struct.id.clock-c.struct.length;c={struct:new le(yt(F,c.struct.id.clock+c.struct.length),gt),offset:0}}else{const gt=c.struct.id.clock+c.struct.length-q.id.clock;gt>0&&(c.struct.constructor===le?c.struct.length-=gt:q=gs(q,gt)),c.struct.mergeWith(q)||(be(S,c.struct,c.offset),c={struct:q,offset:0},B.next())}}else c={struct:B.curr,offset:0},B.next();for(let q=B.curr;q!==null&&q.id.client===F&&q.id.clock===c.struct.id.clock+c.struct.length&&q.constructor!==le;q=B.next())be(S,c.struct,c.offset),c={struct:q,offset:0}}c!==null&&(be(S,c.struct,c.offset),c=null),on(S);const A=i.map(B=>_t(B)),W=wt(A);return Lt(p,W),p.toUint8Array()},In=(r,t,e=Dt,i=Jt)=>{const o=G(t),c=new i,p=new rn(c),S=new e(b.$C(r)),A=new ye(S,!1);for(;A.curr;){const B=A.curr,F=B.id.client,q=o.get(F)||0;if(A.curr.constructor===le){A.next();continue}if(B.id.clock+B.length>q)for(be(p,B,st.T9(q-B.id.clock,0)),A.next();A.curr&&A.curr.id.client===F;)be(p,A.curr,0),A.next();else for(;A.curr&&A.curr.id.client===F&&A.curr.id.clock+A.curr.length<=q;)A.next()}on(p);const W=_t(S);return Lt(c,W),c.toUint8Array()},fr=(r,t)=>In(r,t,mt,Qt),On=r=>{r.written>0&&(r.clientStructs.push({written:r.written,restEncoder:I.Fo(r.encoder.restEncoder)}),r.encoder.restEncoder=I.xv(),r.written=0)},be=(r,t,e)=>{r.written>0&&r.currClient!==t.id.client&&On(r),r.written===0&&(r.currClient=t.id.client,r.encoder.writeClient(t.id.client),I.zd(r.encoder.restEncoder,t.id.clock+e)),t.write(r.encoder,e),r.written++},on=r=>{On(r);const t=r.encoder.restEncoder;I.zd(t,r.clientStructs.length);for(let e=0;e<r.clientStructs.length;e++){const i=r.clientStructs[e];I.zd(t,i.written),I.LH(t,i.restEncoder)}},ze=(r,t,e,i)=>{const o=new e(b.$C(r)),c=new ye(o,!1),p=new i,S=new rn(p);for(let W=c.curr;W!==null;W=c.next())be(S,t(W),0);on(S);const A=_t(o);return Lt(p,A),p.toUint8Array()},Ln=({formatting:r=!0,subdocs:t=!0,yxml:e=!0}={})=>{let i=0;const o=map.create(),c=map.create(),p=map.create(),S=map.create();return S.set(null,null),A=>{switch(A.constructor){case ae:case le:return A;case Gt:{const W=A,B=W.content;switch(B.constructor){case Le:break;case pe:{if(e){const F=B.type;F instanceof Te&&(F.nodeName=map.setIfUndefined(c,F.nodeName,()=>"node-"+i)),F instanceof Fe&&(F.hookName=map.setIfUndefined(c,F.hookName,()=>"hook-"+i))}break}case Ee:{const F=B;F.arr=F.arr.map(()=>i);break}case Oe:{const F=B;F.content=new Uint8Array([i]);break}case Ue:{const F=B;t&&(F.opts={},F.doc.guid=i+"");break}case ve:{const F=B;F.embed={};break}case Zt:{const F=B;r&&(F.key=map.setIfUndefined(p,F.key,()=>i+""),F.value=map.setIfUndefined(S,F.value,()=>({i})));break}case Pe:{const F=B;F.arr=F.arr.map(()=>i);break}case fe:{const F=B;F.str=string.repeat(i%10+"",F.str.length);break}default:error.unexpectedCase()}return W.parentSub&&(W.parentSub=map.setIfUndefined(o,W.parentSub,()=>i+"")),i++,A}default:error.unexpectedCase()}}},pr=(r,t)=>ze(r,Ln(t),mt,Qt),gr=(r,t)=>ze(r,Ln(t),Dt,Jt),mr=r=>ze(r,f.id,mt,Jt),ms=r=>ze(r,h.id,Dt,Qt),Un="You must not compute changes after the event-handler fired.";class He{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ys(this.currentTarget,this.target))}deletes(t){return X(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw d.vt(Un);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(o=>{if(o!==null){const c=e._map.get(o);let p,S;if(this.adds(c)){let A=c.left;for(;A!==null&&this.adds(A);)A=A.left;if(this.deletes(c))if(A!==null&&this.deletes(A))p="delete",S=ft.HV(A.content.getContent());else return;else A!==null&&this.deletes(A)?(p="update",S=ft.HV(A.content.getContent())):(p="add",S=void 0)}else if(this.deletes(c))p="delete",S=ft.HV(c.content.getContent());else return;t.set(o,{action:p,oldValue:S})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw d.vt(Un);const e=this.target,i=u.vt(),o=u.vt(),c=[];if(t={added:i,deleted:o,delta:c,keys:this.keys},this.transaction.changed.get(e).has(null)){let S=null;const A=()=>{S&&c.push(S)};for(let W=e._start;W!==null;W=W.right)W.deleted?this.deletes(W)&&!this.adds(W)&&((S===null||S.delete===void 0)&&(A(),S={delete:0}),S.delete+=W.length,o.add(W)):this.adds(W)?((S===null||S.insert===void 0)&&(A(),S={insert:[]}),S.insert=S.insert.concat(W.content.getContent()),i.add(W)):((S===null||S.retain===void 0)&&(A(),S={retain:0}),S.retain+=W.length);S!==null&&S.retain===void 0&&A()}this._changes=t}return t}}const ys=(r,t)=>{const e=[];for(;t._item!==null&&t!==r;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let i=0,o=t._item.parent._start;for(;o!==t._item&&o!==null;)!o.deleted&&o.countable&&(i+=o.length),o=o.right;e.unshift(i)}t=t._item.parent}return e},xn=80;let cn=0;class bs{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=cn++}}const ws=r=>{r.timestamp=cn++},Mn=(r,t,e)=>{r.p.marker=!1,r.p=t,t.marker=!0,r.index=e,r.timestamp=cn++},_s=(r,t,e)=>{if(r.length>=xn){const i=r.reduce((o,c)=>o.timestamp<c.timestamp?o:c);return Mn(i,t,e),i}else{const i=new bs(t,e);return r.push(i),i}},Ke=(r,t)=>{if(r._start===null||t===0||r._searchMarker===null)return null;const e=r._searchMarker.length===0?null:r._searchMarker.reduce((c,p)=>st.tn(t-c.index)<st.tn(t-p.index)?c:p);let i=r._start,o=0;for(e!==null&&(i=e.p,o=e.index,ws(e));i.right!==null&&o<t;){if(!i.deleted&&i.countable){if(t<o+i.length)break;o+=i.length}i=i.right}for(;i.left!==null&&o>t;)i=i.left,!i.deleted&&i.countable&&(o-=i.length);for(;i.left!==null&&i.left.id.client===i.id.client&&i.left.id.clock+i.left.length===i.id.clock;)i=i.left,!i.deleted&&i.countable&&(o-=i.length);return e!==null&&st.tn(e.index-o)<i.parent.length/xn?(Mn(e,i,o),e):_s(r._searchMarker,i,o)},je=(r,t,e)=>{for(let i=r.length-1;i>=0;i--){const o=r[i];if(e>0){let c=o.p;for(c.marker=!1;c&&(c.deleted||!c.countable);)c=c.left,c&&!c.deleted&&c.countable&&(o.index-=c.length);if(c===null||c.marker===!0){r.splice(i,1);continue}o.p=c,c.marker=!0}(t<o.index||e>0&&t===o.index)&&(o.index=st.T9(t,o.index+e))}},yr=r=>{let t=r._start;const e=[];for(;t;)e.push(t),t=t.right;return e},Ye=(r,t,e)=>{const i=r,o=t.changedParentTypes;for(;N._4(o,r,()=>[]).push(e),r._item!==null;)r=r._item.parent;it(i._eH,e,t)};class re{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=jt(),this._dEH=jt(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw d.bD()}clone(){throw d.bD()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ie(this._eH,t)}observeDeep(t){ie(this._dEH,t)}unobserve(t){Q(this._eH,t)}unobserveDeep(t){Q(this._dEH,t)}toJSON(){}}const Nn=(r,t,e)=>{t<0&&(t=r._length+t),e<0&&(e=r._length+e);let i=e-t;const o=[];let c=r._start;for(;c!==null&&i>0;){if(c.countable&&!c.deleted){const p=c.content.getContent();if(p.length<=t)t-=p.length;else{for(let S=t;S<p.length&&i>0;S++)o.push(p[S]),i--;t=0}}c=c.right}return o},jn=r=>{const t=[];let e=r._start;for(;e!==null;){if(e.countable&&!e.deleted){const i=e.content.getContent();for(let o=0;o<i.length;o++)t.push(i[o])}e=e.right}return t},br=(r,t)=>{const e=[];let i=r._start;for(;i!==null;){if(i.countable&&me(i,t)){const o=i.content.getContent();for(let c=0;c<o.length;c++)e.push(o[c])}i=i.right}return e},Be=(r,t)=>{let e=0,i=r._start;for(;i!==null;){if(i.countable&&!i.deleted){const o=i.content.getContent();for(let c=0;c<o.length;c++)t(o[c],e++,r)}i=i.right}},Bn=(r,t)=>{const e=[];return Be(r,(i,o)=>{e.push(t(i,o,r))}),e},vs=r=>{let t=r._start,e=null,i=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),i=0,t=t.right}const o=e[i++];return e.length<=i&&(e=null),{done:!1,value:o}}}},Fn=(r,t)=>{const e=Ke(r,t);let i=r._start;for(e!==null&&(i=e.p,t-=e.index);i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<i.length)return i.content.getContent()[t];t-=i.length}},Ge=(r,t,e,i)=>{let o=e;const c=r.doc,p=c.clientID,S=c.store,A=e===null?t._start:e.right;let W=[];const B=()=>{W.length>0&&(o=new Gt(yt(p,$t(S,p)),o,o&&o.lastId,A,A&&A.id,t,null,new Ee(W)),o.integrate(r,0),W=[])};i.forEach(F=>{if(F===null)W.push(F);else switch(F.constructor){case Number:case Object:case Boolean:case Array:case String:W.push(F);break;default:switch(B(),F.constructor){case Uint8Array:case ArrayBuffer:o=new Gt(yt(p,$t(S,p)),o,o&&o.lastId,A,A&&A.id,t,null,new Oe(new Uint8Array(F))),o.integrate(r,0);break;case et:o=new Gt(yt(p,$t(S,p)),o,o&&o.lastId,A,A&&A.id,t,null,new Ue(F)),o.integrate(r,0);break;default:if(F instanceof re)o=new Gt(yt(p,$t(S,p)),o,o&&o.lastId,A,A&&A.id,t,null,new pe(F)),o.integrate(r,0);else throw new Error("Unexpected content type in insert operation")}}}),B()},Pn=()=>d.vt("Length exceeded!"),Vn=(r,t,e,i)=>{if(e>t._length)throw Pn();if(e===0)return t._searchMarker&&je(t._searchMarker,e,i.length),Ge(r,t,null,i);const o=e,c=Ke(t,e);let p=t._start;for(c!==null&&(p=c.p,e-=c.index,e===0&&(p=p.prev,e+=p&&p.countable&&!p.deleted?p.length:0));p!==null;p=p.right)if(!p.deleted&&p.countable){if(e<=p.length){e<p.length&&ce(r,yt(p.id.client,p.id.clock+e));break}e-=p.length}return t._searchMarker&&je(t._searchMarker,o,i.length),Ge(r,t,p,i)},Es=(r,t,e)=>{let o=(t._searchMarker||[]).reduce((c,p)=>p.index>c.index?p:c,{index:0,p:t._start}).p;if(o)for(;o.right;)o=o.right;return Ge(r,t,o,e)},Wn=(r,t,e,i)=>{if(i===0)return;const o=e,c=i,p=Ke(t,e);let S=t._start;for(p!==null&&(S=p.p,e-=p.index);S!==null&&e>0;S=S.right)!S.deleted&&S.countable&&(e<S.length&&ce(r,yt(S.id.client,S.id.clock+e)),e-=S.length);for(;i>0&&S!==null;)S.deleted||(i<S.length&&ce(r,yt(S.id.client,S.id.clock+i)),S.delete(r),i-=S.length),S=S.right;if(i>0)throw Pn();t._searchMarker&&je(t._searchMarker,o,-c+i)},Je=(r,t,e)=>{const i=t._map.get(e);i!==void 0&&i.delete(r)},ln=(r,t,e,i)=>{const o=t._map.get(e)||null,c=r.doc,p=c.clientID;let S;if(i==null)S=new Ee([i]);else switch(i.constructor){case Number:case Object:case Boolean:case Array:case String:S=new Ee([i]);break;case Uint8Array:S=new Oe(i);break;case et:S=new Ue(i);break;default:if(i instanceof re)S=new pe(i);else throw new Error("Unexpected content type")}new Gt(yt(p,$t(c.store,p)),o,o&&o.lastId,null,null,t,e,S).integrate(r,0)},an=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},zn=r=>{const t={};return r._map.forEach((e,i)=>{e.deleted||(t[i]=e.content.getContent()[e.length-1])}),t},Hn=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted},wr=(r,t,e)=>{let i=r._map.get(t)||null;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;return i!==null&&me(i,e)?i.content.getContent()[i.length-1]:void 0},Ss=(r,t)=>{const e={};return r._map.forEach((i,o)=>{let c=i;for(;c!==null&&(!t.sv.has(c.id.client)||c.id.clock>=(t.sv.get(c.id.client)||0));)c=c.left;c!==null&&me(c,t)&&(e[o]=c.content.getContent()[c.length-1])}),e},$e=r=>v(r.entries(),t=>!t[1].deleted);class Cs extends He{}class we extends re{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new we;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new we}clone(){const t=new we;return t.insert(0,this.toArray().map(e=>e instanceof re?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Ye(this,t,new Cs(this,t))}insert(t,e){this.doc!==null?Yt(this.doc,i=>{Vn(i,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?Yt(this.doc,e=>{Es(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?Yt(this.doc,i=>{Wn(i,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return Fn(this,t)}toArray(){return jn(this)}slice(t=0,e=this.length){return Nn(this,t,e)}toJSON(){return this.map(t=>t instanceof re?t.toJSON():t)}map(t){return Bn(this,t)}forEach(t){Be(this,t)}[Symbol.iterator](){return vs(this)}_write(t){t.writeTypeRef(Js)}}const ks=r=>new we;class Ts extends He{constructor(t,e,i){super(t,e),this.keysChanged=i}}class Ce extends re{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((i,o)=>{this.set(o,i)}),this._prelimContent=null}_copy(){return new Ce}clone(){const t=new Ce;return this.forEach((e,i)=>{t.set(i,e instanceof re?e.clone():e)}),t}_callObserver(t,e){Ye(this,t,new Ts(this,t,e))}toJSON(){const t={};return this._map.forEach((e,i)=>{if(!e.deleted){const o=e.content.getContent()[e.length-1];t[i]=o instanceof re?o.toJSON():o}}),t}get size(){return[...$e(this._map)].length}keys(){return y($e(this._map),t=>t[0])}values(){return y($e(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return y($e(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,i)=>{e.deleted||t(e.content.getContent()[e.length-1],i,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Yt(this.doc,e=>{Je(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?Yt(this.doc,i=>{ln(i,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return an(this,t)}has(t){return Hn(this,t)}clear(){this.doc!==null?Yt(this.doc,t=>{this.forEach(function(e,i,o){Je(t,o,i)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef($s)}}const Rs=r=>new Ce,_e=(r,t)=>r===t||typeof r=="object"&&typeof t=="object"&&r&&t&&R.SQ(r,t);class un{constructor(t,e,i,o){this.left=t,this.right=e,this.index=i,this.currentAttributes=o}forward(){switch(this.right===null&&d.Mq(),this.right.content.constructor){case Zt:this.right.deleted||Ae(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Kn=(r,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case Zt:t.right.deleted||Ae(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&ce(r,yt(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Qe=(r,t,e,i)=>{const o=new Map,c=i?Ke(t,e):null;if(c){const p=new un(c.p.left,c.p,c.index,o);return Kn(r,p,e-c.index)}else{const p=new un(null,t._start,0,o);return Kn(r,p,e)}},Yn=(r,t,e,i)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===Zt&&_e(i.get(e.right.content.key),e.right.content.value));)e.right.deleted||i.delete(e.right.content.key),e.forward();const o=r.doc,c=o.clientID;i.forEach((p,S)=>{const A=e.left,W=e.right,B=new Gt(yt(c,$t(o.store,c)),A,A&&A.lastId,W,W&&W.id,t,null,new Zt(S,p));B.integrate(r,0),e.right=B,e.forward()})},Ae=(r,t)=>{const{key:e,value:i}=t;i===null?r.delete(e):r.set(e,i)},Gn=(r,t)=>{var e;for(;r.right!==null;){if(!(r.right.deleted||r.right.content.constructor===Zt&&_e((e=t[r.right.content.key])!=null?e:null,r.right.content.value)))break;r.forward()}},Jn=(r,t,e,i)=>{var S;const o=r.doc,c=o.clientID,p=new Map;for(const A in i){const W=i[A],B=(S=e.currentAttributes.get(A))!=null?S:null;if(!_e(B,W)){p.set(A,B);const{left:F,right:q}=e;e.right=new Gt(yt(c,$t(o.store,c)),F,F&&F.lastId,q,q&&q.id,t,null,new Zt(A,W)),e.right.integrate(r,0),e.forward()}}return p},dn=(r,t,e,i,o)=>{e.currentAttributes.forEach((q,dt)=>{o[dt]===void 0&&(o[dt]=null)});const c=r.doc,p=c.clientID;Gn(e,o);const S=Jn(r,t,e,o),A=i.constructor===String?new fe(i):i instanceof re?new pe(i):new ve(i);let{left:W,right:B,index:F}=e;t._searchMarker&&je(t._searchMarker,e.index,A.getLength()),B=new Gt(yt(p,$t(c.store,p)),W,W&&W.lastId,B,B&&B.id,t,null,A),B.integrate(r,0),e.right=B,e.index=F,e.forward(),Yn(r,t,e,S)},$n=(r,t,e,i,o)=>{const c=r.doc,p=c.clientID;Gn(e,o);const S=Jn(r,t,e,o);t:for(;e.right!==null&&(i>0||S.size>0&&(e.right.deleted||e.right.content.constructor===Zt));){if(!e.right.deleted)switch(e.right.content.constructor){case Zt:{const{key:A,value:W}=e.right.content,B=o[A];if(B!==void 0){if(_e(B,W))S.delete(A);else{if(i===0)break t;S.set(A,W)}e.right.delete(r)}else e.currentAttributes.set(A,W);break}default:i<e.right.length&&ce(r,yt(e.right.id.client,e.right.id.clock+i)),i-=e.right.length;break}e.forward()}if(i>0){let A="";for(;i>0;i--)A+=`
`;e.right=new Gt(yt(p,$t(c.store,p)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new fe(A)),e.right.integrate(r,0),e.forward()}Yn(r,t,e,S)},Qn=(r,t,e,i,o)=>{var W,B;let c=t;const p=N.vt();for(;c&&(!c.countable||c.deleted);){if(!c.deleted&&c.content.constructor===Zt){const F=c.content;p.set(F.key,F)}c=c.right}let S=0,A=!1;for(;t!==c;){if(e===t&&(A=!0),!t.deleted){const F=t.content;switch(F.constructor){case Zt:{const{key:q,value:dt}=F,gt=(W=i.get(q))!=null?W:null;(p.get(q)!==F||gt===dt)&&(t.delete(r),S++,!A&&((B=o.get(q))!=null?B:null)===dt&&gt!==dt&&(gt===null?o.delete(q):o.set(q,gt))),!A&&!t.deleted&&Ae(o,F);break}}}t=t.right}return S},Ds=(r,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Zt){const i=t.content.key;e.has(i)?t.delete(r):e.add(i)}t=t.left}},As=r=>{let t=0;return Yt(r.doc,e=>{let i=r._start,o=r._start,c=N.vt();const p=N.C(c);for(;o;){if(o.deleted===!1)switch(o.content.constructor){case Zt:Ae(p,o.content);break;default:t+=Qn(e,i,o,c,p),c=N.C(p),i=o;break}o=o.right}}),t},Is=r=>{const t=new Set,e=r.doc;for(const[i,o]of r.afterState.entries()){const c=r.beforeState.get(i)||0;o!==c&&En(r,e.store.clients.get(i),c,o,p=>{!p.deleted&&p.content.constructor===Zt&&p.constructor!==ae&&t.add(p.parent)})}Yt(e,i=>{O(r,r.deleteSet,o=>{if(o instanceof ae||!o.parent._hasFormatting||t.has(o.parent))return;const c=o.parent;o.content.constructor===Zt?t.add(c):Ds(i,o)});for(const o of t)As(o)})},Xn=(r,t,e)=>{const i=e,o=N.C(t.currentAttributes),c=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case pe:case ve:case fe:e<t.right.length&&ce(r,yt(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(r);break}t.forward()}c&&Qn(r,c,t.right,o,t.currentAttributes);const p=(t.left||t.right).parent;return p._searchMarker&&je(p._searchMarker,t.index,-i+e),t};class Os extends He{constructor(t,e,i){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,i.forEach(o=>{o===null?this.childListChanged=!0:this.keysChanged.add(o)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];Yt(t,i=>{var dt,gt,Vt;const o=new Map,c=new Map;let p=this.target._start,S=null;const A={};let W="",B=0,F=0;const q=()=>{if(S!==null){let Ot=null;switch(S){case"delete":F>0&&(Ot={delete:F}),F=0;break;case"insert":(typeof W=="object"||W.length>0)&&(Ot={insert:W},o.size>0&&(Ot.attributes={},o.forEach((Ft,ue)=>{Ft!==null&&(Ot.attributes[ue]=Ft)}))),W="";break;case"retain":B>0&&(Ot={retain:B},R.Im(A)||(Ot.attributes=R.kp({},A))),B=0;break}Ot&&e.push(Ot),S=null}};for(;p!==null;){switch(p.content.constructor){case pe:case ve:this.adds(p)?this.deletes(p)||(q(),S="insert",W=p.content.getContent()[0],q()):this.deletes(p)?(S!=="delete"&&(q(),S="delete"),F+=1):p.deleted||(S!=="retain"&&(q(),S="retain"),B+=1);break;case fe:this.adds(p)?this.deletes(p)||(S!=="insert"&&(q(),S="insert"),W+=p.content.str):this.deletes(p)?(S!=="delete"&&(q(),S="delete"),F+=p.length):p.deleted||(S!=="retain"&&(q(),S="retain"),B+=p.length);break;case Zt:{const{key:Ot,value:Ft}=p.content;if(this.adds(p)){if(!this.deletes(p)){const ue=(dt=o.get(Ot))!=null?dt:null;_e(ue,Ft)?Ft!==null&&p.delete(i):(S==="retain"&&q(),_e(Ft,(gt=c.get(Ot))!=null?gt:null)?delete A[Ot]:A[Ot]=Ft)}}else if(this.deletes(p)){c.set(Ot,Ft);const ue=(Vt=o.get(Ot))!=null?Vt:null;_e(ue,Ft)||(S==="retain"&&q(),A[Ot]=ue)}else if(!p.deleted){c.set(Ot,Ft);const ue=A[Ot];ue!==void 0&&(_e(ue,Ft)?ue!==null&&p.delete(i):(S==="retain"&&q(),Ft===null?delete A[Ot]:A[Ot]=Ft))}p.deleted||(S==="insert"&&q(),Ae(o,p.content));break}}p=p.right}for(q();e.length>0;){const Ot=e[e.length-1];if(Ot.retain!==void 0&&Ot.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Ie extends re{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(i=>i())}catch(i){console.error(i)}this._pending=null}_copy(){return new Ie}clone(){const t=new Ie;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const i=new Os(this,t,e);Ye(this,t,i),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===fe&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?Yt(this.doc,i=>{const o=new un(null,this._start,0,new Map);for(let c=0;c<t.length;c++){const p=t[c];if(p.insert!==void 0){const S=!e&&typeof p.insert=="string"&&c===t.length-1&&o.right===null&&p.insert.slice(-1)===`
`?p.insert.slice(0,-1):p.insert;(typeof S!="string"||S.length>0)&&dn(i,this,o,S,p.attributes||{})}else p.retain!==void 0?$n(i,this,o,p.retain,p.attributes||{}):p.delete!==void 0&&Xn(i,o,p.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,i){const o=[],c=new Map,p=this.doc;let S="",A=this._start;function W(){if(S.length>0){const F={};let q=!1;c.forEach((gt,Vt)=>{q=!0,F[Vt]=gt});const dt={insert:S};q&&(dt.attributes=F),o.push(dt),S=""}}const B=()=>{for(;A!==null;){if(me(A,t)||e!==void 0&&me(A,e))switch(A.content.constructor){case fe:{const F=c.get("ychange");t!==void 0&&!me(A,t)?(F===void 0||F.user!==A.id.client||F.type!=="removed")&&(W(),c.set("ychange",i?i("removed",A.id):{type:"removed"})):e!==void 0&&!me(A,e)?(F===void 0||F.user!==A.id.client||F.type!=="added")&&(W(),c.set("ychange",i?i("added",A.id):{type:"added"})):F!==void 0&&(W(),c.delete("ychange")),S+=A.content.str;break}case pe:case ve:{W();const F={insert:A.content.getContent()[0]};if(c.size>0){const q={};F.attributes=q,c.forEach((dt,gt)=>{q[gt]=dt})}o.push(F);break}case Zt:me(A,t)&&(W(),Ae(c,A.content));break}A=A.right}W()};return t||e?Yt(p,F=>{t&&nn(F,t),e&&nn(F,e),B()},"cleanup"):B(),o}insert(t,e,i){if(e.length<=0)return;const o=this.doc;o!==null?Yt(o,c=>{const p=Qe(c,this,t,!i);i||(i={},p.currentAttributes.forEach((S,A)=>{i[A]=S})),dn(c,this,p,e,i)}):this._pending.push(()=>this.insert(t,e,i))}insertEmbed(t,e,i){const o=this.doc;o!==null?Yt(o,c=>{const p=Qe(c,this,t,!i);dn(c,this,p,e,i||{})}):this._pending.push(()=>this.insertEmbed(t,e,i||{}))}delete(t,e){if(e===0)return;const i=this.doc;i!==null?Yt(i,o=>{Xn(o,Qe(o,this,t,!0),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,i){if(e===0)return;const o=this.doc;o!==null?Yt(o,c=>{const p=Qe(c,this,t,!1);p.right!==null&&$n(c,this,p,e,i)}):this._pending.push(()=>this.format(t,e,i))}removeAttribute(t){this.doc!==null?Yt(this.doc,e=>{Je(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?Yt(this.doc,i=>{ln(i,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return an(this,t)}getAttributes(){return zn(this)}_write(t){t.writeTypeRef(Qs)}}const Ls=r=>new Ie;class hn{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Te||e.constructor===ke)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ke extends re{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ke}clone(){const t=new ke;return t.insert(0,this.toArray().map(e=>e instanceof re?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new hn(this,t)}querySelector(t){t=t.toUpperCase();const i=new hn(this,o=>o.nodeName&&o.nodeName.toUpperCase()===t).next();return i.done?null:i.value}querySelectorAll(t){return t=t.toUpperCase(),ft.HT(new hn(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Ye(this,t,new Ms(this,e,t))}toString(){return Bn(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},i){const o=t.createDocumentFragment();return i!==void 0&&i._createAssociation(o,this),Be(this,c=>{o.insertBefore(c.toDOM(t,e,i),null)}),o}insert(t,e){this.doc!==null?Yt(this.doc,i=>{Vn(i,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)Yt(this.doc,i=>{const o=t&&t instanceof re?t._item:t;Ge(i,this,o,e)});else{const i=this._prelimContent,o=t===null?0:i.findIndex(c=>c===t)+1;if(o===0&&t!==null)throw d.vt("Reference item not found");i.splice(o,0,...e)}}delete(t,e=1){this.doc!==null?Yt(this.doc,i=>{Wn(i,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return jn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Fn(this,t)}slice(t=0,e=this.length){return Nn(this,t,e)}forEach(t){Be(this,t)}_write(t){t.writeTypeRef(qs)}}const Us=r=>new ke;class Te extends ke{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((i,o)=>{this.setAttribute(o,i)}),this._prelimAttrs=null}_copy(){return new Te(this.nodeName)}clone(){const t=new Te(this.nodeName),e=this.getAttributes();return R.jJ(e,(i,o)=>{typeof i=="string"&&t.setAttribute(o,i)}),t.insert(0,this.toArray().map(i=>i instanceof re?i.clone():i)),t}toString(){const t=this.getAttributes(),e=[],i=[];for(const S in t)i.push(S);i.sort();const o=i.length;for(let S=0;S<o;S++){const A=i[S];e.push(A+'="'+t[A]+'"')}const c=this.nodeName.toLocaleLowerCase(),p=e.length>0?" "+e.join(" "):"";return`<${c}${p}>${super.toString()}</${c}>`}removeAttribute(t){this.doc!==null?Yt(this.doc,e=>{Je(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?Yt(this.doc,i=>{ln(i,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return an(this,t)}hasAttribute(t){return Hn(this,t)}getAttributes(t){return t?Ss(this,t):zn(this)}toDOM(t=document,e={},i){const o=t.createElement(this.nodeName),c=this.getAttributes();for(const p in c){const S=c[p];typeof S=="string"&&o.setAttribute(p,S)}return Be(this,p=>{o.appendChild(p.toDOM(t,e,i))}),i!==void 0&&i._createAssociation(o,this),o}_write(t){t.writeTypeRef(Xs),t.writeKey(this.nodeName)}}const xs=r=>new Te(r.readKey());class Ms extends He{constructor(t,e,i){super(t,i),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(o=>{o===null?this.childListChanged=!0:this.attributesChanged.add(o)})}}class Fe extends Ce{constructor(t){super(),this.hookName=t}_copy(){return new Fe(this.hookName)}clone(){const t=new Fe(this.hookName);return this.forEach((e,i)=>{t.set(i,e)}),t}toDOM(t=document,e={},i){const o=e[this.hookName];let c;return o!==void 0?c=o.createDom(this):c=document.createElement(this.hookName),c.setAttribute("data-yjs-hook",this.hookName),i!==void 0&&i._createAssociation(c,this),c}_write(t){t.writeTypeRef(Zs),t.writeKey(this.hookName)}}const Ns=r=>new Fe(r.readKey());class Xe extends Ie{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Xe}clone(){const t=new Xe;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,i){const o=t.createTextNode(this.toString());return i!==void 0&&i._createAssociation(o,this),o}toString(){return this.toDelta().map(t=>{const e=[];for(const o in t.attributes){const c=[];for(const p in t.attributes[o])c.push({key:p,value:t.attributes[o][p]});c.sort((p,S)=>p.key<S.key?-1:1),e.push({nodeName:o,attrs:c})}e.sort((o,c)=>o.nodeName<c.nodeName?-1:1);let i="";for(let o=0;o<e.length;o++){const c=e[o];i+=`<${c.nodeName}`;for(let p=0;p<c.attrs.length;p++){const S=c.attrs[p];i+=` ${S.key}="${S.value}"`}i+=">"}i+=t.insert;for(let o=e.length-1;o>=0;o--)i+=`</${e[o].nodeName}>`;return i}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(tr)}}const js=r=>new Xe;class fn{constructor(t,e){this.id=t,this.length=e}get deleted(){throw d.bD()}mergeWith(t){return!1}write(t,e,i){throw d.bD()}integrate(t,e){throw d.bD()}}const Bs=0;class ae extends fn{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),_n(t.doc.store,this)}write(t,e){t.writeInfo(Bs),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Oe{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Oe(this.content)}splice(t){throw d.bD()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const Fs=r=>new Oe(r.readBuf());class Le{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Le(this.len)}splice(t){const e=new Le(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){St(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Ps=r=>new Le(r.readLen()),qn=(r,t)=>new et({guid:r,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ue{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ue(qn(this.doc.guid,this.opts))}splice(t){throw d.bD()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Vs=r=>new Ue(qn(r.readString(),r.readAny()));class ve{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ve(this.embed)}splice(t){throw d.bD()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const Ws=r=>new ve(r.readJSON());class Zt{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Zt(this.key,this.value)}splice(t){throw d.bD()}mergeWith(t){return!1}integrate(t,e){const i=e.parent;i._searchMarker=null,i._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const zs=r=>new Zt(r.readKey(),r.readJSON());class Pe{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Pe(this.arr)}splice(t){const e=new Pe(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const i=this.arr.length;t.writeLen(i-e);for(let o=e;o<i;o++){const c=this.arr[o];t.writeString(c===void 0?"undefined":JSON.stringify(c))}}getRef(){return 2}}const Hs=r=>{const t=r.readLen(),e=[];for(let i=0;i<t;i++){const o=r.readString();o==="undefined"?e.push(void 0):e.push(JSON.parse(o))}return new Pe(e)};class Ee{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ee(this.arr)}splice(t){const e=new Ee(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const i=this.arr.length;t.writeLen(i-e);for(let o=e;o<i;o++){const c=this.arr[o];t.writeAny(c)}}getRef(){return 8}}const Ks=r=>{const t=r.readLen(),e=[];for(let i=0;i<t;i++)e.push(r.readAny());return new Ee(e)};class fe{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new fe(this.str)}splice(t){const e=new fe(this.str.slice(t));this.str=this.str.slice(0,t);const i=this.str.charCodeAt(t-1);return i>=55296&&i<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",e.str="\uFFFD"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Ys=r=>new fe(r.readString()),Gs=[ks,Rs,Ls,xs,Us,Ns,js],Js=0,$s=1,Qs=2,Xs=3,qs=4,Zs=5,tr=6;class pe{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new pe(this.type._copy())}splice(t){throw d.bD()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(i=>{i.deleted?i.id.clock<(t.beforeState.get(i.id.client)||0)&&t._mergeStructs.push(i):i.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(i=>{for(;i!==null;)i.gc(t,!0),i=i.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const er=r=>new pe(Gs[r.readTypeRef()](r)),pn=(r,t)=>{let e=t,i=0,o;do i>0&&(e=yt(e.client,e.clock+i)),o=De(r,e),i=e.clock-o.id.clock,e=o.redone;while(e!==null&&o instanceof Gt);return{item:o,diff:i}},gn=(r,t)=>{for(;r!==null&&r.keep!==t;)r.keep=t,r=r.parent._item},qe=(r,t,e)=>{const{client:i,clock:o}=t.id,c=new Gt(yt(i,o+e),t,yt(i,o+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&c.markDeleted(),t.keep&&(c.keep=!0),t.redone!==null&&(c.redone=yt(t.redone.client,t.redone.clock+e)),t.right=c,c.right!==null&&(c.right.left=c),r._mergeStructs.push(c),c.parentSub!==null&&c.right===null&&c.parent._map.set(c.parentSub,c),t.length=e,c},Zn=(r,t)=>ft.zN(r,e=>X(e.deletions,t)),ts=(r,t,e,i,o,c)=>{const p=r.doc,S=p.store,A=p.clientID,W=t.redone;if(W!==null)return ce(r,W);let B=t.parent._item,F=null,q;if(B!==null&&B.deleted===!0){if(B.redone===null&&(!e.has(B)||ts(r,B,e,i,o,c)===null))return null;for(;B.redone!==null;)B=ce(r,B.redone)}const dt=B===null?t.parent:B.content.type;if(t.parentSub===null){for(F=t.left,q=t;F!==null;){let Ft=F;for(;Ft!==null&&Ft.parent._item!==B;)Ft=Ft.redone===null?null:ce(r,Ft.redone);if(Ft!==null&&Ft.parent._item===B){F=Ft;break}F=F.left}for(;q!==null;){let Ft=q;for(;Ft!==null&&Ft.parent._item!==B;)Ft=Ft.redone===null?null:ce(r,Ft.redone);if(Ft!==null&&Ft.parent._item===B){q=Ft;break}q=q.right}}else if(q=null,t.right&&!o){for(F=t;F!==null&&F.right!==null&&(F.right.redone||X(i,F.right.id)||Zn(c.undoStack,F.right.id)||Zn(c.redoStack,F.right.id));)for(F=F.right;F.redone;)F=ce(r,F.redone);if(F&&F.right!==null)return null}else F=dt._map.get(t.parentSub)||null;const gt=$t(S,A),Vt=yt(A,gt),Ot=new Gt(Vt,F,F&&F.lastId,q,q&&q.id,dt,t.parentSub,t.content.copy());return t.redone=Vt,gn(Ot,!0),Ot.integrate(r,0),Ot};class Gt extends fn{constructor(t,e,i,o,c,p,S,A){super(t,A.getLength()),this.origin=i,this.left=e,this.right=o,this.rightOrigin=c,this.parent=p,this.parentSub=S,this.redone=null,this.content=A,this.info=this.content.isCountable()?m.KD:0}set marker(t){(this.info&m.wn)>0!==t&&(this.info^=m.wn)}get marker(){return(this.info&m.wn)>0}get keep(){return(this.info&m.Dk)>0}set keep(t){this.keep!==t&&(this.info^=m.Dk)}get countable(){return(this.info&m.KD)>0}get deleted(){return(this.info&m.D1)>0}set deleted(t){this.deleted!==t&&(this.info^=m.D1)}markDeleted(){this.info|=m.D1}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=$t(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=$t(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===bt&&this.id.client!==this.parent.client&&this.parent.clock>=$t(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=vn(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ce(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ae||this.right&&this.right.constructor===ae)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Gt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Gt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===bt){const i=De(e,this.parent);i.constructor===ae?this.parent=null:this.parent=i.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=vn(t,t.doc.store,yt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let i=this.left,o;if(i!==null)o=i.right;else if(this.parentSub!==null)for(o=this.parent._map.get(this.parentSub)||null;o!==null&&o.left!==null;)o=o.left;else o=this.parent._start;const c=new Set,p=new Set;for(;o!==null&&o!==this.right;){if(p.add(o),c.add(o),Mt(this.origin,o.origin)){if(o.id.client<this.id.client)i=o,c.clear();else if(Mt(this.rightOrigin,o.rightOrigin))break}else if(o.origin!==null&&p.has(De(t.doc.store,o.origin)))c.has(De(t.doc.store,o.origin))||(i=o,c.clear());else break;o=o.right}this.left=i}if(this.left!==null){const i=this.left.right;this.right=i,this.left.right=this}else{let i;if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start,this.parent._start=this;this.right=i}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),_n(t.doc.store,this),this.content.integrate(t,this),Cn(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ae(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:yt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Mt(t.origin,this.lastId)&&this.right===t&&Mt(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(i=>{i.p===t&&(i.p=this,!this.deleted&&this.countable&&(i.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),St(t.deleteSet,this.id.client,this.id.clock,this.length),Cn(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw d.Mq();this.content.gc(t),e?os(t,this,new ae(this.id,this.length)):this.content=new Le(this.length)}write(t,e){const i=e>0?yt(this.id.client,this.id.clock+e-1):this.origin,o=this.rightOrigin,c=this.parentSub,p=this.content.getRef()&m.WY|(i===null?0:m.wt)|(o===null?0:m.D7)|(c===null?0:m.KJ);if(t.writeInfo(p),i!==null&&t.writeLeftID(i),o!==null&&t.writeRightID(o),i===null&&o===null){const S=this.parent;if(S._item!==void 0){const A=S._item;if(A===null){const W=se(S);t.writeParentInfo(!0),t.writeString(W)}else t.writeParentInfo(!1),t.writeLeftID(A.id)}else S.constructor===String?(t.writeParentInfo(!0),t.writeString(S)):S.constructor===bt?(t.writeParentInfo(!1),t.writeLeftID(S)):d.Mq();c!==null&&t.writeString(c)}this.content.write(t,e)}}const es=(r,t)=>nr[t&m.WY](r),nr=[()=>{d.Mq()},Ps,Hs,Fs,Ys,Ws,zs,er,Ks,Vs,()=>{d.Mq()}],sr=10;class le extends fn{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){d.Mq()}write(t,e){t.writeInfo(sr),I.zd(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const ns=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof J.g!="undefined"?J.g:{},ss="__ $YJS$ __";ns[ss]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),ns[ss]=!0}}]);})();
