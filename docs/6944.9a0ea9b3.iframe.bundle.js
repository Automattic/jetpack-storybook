"use strict";(()=>{var re=Object.defineProperty;var oe=(D,S,a)=>S in D?re(D,S,{enumerable:!0,configurable:!0,writable:!0,value:a}):D[S]=a;var Lt=(D,S,a)=>(oe(D,typeof S!="symbol"?S+"":S,a),a);(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[6944],{"../connection/components/use-connection/index.jsx":(D,S,a)=>{a.d(S,{Z:()=>E});var p=a("../api/index.jsx"),u=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-dispatch/use-dispatch.js"),C=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),I=a("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),c=a("../connection/state/store.jsx");const d=window!=null&&window.JP_CONNECTION_INITIAL_STATE?window.JP_CONNECTION_INITIAL_STATE:{},E=function(){let{registrationNonce:N=d.registrationNonce,apiRoot:L=d.apiRoot,apiNonce:f=d.apiNonce,redirectUri:g,autoTrigger:Z,from:P,skipUserConnection:R}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{registerSite:$,connectUser:w,refreshConnectedPlugins:b}=(0,u.Z)(c.t),V=(0,C.Z)(_=>_(c.t).getRegistrationError()),{siteIsRegistering:k,userIsConnecting:H,userConnectionData:U,connectedPlugins:j,connectionErrors:et,isRegistered:y,isUserConnected:F,hasConnectedOwner:x,isOfflineMode:B}=(0,C.Z)(_=>({siteIsRegistering:_(c.t).getSiteIsRegistering(),userIsConnecting:_(c.t).getUserIsConnecting(),userConnectionData:_(c.t).getUserConnectionData(),connectedPlugins:_(c.t).getConnectedPlugins(),connectionErrors:_(c.t).getConnectionErrors(),isOfflineMode:_(c.t).getIsOfflineMode(),..._(c.t).getConnectionStatus()})),h=()=>{if(R){if(g)return window.location=g,Promise.resolve(g)}else return w({from:P,redirectUri:g});return Promise.resolve()},v=_=>(_&&_.preventDefault(),y?h():$({registrationNonce:N,redirectUri:g}).then(()=>h()));return(0,I.useEffect)(()=>{p.ZP.setApiRoot(L),p.ZP.setApiNonce(f)},[L,f]),(0,I.useEffect)(()=>{Z&&!k&&!H&&v()},[]),{handleRegisterSite:v,handleConnectUser:h,refreshConnectedPlugins:b,isRegistered:y,isUserConnected:F,siteIsRegistering:k,userIsConnecting:H,registrationError:V,userConnectionData:U,hasConnectedOwner:x,connectedPlugins:j,connectionErrors:et,isOfflineMode:B}}},"../connection/state/store.jsx":(D,S,a)=>{a.d(S,{t:()=>J});var p=a("../api/index.jsx");const u="SET_CONNECTION_STATUS",C="SET_CONNECTION_STATUS_IS_FETCHING",I="FETCH_CONNECTION_STATUS",c="SET_SITE_IS_REGISTERING",d="SET_USER_IS_CONNECTING",E="SET_REGISTRATION_ERROR",N="CLEAR_REGISTRATION_ERROR",L="REGISTER_SITE",f="SET_AUTHORIZATION_URL",g="CONNECT_USER",Z="DISCONNECT_USER_SUCCESS",P="FETCH_AUTHORIZATION_URL",R="SET_CONNECTED_PLUGINS",$="REFRESH_CONNECTED_PLUGINS",w="SET_CONNECTION_ERRORS",b="SET_IS_OFFLINE_MODE",V=n=>({type:u,connectionStatus:n}),k=n=>({type:C,isFetching:n}),H=()=>({type:I}),U=n=>({type:c,isRegistering:n}),j=n=>({type:d,isConnecting:n}),et=()=>({type:Z}),y=n=>({type:E,registrationError:n}),F=()=>({type:N}),x=n=>({type:f,authorizationUrl:n}),B=n=>({type:P,redirectUri:n}),h=n=>({type:R,connectedPlugins:n}),v=n=>({type:w,connectionErrors:n}),_=n=>({type:b,isOfflineMode:n});function K(){let{from:n,redirectFunc:o,redirectUri:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){yield j(!0),yield{type:g,from:n,redirectFunc:o,redirectUri:l}}()}function Tt(n){let{registrationNonce:o,redirectUri:l}=n;return function*(){yield F(),yield U(!0);try{const A=yield{type:L,registrationNonce:o,redirectUri:l};return yield V({isRegistered:!0}),yield x(A.authorizeUrl),yield U(!1),Promise.resolve(A)}catch(A){return yield y(A),yield U(!1),Promise.reject(A)}}()}const st={setConnectionStatus:V,setConnectionStatusIsFetching:k,fetchConnectionStatus:H,fetchAuthorizationUrl:B,setSiteIsRegistering:U,setUserIsConnecting:j,setRegistrationError:y,clearRegistrationError:F,setAuthorizationUrl:x,registerSite:Tt,connectUser:K,disconnectUserSuccess:et,setConnectedPlugins:h,refreshConnectedPlugins:()=>async n=>{let{dispatch:o}=n;return await new Promise(l=>p.ZP.fetchConnectedPlugins().then(A=>{o(h(A)),l(A)}))},setConnectionErrors:v,setIsOfflineMode:_};var pt=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/factory.js");const J="jetpack-connection",St=n=>{let{registrationNonce:o,redirectUri:l}=n;return p.ZP.registerSite(o,l)},Ct=(0,pt.R)(n=>{let{resolveSelect:o}=n;return function(){let{from:l,redirectFunc:A,redirectUri:z}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((dt,vt)=>{o(J).getAuthorizationUrl(z).then(q=>{const at=A||(Mt=>window.location.assign(Mt)),Dt=new URL(q);l&&Dt.searchParams.set("from",encodeURIComponent(l));const gt=Dt.toString();at(gt),dt(gt)}).catch(q=>{vt(q)})})}}),At={FETCH_AUTHORIZATION_URL:n=>{let{redirectUri:o}=n;return p.ZP.fetchAuthorizationUrl(o)},REGISTER_SITE:St,CONNECT_USER:Ct};var ct=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const It=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case u:return{...n,...o.connectionStatus};case Z:return{...n,isUserConnected:!1}}return n},ft=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case R:return o.connectedPlugins}return n},Pt=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case C:return o.isFetching}return n},ot=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case c:return o.isRegistering}return n},Rt=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case d:return o.isConnecting}return n},Y=(n,o)=>{switch(o.type){case N:return!1;case E:return o.registrationError;default:return n}},Ot=(n,o)=>{switch(o.type){case f:return o.authorizationUrl;default:return n}},Q=(n,o)=>{switch(o.type){default:return n}},Nt=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;switch(o.type){case w:return o.connectionErrors}return n},G=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case b:return o.isConnecting}return n},bt=(0,ct.UY)({connectionStatus:It,connectionStatusIsFetching:Pt,siteIsRegistering:ot,userIsConnecting:Rt,registrationError:Y,authorizationUrl:Ot,userConnectionData:Q,connectedPlugins:ft,connectionErrors:Nt,isOfflineMode:G});var kt=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/select.js"),Ht=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/dispatch.js");const xt={...{getAuthorizationUrl:{isFulfilled:function(n){const o=!!n.authorizationUrl;for(var l=arguments.length,A=new Array(l>1?l-1:0),z=1;z<l;z++)A[z-1]=arguments[z];const dt=(0,kt.Y)(J).hasFinishedResolution("getAuthorizationUrl",A);return o&&!dt&&(0,Ht.W)(J).finishResolution("getAuthorizationUrl",A),o},*fulfill(n){const o=yield st.fetchAuthorizationUrl(n);yield st.setAuthorizationUrl(o.authorizeUrl)}}}},yt={...{getConnectionStatus:n=>n.connectionStatus||{},getConnectionStatusIsFetching:()=>!1,getSiteIsRegistering:n=>n.siteIsRegistering||!1,getUserIsConnecting:n=>n.userIsConnecting||!1,getRegistrationError:n=>n.registrationError||!1,getAuthorizationUrl:n=>n.authorizationUrl||!1,getUserConnectionData:n=>n.userConnectionData||!1,getConnectedPlugins:n=>n.connectedPlugins||[],getConnectionErrors:n=>n.connectionErrors||[],getIsOfflineMode:n=>n.isOfflineMode||!1,getWpcomUser:n=>{var o,l;return(l=(o=n==null?void 0:n.userConnectionData)==null?void 0:o.currentUser)==null?void 0:l.wpcomUser},getBlogId:n=>{var o,l;return(l=(o=n==null?void 0:n.userConnectionData)==null?void 0:o.currentUser)==null?void 0:l.blogId}}};var ut=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");const X=class{static mayBeInit(o,l){X.store===null&&(X.store=(0,ut.Z)(o,l),(0,ct.z2)(X.store))}};let nt=X;Lt(nt,"store",null);const Ft=nt,lt=window.JP_CONNECTION_INITIAL_STATE;lt||console.error("Jetpack Connection package: Initial state is missing. Check documentation to see how to use the Connection composer package to set up the initial state."),Ft.mayBeInit(J,{__experimentalUseThunks:!0,reducer:bt,actions:st,selectors:yt,resolvers:xt,controls:At,initialState:lt||{}})},"../../packages/my-jetpack/_inc/components/product-card/action-button.jsx":(D,S,a)=>{a.d(S,{N:()=>E,Z:()=>L});var p=a("../components/components/button/index.tsx"),u=a("../../../node_modules/.pnpm/@wordpress+i18n@4.41.0/node_modules/@wordpress/i18n/build-module/index.js"),C=a("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),I=a("../../packages/my-jetpack/_inc/hooks/use-product/index.js"),c=a("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const d=u.__,E={ACTIVE:"active",INACTIVE:"inactive",ERROR:"error",ABSENT:"plugin_absent",ABSENT_WITH_PLAN:"plugin_absent_with_plan",NEEDS_PURCHASE:"needs_purchase",NEEDS_PURCHASE_OR_FREE:"needs_purchase_or_free",CAN_UPGRADE:"can_upgrade"},N=f=>{let{status:g,admin:Z,name:P,slug:R,onActivate:$,onManage:w,onFixConnection:b,isFetching:V,isInstallingStandalone:k,isDeactivatingStandalone:H,className:U,onAdd:j}=f;const{detail:et}=(0,I.i)(R),{manageUrl:y,purchaseUrl:F}=et,x=!y,B=V||k||H,h={variant:B?void 0:"primary",disabled:B,className:U};if(!Z)return(0,c.jsx)(p.Z,{...h,size:"small",variant:"link",weight:"regular",children:(0,u.gB)(d("Learn about %s","jetpack-my-jetpack"),P)});switch(g){case E.ABSENT:case E.ABSENT_WITH_PLAN:return(0,c.jsxs)(p.Z,{...h,href:`#/add-${R}`,size:"small",variant:"link",weight:"regular",children:[g===E.ABSENT&&(0,u.gB)(d("Get %s","jetpack-my-jetpack"),P),g===E.ABSENT_WITH_PLAN&&(0,u.gB)(d("Install %s","jetpack-my-jetpack"),P)]});case E.NEEDS_PURCHASE:case E.CAN_UPGRADE:{const v=d("Upgrade","jetpack-my-jetpack"),_=d("Purchase","jetpack-my-jetpack"),K=F?v:_;return(0,c.jsx)(p.Z,{...h,href:F||`#/add-${R}`,size:"small",weight:"regular",onClick:j,children:K})}case E.NEEDS_PURCHASE_OR_FREE:return(0,c.jsx)(p.Z,{...h,href:`#/add-${R}`,size:"small",weight:"regular",onClick:j,children:d("Start for free","jetpack-my-jetpack")});case E.ACTIVE:{const v=d("View","jetpack-my-jetpack"),_=d("Manage","jetpack-my-jetpack"),K=F?v:_;return(0,c.jsx)(p.Z,{...h,disabled:x||(h==null?void 0:h.disabled),size:"small",weight:"regular",variant:"secondary",href:y,onClick:w,children:K})}case E.ERROR:return(0,c.jsx)(p.Z,{...h,href:"#/connection",size:"small",weight:"regular",onClick:b,children:d("Fix connection","jetpack-my-jetpack")});case E.INACTIVE:return(0,c.jsx)(p.Z,{...h,size:"small",weight:"regular",variant:"secondary",onClick:$,children:d("Activate","jetpack-my-jetpack")});default:return null}};N.__docgenInfo={description:"",methods:[],displayName:"ActionButton"};const L=N},"../../packages/my-jetpack/_inc/hooks/use-product/index.js":(D,S,a)=>{a.d(S,{i:()=>I});var p=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-dispatch/use-dispatch.js"),u=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/components/use-select/index.js"),C=a("../../packages/my-jetpack/_inc/state/store.js");function I(c){const{activateProduct:d,deactivateProduct:E,installStandalonePluginForProduct:N,deactivateStandalonePluginForProduct:L}=(0,p.Z)(C.t),f=(0,u.Z)(g=>g(C.t).getProduct(c));return{activate:()=>d(c),deactivate:()=>E(c),deactivateStandalonePlugin:()=>L(c),installStandalonePlugin:()=>N(c),productsList:(0,u.Z)(g=>g(C.t).getProducts()),detail:f,isActive:f.status==="active",isFetching:(0,u.Z)(g=>g(C.t).isFetching(c)),stats:(0,u.Z)(g=>g(C.t).getProductStats(c))}}},"../../packages/my-jetpack/_inc/state/store.js":(D,S,a)=>{a.d(S,{t:()=>Vt,N:()=>se});var p=a("../connection/state/store.jsx"),u=a("../../../node_modules/.pnpm/@wordpress+api-fetch@6.38.0/node_modules/@wordpress/api-fetch/build-module/index.js"),C=a("../../../node_modules/.pnpm/@wordpress+i18n@4.41.0/node_modules/@wordpress/i18n/build-module/index.js");const I="my-jetpack/v1",c=`${I}/site/purchases`,d=`${I}/site/products`,E=`${I}/site/product-data`,N=`${I}/chat/availability`,L=`${I}/chat/authentication`,f=["scan"],g="videopress",Z="videopress/v1/stats/featured",P=C.__,R="SET_PURCHASES_IS_FETCHING",$="FETCH_PURCHASES",w="SET_PURCHASES",b="SET_AVAILABLE_LICENSES_IS_FETCHING",V="FETCH_AVAILABLE_LICENSES",k="SET_AVAILABLE_LICENSES",H="SET_IS_FETCHING_PRODUCT",U="SET_PRODUCT",j="SET_PRODUCT_REQUEST_ERROR",et="ACTIVATE_PRODUCT",y="SET_PRODUCT_STATUS",F="SET_CHAT_AVAILABILITY_IS_FETCHING",x="SET_CHAT_AVAILABILITY",B="SET_CHAT_AUTHENTICATION_IS_FETCHING",h="SET_CHAT_AUTHENTICATION",v="SET_PRODUCT_DATA_IS_FETCHING",_="SET_PRODUCT_DATA",K="SET_GLOBAL_NOTICE",Tt="CLEAN_GLOBAL_NOTICE",mt="SET_PRODUCT_STATS",st="SET_IS_FETCHING_PRODUCT_STATS",pt=t=>({type:R,isFetching:t}),jt=t=>({type:F,isFetching:t}),J=t=>({type:B,isFetching:t}),St=t=>({type:v,isFetching:t}),Ct=()=>({type:$}),wt=t=>({type:w,purchases:t}),At=t=>({type:x,chatAvailability:t}),ct=t=>({type:h,chatAuthentication:t}),It=t=>({type:b,isFetching:t}),ft=()=>({type:V}),Pt=t=>({type:k,availableLicenses:t}),ot=t=>({type:U,product:t}),Rt=t=>({type:_,productData:t}),Y=(t,e)=>({type:j,productId:t,error:e}),Ot=(t,e)=>({type:y,productId:t,status:e}),Q=(t,e)=>({type:"SET_GLOBAL_NOTICE",message:t,options:e}),Nt=()=>({type:"CLEAN_GLOBAL_NOTICE"});function G(t,e){return{type:H,productId:t,isFetching:e}}function Ut(t,e,r){let{select:s,dispatch:i,registry:T}=r;return new Promise((M,W)=>{if(!s.isValidProduct(t)){const O=P("Invalid product name","jetpack-my-jetpack"),ht=new Error(O);i(Y(t,ht)),i(Q(O,{status:"error",isDismissible:!0})),W(ht);return}const rt=e.activate?"POST":"DELETE";return i(G(t,!0)),(0,u.Z)({path:`${d}/${t}`,method:rt}).then(O=>{i(G(t,!1)),i(ot(O)),T.dispatch(p.t).refreshConnectedPlugins(),M(O==null?void 0:O.status)}).catch(O=>{const{name:ht}=s.getProduct(t),ne=(0,C.gB)(P("Failed to activate %1$s. Please try again","jetpack-my-jetpack"),ht);i(G(t,!1)),i(Y(t,O)),i(Q(ne,{status:"error",isDismissible:!0})),W(O)})})}const Bt={setPurchasesIsFetching:pt,setChatAvailabilityIsFetching:jt,setChatAuthenticationIsFetching:J,fetchPurchases:Ct,setPurchases:wt,setChatAvailability:At,setChatAuthentication:ct,setProductDataIsFetching:St,setProductData:Rt,setAvailableLicensesIsFetching:It,fetchAvailableLicenses:ft,setAvailableLicenses:Pt,setProductStats:(t,e)=>({type:mt,productId:t,stats:e}),setIsFetchingProductStats:(t,e)=>({type:st,productId:t,isFetching:e}),...{setGlobalNotice:Q,cleanGlobalNotice:Nt},...{setProduct:ot,activateProduct:t=>async e=>await Ut(t,{activate:!0},e),deactivateStandalonePluginForProduct:t=>async e=>await Ut(t,{activate:!1},e),installStandalonePluginForProduct:t=>async e=>{const{select:r,dispatch:s,registry:i}=e;return await new Promise((T,M)=>{if(!r.isValidProduct(t)){const m=P("Invalid product name","jetpack-my-jetpack"),rt=new Error(m);s(Y(t,rt)),s(Q(m,{status:"error",isDismissible:!0})),M(rt);return}return s(G(t,!0)),(0,u.Z)({path:`${d}/${t}/install-standalone`,method:"POST"}).then(m=>{s(G(t,!1)),s(ot(m)),i.dispatch(p.t).refreshConnectedPlugins(),T(m==null?void 0:m.standalone_plugin_info)}).catch(m=>{const{name:rt}=r.getProduct(t),O=(0,C.gB)(P("Failed to install standalone plugin for %1$s: %2$s. Please try again","jetpack-my-jetpack"),rt,m.message);s(G(t,!1)),s(Y(t,m)),s(Q(O,{status:"error",isDismissible:!0})),M(m)})})},setIsFetchingProduct:G,setRequestProductError:Y,setProductStatus:Ot}};function Gt(){return new Promise((t,e)=>{(0,u.Z)({path:c}).then(t).catch(e)})}const yt={[$]:Gt};var ut=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const nt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case H:{const{productId:r,isFetching:s}=e;return{...t,isFetching:{...t.isFetching,[r]:s},errors:{...t.errors,[r]:s?void 0:t.errors[r]}}}case y:{const{productId:r,status:s}=e;return{...t,items:{...t.items,[r]:{...t.items[r],status:s}}}}case U:{const{product:r}=e,{slug:s}=r;return{...t,items:{...t.items,[s]:r}}}case j:{const{productId:r,error:s}=e;return{...t,errors:{...t.errors,[r]:s}}}default:return t}},Ft=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case v:return{...t,isFetching:e.isFetching};case _:return{...t,items:(e==null?void 0:e.productData)||{}};default:return t}},lt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case R:return{...t,isFetching:e.isFetching};case w:return{...t,items:(e==null?void 0:e.purchases)||[]};default:return t}},X=function(){var r;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{isFetching:!1,isAvailable:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case F:return{...t,isFetching:e.isFetching};case x:return{...t,isAvailable:(r=e==null?void 0:e.chatAvailability)==null?void 0:r.is_available};default:return t}},n=function(){var r,s;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{isFetching:!1,jwt:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case B:return{...t,isFetching:e.isFetching};case h:return{...t,jwt:(s=(r=e==null?void 0:e.chatAuthentication)==null?void 0:r.user)==null?void 0:s.jwt};default:return t}},o=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case b:return{...t,isFetching:e.isFetching};case k:return{...t,items:(e==null?void 0:e.availableLicenses)||[]};default:return t}},l=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{global:{}},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case K:{const{message:r,options:s}=e;return{...t,global:{message:r,options:s}}}case Tt:return{...t,global:{}};default:return t}},A=function(){return arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}},z=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case st:{const{productId:r,isFetching:s}=e;return{...t,isFetching:{...t.isFetching,[r]:s}}}case mt:{const{productId:r,stats:s}=e;return{...t,items:{...t.items,[r]:s}}}default:return t}},vt=(0,ut.UY)({products:nt,productData:Ft,purchases:lt,chatAvailability:X,chatAuthentication:n,availableLicenses:o,notices:l,plugins:A,stats:z});var q=a("../api/index.jsx"),at=a("../../packages/my-jetpack/_inc/components/product-card/action-button.jsx");const gt=async()=>(0,u.Z)({path:Z}),Kt=async t=>t===g?gt():null,Jt=C.__,Yt={...{getProduct:{isFulfilled:(t,e)=>{var s;return(((s=t==null?void 0:t.products)==null?void 0:s.items)||{}).hasOwnProperty(e)&&!f.includes(e)},fulfill:t=>async e=>{let{dispatch:r}=e;try{r.setIsFetchingProduct(t,!0);const s=await(0,u.Z)({path:`${d}/${t}`});return r.setProduct(s),r.setIsFetchingProduct(t,!1),Promise.resolve()}catch(s){if(r.setIsFetchingProduct(t,!1),s!=null&&s.code&&(s!=null&&s.message))return r.setRequestProductError(t,s),Promise.reject(s);throw new Error(s)}}},getPurchases:()=>async t=>{let{dispatch:e}=t;e.setPurchasesIsFetching(!0);try{e.setPurchases(await(0,u.Z)({path:c})),e.setPurchasesIsFetching(!1)}catch(r){e.setPurchasesIsFetching(!1),r.code!=="not_connected"&&e.setGlobalNotice(Jt("There was an error fetching your purchases information. Check your site connectivity and try again.","jetpack-my-jetpack"),{status:"error"})}},getChatAvailability:()=>async t=>{let{dispatch:e}=t;e.setChatAvailabilityIsFetching(!0);try{e.setChatAvailability(await(0,u.Z)({path:N})),e.setChatAvailabilityIsFetching(!1)}catch(r){e.setChatAvailabilityIsFetching(!1)}},getChatAuthentication:()=>async t=>{let{dispatch:e}=t;e.setChatAuthenticationIsFetching(!0);try{e.setChatAuthentication(await(0,u.Z)({path:L})),e.setChatAuthenticationIsFetching(!1)}catch(r){e.setChatAuthenticationIsFetching(!1)}},getAvailableLicenses:()=>async t=>{let{dispatch:e}=t;e.setAvailableLicensesIsFetching(!0);try{const{apiRoot:r,apiNonce:s}=(window==null?void 0:window.myJetpackRest)||{};q.ZP.setApiRoot(r),q.ZP.setApiNonce(s);const i=await q.ZP.getUserLicenses();i&&i.items?e.setAvailableLicenses(i.items.filter(T=>{let{attached_at:M,revoked_at:W}=T;return M===null&&W===null})):e.setAvailableLicenses([])}catch(r){e.setAvailableLicenses([])}finally{e.setAvailableLicensesIsFetching(!1)}},getProductData:()=>async t=>{let{dispatch:e}=t;e.setProductDataIsFetching(!0);try{e.setProductData(await(0,u.Z)({path:E})),e.setProductDataIsFetching(!1)}catch(r){e.setProductDataIsFetching(!1)}}},getProductStats:{isFulfilled:(t,e)=>{var r,s;return((s=(r=t.stats)==null?void 0:r.items)==null?void 0:s.hasOwnProperty(e))||!1},fulfill:t=>async e=>{let{dispatch:r,select:s}=e;const{status:i}=s.getProduct(t);if(i!==at.N.ACTIVE)return r.setProductStats(t,null),Promise.resolve();try{r.setIsFetchingProductStats(t,!0);const T=await Kt(t);return r.setProductStats(t,T),r.setIsFetchingProductStats(t,!1),Promise.resolve()}catch(T){if(r.setProductStats(t,null),r.setIsFetchingProductStats(t,!1),T!=null&&T.code&&(T!=null&&T.message))return Promise.reject(T);throw new Error(T)}}}};function Qt(t){return t.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace("_",""))}function Xt(t){return t.indexOf("_")!==-1}function tt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=Object.assign({},t);for(const s in r)r.hasOwnProperty(s)&&Xt(s)&&(r[Qt(s)]=r[s],e&&delete r[s]);return r}const _t=t=>{var e;return((e=t.products)==null?void 0:e.items)||{}},Zt=t=>Object.keys(_t(t)),qt={...{getProducts:_t,getProductNames:Zt,getProduct:(t,e)=>{var i,T;const r=((i=_t(t))==null?void 0:i[e])||{},s=tt(r,!0);return s.standalonePluginInfo=tt(s.standalonePluginInfo||{},!0),s.pricingForUi=tt(s.pricingForUi||{},!0),s.pricingForUi.introductoryOffer=s.pricingForUi.isIntroductoryOffer?tt(s.pricingForUi.introductoryOffer,!0):null,(T=s.pricingForUi)!=null&&T.tiers&&(s.pricingForUi.tiers=tt(s.pricingForUi.tiers,!0),s.pricingForUi.tiers=Object.keys(s.pricingForUi.tiers).reduce((M,W)=>{const m=tt(s.pricingForUi.tiers[W],!0)||{};return M[W]={...m,introductoryOffer:m!=null&&m.isIntroductoryOffer?tt(m==null?void 0:m.introductoryOffer,!0):null},M},{})),s.features=s.features||[],s.supportedProducts=s.supportedProducts||[],s.pricingForUi.fullPricePerMonth=s.pricingForUi.productTerm==="year"?Math.ceil(s.pricingForUi.fullPrice/12*100)/100:s.pricingForUi.fullPrice,s.pricingForUi.discountPricePerMonth=s.pricingForUi.productTerm==="year"?Math.ceil(s.pricingForUi.discountPrice/12*100)/100:s.pricingForUi.discountPrice,s},isValidProduct:(t,e)=>Zt(t).includes(e),isFetching:(t,e)=>{var r,s;return((s=(r=t.products)==null?void 0:r.isFetching)==null?void 0:s[e])||!1},getProductsThatRequiresUserConnection:t=>{const e=_t(t);return Object.keys(e).reduce((r,s)=>{const i=e[s];return(i==null?void 0:i.requires_user_connection)&&((i==null?void 0:i.status)===at.N.ACTIVE||(i==null?void 0:i.status)===at.N.ERROR)&&r.push(i==null?void 0:i.name),r},[])}},...{getPurchases:t=>{var e;return((e=t.purchases)==null?void 0:e.items)||[]},isRequestingPurchases:t=>{var e;return((e=t.purchases)==null?void 0:e.isFetching)||!1}},...{getChatAvailability:t=>t.chatAvailability.isAvailable,isRequestingChatAvailability:t=>t.chatAvailability.isFetching},...{getChatAuthentication:t=>t.chatAuthentication.jwt,isRequestingChatAuthentication:t=>t.chatAuthentication.isFetching},...{getProductData:t=>{var e;return((e=t.productData)==null?void 0:e.items)||{}},isFetchingProductData:t=>{var e;return((e=t.productData)==null?void 0:e.isFetching)||!1}},...{getAvailableLicenses:t=>{var e;return((e=t.availableLicenses)==null?void 0:e.items)||[]},isFetchingAvailableLicenses:t=>{var e;return((e=t.availableLicenses)==null?void 0:e.isFetching)||!1}},...{getGlobalNotice:t=>{var e;return(e=t.notices)==null?void 0:e.global}},...{hasStandalonePluginInstalled:t=>Object.values(t.plugins).filter(e=>["jetpack-backup","jetpack-boost","jetpack-protect","jetpack-search","jetpack-social","jetpack-videopress"].indexOf(e.TextDomain)>=0).length>0},...{getProductStats:(t,e)=>{var r,s;return(s=(r=t.stats)==null?void 0:r.items)==null?void 0:s[e]},isFetchingProductStats:(t,e)=>{var r,s;return((s=(r=t.stats)==null?void 0:r.isFetching)==null?void 0:s[e])||!1}}};var te=a("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");const it=class{static mayBeInit(e,r){it.store===null&&(it.store=(0,te.Z)(e,r),(0,ut.z2)(it.store))}};let Et=it;Lt(Et,"store",null);const ee=Et,Vt="my-jetpack";function se(){ee.mayBeInit(Vt,{__experimentalUseThunks:!0,reducer:vt,actions:Bt,selectors:qt,resolvers:Yt,controls:yt,initialState:window.myJetpackInitialState||{}})}}}]);})();
