"use strict";(()=>{(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[2993],{"../../plugins/protect/src/js/state/store.js":(Me,ne,u)=>{u.d(ne,{t:()=>te,N:()=>He});var se=u("../../../node_modules/.pnpm/camelize@1.0.1/node_modules/camelize/index.js"),_=u.n(se),c=u("../../../node_modules/.pnpm/@wordpress+api-fetch@6.27.0/node_modules/@wordpress/api-fetch/build-module/index.js"),p=u("../../../node_modules/.pnpm/@wordpress+i18n@4.30.0/node_modules/@wordpress/i18n/build-module/index.js");const ae=p._n,i=p.__,E="SET_CREDENTIALS_STATE_IS_FETCHING",I="SET_CREDENTIALS_STATE",y="SET_STATUS",A="SET_STATUS_PROGRESS",N="START_SCAN_OPTIMISTICALLY",P="SET_STATUS_IS_FETCHING",w="SET_SCAN_IS_UNAVAILABLE",U="SET_SCAN_IS_ENQUEUING",C="SET_INSTALLED_PLUGINS",k="SET_INSTALLED_THEMES",F="SET_WP_VERSION",R="SET_JETPACK_SCAN",Ze="SET_PRODUCT_DATA",W="SET_THREAT_IS_UPDATING",L="SET_THREATS_ARE_FIXING",j="SET_MODAL",G="SET_NOTICE",b="CLEAR_NOTICE",v="SET_HAS_REQUIRED_PLAN",O="SET_WAF_IS_SEEN",x="SET_WAF_UPGRADE_IS_SEEN",D="SET_WAF_IS_ENABLED",H="SET_WAF_IS_UPDATING",M="SET_WAF_IS_TOGGLING",Z="SET_WAF_CONFIG",V="SET_WAF_STATS",B=e=>({type:y,status:e}),re=e=>({type:A,currentProgress:e}),J=()=>({type:N}),ue=()=>e=>{let{dispatch:t}=e;(0,c.Z)({path:"jetpack-protect/v1/check-plan",method:"GET"}).then(n=>t(K(n)))},z=e=>(0,c.Z)({path:`jetpack-protect/v1/status${e?"?hard_refresh=true":""}`,method:"GET"}),g=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return async t=>{let{dispatch:n}=t;return n(m(!0)),await new Promise((s,a)=>z(e).then($).then(r=>{n(q(r.status==="unavailable")),n(B(_()(r))),s(r)}).catch(r=>{a(r)}).finally(()=>{n(m(!1))}))}},$=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return new Promise((n,s)=>{e.status==="unavailable"&&t<3?z(!0).then(a=>{setTimeout(()=>{$(a,t+1).then(r=>n(r)).catch(r=>s(r))},5e3)}).catch(s):n(e)})},ce=()=>async e=>{let{dispatch:t}=e;return await new Promise((n,s)=>(t(h(!0)),(0,c.Z)({path:"jetpack-protect/v1/check-credentials",method:"POST"}).then(a=>{t(Q(a)),n(a)}).catch(a=>{s(a)}).finally(()=>{t(h(!1))})))},h=e=>({type:E,isFetching:e}),Q=e=>({type:I,credentials:e}),m=e=>({type:P,status:e}),q=e=>({type:w,status:e}),S=e=>({type:U,isEnqueuing:e}),oe=e=>({type:C,plugins:e}),ie=e=>({type:k,themes:e}),le=e=>({type:F,version:e}),ge=e=>({type:R,scan:e}),d=(e,t)=>({type:W,payload:{threatId:e,isUpdating:t}}),T=e=>({type:L,threatIds:e}),de=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>{};return async n=>{let{dispatch:s}=n;return s(d(e,!0)),await new Promise(()=>(0,c.Z)({path:`jetpack-protect/v1/ignore-threat?threat_id=${e}`,method:"POST"}).then(()=>s(g())).then(()=>s(o({type:"success",message:i("Threat ignored","jetpack-protect")}))).catch(()=>s(o({type:"error",message:i("An error ocurred ignoring the threat.","jetpack-protect")}))).finally(()=>{s(d(e,!1)),t()}))}},Y=e=>async t=>{let{dispatch:n}=t;const s=e.reduce((a,r)=>`${a}threat_ids[]=${r}&`,"jetpack-protect/v1/fix-threats-status?");return n(T(e)),await(0,c.Z)({path:s,method:"GET"}).then(async a=>{const r=Object.values(a.threats);if(r.filter(f=>f.status==="in_progress").length>0)return await new Promise(()=>{setTimeout(()=>{n(Y(e))},1e3)});if(!r.filter(f=>f.status==="fixed").length===e.length)throw"Not all threats could be fixed."}).then(()=>{n(g()),n(o({type:"success",message:(0,p.gB)(ae("%s threat was fixed successfully","%s threats were fixed successfully",e.length,"jetpack-protect"),e.length)}))}).catch(()=>{n(o({type:"error",message:i("Not all threats could be fixed. Please contact our support.","jetpack-protect")}))}).finally(()=>{n(T([]))})},pe=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>{};return async n=>{let{dispatch:s}=n;return e.forEach(a=>{s(d(a,!0))}),await new Promise(()=>(0,c.Z)({path:`jetpack-protect/v1/fix-threats?threat_ids=${e}`,method:"POST",data:{threatIds:e}}).then(()=>s(o({type:"success",message:i("We're hard at work fixing this threat in the background. Please check back shortly.","jetpack-protect")}))).then(()=>{setTimeout(()=>s(Y(e)),1e3)}).catch(()=>s(o({type:"error",message:i("Error fixing threats. Please contact support.","jetpack-protect")}))).finally(()=>{e.forEach(a=>{s(d(a,!1))}),t()}))}},he=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:()=>{};return async t=>{let{dispatch:n}=t;return n(S(!0)),await new Promise(()=>(0,c.Z)({path:"jetpack-protect/v1/scan",method:"POST"}).then(()=>{n(J()),setTimeout(()=>n(g(!0)),5e3)}).catch(()=>n(o({type:"error",message:i("An error ocurred enqueuing the scan","jetpack-protect")}))).finally(()=>{n(S(!1)),e()}))}},me=e=>({type:j,payload:e}),o=e=>({type:G,payload:e}),Se=()=>({type:b}),K=e=>({type:v,hasRequiredPlan:e}),X={checkCredentials:ce,setCredentials:Q,setCredentialsIsFetching:h,setStatus:B,setStatusProgress:re,startScanOptimistically:J,refreshStatus:g,setStatusIsFetching:m,setScanIsEnqueuing:S,setInstalledPlugins:oe,setInstalledThemes:ie,setwpVersion:le,setJetpackScan:ge,ignoreThreat:de,setModal:me,setNotice:o,clearNotice:Se,fixThreats:pe,scan:he,setThreatsAreFixing:T,refreshPlan:ue,setHasRequiredPlan:K,setScanIsUnavailable:q,setWafIsEnabled:e=>({type:D,isEnabled:e}),setWafIsSeen:e=>({type:O,isSeen:e}),setWafUpgradeIsSeen:e=>({type:x,upgradeIsSeen:e}),setWafIsUpdating:e=>({type:H,isUpdating:e}),setWafIsToggling:e=>({type:M,isToggling:e}),setWafConfig:e=>({type:Z,config:e}),setWafStats:e=>({type:V,stats:e})};var ee=u("../../../node_modules/.pnpm/@wordpress+data@9.0.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const Te=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return t.credentials}return e},fe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return t.isFetching}return e},_e=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return t.status;case A:return{...e,currentProgress:t.currentProgress};case N:return{...e,currentProgress:0,status:"optimistically_scanning"}}return e},Ee=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return t.status}return e},Ie=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return t.status}return e},ye=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return t.isEnqueuing}return e},Ae=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return t.plugins}return e},Ne=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return t.themes}return e},Pe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return t.version}return e},we=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.scan}return e},Ue=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case W:return{...e,[t.payload.threatId]:t.payload.isUpdating}}return e},Ce=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return t.threatIds}return e},ke=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return{...e,...t.payload}}return e},Fe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return{...e,...t.payload};case b:return{}}return e},Re=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:return t.hasRequiredPlan}return e},We={isSupported:null,isSeen:!1,upgradeIsSeen:!1,isEnabled:!1,isUpdating:!1,isToggling:!1,config:void 0,stats:void 0},Le=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:We,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return{...e,isSeen:t.isSeen};case x:return{...e,upgradeIsSeen:t.upgradeIsSeen};case D:return{...e,isEnabled:t.isEnabled};case Z:return{...e,config:t.config};case V:return{...e,stats:t.stats};case H:return{...e,isUpdating:t.isUpdating};case M:return{...e,isToggling:t.isToggling}}return e},je=(0,ee.UY)({credentials:Te,credentialsIsFetching:fe,status:_e,statusIsFetching:Ee,scanIsUnavailable:Ie,scanIsEnqueuing:ye,installedPlugins:Ae,installedThemes:Ne,wpVersion:Pe,jetpackScan:we,threatsUpdating:Ue,modal:ke,notice:Fe,setThreatsFixing:Ce,hasRequiredPlan:Re,waf:Le}),Ge={getJetpackScan:{isFulfilled:e=>Object.keys(e==null?void 0:e.jetpackScan).length>0,fulfill:()=>async e=>{let{dispatch:t}=e;const n=await(0,c.Z)({path:"/my-jetpack/v1/site/products/scan",method:"GET"});t(X.setJetpackScan(n))}}},be={getCredentials:e=>e.credentials||null,getCredentialsIsFetching:e=>e.credentialsIsFetching||!1,getInstalledPlugins:e=>e.installedPlugins||{},getInstalledThemes:e=>e.installedThemes||{},getStatus:e=>e.status||{},getStatusIsFetching:e=>e.statusIsFetching||!1,getScanIsUnavailable:e=>e.scanIsUnavailable||!1,getScanIsEnqueuing:e=>e.scanIsEnqueuing||!1,getWpVersion:e=>e.wpVersion||"",getJetpackScan:e=>e.jetpackScan||{},getThreatsUpdating:e=>e.threatsUpdating||{},getModalType:e=>{var t;return((t=e.modal)==null?void 0:t.type)||null},getModalProps:e=>{var t;return((t=e.modal)==null?void 0:t.props)||{}},getNotice:e=>e.notice||null,getThreatsAreFixing:e=>e.threatsAreFixing||[],hasRequiredPlan:e=>e.hasRequiredPlan||!1,getWaf:e=>e.waf};var ve=u("../../../node_modules/.pnpm/@babel+runtime@7.21.5/node_modules/@babel/runtime/helpers/defineProperty.js"),Oe=u.n(ve),xe=u("../../../node_modules/.pnpm/@wordpress+data@9.0.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");class l{static mayBeInit(t,n){l.store===null&&(l.store=(0,xe.Z)(t,n),(0,ee.z2)(l.store))}}Oe()(l,"store",null);const De=l,te="jetpack-protect";function He(){De.mayBeInit(te,{__experimentalUseThunks:!0,reducer:je,actions:X,selectors:be,resolvers:Ge,initialState:_()(window.jetpackProtectInitialState)||{}})}}}]);})();
