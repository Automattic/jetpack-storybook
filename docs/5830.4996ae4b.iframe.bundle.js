"use strict";(()=>{var Ze=Object.defineProperty;var Ve=(l,c,u)=>c in l?Ze(l,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[c]=u;var re=(l,c,u)=>(Ve(l,typeof c!="symbol"?c+"":c,u),u);(self.webpackChunk_automattic_jetpack_storybook=self.webpackChunk_automattic_jetpack_storybook||[]).push([[5830],{"../../plugins/protect/src/js/state/store.js":(l,c,u)=>{u.d(c,{t:()=>ae,N:()=>Me});var ue=u("../../../node_modules/.pnpm/camelize@1.0.1/node_modules/camelize/index.js"),A=u.n(ue),i=u("../../../node_modules/.pnpm/@wordpress+api-fetch@6.38.0/node_modules/@wordpress/api-fetch/build-module/index.js"),m=u("../../../node_modules/.pnpm/@wordpress+i18n@4.41.0/node_modules/@wordpress/i18n/build-module/index.js");const ce=m._n,g=m.__,y="SET_CREDENTIALS_STATE_IS_FETCHING",N="SET_CREDENTIALS_STATE",P="SET_STATUS",w="SET_STATUS_PROGRESS",U="START_SCAN_OPTIMISTICALLY",k="SET_STATUS_IS_FETCHING",C="SET_SCAN_IS_UNAVAILABLE",F="SET_SCAN_IS_ENQUEUING",R="SET_INSTALLED_PLUGINS",W="SET_INSTALLED_THEMES",L="SET_WP_VERSION",j="SET_JETPACK_SCAN",Be="SET_PRODUCT_DATA",G="SET_THREAT_IS_UPDATING",b="SET_THREATS_ARE_FIXING",O="SET_MODAL",v="SET_NOTICE",x="CLEAR_NOTICE",D="SET_HAS_REQUIRED_PLAN",H="SET_WAF_IS_SEEN",M="SET_WAF_UPGRADE_IS_SEEN",Z="SET_WAF_IS_ENABLED",V="SET_WAF_IS_UPDATING",B="SET_WAF_IS_TOGGLING",J="SET_WAF_CONFIG",q="SET_WAF_STATS",z=e=>({type:P,status:e}),ie=e=>({type:w,currentProgress:e}),$=()=>({type:U}),oe=()=>e=>{let{dispatch:t}=e;(0,i.Z)({path:"jetpack-protect/v1/check-plan",method:"GET"}).then(n=>t(te(n)))},Q=e=>(0,i.Z)({path:`jetpack-protect/v1/status${e?"?hard_refresh=true":""}`,method:"GET"}),p=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return async t=>{let{dispatch:n}=t;return n(f(!0)),await new Promise((s,a)=>Q(e).then(Y).then(r=>{n(X(r.status==="unavailable")),n(z(A()(r))),s(r)}).catch(r=>{a(r)}).finally(()=>{n(f(!1))}))}},Y=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return new Promise((n,s)=>{e.status==="unavailable"&&t<3?Q(!0).then(a=>{setTimeout(()=>{Y(a,t+1).then(r=>n(r)).catch(r=>s(r))},5e3)}).catch(s):n(e)})},le=()=>async e=>{let{dispatch:t}=e;return await new Promise((n,s)=>(t(T(!0)),(0,i.Z)({path:"jetpack-protect/v1/check-credentials",method:"POST"}).then(a=>{t(K(a)),n(a)}).catch(a=>{s(a)}).finally(()=>{t(T(!1))})))},T=e=>({type:y,isFetching:e}),K=e=>({type:N,credentials:e}),f=e=>({type:k,status:e}),X=e=>({type:C,status:e}),_=e=>({type:F,isEnqueuing:e}),ge=e=>({type:R,plugins:e}),de=e=>({type:W,themes:e}),pe=e=>({type:L,version:e}),he=e=>({type:j,scan:e}),h=(e,t)=>({type:G,payload:{threatId:e,isUpdating:t}}),E=e=>({type:b,threatIds:e}),Se=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>{};return async n=>{let{dispatch:s}=n;return s(h(e,!0)),await new Promise(()=>(0,i.Z)({path:`jetpack-protect/v1/ignore-threat?threat_id=${e}`,method:"POST"}).then(()=>s(p())).then(()=>s(o({type:"success",message:g("Threat ignored","jetpack-protect")}))).catch(()=>s(o({type:"error",message:g("An error ocurred ignoring the threat.","jetpack-protect")}))).finally(()=>{s(h(e,!1)),t()}))}},ee=e=>async t=>{let{dispatch:n}=t;const s=e.reduce((a,r)=>`${a}threat_ids[]=${r}&`,"jetpack-protect/v1/fix-threats-status?");return n(E(e)),await(0,i.Z)({path:s,method:"GET"}).then(async a=>{const r=Object.values(a.threats);if(r.filter(I=>I.status==="in_progress").length>0)return await new Promise(()=>{setTimeout(()=>{n(ee(e))},1e3)});if(!r.filter(I=>I.status==="fixed").length===e.length)throw"Not all threats could be fixed."}).then(()=>{n(p()),n(o({type:"success",message:(0,m.gB)(ce("%s threat was fixed successfully","%s threats were fixed successfully",e.length,"jetpack-protect"),e.length)}))}).catch(()=>{n(o({type:"error",message:g("Not all threats could be fixed. Please contact our support.","jetpack-protect")}))}).finally(()=>{n(E([]))})},me=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>{};return async n=>{let{dispatch:s}=n;return e.forEach(a=>{s(h(a,!0))}),await new Promise(()=>(0,i.Z)({path:`jetpack-protect/v1/fix-threats?threat_ids=${e}`,method:"POST",data:{threatIds:e}}).then(()=>s(o({type:"success",message:g("We're hard at work fixing this threat in the background. Please check back shortly.","jetpack-protect")}))).then(()=>{setTimeout(()=>s(ee(e)),1e3)}).catch(()=>s(o({type:"error",message:g("Error fixing threats. Please contact support.","jetpack-protect")}))).finally(()=>{e.forEach(a=>{s(h(a,!1))}),t()}))}},Te=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:()=>{};return async t=>{let{dispatch:n}=t;return n(_(!0)),await new Promise(()=>(0,i.Z)({path:"jetpack-protect/v1/scan",method:"POST"}).then(()=>{n($()),setTimeout(()=>n(p(!0)),5e3)}).catch(()=>n(o({type:"error",message:g("An error ocurred enqueuing the scan","jetpack-protect")}))).finally(()=>{n(_(!1)),e()}))}},fe=e=>({type:O,payload:e}),o=e=>({type:v,payload:e}),_e=()=>({type:x}),te=e=>({type:D,hasRequiredPlan:e}),ne={checkCredentials:le,setCredentials:K,setCredentialsIsFetching:T,setStatus:z,setStatusProgress:ie,startScanOptimistically:$,refreshStatus:p,setStatusIsFetching:f,setScanIsEnqueuing:_,setInstalledPlugins:ge,setInstalledThemes:de,setwpVersion:pe,setJetpackScan:he,ignoreThreat:Se,setModal:fe,setNotice:o,clearNotice:_e,fixThreats:me,scan:Te,setThreatsAreFixing:E,refreshPlan:oe,setHasRequiredPlan:te,setScanIsUnavailable:X,setWafIsEnabled:e=>({type:Z,isEnabled:e}),setWafIsSeen:e=>({type:H,isSeen:e}),setWafUpgradeIsSeen:e=>({type:M,upgradeIsSeen:e}),setWafIsUpdating:e=>({type:V,isUpdating:e}),setWafIsToggling:e=>({type:B,isToggling:e}),setWafConfig:e=>({type:J,config:e}),setWafStats:e=>({type:q,stats:e})};var se=u("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/index.js");const Ee=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return t.credentials}return e},Ie=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return t.isFetching}return e},Ae=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return t.status;case w:return{...e,currentProgress:t.currentProgress};case U:return{...e,currentProgress:0,status:"optimistically_scanning"}}return e},ye=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return t.status}return e},Ne=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return t.status}return e},Pe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return t.isEnqueuing}return e},we=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.plugins}return e},Ue=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case W:return t.themes}return e},ke=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return t.version}return e},Ce=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return t.scan}return e},Fe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return{...e,[t.payload.threatId]:t.payload.isUpdating}}return e},Re=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return t.threatIds}return e},We=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return{...e,...t.payload}}return e},Le=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:return{...e,...t.payload};case x:return{}}return e},je=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return t.hasRequiredPlan}return e},Ge={wafSupported:null,bruteForceSupported:null,isSeen:!1,upgradeIsSeen:!1,isEnabled:!1,isUpdating:!1,isToggling:!1,config:void 0,stats:void 0},be=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:return{...e,isSeen:t.isSeen};case M:return{...e,upgradeIsSeen:t.upgradeIsSeen};case Z:return{...e,isEnabled:t.isEnabled};case J:return{...e,config:t.config};case q:return{...e,stats:t.stats};case V:return{...e,isUpdating:t.isUpdating};case B:return{...e,isToggling:t.isToggling}}return e},Oe=(0,se.UY)({credentials:Ee,credentialsIsFetching:Ie,status:Ae,statusIsFetching:ye,scanIsUnavailable:Ne,scanIsEnqueuing:Pe,installedPlugins:we,installedThemes:Ue,wpVersion:ke,jetpackScan:Ce,threatsUpdating:Fe,modal:We,notice:Le,setThreatsFixing:Re,hasRequiredPlan:je,waf:be}),ve={getJetpackScan:{isFulfilled:e=>Object.keys(e==null?void 0:e.jetpackScan).length>0,fulfill:()=>async e=>{let{dispatch:t}=e;const n=await(0,i.Z)({path:"/my-jetpack/v1/site/products/scan",method:"GET"});t(ne.setJetpackScan(n))}}},xe={getCredentials:e=>e.credentials||null,getCredentialsIsFetching:e=>e.credentialsIsFetching||!1,getInstalledPlugins:e=>e.installedPlugins||{},getInstalledThemes:e=>e.installedThemes||{},getStatus:e=>e.status||{},getStatusIsFetching:e=>e.statusIsFetching||!1,getScanIsUnavailable:e=>e.scanIsUnavailable||!1,getScanIsEnqueuing:e=>e.scanIsEnqueuing||!1,getWpVersion:e=>e.wpVersion||"",getJetpackScan:e=>e.jetpackScan||{},getThreatsUpdating:e=>e.threatsUpdating||{},getModalType:e=>{var t;return((t=e.modal)==null?void 0:t.type)||null},getModalProps:e=>{var t;return((t=e.modal)==null?void 0:t.props)||{}},getNotice:e=>e.notice||null,getThreatsAreFixing:e=>e.threatsAreFixing||[],hasRequiredPlan:e=>e.hasRequiredPlan||!1,getWaf:e=>e.waf};var De=u("../../../node_modules/.pnpm/@wordpress+data@9.11.0_react@18.2.0/node_modules/@wordpress/data/build-module/redux-store/index.js");const d=class{static mayBeInit(t,n){d.store===null&&(d.store=(0,De.Z)(t,n),(0,se.z2)(d.store))}};let S=d;re(S,"store",null);const He=S,ae="jetpack-protect";function Me(){He.mayBeInit(ae,{__experimentalUseThunks:!0,reducer:Oe,actions:ne,selectors:xe,resolvers:ve,initialState:A()(window.jetpackProtectInitialState)||{}})}}}]);})();
